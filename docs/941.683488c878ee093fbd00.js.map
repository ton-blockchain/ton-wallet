{"version":3,"file":"941.683488c878ee093fbd00.js","mappings":";UAAIA,ECAAC,kDCEG,MAAMC,WAA2BC,MAClC,CAAC,oBAAqB,kBAAkBC,SAASC,KAAKC,SAASC,gICQ9D,SAASC,EAAoBC,GAClC,OAAKA,GACEC,EAAAA,EAAAA,GAAaD,GADE,EAExB,CAEA,SAASE,EAA8BC,EAAYC,EAAiBC,GAClE,MAAMC,EAAQH,EAAKI,UAEbC,EAAQF,EAAMG,SAAS,GACvBC,EAAQJ,EAAMG,SAAS,GAE7B,GAAID,IAAUJ,GAAWM,IAAUL,EACjC,MAAM,IAAIM,MAAM,mCAGlB,OA0KF,SAAsBL,GACpBA,EAAMG,SAAS,GACf,IAAIG,EAAIN,EAAMO,YAAY,GACtBD,EAAI,OACNA,GAAK,MAGP,MAAME,EAAWR,EAAMO,YAAY,KACnC,GAAqD,OAAjD,GAAGD,EAAEG,SAAS,OAAOD,EAASC,SAAS,MACzC,OAEF,MAAMC,EAAI,GAAGJ,EAAEG,SAAS,OAAOD,EAASC,SAAS,IAAIE,SAAS,GAAI,OAClE,OAAOC,EAAAA,QAAQC,MAAMH,EACvB,CAvLSI,CAAad,EACtB,CAMA,SAASe,EAAwBlB,GAC/B,OAAOD,EAA8BC,EAAM,IAAM,IACnD,CAEA,SAASmB,EAAwBnB,GAC/B,MAAMG,EAAQH,EAAKI,UACbC,EAAQF,EAAMG,SAAS,GACvBC,EAAQJ,EAAMG,SAAS,GAE7B,GAAc,MAAVD,GAA4B,MAAVE,EACpB,MAAM,IAAIC,MAAM,mCAIlB,OADeL,EAAMiB,WAAW,GAClBR,SAAS,MACzB,CA2BAS,eAAeC,EACbC,EACAC,EACAC,EACA5B,EACA6B,GAEA,MAAMC,EAA8B,EAAxBF,EAAeG,OAErBC,GAAa,IAAIC,EAAAA,SACpBC,YAAYN,GACZO,SAEGC,EAAiBrC,EAAoBC,IACrC,MAAEqC,SAAgBX,EAAOY,cAAcpB,EAAAA,QAAQC,MAAMQ,GAAa,aAAc,CACpF,CAAEY,KAAM,QAASpC,KAAM6B,GACvB,CAAEO,KAAM,MAAOC,MAAOJ,KAGlBK,EAAYJ,EAAMK,aAExB,IAAIvC,EAEJ,IACEA,EAAOkC,EAAMM,UACf,CAAE,MAAOC,GACP,CAGF,GAAkB,IAAdH,EAAJ,CAIA,GAAIA,EAAY,GAAM,EACpB,MAAM,IAAI9B,MAAM,4CAKlB,GAAI8B,EAAYX,EACd,MAAM,IAAInB,MAAM,oBAAoB8B,KAAaX,KAC5C,GAAIW,IAAcX,EACvB,OAAI9B,IAAa6C,EAAAA,GAAYC,gBACpB3C,EAAOkB,EAAwBlB,QAAQ4C,EACrC/C,IAAa6C,EAAAA,GAAYG,OAC3B7C,EA3Fb,SAAyCA,GACvC,OAAOD,EAA8BC,EAAM,IAAM,IACnD,CAyFoB8C,CAAgC9C,QAAQ4C,EAC7C/C,IAAa6C,EAAAA,GAAYK,KAC3B/C,EAxEb,SAAyBA,GACvB,MAAMG,EAAQH,EAAKI,UACbC,EAAQF,EAAMG,SAAS,GACvBC,EAAQJ,EAAMG,SAAS,GAE7B,OAAc,MAAVD,GAA4B,IAAVE,EAOxB,SAAgCP,GAC9B,MAAMG,EAAQH,EAAKI,UACbC,EAAQF,EAAMG,SAAS,GACvBC,EAAQJ,EAAMG,SAAS,GAE7B,GAAc,MAAVD,GAA4B,IAAVE,EACpB,MAAM,IAAIC,MAAM,mCAIlB,OADeL,EAAMiB,WAAW,GAClBR,SAAS,MACzB,CAjBWoC,CAAuBhD,GAEvBmB,EAAwBnB,EAEnC,CA8DoBiD,CAAgBjD,QAAQ4C,EAC7B/C,IAAa6C,EAAAA,GAAYQ,MAC3BlD,EAAOmB,EAAwBnB,QAAQ4C,EAEvC5C,EAEJ,GAAKA,EAEL,CACL,MAAMmD,EAAcjC,EAAwBlB,GAC5C,OAAI0B,EACE7B,IAAa6C,EAAAA,GAAYC,gBACpBQ,OAEP,EAGK7B,EAAeC,EAAQ4B,EAAYvC,WAAYa,EAAetB,MAAMmC,EAAY,GAAIzC,GAAU,EAEzG,CAnCA,CAoCF,CAGO,SAASuD,EAAaC,GAC3B,IAAKA,IAAWA,EAAOzB,OACrB,MAAM,IAAIpB,MAAM,gBAElB,GAAe,MAAX6C,EACF,MAAO,GAGTA,EAASA,EAAOC,cAEhB,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAOzB,OAAQ2B,IACjC,GAAIF,EAAOG,WAAWD,IAAM,GAC1B,MAAM,IAAI/C,MAAM,wDAIpB,IAAK,IAAI+C,EAAI,EAAGA,EAAIF,EAAOzB,OAAQ2B,IAAK,CACtC,MAAM1C,EAAIwC,EAAOI,UAAUF,EAAGA,EAAI,GAClC,IAAK,IAAIG,EAAI,IAAKA,GAAK,IAAKA,IAC1B,GAAI7C,IAAM8C,OAAOC,aAAaF,GAC5B,MAAM,IAAIlD,MAAM,0DAGtB,CAEA,MAAMqD,EAAMR,EAAOS,MAAM,KAQzB,OANAD,EAAIE,SAASC,IACX,IAAKA,EAAKpC,OACR,MAAM,IAAIpB,MAAM,6CAClB,IAGK,GAAGqD,EAAII,UAAUC,KAAK,SAC/B,CAEO,SAASC,EACd5C,EACA6C,EACAf,EACAxD,EACA6B,GAEA,IAAI2C,EAAYjB,EAAaC,GAK7B,OAJIgB,EAAUzC,OAAS,MACrByC,EAAY,KAAKA,KAGZ/C,EAAeC,EAAQ6C,EAAgBE,EAAOC,KAAKF,GAAYxE,EAAU6B,EAClF,0GC5LA,MAAM8C,GAA+B,gBAAZC,EAAAA,KAAyC,YAAZA,EAAAA,MAC/B,iBAAXC,SACNpF,EAAAA,EAEAqF,GAAiBC,EAAAA,EAAAA,KAAUC,GAAYH,OAAOI,MAAMD,IAAU,GAAKE,EAAAA,IAKzE,SAASC,EAAiBC,GAEpBA,aAAaC,YAA4B,uCAAdD,EAAEJ,UAIjCI,EAAEE,iBAEFC,EAAYH,aAAaC,WAAcD,EAAEI,OAASJ,EAAEJ,QAAWI,EAAEK,QACnE,CAEO,SAASF,EAAY3C,IAC1B8C,EAAAA,EAAAA,IAAc,cAAe9C,GAE7B,MAAMoC,EAAyB,iBAARpC,EAAmBA,EAAMA,EAAIoC,QAC9C3C,EAAuB,iBAARO,EAAmBA,EAAIP,WAAQU,EAEhDiC,EAAQW,SAAS,qCAIjBhB,GACFG,EAAe,GAAGc,EAAAA,UAAuBZ,GAAYpC,MAAQP,IAEjE,CA3BAzC,KAAKiG,iBAAiB,QAASV,GAC/BvF,KAAKiG,iBAAiB,qBAAsBV,kbCTrC,MAAMW,EAAiB,gBAEjBC,EAAU,YACVC,EAAwB,UACxBC,EAA6B,UAC7BC,EAA6B,UAC7BC,EAAkC,SAClCC,EAAqC,SACrCC,EAAgC,GAChCC,EAAwB,UAGxBC,EAAsB,WACtBC,EAA2B,SAC3BC,EAA8B,GAM9BC,EAA0B,IAE1BC,EAAU,CACrBC,gBAAiBb,EACjBc,kBAAmBd,EACnBe,YAAaf,EACbgB,cAAehB,EACfiB,oBAAqBC,EAAAA,GAAiBC,cACtCC,aAAcF,EAAAA,GAAiBC,cAAgBlB,EAC/CoB,eAAgBH,EAAAA,GAAiBI,gBACjCC,aAAcL,EAAAA,GAAiBM,gBAAkBN,EAAAA,GAAiBO,sBAClEC,UAAW,UACXC,YAAa1B,EAAwB,WACrC2B,mBAAoB,WACpBC,cAAe5B,EAAwB,WACvC6B,qBAAsB,WACtBC,oBAAqB,WACrBC,2BAA4B,WAgBjBC,EAAgB,IAChBC,EAAkB,IAElBC,EAAW,EAEXC,EAAmB,EACnBC,GAAwB,EAIxBC,EAAa,KAEbC,EAA6C,CACxD,WAAY,WAAY,WAAY,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,MAGjEC,EAAsB,+BAI5B,IAAKC,EAAS,SAATA,GAAS,OAATA,EAAAA,EAAS,8BAATA,EAAAA,EAAS,yBAATA,CAAS,MAKd,MAAMC,EAAYD,EAAUE,UACtBC,EAAuB,IAEvBC,EAAuB,EACvBC,EAAsB,EACtBC,EAAkB,IAExB,IAAKC,EAAM,SAANA,GAAM,OAANA,EAAAA,EAAM,qBAANA,EAAAA,EAAM,iCAANA,EAAAA,EAAM,4BAANA,EAAAA,EAAM,8BAANA,CAAM,MAONC,EAAY,SAAZA,GAAY,OAAZA,EAAAA,EAAY,+BAAZA,EAAAA,EAAY,wDAAZA,EAAAA,EAAY,+CAAZA,EAAAA,EAAY,gCAAZA,EAAAA,EAAY,wBAAZA,EAAAA,EAAY,gDAAZA,CAAY,MASZC,EAAS,SAATA,GAAS,OAATA,EAAAA,EAAS,kDAATA,EAAAA,EAAS,gDAATA,EAAAA,EAAS,gCAATA,CAAS,MAMTC,EAAmB,SAAnBA,GAAmB,OAAnBA,EAAAA,EAAmB,sCAAnBA,EAAAA,EAAmB,0CAAnBA,EAAAA,EAAmB,8BAAnBA,EAAAA,EAAmB,+BAAnBA,EAAAA,EAAmB,mCAAnBA,EAAAA,EAAmB,gDAAnBA,EAAAA,EAAmB,0BAAnBA,EAAAA,EAAmB,4BAAnBA,EAAAA,EAAmB,gDAAnBA,EAAAA,EAAmB,wBAAnBA,CAAmB,MAgBnBC,EAAmB,SAAnBA,GAAmB,OAAnBA,EAAAA,EAAmB,4CAAnBA,EAAAA,EAAmB,wCAAnBA,CAAmB,MAKnBC,EAAe,SAAfA,GAAe,OAAfA,EAAAA,EAAe,wCAAfA,CAAe,MAIfC,EAAqB,SAArBA,GAAqB,OAArBA,EAAAA,EAAqB,0BAArBA,EAAAA,EAAqB,wCAArBA,CAAqB,MAKrBC,EAAS,SAATA,GAAS,OAATA,EAAAA,EAAS,wCAATA,CAAS,MAITC,EAAc,SAAdA,GAAc,OAAdA,EAAAA,EAAc,oBAAdA,CAAc,MAIdC,EAAW,SAAXA,GAAW,OAAXA,EAAAA,EAAW,2CAAXA,CAAW,MAIXC,EAAY,SAAZA,GAAY,OAAZA,EAAY,gBAAZA,EAAY,kBAAZA,CAAY,MAKZ5G,EAAW,SAAXA,GAAW,OAAXA,EAAW,oCAAXA,EAAW,gBAAXA,EAAW,YAAXA,EAAW,gBAAXA,EAAW,kBAAXA,CAAW,MAQhB,MAAM6G,EAAkB,CAC7BV,EAAaW,SACbJ,EAAeK,IAGJC,EAAwB,CACnCC,kBAAmB,mEACnBC,OAAQ,mEACRC,KAAM,mEACNC,QAAS,oEAGEC,EAAqD,CAChEC,SAAU,CACRC,KAAM,WACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErBsH,SAAU,CACRF,KAAM,WACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErBuH,SAAU,CACRH,KAAM,WACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErBwH,KAAM,CACJJ,KAAM,OACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErByH,KAAM,CACJL,KAAM,OACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErB0H,KAAM,CACJN,KAAM,OACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErB2H,KAAM,CACJP,KAAM,OACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErB4H,KAAM,CACJR,KAAM,OACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErB6H,KAAM,CACJT,KAAM,OACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErB8H,GAAI,CACFV,KAAM,KACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErB+H,WAAY,CACVX,KAAM,aACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErBgI,cAAe,CACbZ,KAAM,gBACNC,KAAM,mEACN9H,KAAMkH,EAAawB,SAErBC,SAAU,CACRd,KAAM,WACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErBmI,WAAY,CACVf,KAAM,aACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErBoI,QAAS,CACPhB,KAAM,UACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErBqI,YAAa,CACXjB,KAAM,cACNC,KAAM,mEACN9H,KAAMkH,EAAazG,QAErBsI,WAAY,CACVlB,KAAM,aACNC,KAAM,mEACNkB,eAAe,GAEjBC,kBAAmB,CACjBpB,KAAM,oBACNC,KAAM,mEACNkB,eAAe,GAGjBE,kBAAmB,CACjBrB,KAAM,oBACNC,KAAM,mEACNkB,eAAe,GAEjBG,eAAgB,CACdtB,KAAM,iBACNC,KAAM,mEACNkB,eAAe,GAEjBI,WAAY,CACVvB,KAAM,aACNC,KAAM,mEACNkB,eAAe,GAEjBK,eAAgB,CACdxB,KAAM,iBACNC,KAAM,mEACNkB,eAAe,GAEjBM,aAAc,CACZzB,KAAM,eACNC,KAAM,mEACNkB,eAAe,GAGjBO,eAAgB,CACd1B,KAAM,iBACNC,KAAM,mEACNkB,eAAe,GAGjBQ,mBAAoB,CAClB3B,KAAM,qBACNC,KAAM,mEACNkB,eAAe,GAEjBS,aAAc,CACZ5B,KAAM,eACNC,KAAM,mEACNkB,eAAe,GAGjBU,iBAAkB,CAChB7B,KAAM,mBACNC,KAAM,mEACNkB,eAAe,kDC5TJ,MAAMW,EAOnBC,WAAAA,GACEC,KAAKC,QAAU,IAAIC,SAAQ,CAACC,EAASC,KACnCJ,KAAKI,OAASA,EACdJ,KAAKG,QAAUA,CAAO,GAE1B,CAIA,eAAOE,CAAYjK,GACjB,MAAMjD,EAAW,IAAI2M,EAErB,OADA3M,EAASgN,QAAQ/J,GACVjD,CACT,2ECfK,MAAM2F,EAAS,IAITwH,EAAO,KAHW,GAATxH,EACO,GACH,KAGSyH,EAAAA,EAAAA,IAAU,SAC3CC,EACAC,EACAC,GAIG,IAHHC,EAAiDC,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,QACpDC,EAAeD,UAAAjL,OAAA,EAAAiL,UAAA,QAAAjK,EACfmK,EAAQF,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,IAAAA,UAAA,GAER,OAAO,IAAIG,KAAKN,GAAYO,eAC1BR,EACA,CACES,KAAMP,OAAS/J,EAAY,UAC3BuK,MAAOP,QAAehK,EACtBwK,IAAKN,OAAQlK,EAAY,UACzByK,KAAMN,EAAW,eAAYnK,EAC7B0K,OAAQP,EAAW,eAAYnK,EAC/B2K,UAAW,OAGjB,mDCyQO,IAAKC,EAAoB,SAApBA,GAAoB,OAApBA,EAAAA,EAAoB,qBAApBA,EAAAA,EAAoB,qBAApBA,EAAAA,EAAoB,uBAApBA,CAAoB,s0JCzQ9BC,EAAS,IA+BTC,EAAO,YACPC,EAAUD,EAAO,WACjBE,EAAaD,EAAU,iBACvBE,EAAaF,EAAU,gBACvBG,EAAcJ,EAAO,mBAGrBK,EAAI,CAAC,EACLC,OAAY,EACZC,EAAU,uCA0HZ,SAASC,EAAMC,EAAGC,EAAIC,EAAIC,GACxB,IAAIC,EAAKJ,EAAEzK,EAGX,GADI2K,IAAOL,IAAWK,EAAKF,EAAEnC,YAAYwC,IAC9B,IAAPH,GAAmB,IAAPA,GAAmB,IAAPA,GAAmB,IAAPA,EACtC,MAAM7N,MAAMqN,GAGd,GAAIO,EAAK,EACPE,EACS,IAAPD,IAAaC,KAAUC,EAAG,KAAc,IAAPH,IAC1B,IAAPC,GAAYE,EAAG,IAAM,GACd,IAAPF,IAAaE,EAAG,GAAK,GAAe,IAAVA,EAAG,KAAaD,GAAQC,EAAG,KAAOP,KAG9DO,EAAG3M,OAAS,EAER0M,GAGFH,EAAElJ,EAAIkJ,EAAElJ,EAAImJ,EAAK,EACjBG,EAAG,GAAK,GAIRA,EAAG,GAAKJ,EAAElJ,EAAI,OAEX,GAAImJ,EAAKG,EAAG3M,OAAQ,CAazB,GAVA0M,EACS,IAAPD,GAAYE,EAAGH,IAAO,GACf,IAAPC,IAAaE,EAAGH,GAAM,GAAgB,IAAXG,EAAGH,KAC3BE,GAAQC,EAAGH,EAAK,KAAOJ,GAA0B,EAAbO,EAAGH,EAAK,MACxC,IAAPC,IAAaC,KAAUC,EAAG,IAG5BA,EAAG3M,OAASwM,EAGRE,EAGF,OAASC,IAAKH,GAAM,GAElB,GADAG,EAAGH,GAAM,EACE,IAAPA,EAAU,GACVD,EAAElJ,EACJsJ,EAAGE,QAAQ,GACX,KACF,CAKJ,IAAKL,EAAKG,EAAG3M,QAAS2M,IAAKH,IAAMG,EAAGG,KACtC,CAEA,OAAOP,CACT,CAOA,SAASQ,EAAUR,EAAGS,EAAeC,GACnC,IAAI5J,EAAIkJ,EAAElJ,EACRpE,EAAIsN,EAAEzK,EAAEQ,KAAK,IACbzD,EAAII,EAAEe,OAGR,GAAIgN,EACF/N,EAAIA,EAAEiO,OAAO,IAAMrO,EAAI,EAAI,IAAMI,EAAEV,MAAM,GAAK,KAAO8E,EAAI,EAAI,IAAM,MAAQA,OAGtE,GAAIA,EAAI,EAAG,CAChB,OAASA,GAAIpE,EAAI,IAAMA,EACvBA,EAAI,KAAOA,CACb,MAAO,GAAIoE,EAAI,EACb,KAAMA,EAAIxE,EACR,IAAKwE,GAAKxE,EAAGwE,KAAMpE,GAAK,SACfoE,EAAIxE,IACbI,EAAIA,EAAEV,MAAM,EAAG8E,GAAK,IAAMpE,EAAEV,MAAM8E,SAE3BxE,EAAI,IACbI,EAAIA,EAAEiO,OAAO,GAAK,IAAMjO,EAAEV,MAAM,IAGlC,OAAOgO,EAAEtN,EAAI,GAAKgO,EAAY,IAAMhO,EAAIA,CAC1C,CASAkN,EAAEgB,IAAM,WACN,IAAIZ,EAAI,IAAIlC,KAAKD,YAAYC,MAE7B,OADAkC,EAAEtN,EAAI,EACCsN,CACT,EAQAJ,EAAEiB,IAAM,SAAUC,GAChB,IAAIC,EACFf,EAAIlC,KACJsC,EAAKJ,EAAEzK,EACPyL,GAAMF,EAAI,IAAId,EAAEnC,YAAYiD,IAAIvL,EAChCH,EAAI4K,EAAEtN,EACNuO,EAAIH,EAAEpO,EACNwO,EAAIlB,EAAElJ,EACNqK,EAAIL,EAAEhK,EAGR,IAAKsJ,EAAG,KAAOY,EAAG,GAAI,OAAQZ,EAAG,GAAuBhL,EAAjB4L,EAAG,IAAUC,EAAL,EAG/C,GAAI7L,GAAK6L,EAAG,OAAO7L,EAKnB,GAHA2L,EAAQ3L,EAAI,EAGR8L,GAAKC,EAAG,OAAOD,EAAIC,EAAIJ,EAAQ,GAAK,EAKxC,IAHAE,GAAKC,EAAId,EAAG3M,SAAW0N,EAAIH,EAAGvN,QAAUyN,EAAIC,EAGvC/L,GAAK,IAAKA,EAAI6L,GACjB,GAAIb,EAAGhL,IAAM4L,EAAG5L,GAAI,OAAOgL,EAAGhL,GAAK4L,EAAG5L,GAAK2L,EAAQ,GAAK,EAI1D,OAAOG,GAAKC,EAAI,EAAID,EAAIC,EAAIJ,EAAQ,GAAK,CAC3C,EAOAnB,EAAEwB,IAAM,SAAUN,GAChB,IAAId,EAAIlC,KACNuD,EAAMrB,EAAEnC,YACRyD,EAAItB,EAAEzK,EACNgM,GAAKT,EAAI,IAAIO,EAAIP,IAAIvL,EACrB2L,EAAIlB,EAAEtN,GAAKoO,EAAEpO,EAAI,GAAK,EACtB8O,EAAKH,EAAII,GAEX,GAAID,MAASA,GAAMA,EAAK,GAAKA,EAAKlC,EAChC,MAAMjN,MAAMoN,GAId,IAAK8B,EAAE,GACL,MAAMlP,MAAMsN,GAId,IAAK2B,EAAE,GAGL,OAFAR,EAAEpO,EAAIwO,EACNJ,EAAEvL,EAAI,CAACuL,EAAEhK,EAAI,GACNgK,EAGT,IAAIY,EAAIC,EAAIrP,EAAGuO,EAAKe,EAClBC,EAAKN,EAAEvP,QACP8P,EAAKJ,EAAKH,EAAE9N,OACZsO,EAAKT,EAAE7N,OACPuO,EAAIV,EAAEtP,MAAM,EAAG0P,GACfO,EAAKD,EAAEvO,OACPyO,EAAIpB,EACJqB,EAAKD,EAAE3M,EAAI,GACX6M,EAAK,EACLC,EAAIb,GAAMU,EAAEpL,EAAIkJ,EAAElJ,EAAIgK,EAAEhK,GAAK,EAS/B,IAPAoL,EAAExP,EAAIwO,EACNA,EAAImB,EAAI,EAAI,EAAIA,EAGhBR,EAAGvB,QAAQ,GAGJ2B,IAAOP,GAAKM,EAAEM,KAAK,GAE1B,EAAG,CAGD,IAAKhQ,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAGvB,GAAIoP,IAAOO,EAAKD,EAAEvO,QAChBoN,EAAMa,EAAKO,EAAK,GAAK,OAErB,IAAKL,GAAM,EAAGf,EAAM,IAAKe,EAAKF,GAC5B,GAAIH,EAAEK,IAAOI,EAAEJ,GAAK,CAClBf,EAAMU,EAAEK,GAAMI,EAAEJ,GAAM,GAAK,EAC3B,KACF,CAKJ,KAAIf,EAAM,GAgBR,MAZA,IAAKc,EAAKM,GAAMP,EAAKH,EAAIM,EAAII,GAAK,CAChC,GAAID,IAAIC,GAAMN,EAAGM,GAAK,CAEpB,IADAL,EAAKK,EACEL,IAAOI,IAAIJ,IAAMI,EAAEJ,GAAM,IAC9BI,EAAEJ,GACJI,EAAEC,IAAO,EACX,CACAD,EAAEC,IAAON,EAAGM,EACd,CAEA,MAAQD,EAAE,IAAKA,EAAEO,OAIrB,CAGAJ,EAAGC,KAAQvB,EAAMvO,IAAMA,EAGnB0P,EAAE,IAAMnB,EAAKmB,EAAEC,GAAMX,EAAEQ,IAAO,EAC7BE,EAAI,CAACV,EAAEQ,GAEd,QAAUA,IAAOC,GAAMC,EAAE,KAAOnC,IAAcqB,KAc9C,OAXKiB,EAAG,IAAY,GAANC,IAGZD,EAAGI,QACHL,EAAEpL,IACFuL,KAIED,EAAKC,GAAGtC,EAAMmC,EAAGG,EAAGhB,EAAIhB,GAAI2B,EAAE,KAAOnC,GAElCqC,CACT,EAMAtC,EAAE4C,GAAK,SAAU1B,GACf,OAAuB,IAAhBhD,KAAK+C,IAAIC,EAClB,EAOAlB,EAAE6C,GAAK,SAAU3B,GACf,OAAOhD,KAAK+C,IAAIC,GAAK,CACvB,EAOAlB,EAAE8C,IAAM,SAAU5B,GAChB,OAAOhD,KAAK+C,IAAIC,IAAM,CACxB,EAMAlB,EAAE+C,GAAK,SAAU7B,GACf,OAAOhD,KAAK+C,IAAIC,GAAK,CACvB,EAOAlB,EAAEgD,IAAM,SAAU9B,GAChB,OAAOhD,KAAK+C,IAAIC,GAAK,CACvB,EAMAlB,EAAEiD,MAAQjD,EAAEkD,IAAM,SAAUhC,GAC1B,IAAI1L,EAAG6L,EAAG8B,EAAGC,EACXhD,EAAIlC,KACJuD,EAAMrB,EAAEnC,YACRyD,EAAItB,EAAEtN,EACN6O,GAAKT,EAAI,IAAIO,EAAIP,IAAIpO,EAGvB,GAAI4O,GAAKC,EAEP,OADAT,EAAEpO,GAAK6O,EACAvB,EAAEiD,KAAKnC,GAGhB,IAAIV,EAAKJ,EAAEzK,EAAEvD,QACXkR,EAAKlD,EAAElJ,EACPkK,EAAKF,EAAEvL,EACP4N,EAAKrC,EAAEhK,EAGT,IAAKsJ,EAAG,KAAOY,EAAG,GAQhB,OAPIA,EAAG,GACLF,EAAEpO,GAAK6O,EACEnB,EAAG,GACZU,EAAI,IAAIO,EAAIrB,GAEZc,EAAEpO,EAAI,EAEDoO,EAIT,GAAIQ,EAAI4B,EAAKC,EAAI,CAWf,KATIH,EAAO1B,EAAI,IACbA,GAAKA,EACLyB,EAAI3C,IAEJ+C,EAAKD,EACLH,EAAI/B,GAGN+B,EAAEjN,UACGyL,EAAID,EAAGC,KAAMwB,EAAET,KAAK,GACzBS,EAAEjN,SACJ,MAKE,IAFAmL,IAAM+B,EAAO5C,EAAG3M,OAASuN,EAAGvN,QAAU2M,EAAKY,GAAIvN,OAE1C6N,EAAIC,EAAI,EAAGA,EAAIN,EAAGM,IACrB,GAAInB,EAAGmB,IAAMP,EAAGO,GAAI,CAClByB,EAAO5C,EAAGmB,GAAKP,EAAGO,GAClB,KACF,CAgBJ,GAXIyB,IACFD,EAAI3C,EACJA,EAAKY,EACLA,EAAK+B,EACLjC,EAAEpO,GAAKoO,EAAEpO,IAON6O,GAAKN,EAAID,EAAGvN,SAAW2B,EAAIgL,EAAG3M,SAAW,EAAG,KAAO8N,KAAMnB,EAAGhL,KAAO,EAGxE,IAAKmM,EAAInM,EAAG6L,EAAIK,GAAI,CAClB,GAAIlB,IAAKa,GAAKD,EAAGC,GAAI,CACnB,IAAK7L,EAAI6L,EAAG7L,IAAMgL,IAAKhL,IAAKgL,EAAGhL,GAAK,IAClCgL,EAAGhL,GACLgL,EAAGa,IAAM,EACX,CAEAb,EAAGa,IAAMD,EAAGC,EACd,CAGA,KAAmB,IAAZb,IAAKmB,IAAWnB,EAAGG,MAG1B,KAAiB,IAAVH,EAAG,IACRA,EAAGmC,UACDY,EAeJ,OAZK/C,EAAG,KAGNU,EAAEpO,EAAI,EAGN0N,EAAK,CAAC+C,EAAK,IAGbrC,EAAEvL,EAAI6K,EACNU,EAAEhK,EAAIqM,EAECrC,CACT,EAMAlB,EAAEwD,IAAM,SAAUtC,GAChB,IAAIuC,EACFrD,EAAIlC,KACJuD,EAAMrB,EAAEnC,YACRyD,EAAItB,EAAEtN,EACN6O,GAAKT,EAAI,IAAIO,EAAIP,IAAIpO,EAEvB,IAAKoO,EAAEvL,EAAE,GACP,MAAMlD,MAAMsN,GAQd,OALAK,EAAEtN,EAAIoO,EAAEpO,EAAI,EACZ2Q,EAAmB,GAAZvC,EAAED,IAAIb,GACbA,EAAEtN,EAAI4O,EACNR,EAAEpO,EAAI6O,EAEF8B,EAAa,IAAIhC,EAAIrB,IAEzBsB,EAAID,EAAII,GACRF,EAAIF,EAAIhB,GACRgB,EAAII,GAAKJ,EAAIhB,GAAK,EAClBL,EAAIA,EAAEoB,IAAIN,GACVO,EAAII,GAAKH,EACTD,EAAIhB,GAAKkB,EAEFzD,KAAK+E,MAAM7C,EAAEsD,MAAMxC,IAC5B,EAMAlB,EAAE2D,IAAM,WACN,IAAIvD,EAAI,IAAIlC,KAAKD,YAAYC,MAE7B,OADAkC,EAAEtN,GAAKsN,EAAEtN,EACFsN,CACT,EAMAJ,EAAEqD,KAAOrD,EAAE4D,IAAM,SAAU1C,GACzB,IAAIhK,EAAGoK,EAAG6B,EACR/C,EAAIlC,KACJuD,EAAMrB,EAAEnC,YAKV,GAHAiD,EAAI,IAAIO,EAAIP,GAGRd,EAAEtN,GAAKoO,EAAEpO,EAEX,OADAoO,EAAEpO,GAAKoO,EAAEpO,EACFsN,EAAE6C,MAAM/B,GAGjB,IAAIoC,EAAKlD,EAAElJ,EACTsJ,EAAKJ,EAAEzK,EACP4N,EAAKrC,EAAEhK,EACPkK,EAAKF,EAAEvL,EAGT,IAAK6K,EAAG,KAAOY,EAAG,GAQhB,OAPKA,EAAG,KACFZ,EAAG,GACLU,EAAI,IAAIO,EAAIrB,GAEZc,EAAEpO,EAAIsN,EAAEtN,GAGLoO,EAOT,GAJAV,EAAKA,EAAGpO,QAIJ8E,EAAIoM,EAAKC,EAAI,CAUf,IATIrM,EAAI,GACNqM,EAAKD,EACLH,EAAI/B,IAEJlK,GAAKA,EACLiM,EAAI3C,GAGN2C,EAAEjN,UACKgB,KAAMiM,EAAET,KAAK,GACpBS,EAAEjN,SACJ,CAYA,IATIsK,EAAG3M,OAASuN,EAAGvN,OAAS,IAC1BsP,EAAI/B,EACJA,EAAKZ,EACLA,EAAK2C,GAGPjM,EAAIkK,EAAGvN,OAGFyN,EAAI,EAAGpK,EAAGsJ,EAAGtJ,IAAM,GAAIoK,GAAKd,IAAKtJ,GAAKsJ,EAAGtJ,GAAKkK,EAAGlK,GAAKoK,GAAK,GAAK,EAUrE,IANIA,IACFd,EAAGE,QAAQY,KACTiC,GAICrM,EAAIsJ,EAAG3M,OAAoB,IAAZ2M,IAAKtJ,IAAWsJ,EAAGG,MAKvC,OAHAO,EAAEvL,EAAI6K,EACNU,EAAEhK,EAAIqM,EAECrC,CACT,EAUAlB,EAAE6D,IAAM,SAAUnR,GAChB,IAAI0N,EAAIlC,KACN4F,EAAM,IAAI1D,EAAEnC,YAAY,KACxBiD,EAAI4C,EACJ3C,EAAQzO,EAAI,EAEd,GAAIA,MAAQA,GAAKA,GAAI,KAAcA,EA7rBvB,IA8rBV,MAAMD,MAAMmN,EAAU,YAKxB,IAFIuB,IAAOzO,GAAKA,GAGN,EAAJA,IAAOwO,EAAIA,EAAEwC,MAAMtD,IACvB1N,IAAM,GAEN0N,EAAIA,EAAEsD,MAAMtD,GAGd,OAAOe,EAAQ2C,EAAItC,IAAIN,GAAKA,CAC9B,EAUAlB,EAAE+D,KAAO,SAAU1D,EAAIC,GACrB,GAAID,MAASA,GAAMA,EAAK,GAAKA,EAAKX,EAChC,MAAMjN,MAAMmN,EAAU,aAExB,OAAOO,EAAM,IAAIjC,KAAKD,YAAYC,MAAOmC,EAAIC,EAC/C,EAYAN,EAAEG,MAAQ,SAAUyB,EAAItB,GACtB,GAAIsB,IAAO3B,EAAW2B,EAAK,OACtB,GAAIA,MAASA,GAAMA,GAAMlC,GAAUkC,EAAKlC,EAC3C,MAAMjN,MAAMoN,GAEd,OAAOM,EAAM,IAAIjC,KAAKD,YAAYC,MAAO0D,EAAK1D,KAAKhH,EAAI,EAAGoJ,EAC5D,EAOAN,EAAEgE,KAAO,WACP,IAAI5B,EAAGzM,EAAGwN,EACR/C,EAAIlC,KACJuD,EAAMrB,EAAEnC,YACRnL,EAAIsN,EAAEtN,EACNoE,EAAIkJ,EAAElJ,EACN+M,EAAO,IAAIxC,EAAI,OAGjB,IAAKrB,EAAEzK,EAAE,GAAI,OAAO,IAAI8L,EAAIrB,GAG5B,GAAItN,EAAI,EACN,MAAML,MAAMkN,EAAO,kBAQX,KAJV7M,EAAIoR,KAAKF,KAAK5D,EAAI,MAIHtN,IAAM,MACnB6C,EAAIyK,EAAEzK,EAAEQ,KAAK,KACLtC,OAASqD,EAAI,IAAIvB,GAAK,KAE9BuB,IAAMA,EAAI,GAAK,EAAI,IAAMA,EAAI,GAAS,EAAJA,GAClCkL,EAAI,IAAIX,IAFR3O,EAAIoR,KAAKF,KAAKrO,KAEI,IAAQ,MAAQ7C,EAAIA,EAAEqR,iBAAiB/R,MAAM,EAAGU,EAAEsR,QAAQ,KAAO,IAAMlN,IAEzFkL,EAAI,IAAIX,EAAI3O,EAAI,IAGlBoE,EAAIkL,EAAElL,GAAKuK,EAAII,IAAM,GAGrB,GACEsB,EAAIf,EACJA,EAAI6B,EAAKP,MAAMP,EAAEE,KAAKjD,EAAEoB,IAAI2B,WACrBA,EAAExN,EAAEvD,MAAM,EAAG8E,GAAGf,KAAK,MAAQiM,EAAEzM,EAAEvD,MAAM,EAAG8E,GAAGf,KAAK,KAE3D,OAAOgK,EAAMiC,GAAIX,EAAII,IAAM,GAAKO,EAAElL,EAAI,EAAGuK,EAAIhB,GAC/C,EAMAT,EAAE0D,MAAQ1D,EAAEqE,IAAM,SAAUnD,GAC1B,IAAIvL,EACFyK,EAAIlC,KACJuD,EAAMrB,EAAEnC,YACRuC,EAAKJ,EAAEzK,EACPyL,GAAMF,EAAI,IAAIO,EAAIP,IAAIvL,EACtB+L,EAAIlB,EAAG3M,OACP8N,EAAIP,EAAGvN,OACP2B,EAAI4K,EAAElJ,EACNmK,EAAIH,EAAEhK,EAMR,GAHAgK,EAAEpO,EAAIsN,EAAEtN,GAAKoO,EAAEpO,EAAI,GAAK,GAGnB0N,EAAG,KAAOY,EAAG,GAEhB,OADAF,EAAEvL,EAAI,CAACuL,EAAEhK,EAAI,GACNgK,EAiBT,IAbAA,EAAEhK,EAAI1B,EAAI6L,EAGNK,EAAIC,IACNhM,EAAI6K,EACJA,EAAKY,EACLA,EAAKzL,EACL0L,EAAIK,EACJA,EAAIC,EACJA,EAAIN,GAID1L,EAAI,IAAI2O,MAAMjD,EAAIK,EAAIC,GAAIN,KAAM1L,EAAE0L,GAAK,EAK5C,IAAK7L,EAAImM,EAAGnM,KAAM,CAIhB,IAHAmM,EAAI,EAGCN,EAAIK,EAAIlM,EAAG6L,EAAI7L,GAGlBmM,EAAIhM,EAAE0L,GAAKD,EAAG5L,GAAKgL,EAAGa,EAAI7L,EAAI,GAAKmM,EACnChM,EAAE0L,KAAOM,EAAI,GAGbA,EAAIA,EAAI,GAAK,EAGfhM,EAAE0L,GAAKM,CACT,CAOA,IAJIA,IAAKT,EAAEhK,EACNvB,EAAEgN,QAGFnN,EAAIG,EAAE9B,QAAS8B,IAAIH,IAAKG,EAAEgL,MAG/B,OAFAO,EAAEvL,EAAIA,EAECuL,CACT,EAUAlB,EAAEmE,cAAgB,SAAUvC,EAAItB,GAC9B,IAAIF,EAAIlC,KACNxL,EAAI0N,EAAEzK,EAAE,GAEV,GAAIiM,IAAO3B,EAAW,CACpB,GAAI2B,MAASA,GAAMA,EAAK,GAAKA,EAAKlC,EAChC,MAAMjN,MAAMoN,GAGd,IADAO,EAAID,EAAM,IAAIC,EAAEnC,YAAYmC,KAAMwB,EAAItB,GAC/BF,EAAEzK,EAAE9B,OAAS+N,GAAKxB,EAAEzK,EAAE+M,KAAK,EACpC,CAEA,OAAO9B,EAAUR,GAAG,IAAQ1N,EAC9B,EAaAsN,EAAEuE,QAAU,SAAU3C,EAAItB,GACxB,IAAIF,EAAIlC,KACNxL,EAAI0N,EAAEzK,EAAE,GAEV,GAAIiM,IAAO3B,EAAW,CACpB,GAAI2B,MAASA,GAAMA,EAAK,GAAKA,EAAKlC,EAChC,MAAMjN,MAAMoN,GAKd,IAAK+B,EAAKA,GAHVxB,EAAID,EAAM,IAAIC,EAAEnC,YAAYmC,GAAIwB,EAAKxB,EAAElJ,EAAI,EAAGoJ,IAG7BpJ,EAAI,EAAGkJ,EAAEzK,EAAE9B,OAAS+N,GAAKxB,EAAEzK,EAAE+M,KAAK,EACrD,CAEA,OAAO9B,EAAUR,GAAG,IAAS1N,EAC/B,EASAsN,EAAEwE,OAAOC,IAAI,+BAAiCzE,EAAE0E,OAAS1E,EAAEnN,SAAW,WACpE,IAAIuN,EAAIlC,KACNuD,EAAMrB,EAAEnC,YACV,OAAO2C,EAAUR,EAAGA,EAAElJ,GAAKuK,EAAIkD,IAAMvE,EAAElJ,GAAKuK,EAAImD,KAAMxE,EAAEzK,EAAE,GAC5D,EAMAqK,EAAE6E,SAAW,WACX,IAAInS,EAAIoS,OAAOlE,EAAU1C,MAAM,GAAM,IACrC,IAAgC,IAA5BA,KAAKD,YAAY8G,SAAoB7G,KAAK0E,GAAGlQ,EAAEG,YACjD,MAAMJ,MAAMkN,EAAO,wBAErB,OAAOjN,CACT,EAYAsN,EAAEgF,YAAc,SAAU3E,EAAIC,GAC5B,IAAIF,EAAIlC,KACNuD,EAAMrB,EAAEnC,YACRvL,EAAI0N,EAAEzK,EAAE,GAEV,GAAI0K,IAAOJ,EAAW,CACpB,GAAII,MAASA,GAAMA,EAAK,GAAKA,EAAKX,EAChC,MAAMjN,MAAMmN,EAAU,aAGxB,IADAQ,EAAID,EAAM,IAAIsB,EAAIrB,GAAIC,EAAIC,GACnBF,EAAEzK,EAAE9B,OAASwM,GAAKD,EAAEzK,EAAE+M,KAAK,EACpC,CAEA,OAAO9B,EAAUR,EAAGC,GAAMD,EAAElJ,GAAKkJ,EAAElJ,GAAKuK,EAAIkD,IAAMvE,EAAElJ,GAAKuK,EAAImD,KAAMlS,EACrE,EASAsN,EAAEiF,QAAU,WACV,IAAI7E,EAAIlC,KACNuD,EAAMrB,EAAEnC,YACV,IAAmB,IAAfwD,EAAIsD,OACN,MAAMtS,MAAMkN,EAAO,sBAErB,OAAOiB,EAAUR,EAAGA,EAAElJ,GAAKuK,EAAIkD,IAAMvE,EAAElJ,GAAKuK,EAAImD,IAAI,EACtD,EAMO,IAAInD,EAn7BX,SAASyD,IAQP,SAASzD,EAAI/O,GACX,IAAI0N,EAAIlC,KAGR,KAAMkC,aAAaqB,GAAM,OAAO/O,IAAMuN,EAAYiF,IAAU,IAAIzD,EAAI/O,GAGpE,GAAIA,aAAa+O,EACfrB,EAAEtN,EAAIJ,EAAEI,EACRsN,EAAElJ,EAAIxE,EAAEwE,EACRkJ,EAAEzK,EAAIjD,EAAEiD,EAAEvD,YACL,CACL,GAAiB,iBAANM,EAAgB,CACzB,IAAmB,IAAf+O,EAAIsD,QAAgC,iBAANrS,EAChC,MAAMyS,UAAUvF,EAAU,SAI5BlN,EAAU,IAANA,GAAW,EAAIA,EAAI,EAAI,KAAOkD,OAAOlD,EAC3C,EA+BN,SAAe0N,EAAG1N,GAChB,IAAIwE,EAAG1B,EAAG4P,EAEV,IAAKlF,EAAQmF,KAAK3S,GAChB,MAAMD,MAAMmN,EAAU,UAyBxB,IArBAQ,EAAEtN,EAAmB,KAAfJ,EAAEqO,OAAO,IAAarO,EAAIA,EAAEN,MAAM,IAAK,GAAK,GAG7C8E,EAAIxE,EAAE0R,QAAQ,OAAS,IAAG1R,EAAIA,EAAE4S,QAAQ,IAAK,MAG7C9P,EAAI9C,EAAE6S,OAAO,OAAS,GAGrBrO,EAAI,IAAGA,EAAI1B,GACf0B,IAAMxE,EAAEN,MAAMoD,EAAI,GAClB9C,EAAIA,EAAEgD,UAAU,EAAGF,IACV0B,EAAI,IAGbA,EAAIxE,EAAEmB,QAGRuR,EAAK1S,EAAEmB,OAGF2B,EAAI,EAAGA,EAAI4P,GAAqB,KAAf1S,EAAEqO,OAAOvL,MAAcA,EAE7C,GAAIA,GAAK4P,EAGPhF,EAAEzK,EAAI,CAACyK,EAAElJ,EAAI,OACR,CAGL,KAAOkO,EAAK,GAAuB,KAAlB1S,EAAEqO,SAASqE,KAK5B,IAJAhF,EAAElJ,EAAIA,EAAI1B,EAAI,EACd4K,EAAEzK,EAAI,GAGDuB,EAAI,EAAG1B,GAAK4P,GAAKhF,EAAEzK,EAAEuB,MAAQxE,EAAEqO,OAAOvL,IAC7C,CAGF,CA5EMvC,CAAMmN,EAAG1N,EACX,CAIA0N,EAAEnC,YAAcwD,CAClB,CAaA,OAXAA,EAAI+D,UAAYxF,EAChByB,EAAII,GAjGG,GAkGPJ,EAAIhB,GAxFC,EAyFLgB,EAAIkD,IA5EC,EA6ELlD,EAAImD,GAtEC,GAuELnD,EAAIsD,QAhEK,EAiETtD,EAAIgE,UAAY,EAChBhE,EAAIiE,YAAc,EAClBjE,EAAIkE,cAAgB,EACpBlE,EAAImE,QAAU,EAEPnE,CACT,CAk4BiByD,GC5/BjBzD,EAAIhB,GAAK,EACTgB,EAAIkD,IAAM,IACVlD,EAAImD,GAAK,IAET,MAAMiB,EAAMpE,EAAI,IAET,SAASqE,EAAYxR,EAAwByR,GAClD,OAAOC,OAAOvE,EAAInN,GAAO+P,IAAIwB,EAAIhC,IAAIkC,GAAYE,EAAAA,IAAQF,WAAW5F,QAAQtN,WAC9E,CAEO,SAASqT,EAAU5R,EAAwByR,GAAoC,IAAjBI,EAAOrH,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,IAAAA,UAAA,GAC1E,OAAOsH,EAAM9R,EAAOyR,GAAYE,EAAAA,IAAQF,SAAUI,GAAStT,UAC7D,CAEO,SAASuT,EAAM9R,GAA8E,IAAtDyR,EAAgBjH,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGmH,EAAAA,IAAQF,SAAUI,EAAOrH,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,IAAAA,UAAA,GACxF,OAAO2C,EAAInN,EAAMzB,YAAY2O,IAAIqE,EAAIhC,IAAIkC,IAAW5F,MAAM4F,EAAUI,EAAU1E,EAAIiE,iBAAc7Q,EAClG,CCXO,SAASwR,EAAYC,GAC1B,OAAO5U,KAAK6U,OAAOC,gBAAgB,IAAIC,WAAWH,GACpD,iBCNO,MAAMI,EAAgB,UAEtB,SAASC,EAAyBC,EAAatS,GACpD,MAAqB,iBAAVA,GAAsBA,EAAMuS,WAAWH,GACzCV,OAAO1R,EAAMlC,MAAM,IAErBkC,CACT,CAEO,SAASwS,EAAUxS,GACxB,OAAkB,KAAXA,GAAiBA,EAAQ,IAAMA,EAAQA,CAChD,CAQO,SAASyS,EAAqBzS,EAAe0S,GAClD,OAAQ1S,EAAQuD,EAAAA,IAAWiO,EAAYkB,EACzC,CAEO,SAASC,EAAuB3S,EAAe0S,GACpD,OAAQ1S,EAAQwR,EAAYkB,GAAQnP,EAAAA,GACtC,CCzBO,MAAMqP,EAAmB,aAEhC,SAASC,EAAoCP,EAAatS,GACxD,YAAcO,IAAVP,EACK,GAAG4S,UAKL5S,CACT,CAEA,SAAS8S,EAAmCR,EAAatS,GAEvD,MAAqB,iBAAVA,GAAsBA,EAAMuS,WAAWH,GACzCV,OAAO1R,EAAMlC,MAAMsU,IAIP,iBAAVpS,GAAsBA,EAAMuS,WAAWK,QAAlD,EAIO5S,CACT,gBCdA,MAAM+S,EAAgB,IAAIC,ICT1BtB,OAAOR,UAAUd,OAAS,WACxB,MAAO,GAAGgC,IAAgBxI,KAAKrL,YACjC,iBCFO,SAAS0U,EAAeC,GAC7B,MAAMC,EAAQD,EAAUzR,MAAM,MACvB2R,EAAIC,EAAU,WAA+B,IAAjBF,EAAM5T,OAAe,CAAC4T,EAAM,GAAIA,EAAM,IAAMA,EAC/E,MAAO,CAAEC,GAAI5C,OAAO4C,GAAKC,UAC3B,CCPe,SAASC,EAAqBC,GAC3C,OAA2B,IAApBA,EAAShU,QAAgBgU,EAAS,GAAGhU,SAAWiU,EAAAA,GACzD,ECE8BrJ,WAAAA,IAAU,SAACsJ,GAAuE,IAAtDpF,EAAK7D,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAJzB,EAIoDkJ,EAASlJ,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG6D,EACpG,GAAKoF,EAEL,OAAIA,EAAQlU,QAAU8O,EAAQqF,EALVC,EAK4CF,EAEzD,GAAGA,EAAQ3V,MAAM,EAAGuQ,QAAkBoF,EAAQ3V,OAAO4V,IAC9D,mGCDA,MAGME,EAAY,kBAClB,SAASC,EAAcC,GACrB,OAAOA,EAAI9C,QAAQ,IAAM,GAC3B,CAEO,MAiDM+C,EAAa,SAACC,EAAYC,GAA8C,IAAnCC,EAAM1J,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAxDhC,WAyDtB,IAb0BwJ,MACrBJ,EAAU7C,KAAKiD,KAGZA,EACLvS,MAAM,KACN3D,MAAM,GACNqW,IAAIN,GAEJO,KAAKC,OAIHC,CAAYN,GACf,MAAM,IAAI7V,MAAM,2BAGlB,MAAM,IAAEmU,EAAG,UAAEiC,GAtDsBN,KACnC,MACMO,EADOC,IAAW,SATJ,gBAULC,OAAOzS,EAAOC,KAAK+R,EAAM,QAAQU,SAGhD,MAAO,CACLrC,IAHSkC,EAAE1W,MAAM,EAAG,IAIpByW,UAHSC,EAAE1W,MAAM,IAIlB,EA8C0B8W,CAAqBX,GAOhD,OANiBD,EACdvS,MAAM,KACN3D,MAAM,GACNqW,IAAIN,GACJM,KAAKU,GAAOC,SAASD,EAAI,MAEZE,QACd,CAACC,EAAYC,IAnDMC,EAAAC,EAA2BC,KAAwB,IAAlD,IAAE9C,EAAG,UAAEiC,GAAiBY,EAC9C,MAAME,EAAcpT,EAAOqT,YAAY,GACvCD,EAAYE,cAAcH,EAAO,GAEjC,MAAMI,EAAOvT,EAAOwT,OAAO,CAACxT,EAAOyT,MAAM,EAAG,GAAIpD,EAAK+C,IAE/Cb,EAAIC,IAAW,SAAUF,GAC5BG,OAAOc,GACPb,SAGH,MAAO,CACLrC,IAHSkC,EAAE1W,MAAM,EAAG,IAIpByW,UAHSC,EAAE1W,MAAM,IAIlB,EAqC0BoX,CAAQF,EAAYC,EAAUf,IACvD,CAAE5B,MAAKiC,aAEX,EC3EO,SAASoB,EAA2CC,EAA0BtD,GACnF,OAAOsD,EAAWb,QAAO,CAACc,EAA2BC,KACnDD,EAAMC,EAAOxD,IAAQwD,EAEdD,IACN,CAAC,EACN,CA0BO,SAASE,EAA2BC,EAAWC,GACpD,OAAOA,EAAKlB,QAAO,CAACmB,EAAQ5D,KAC1B4D,EAAO5D,GAAO0D,EAAO1D,GACd4D,IACN,CAAC,EACN,CAYO,SAASC,EAA0CH,EAAWC,GACnE,MAAMG,EAAa,IAAIC,IAAIJ,EAAK9B,IAAI7S,SAIpC,OAAOyU,EAAKC,EAHMM,OAAOL,KAAKD,GAC3BO,QAAQjE,IAAS8D,EAAWI,IAAIlE,KAGrC,CAEO,SAASmE,EAAgCT,GAC9C,OAAOM,OAAOL,KAAKD,GAAQjB,QAAO,CAACmB,EAAQQ,KACzC,MAAMpE,EAAMoE,EAIZ,YAHoBnW,IAAhByV,EAAO1D,KACT4D,EAAO5D,GAAO0D,EAAO1D,IAEhB4D,CAAM,GACZ,CAAC,EACN,CAsCO,SAASS,EAAWC,GACzB,OAAOA,EAAML,OAAOM,QACtB,CAUO,SAASpV,GAASmV,EAAYE,GACnC,MAAMZ,EAAgB,GACtB,IAAK,IAAIhV,EAAI,EAAGA,EAAI0V,EAAMrX,OAAQ2B,GAAK4V,EACrCZ,EAAO9H,KAAKwI,EAAM9Y,MAAMoD,EAAGA,EAAI4V,IAGjC,OAAOZ,CACT,CAsCO,SAASa,GAAMC,EAAeC,GACnC,MAAMzV,EAAgB,GACtB,IAAK,IAAIN,EAAI8V,EAAO9V,EAAI+V,GACtBzV,EAAI4M,KAAKlN,KAEX,OAAOM,CACT,CAEO,SAAS0V,GAAsBjB,EAAgBkB,GACpD,OAAOlB,EAAKlB,QAAO,CAACqC,EAAK9E,EAAK8C,KAC5BgC,EAAI9E,GAAOtC,MAAMqH,QAAQF,GAAUA,EAAO/B,GAAS+B,EAC5CC,IACN,CAAC,EACN,CAEO,SAASE,GAAiCV,EAAqBtE,GACpE,OAAOsE,EAAMzC,KAAKnU,GAAUA,EAAMsS,IACpC,CAEO,SAASiF,GAAkBC,EAAqBC,GACrD,MAAMC,EAAO,IAAIrB,IAAIoB,GACfE,EAAY,GAElB,IAAK,MAAMC,KAAWJ,EACfE,EAAKlB,IAAIoB,IACZD,EAAKvJ,KAAKwJ,GAId,OAAOD,CACT,qIC9LO,SAASE,GAAiB7W,GAC/B,IAAK,MAAM8W,KAAQC,EAAAA,IAAe,CAChC,MAAM,SAAEC,EAAQ,WAAEC,GAAeH,EAKjC,IAAK,IAAI5W,EAAI8W,EAASzY,OAAS,EAAG2B,GAAK,EAAGA,IAAK,CAC7C,MAAMgX,EAASF,EAAS9W,GACxB,IAAKF,EAAOmC,SAAS,IAAI+U,KACvB,SAGF,MAAMC,EAAOnX,EAAOlD,MAAM,GAAIoa,EAAO3Y,OAAS,GAC9C,GAAK0Y,EAAWlH,KAAKoH,GAIrB,MAAO,CAAEA,OAAML,OACjB,CACF,CAGF,4GC9BO,SAASM,GAAOC,GACrB,OAAOpG,OAAOqG,OAAO3D,OAAO,UAAW0D,EACzC,CAEO,SAASE,GAAWF,GACzB,OAAOpW,GAAOC,KAAKmW,GAAO9Z,SAAS,MACrC,CAEO,SAASia,GAAWC,GACzB,OAAOtG,WAAWjQ,KAAKD,GAAOC,KAAKuW,EAAK,OAC1C,CAEO,SAASC,GAAcL,GAC5B,OAAOpW,GAAOC,KAAKmW,GAAO9Z,SAAS,SACrC,CAEO,SAASoa,GAAcC,GAC5B,OAAOzG,WAAWjQ,KAAKD,GAAOC,KAAK0W,EAAQ,UAC7C,CCJA,IAAIC,GAQG,SAASC,GAAeC,GAAmB,IAAAC,EAUhD,OATAH,GAAc,IACTE,EACHE,iBAAiB,EACjBC,eAAgBH,EAAKI,YAAeC,EAAAA,MAAiBL,EAAKM,oBAE1DC,WAAY,CAAE,eAAgBP,EAAKI,WAhBf,UAgBkD,QAAPH,EAAG5b,YAAI,IAAA4b,OAAA,EAAJA,EAAMO,QACxEC,oBAAqBT,EAAKI,WAAaM,EAAAA,IAAiCC,EAAAA,IACxEC,oBAAqBZ,EAAKI,WAAaS,EAAAA,IAAiCC,EAAAA,KAEnEhB,EACT,CAEO,SAASiB,KACd,OAAOjB,EACT,gBCjCO,SAASkB,KACd,OZwBK,WACL,IAAI/Z,EAAQ0R,OAAO,GACnB,IAAK,MAAMsI,KAAgBjI,EY1BP,GZ0B2B,CAC7C,MAAMkI,EAAevI,OAAOsI,GAC5Bha,GAASA,GAAS0R,OAAO,IAAMuI,CACjC,CACA,OAAOja,CACT,CY/BSka,EACT,oCC+CA,MAAMC,GAAwB,IAE9B,IAAIC,GAEG,MAAMC,GAA6D,CACxE1S,SAAU2S,GAAAA,EACVxS,SAAUyS,GAAAA,EACVxS,SAAUyS,GAAAA,EACVxS,KAAMyS,GAAAA,EACNxS,KAAMyS,GAAAA,EACNxS,KAAMyS,GAAAA,EACNxS,KAAMyS,GAAAA,EACNvS,KAAMwS,GAAAA,EACNvS,GAAIwS,GAAAA,oBAGC,SAASC,KAA8C,IAAjC1H,EAAmB7I,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,UACjD,IAAK4P,GAAiB,CACpB,MAAM,WAAEd,EAAU,oBAAEE,EAAmB,oBAAEG,GAAwBG,KAEjEM,GAAkB,CAChBY,QAAS,IAAIC,GAAAA,EAAU,CACrBC,SAAU,GAAGC,EAAAA,qBACbC,QAASC,EAAAA,IACTC,OAAQ9B,EACR+B,QAASjC,IAEXkC,QAAS,IAAIP,GAAAA,EAAU,CACrBC,SAAU,GAAGO,EAAAA,qBACbL,QAASC,EAAAA,IACTC,OAAQ3B,EACR4B,QAASjC,IAGf,CAEA,OAAOc,GAAgB/G,EACzB,CAEO,MAAMqI,IAA4BC,EAAAA,GAAAA,IACvC3c,MAAOqU,EAAqBI,EAAiBmI,KAC3C,MAAMC,EAASd,GAAa1H,GAASyI,KAAK,IAAIC,GAAAA,GAAard,GAAAA,QAAQC,MAAMid,KAEzE,OAAOI,SADqBH,EAAOI,iBAAiBvd,GAAAA,QAAQC,MAAM8U,KAC5B,EAAMJ,EAAQ,IAI3C6I,IAAsBP,EAAAA,GAAAA,IAAe3c,MAAOqU,EAAqB8I,KAC5E,MAAMC,EAAcrB,GAAa1H,GAASyI,KAAK,IAAIO,GAAAA,EAAa3d,GAAAA,QAAQC,MAAMwd,KAE9E,OAAOH,UADYI,EAAYE,iBACHT,QAAQ,EAAMxI,EAAQ,IAGvCkJ,IAAqBZ,EAAAA,GAAAA,IAAe3c,MAAOqU,EAAqBI,KAC3E,MAAM+I,QAAYzB,GAAa1H,GAASoJ,mBAAmB/d,GAAAA,QAAQC,MAAM8U,GAAU,kBACnF,GAAsB,IAAlB+I,EAAIE,UAMR,OAAOlE,GAFWgE,EAAI3c,MAAM8c,gBACNpe,SAAS,IAAIE,SAAS,GAAI,KAC1B,IAGXme,IAA2BjB,EAAAA,GAAAA,IAAe3c,MACrDqU,EACAwJ,EACAC,EACArJ,KAEA,MAAMsJ,EAAYhC,GAAa1H,GACzB2J,EAAOD,EAAUjB,KAAKmB,GAAAA,GAAYC,kBAAkBxe,GAAAA,QAAQC,MAAMke,KAClEM,QAAuBH,EAAKf,iBAAiBvd,GAAAA,QAAQC,MAAM8U,GAAUqJ,GAC3E,OAAOC,EAAUjB,KAAKsB,GAAAA,GAAYF,kBAAkBC,GAAe,IAQ9D,SAASE,GAAehF,GAC7B,OAAOiF,GAAAA,KAAKC,QAAQtb,GAAOC,KAAKmW,GAClC,CAEO,SAAS2D,GAAgBvI,GAAuF,IAA5D+J,EAAYhT,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG5E,GAAAA,GAAuByN,EAAoB7I,UAAAjL,OAAA,EAAAiL,UAAA,QAAAjK,EAInH,MAHuB,iBAAZkT,IACTA,EAAU/U,GAAAA,QAAQC,MAAM8U,IAEnBA,EAAQlV,SAAS,CACtBkf,SAAS,EACTC,WAAYF,EACZG,SAAsB,YAAZtK,GAEd,CAEO,SAASuK,GAAanK,GAI3B,MAHuB,iBAAZA,IACTA,EAAU/U,GAAAA,QAAQC,MAAM8U,IAEnBA,EAAQoK,aACjB,CAEO,SAASC,GAAuBC,GACrC,MAAM,QACJC,EAAO,YACPC,EAAW,UACXC,EAAS,gBACTC,EAAe,cACfC,EAAa,cACbC,GACEN,EACJ,IAAIO,EAAiBP,EAAOO,eAExBC,GAAU,IAAI9e,GAAAA,SACf+e,UAAUhY,GAAAA,GAAaiY,SAAU,IACjCD,UAAUR,GAAWjE,KAAmB,IACxC2E,WAAWT,GACXU,aAAajgB,GAAAA,QAAQC,MAAMuf,IAC3BS,aAAajgB,GAAAA,QAAQC,MAAMwf,IAC3BS,cAAcP,GACdK,WAAWN,GAAiB,IAqB/B,OAnBIE,aAA0BnM,aAE5BmM,EAAiBO,GAAiBP,EADhB1O,KAAK/D,MAAM0S,EAAQO,cAAgB,KAIlDR,EAGHC,EADmC,iBAAnBD,EACNC,EAAQQ,UAAS,GACxBP,UAAU,EAAG,IACb9e,YAAYuC,GAAOC,KAAKoc,IAClBA,aAA0BnM,WACzBoM,EAAQQ,UAAS,GACxBrf,YAAYuC,GAAOC,KAAKoc,IAEjBC,EAAQQ,UAAS,GACxBC,SAASV,GAVZC,EAAQQ,UAAS,GAaZR,EAAQU,SACjB,CAWO,SAASC,GAAeC,GAC7B,MAAMC,EAASnd,GAAOC,KAAKid,GACrB9G,EAAQ,IAAIlG,WAAWiN,EAAO7f,OAAS,GAEvC8f,EAAcpd,GAAOyT,MAAM,GAKjC,OAJA2J,EAAY9J,cAAchP,GAAAA,GAAO+Y,SACjCjH,EAAMkH,IAAIF,EAAa,GACvBhH,EAAMkH,IAAIH,EAAQ,GAEX/G,CACT,CAEO,SAASwG,GAAiBxG,GAAwE,IAArDmH,EAAQhV,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG2P,GAE7D,OADelY,GAAOC,KAAKmW,GAChB9Y,QAAUigB,EACZnH,EAGFoH,GAAqBpH,EAC9B,CAEO,SAASoH,GAAqBpH,GACnC,MAAMqH,EAAevF,GAErB,IAAIwF,EAEJ,IAAK,IAAIze,EAHS0O,KAAKgQ,KAAKvH,EAAM9Y,OAASmgB,GAGlB,EAAGxe,GAAK,EAAGA,IAAK,CACvC,MAAM2e,EAAa3e,EAAIwe,EACjBI,EAAalQ,KAAKmQ,IAAIL,EAAcrH,EAAM9Y,OAASsgB,GACnDG,EAAa/d,GAAOC,KAAKmW,EAAM+G,OAAQ/G,EAAM4H,WAAaJ,EAAYC,GAEtEI,GAAe,IAAIzgB,GAAAA,SAAUC,YAAYsgB,GAC3CL,GACFO,EAAalB,SAASW,GAExBA,EAAWO,EAAajB,SAC1B,CAEA,OAAOU,GAAYrC,GAAAA,KAAK6C,KAC1B,CAEO,SAASC,GAAiC5K,GAI/C,GAAIA,EAAKjW,OAHkB,GACF,GAEiC4a,GACxD,MAAM,IAAIhc,MAAM,0BAGlB,OAAO,IAAIsB,GAAAA,SACRC,YAAYuC,GAAOC,KAAKsT,EAAK6K,SAAS,EARd,MASxBrB,SAASS,GAAqBjK,EAAK6K,SATX,MAUxBpB,SACL,CAEO,SAASqB,GAA8BtC,GAC5C,OAAO,IAAIve,GAAAA,SACR+e,UAAU9X,GAAAA,GAAoB6Z,QAAS,IACvC/B,UAAUR,GAAW,EAAG,IACxBre,QACL,CAqCO,SAASf,GAAa6U,GAQ3B,IACE,GAAI/U,GAAAA,QAAQ8hB,MAAM/M,GAChB,MAAO,CACLA,QAAS/U,GAAAA,QAAQ+hB,SAAShN,GAC1B+M,OAAO,EACPE,SAAS,GAEN,GAAIhiB,GAAAA,QAAQiiB,WAAWlN,GAC5B,MAAO,IACF/U,GAAAA,QAAQkiB,cAAcnN,GACzBoN,gBAAgB,EAChBH,SAAS,EAGf,CAAE,MAAOtgB,GACP,CAGF,MAAO,CAAEsgB,SAAS,EACpB,CAEO,SAASI,GAAgBrN,GAC9B,OAAOoD,QAAQjY,GAAa6U,GAAS+M,MACvC,CAmBO,SAASO,GAA0BC,EAA0BC,EAAwBjD,GAC1F,OAAOkD,EAAAA,GAAAA,aACJ1C,UAAU2C,GAAAA,GAAqBtc,gBAAiB,IAChD2Z,UAAUR,GAAW,EAAG,IACxBU,WAAWsC,GACXjC,SAASkC,IAAgB,GACzBhC,SACL,CAEO,SAASmC,GAAwBC,EAAuBrD,GAC7D,MAAMsD,EAAiBC,GAAAA,WAAWC,MAAMD,GAAAA,WAAWE,KAAK/iB,UAAW6iB,GAAAA,WAAWG,OAAOC,QAErF,IAAK,MAAMC,KAAcP,EACvBC,EAAe/B,IAAI7gB,GAAAA,QAAQC,MAAMijB,IAAa,GAGhD,OAAOV,EAAAA,GAAAA,aACJ1C,UAAU2C,GAAAA,GAAqBU,cAAe,IAC9CrD,UAAUR,GAAW,EAAG,IACxB8D,UAAUR,EAAgBC,GAAAA,WAAWE,KAAK/iB,UAAW6iB,GAAAA,WAAWG,OAAOC,QACvE1C,SACL,CAGO,SAAS8C,GAAYC,GAC1B,OAAKC,GAAeD,IL7VpBnM,EKiWiBmM,ELhWjBE,EKgWuBliB,GACjBA,aAAiBuhB,GAAAA,WACZQ,GAAY7K,GAAmBlX,EAAMiW,OAAQjW,EAAMmX,WAExD8K,GAAejiB,GACV+hB,GAAY/hB,GAEdA,ELrWFsW,OAAOL,KAAKJ,GAAOd,QAAO,CAACoN,EAA8B7P,EAAK8C,KACnE+M,EAAS7P,GAAO4P,EAASrM,EAAMvD,IACxB6P,IACN,CAAC,IKwVKH,EL/VJ,IACLnM,EACAqM,CKyWF,CAEA,SAASD,GAAeD,GAEtB,OAAe,OAARA,GACa,iBAARA,GACP1L,OAAO8L,eAAeJ,KAAS1L,OAAOpF,SAC7C,CCjZO,ICQHmR,GDRQC,GAAW,SAAXA,GAAW,OAAXA,EAAAA,EAAW,yBAAXA,EAAAA,EAAW,+BAAXA,EAAAA,EAAW,mCAAXA,EAAAA,EAAW,uCAAXA,CAAW,MEAR,SAASC,KACtB,OAAO5X,KAAK6X,MAAMjkB,SAAS,IAAMqR,KAAK6S,SAASlkB,SAAS,IAAIT,MAAM,EACpE,CCiFA,MAAM4kB,GACIC,cAAgB,IAAI3P,IAEpB4P,wBAA0B,IAAI5P,IAEtCrJ,WAAAA,CACSkZ,EACCC,EACAC,EACAC,GAER,IADQC,EAAYzY,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,IAAG,KAJnBqY,OAAAA,EAA0E,KACzEC,SAAAA,EAAsC,KACtCC,QAAAA,EAAgB,KAChBC,cAAAA,EAAuB,KACvBC,aAAAA,CAEV,CAEOC,OAAAA,GACP,CAEAC,IAAAA,GAAqB,QAAAC,EAAA5Y,UAAAjL,OAAbwZ,EAAI,IAAA/I,MAAAoT,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJtK,EAAIsK,GAAA7Y,UAAA6Y,GACVzZ,KAAK0Z,YAAY,CACfvjB,KAAM,OACNgZ,QAEJ,CAEAwK,OAAAA,CAAQC,GACN,MAAM,cAAEb,EAAa,wBAAEC,GAA4BhZ,KAE7C6Z,EAAYlB,KACZmB,EAA0B,CAC9B3jB,KAAM,aACN0jB,eACGD,GAGCG,EAAe,CAAEF,aAGjB5Z,EAAU,IAAIC,SAAa,CAACC,EAASC,KACzCsM,OAAOsN,OAAOD,EAAc,CAAE5Z,UAASC,UAAS,IAGlD,GAAqD,mBAA1C0Z,EAAQ3K,KAAK2K,EAAQ3K,KAAKxZ,OAAS,GAAmB,CAC/DmkB,EAAQG,cAAe,EAEvB,MAAM3B,EAAWwB,EAAQ3K,KAAK1M,MAC9BsX,EAAazB,SAAWA,EACxBU,EAAwBrD,IAAI2C,EAAUyB,EACxC,CAeA,OAbAhB,EAAcpD,IAAIkE,EAAWE,GAC7B9Z,EACGia,OAAM,KAAe,IACrBC,SAAQ,KACPpB,EAAcqB,OAAOP,GAEjBE,EAAazB,UACfU,EAAwBoB,OAAOL,EAAazB,SAC9C,IAGJtY,KAAK0Z,YAAYI,GAEV7Z,CACT,CAEAoa,cAAAA,CAAeC,GACbA,EAAiBC,YAAa,EAE9B,MAAM,UAAEV,GAAc7Z,KAAKgZ,wBAAwBwB,IAAIF,IAAqB,CAAC,EACxET,GAIL7Z,KAAK0Z,YAAY,CACfvjB,KAAM,iBACN0jB,aAEJ,CAEAY,SAAAA,CAAU7O,GACR,IACEA,EhBlIC,SAAiFA,GACtF,MAAoB,iBAATA,EACF8O,KAAK3lB,MAAM6W,EAAM1C,GAEnB0C,CACT,CgB6Ha+O,CAAuB/O,EAChC,CAAE,MAAOpV,GAEP,YADA8C,EAAAA,EAAAA,IAAc,gDAAiD9C,EAEjE,CAEA,MAAM,cAAEuiB,EAAa,QAAEI,GAAYnZ,KACnC,GAAI4L,EAAKuN,UAAYA,EAOrB,GAHkB,WAAdvN,EAAKzV,MAAqB6J,KAAKkZ,UACjClZ,KAAKkZ,SAAStN,EAAKd,QAEH,mBAAdc,EAAKzV,KAA2B,CAClC,MAAM4jB,EAAehB,EAAcyB,IAAI5O,EAAKiO,WACxCE,IACEnO,EAAKxS,MACP2gB,EAAa3Z,OAAOwL,EAAKxS,OAEzB2gB,EAAa5Z,QAAQyL,EAAKgP,UAGhC,MAAO,GAAkB,mBAAdhP,EAAKzV,KAA2B,KAAA0kB,EACzC,MAAMd,EAAehB,EAAcyB,IAAI5O,EAAKiO,WAC5CE,SAAsB,QAAVc,EAAZd,EAAczB,gBAAQ,IAAAuC,GAAtBA,EAAAC,KAAAf,KAA4BnO,EAAKmP,aACnC,MAAO,GAAkB,mBAAdnP,EAAKzV,KAA2B,KAAA6kB,EAAAC,EACzC,MAAM7hB,EAAQ,IAAI7E,MAAgB,QAAXymB,EAACpP,EAAKxS,aAAK,IAAA4hB,OAAA,EAAVA,EAAYpiB,SAIpC,MAHc,QAAdqiB,EAAIrP,EAAKxS,aAAK,IAAA6hB,GAAVA,EAAYhlB,QACdmD,EAAMnD,MAAQ2V,EAAKxS,MAAMnD,OAErBmD,CACR,CACF,CAEQsgB,WAAAA,CAAY9N,GAClBA,EAAKuN,QAAUnZ,KAAKmZ,QAEpB,IAAI+B,EAAsCtP,EACtC5L,KAAKoZ,gBACP8B,EhB9KC,SAAgCtP,GACrC,OAAO8O,KAAKhY,UAAUkJ,EAAM3C,EAC9B,CgB4KgBkS,CAAuBvP,IAG/B,SAAU5L,KAAKiZ,OACjBjZ,KAAKiZ,OAAOS,YAAYwB,EAASlb,KAAKqZ,cAEtCrZ,KAAKiZ,OAAOS,YAAYwB,EAE5B,EF7LK,SAASE,GAA0CC,GACxD,IAAK5C,GACH,MAAM,IAAIlkB,MAAM,0BACjB,QAAAilB,EAAA5Y,UAAAjL,OAHyEwZ,EAAI,IAAA/I,MAAAoT,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJtK,EAAIsK,EAAA,GAAA7Y,UAAA6Y,GAK9E,OAAOhB,GAAUkB,QAAQ,CAAE3b,KAAMqd,EAAYlM,QAC/C,CGvBA,IAAImM,GAAoB,CAAC,EAEzB,MAqDA,GAnDI,CACF,aAAMC,CAAQ7S,EAAiB8S,GAC7B,GAAItL,KAAiBuL,cAAgB/S,KAAO4S,KAAUE,EACpD,OAAOF,GAAM5S,GAGf,MAAM4D,QAAe8O,GAAW,0BAA2B1S,GACrDtS,EAAQkW,EAASoO,KAAK3lB,MAAMuX,EAAQ7D,QAAiB9R,EAU3D,OARIuZ,KAAiBuL,oBACL9kB,IAAVP,SACKklB,GAAM5S,GAEb4S,GAAM5S,GAAOtS,GAIVA,CACT,EAEA,aAAMslB,CAAQhT,EAAiBtS,SACvBglB,GAAW,0BAA2B1S,EAAKgS,KAAKhY,UAAUtM,IAE5D8Z,KAAiBuL,eACnBH,GAAM5S,GAAOtS,EAEjB,EAEA,gBAAMulB,CAAWjT,SACT0S,GAAW,6BAA8B1S,GAE3CwH,KAAiBuL,qBACZH,GAAM5S,EAEjB,EAEA,WAAMkT,SACER,GAAW,yBAEblL,KAAiBuL,eACnBH,GAAQ,CAAC,EAEb,EAEA,aAAMO,GACJ,MAAMvP,QAAe8O,GAAW,wBAEhC,OAAO9O,aAAM,EAANA,EAAQlW,KACjB,GCtDIyH,GAAUvK,EAAAA,IAAeE,KAAKsoB,OAAOje,QAAQke,WAAQplB,EAE3D,GAAiBkH,IAAW,CAC1B0d,QAASnmB,UAAU,IAAA4mB,EAAA,OAA4B,QAA5BA,QAAYne,GAAQ2c,IAAI9R,UAAI,IAAAsT,OAAA,EAAvBA,EAA2BtT,EAAI,EACvDgT,QAASA,CAAChT,EAAKtS,IAAUyH,GAAQ8X,IAAI,CAAE,CAACjN,GAAMtS,IAC9CulB,WAAY9d,GAAQoe,OAAOC,KAAKre,IAChC+d,MAAO/d,GAAQ+d,MAAMM,KAAKre,IAC1Bse,OAAQte,GAAQ2c,IAAI0B,KAAKre,IACzBue,QAASve,GAAQ8X,IAAIuG,KAAKre,IAC1Bwe,QAASxe,GAAQ2c,IAAI0B,KAAKre,MACtB,CAAC,kBCPP,MAAMye,GAAQC,GAAAA,GAAgBC,EAAAA,IAAiBC,EAAAA,KAE/C,IACElB,QAAUvd,GAAqBue,GAAAA,GAAQve,EAAMse,IAC7CZ,QAASA,CAAC1d,EAAkB5H,IAAemmB,GAAAA,GAAQve,EAAM5H,EAAOkmB,IAChEX,WAAa3d,GAAqBue,GAAAA,GAAQve,EAAMse,IAChDV,MAAOA,IAAMW,GAAAA,GAAUD,IACvBH,OAAQ/mB,UAEN,MAAMiX,QAAckQ,GAAAA,GAASD,IAE7B,OAAOhP,GAAmBjB,QADLkQ,GAAAA,GAAYlQ,EAAMiQ,IACA,EAEzCD,QAASjnB,SAEAkY,GAAmBjB,QADLkQ,GAAAA,GAAYlQ,EAAMiQ,KAGzCF,QAAUM,GACDH,GAAAA,GAAY7P,OAAOiQ,QAAQD,GAAQJ,KCpB9C,SAASM,GAAYC,GACnB,OAAO,kBAAkB3c,QAAQC,QAAQ0c,KAAGjc,WAAS,CACvD,CAEA,MAkCA,GAlCkD,iBAAjBkc,aAA4B,CAC3DvB,QAASqB,GAAYE,aAAavB,SAClCG,QAASkB,GAAYE,aAAapB,SAClCC,WAAYiB,GAAYE,aAAanB,YACrCC,MAAOgB,GAAYE,aAAalB,OAChCO,OAAQS,IAAY,KAAM,IAAME,iBAChCT,QAASO,IAAavQ,GAAmBF,EAAK2Q,aAAczQ,KAC5D+P,QAASQ,IAAaF,IACpBhQ,OAAOsN,OAAO8C,aAAcJ,EAAM,KAElC,CACFnB,QAAQ7S,GACC0S,GAAW,sBAAuB1S,GAE3CgT,QAAOA,CAAChT,EAAiBtS,IAChBglB,GAAW,sBAAuB1S,EAAKtS,GAEhDulB,WAAWjT,GACF0S,GAAW,yBAA0B1S,GAE9CkT,MAAKA,IACIR,GAAW,qBAEpBe,OAAMA,IACGf,GAAW,sBAEpBiB,QAAQhQ,GACC+O,GAAW,sBAAuB/O,GAE3C+P,QAAQM,GACCtB,GAAW,sBAAuBsB,IC/BhC7e,GAAUvK,EAAAA,IAAeypB,GAAmBvN,EAAAA,IAAewN,GAAmBT,GCQrFU,IDLHvE,GAAYwE,UACZxE,GAAYyE,aACZzE,GAAY0E,eACZ1E,GAAY2E,iBCEY,GAEpB,IAAIC,GACX,MAAMC,GAAe,IAAIrd,SAAeC,IACtCmd,GAAend,CAAO,IAsBjB/K,eAAeooB,GAAmBlU,EAAmBmU,GAC1D,aAAcC,GAAoCpU,IAAYmU,GAAO5T,OACvE,CAEOzU,eAAeuoB,GAAqBrU,GACzC,aAAcsU,GAAsBtU,IAAYuU,GAClD,CAEOzoB,eAAe0oB,GAAsBxU,GAC1C,aAmBKlU,eAAoEkU,GACzE,MAAMyU,QAAgBL,GAAmBpU,GACzC,GAAKyU,EAA+BC,KAAM,OAAOD,EACjD,MAAM,IAAIxpB,MAAM,sBAClB,CAvBgB0pB,CAAuB3U,IAAY0U,IACnD,CAEO,SAASE,GAAiD5U,GAC/D,OAAO6U,GAAgB7U,EAAW,WACpC,CAEOlU,eAAesoB,GAA4CpU,GAChE,MAAMyU,QAAgBG,GAA2B5U,GACjD,GAAIyU,EAAS,OAAOA,EACpB,MAAM,IAAIxpB,MAAM,WAAW+U,kBAC7B,CAEOlU,eAAewoB,GAAmDtU,GACvE,MAAMyU,QAAgBL,GAAmBpU,GACzC,GAAIyU,EAAQF,IAAK,OAAOE,EACxB,MAAM,IAAIxpB,MAAM,qBAClB,CAQO,SAAS6pB,KACd,OAAOvgB,GAAQ0d,QAAQ,WACzB,CAEOnmB,eAAeipB,GACpB/U,EACAgV,GAGA,OAAOC,GAAgBjV,EAAW,WAAY,UADxBoU,GAAsBpU,MAGvCgV,GAEP,CAYOlpB,eAAe+oB,GAAgB7U,EAAmBZ,GAAiB,IAAA8V,EACxE,OAAkC,QAAlCA,QAAc3gB,GAAQ0d,QAAQ7S,UAAI,IAAA8V,OAAA,EAA3BA,EAA+BlV,EACxC,CAEOlU,eAAeqpB,GAAmBnV,EAAmBZ,GAC1D,MAAMkD,QAAa/N,GAAQ0d,QAAQ7S,GACnC,IAAKkD,EAAM,OAEX,MAAQ,CAACtC,GAAYoV,KAAiBC,GAAa/S,QAC7C/N,GAAQ6d,QAAQhT,EAAKiW,EAC7B,CAEOvpB,eAAempB,GAAgBjV,EAAmBZ,EAAiBtS,GACxE,MAAMwV,QAAa/N,GAAQ0d,QAAQ7S,SAC7B7K,GAAQ6d,QAAQhT,EAAK,IAAKkD,EAAM,CAACtC,GAAYlT,GACrD,CAEOhB,eAAewpB,GAA2BnV,EAAiBf,GAChE,MAAMkD,QAAa/N,GAAQ0d,QAAQ7S,GACnC,GAAKkD,EAAL,CAEA,IAAK,MAAMtC,KAAaoD,OAAOL,KAAKT,GAC9BvC,EAAeC,GAAWG,UAAYA,UACjCmC,EAAKtC,SAIVzL,GAAQ6d,QAAQhT,EAAKkD,EARV,CASnB,CAEOxW,eAAeypB,KACpB,MAAMvV,QAAkBwV,KACxB,GAAKxV,EACL,OAAOD,EAAeC,GAAWG,OACnC,CAUO,SAASqV,KACd,OAAOjhB,GAAQ0d,QAAQ,mBACzB,CAMO,SAASwD,GAAwBhB,GACtC,MAAMiB,EAAoD,CAAC,EAK3D,MAHI,QAASjB,GAAWA,EAAQF,MAAKmB,EAAenB,IAAME,EAAQF,IAAIhU,SAClE,SAAUkU,GAAWA,EAAQC,OAAMgB,EAAehB,KAAOD,EAAQC,KAAKnU,SAEnEmV,CACT,CCzJA,MAAMC,GAAyB,CAC7B,CAAEjhB,KAAM,WACR,EACA,CAAC,aAAc,cAGXkhB,GAAyB,CAC7BlhB,KAAM,SACNmhB,WAAY,IACZlhB,KAAM,WAGFmhB,GAAyB,CAAEphB,KAAM,UAAWrI,OAAQ,KAMnD,SAAS0pB,GAAsB1V,GACpC,OAAO2V,EAAAA,GAAuB3V,EAAS1R,KAAK,KAC9C,CAyBO7C,eAAemqB,GAAgB5V,EAAoB6V,GACxD,MAAMC,EAAY9V,EAAS1R,KAAK,KAC1BynB,EAAOrX,OAAOC,gBAAgB,IAAIC,WAAW,KAC7CoX,QAAoBtX,OAAOqG,OAAOkR,UACtC,OACA,IAAIC,aAAcC,OAAON,MACtBP,IAECvW,QAAYL,OAAOqG,OAAOqR,UAC9B,CACEL,UACGR,IAELS,EACAP,IACA,EACA,CAAC,YAEGY,EAAK3X,OAAOC,gBAAgB,IAAIC,WAAW,KAC3C0X,GAAU,IAAIJ,aAAcC,OAAOL,GACnCS,QAAiB7X,OAAOqG,OAAOyR,QAAQ,CAAEniB,KAAM,UAAWgiB,MAAMtX,EAAKuX,GACrEG,EAAUha,MAAM9N,KAAK,IAAIiQ,WAAW2X,IACpCG,EAAWC,KAAK5oB,OAAOC,gBAAgByoB,IACvCG,EAAQna,MAAM9N,KAAK0nB,GAAIzV,KAAK9G,GAAO,KAAKA,EAAE9O,SAAS,MAAOT,OAAO,KAAI+D,KAAK,IAGhF,MAAO,GAFSmO,MAAM9N,KAAKonB,GAAMnV,KAAK9G,GAAO,KAAKA,EAAE9O,SAAS,MAAOT,OAAO,KAAI+D,KAAK,OAE/DsoB,KAASF,GAChC,CAEOjrB,eAAeorB,GAAgBC,EAAmBjB,GACvD,IAAKiB,EAAUltB,SAAS,KACtB,OA0BJ6B,eAAqCqrB,EAAmBjB,GACtD,MAAMkB,GAAS,IAAIb,aAAcC,OAAON,GAClCmB,QAAetY,OAAOqG,OAAO3D,OAAO,UAAW2V,GAC/CV,EAAKS,EAAUvsB,MAAM,EAAG,IAAI0sB,MAAM,SAAUrW,KAAKsW,GAAS3V,SAAS2V,EAAM,MACzEC,EAAM,CAAE9iB,KAAM,UAAWgiB,GAAI,IAAIzX,WAAWyX,IAC5CtX,QAAYL,OAAOqG,OAAOkR,UAAU,MAAOe,EAAQG,GAAK,EAAO,CAAC,YAChEC,EAAQC,KAAKP,EAAUvsB,MAAM,KAC7B+sB,EAAU,IAAI1Y,WAAWwY,EAAMH,MAAM,WAAYrW,KAAK2W,GAAOA,EAAG3pB,WAAW,MAC3E4pB,QAAoB9Y,OAAOqG,OAAO0S,QAAQN,EAAKpY,EAAKuY,GAG1D,OAFkB,IAAII,aAAcC,OAAOH,GAE1BtpB,MAAM,IACzB,CAtCW0pB,CAAsBd,EAAWjB,GAG1C,MAAOgC,EAASjB,EAAOkB,GAAiBhB,EAAU5oB,MAAM,KAClD6nB,EAAO,IAAInX,WAAWiZ,EAAQZ,MAAM,SAAUrW,KAAK9G,GAAMyH,SAASzH,EAAG,OACrEuc,EAAK,IAAIzX,WAAWgY,EAAMK,MAAM,SAAUrW,KAAK9G,GAAMyH,SAASzH,EAAG,OACjEkc,QAAoBtX,OAAOqG,OAAOkR,UACtC,OACA,IAAIC,aAAcC,OAAON,MACtBP,IAECvW,QAAYL,OAAOqG,OAAOqR,UAC9B,CAAEL,UAASR,IACXS,EACAP,IACA,EACA,CAAC,YAEG2B,EAAQC,KAAKS,GACbR,EAAU,IAAI1Y,WAAWwY,EAAMH,MAAM,WAAYrW,KAAK2W,GAAOA,EAAG3pB,WAAW,MAC3E4pB,QAAoB9Y,OAAOqG,OAAO0S,QAAQ,CAAEpjB,KAAM,UAAWgiB,MAAMtX,EAAKuY,GAG9E,OAFkB,IAAII,aAAcC,OAAOH,GAE1BtpB,MAAM,IACzB,CAgBOzC,eAAessB,GAAYpY,EAAmBkW,EAAkBzB,GACrE,MAAM4D,EAAgB,CAACnC,GAEvB,IACE,MAAM,kBAAEoC,GAAsB7D,EAC9B4D,EAAcnd,KAAKod,GAEnB,MAAMjY,QAAiB6W,GAAgBoB,EAAmBpC,GAO1D,OANAmC,EAAcnd,QAAQmF,GAEjBiY,EAAkBruB,SAAS,YAxG7B6B,eAA8CkU,EAAmBK,EAAoB6V,GAC1F,MAAMmC,EAAgB,CAACnC,KAAa7V,GAEpC,IACE,MAAMiY,QAA0BrC,GAAgB5V,EAAU6V,GAC1DmC,EAAcnd,KAAKod,GAGnB,MAAMC,QAA0BrB,GAAgBoB,EAAmBpC,GAChEtF,OAAM,KAAe,IAExB,IAAKsF,IAAaqC,EAChB,MAAO,CAAEzoB,MAAO0oB,EAAAA,GAAeC,kBAG3B1D,GAA4C/U,EAAW,CAAEsY,qBACjE,CAAE,MAAOprB,IACP8C,EAAAA,EAAAA,IAAc,iCAAkC0oB,GAA6BxrB,EAAKmrB,GACpF,CAGF,CAoFYM,CAA+B3Y,EAAWK,EAAU6V,GAGrD7V,CACT,CAAE,MAAOnT,GAGP,YAFA8C,EAAAA,EAAAA,IAAc,cAAe0oB,GAA6BxrB,EAAKmrB,GAGjE,CACF,CAEA,SAASK,GAA6B5oB,EAAgBuoB,GACpD,MAAMO,EAAoBC,IACxB,IAAK,MAAMC,KAAYT,EACrBQ,EAAOA,EAAKE,WAAWD,EAAU,YAEnC,OAAOD,CAAI,EAGb,GAAqB,iBAAV/oB,EACT,OAAO8oB,EAAiB9oB,GAG1B,GAAIA,aAAiB7E,MAAO,KAAA+tB,EAC1B,MAAM1pB,EAAUspB,EAAiB9oB,EAAMR,SACvC,MAAO,CACLoF,KAAM5E,EAAM4E,KACZpF,UACA3C,MAAkB,QAAbqsB,EAAElpB,EAAMnD,aAAK,IAAAqsB,OAAA,EAAXA,EAAaD,WAAWjpB,EAAMR,QAASA,GAElD,CAEA,OAAOQ,CACT,gBCrKA,MAAMmpB,GACJ,6QAEIC,GACJ,yyFACIC,GAAiB,UACjBC,GAAe,kEACfC,GAAiB,+BAIVC,GAAgB,2DCbhBC,GAAa,IAAIzZ,IAAoB,CAChD,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,4BACN,CAAC,IAAK,+BACN,CAAC,IAAK,sDACN,CAAC,IAAK,mCACN,CAAC,IAAK,0BACN,CAAC,IAAK,gCACN,CAAC,IAAK,4BACN,CAAC,IAAK,6BACN,CAAC,IAAK,uCACN,CAAC,KAAM,aACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,QACP,CAAC,KAAM,KACP,CAAC,KAAM,KACP,CAAC,KAAM,KACP,CAAC,KAAM,KACP,CAAC,KAAM,KACP,CAAC,KAAM,KACP,CAAC,IAAK,sIACN,CAAC,IAAK,oHACN,CAAC,IAAK,sHACN,CAAC,IAAK,oEACN,CAAC,IAAK,qFACN,CAAC,IAAK,sGACN,CAAC,IAAK,2EACN,CAAC,IAAK,iEACN,CAAC,IAAK,sHACN,CAAC,IAAK,oHACN,CAAC,IAAK,kEACN,CAAC,IAAK,+CACN,CAAC,IAAK,gEACN,CAAC,IAAK,kDACN,CAAC,IAAK,wGACN,CAAC,IAAK,qEACN,CAAC,IAAK,qFACN,CAAC,IAAK,sGACN,CAAC,IAAK,+EACN,CAAC,IAAK,6CACN,CAAC,IAAK,2FACN,CAAC,IAAK,0DACN,CAAC,IAAK,2FACN,CAAC,IAAK,mFACN,CAAC,IAAK,oFACN,CAAC,IAAK,4CACN,CAAC,IAAK,yGACN,CAAC,IAAK,6GACN,CACE,IAEA,uNAEF,CACE,IAEA,oKAEF,CAAC,IAAK,iFACN,CAAC,IAAK,wDACN,CAAC,IAAK,4CACN,CAAC,IAAK,yCACN,CAAC,IAAK,sEACN,CAAC,IAAK,2EACN,CAAC,IAAK,wEACN,CAAC,IAAK,uDACN,CAAC,IAAK,8GACN,CAAC,IAAK,qDACN,CAAC,IAAK,qGACN,CAAC,IAAK,gHACN,CAAC,IAAK,sDACN,CAAC,IAAK,iEACN,CAAC,IAAK,+EACN,CAAC,IAAK,6EACN,CAAC,IAAK,mHACN,CAAC,IAAK,gDACN,CAAC,IAAK,oGACN,CAAC,IAAK,6EACN,CAAC,IAAK,uCACN,CAAC,IAAK,4ECnFF0Z,GAAc,IAAI1Z,IAClB2Z,GAAiB,IAAI3Z,IAE3B,IAAK,MAAOmF,EAAMyU,KAASH,GAAWlG,UAAW,CAC/CmG,GAAYnN,IAAIpH,EAAM,IAAIyU,IAE1B,IAAK,MAAMC,KAAQD,EACjBD,GAAepN,IAAIsN,EAAM1U,EAE7B,CAEO,SAAS2U,GAAUC,GACxB,GFFK,SAAkBA,GACvB,OAAOP,GAAczb,KAAKgc,EAC5B,CEAMC,CAASD,GAAM,OAAOA,EAE1B,IAAIE,EAAS,GAEb,IAAK,MAAMJ,KFEN,SAAeE,GACpB,OAAOA,EACJ/b,QAAQob,GAA8B,IACtCpb,QAAQmb,GAAgC,MACxCnb,QAAQqb,GAAgB,KACxBrb,QAAQsb,GAAc,KACtBtb,QAAQub,GAAgB,GAC7B,CETqBW,CAAMH,GACvBE,GAAUN,GAAevI,IAAIyI,IAASA,EAGxC,OAAOI,CACT,4BCtBA,MAAME,GAAmB,IAElBnuB,eAAeouB,GAAmBpZ,EAAcwB,EAAkB6X,GAQvE,MAAM,UACJC,EAAS,kBAAEC,EAAiB,OAAEC,EAAM,YAAEC,EAAW,QAAEC,EAAO,SAAEC,GAC1DN,GAAW,CAAC,EAEVO,EAAM,IAAIC,IAAI,GAAGC,EAAAA,MAAyB9Z,KAE1CmP,EAAoB,CACxBqK,OAAQA,GAAU,OAClBjS,QAAS,CACP,eAAgB,sBACbwS,QACCT,GAAa,CAAE,eAAgBA,IAErCU,KAAM1J,KAAKhY,UAAUkJ,IAGjBgP,EAAWiJ,QACPQ,EAAAA,GAAAA,IAAeL,EAAKzK,EAAM,CAChCuK,UACAC,WACAO,kBAAoB1rB,KAAaA,SAAAA,EAASrF,SAAS,8BAE7CgxB,MAAMP,EAAIrvB,WAAY4kB,GAIhC,aAFMiL,EAAAA,GAAAA,IAAkB5J,EAAU+I,EAAoB,CAACJ,SAAoB5sB,GAEpEikB,EAAS6J,MAClB,CAEO,SAASC,GAAwBta,EAAcwB,EAAmB+F,GACvE,MAAMqS,EAAM,IAAIC,IAAI,GAAGC,EAAAA,MAAyB9Z,KAEhD,OAAOua,EAAAA,GAAAA,IAAUX,EAAKpY,EAAM,CAC1B+F,QAAS,IACJA,KACAwS,OAGT,CAEO,SAASA,KACd,MAAO,IACFjU,KAAiBR,WACpB,gBAAiBkV,EAAAA,IACjB,YAAapsB,EAAAA,IAEjB,CAEO,SAASqsB,GAA6Bb,GAC3C,IAAK,MAAOhmB,EAAM5H,KAAUsW,OAAOiQ,QAAQwH,MAAsB,CAC/D,MAAMvD,EAAQ,gBAAgBkE,KAAK9mB,GAC/B4iB,GACFoD,EAAIe,aAAaC,OAAOpE,EAAM,GAAGvpB,cAAejB,EAEpD,CACF,CC7DA,IAAI6uB,GAAoC,CAAC,EACrCC,GAAwB,GACxBC,GAAe,IAAI1Y,IACnB2Y,GAAqB,IAAI3Y,IACzB4Y,GAAmF,CAAC,EACxF,MAAMC,GAA8B,IAAIxlB,GAAAA,EAEjC1K,eAAemwB,KACpB,IACE,MAAM3Z,QAAa8Y,GAMhB,oBAEHO,GAAiBrZ,EAAKqZ,eACtBC,GAActZ,EAAKsZ,YAAY3a,KAAKrI,GAAM,IAAIsjB,OAAOtjB,EAAG,OACxDijB,GAAe,IAAI1Y,IAAIb,EAAKuZ,cAC5BC,GAAqB,IAAI3Y,IAAIb,EAAKwZ,oBAClCC,GAA4CzZ,EAAK6Z,uBAAuBta,QAAO,CAACqC,EAAKkY,KACnF,MAAM,YAAEC,KAAgBC,GAASF,EAMjC,OAJAC,EAAY7tB,SAAS+R,IACnB2D,EAAI3D,GAAW+b,CAAI,IAGdpY,CAAG,GACT,CAAC,GACJ8X,GAA4BnlB,SAC9B,CAAE,MAAO3J,IACP8C,EAAAA,EAAAA,IAAc,0BAA2B9C,EAC3C,CACF,CAEO,SAASqvB,KACd,OAAOZ,EACT,CAEO7vB,eAAe0wB,KAGpB,aAFMR,GAA4BrlB,QAE3BolB,EACT,CAMO,SAASU,GAAoBlc,GAClC,OAAOob,GAAepb,EACxB,CAMO,SAASmc,GAAyBnc,GACvC,OAAOub,GAAmBxY,IAAI/C,EAChC,CAEO,SAASoc,GAAiB9D,GAC/B,MAAM+D,EAAUhD,GAAUf,GAAMgE,SAASC,EAAAA,KAEzC,IAAK,MAAMxF,KAASsF,EAAS,KAAAG,EAC3B,MAAMC,EAAmB,QAAfD,EAAGzF,EAAM2F,cAAM,IAAAF,OAAA,EAAZA,EAAcC,KAC3B,GAAIA,IAb2BlvB,EAaCkvB,GAZ3BnB,GAAavY,IAAIxV,EAAOC,gBAa3B,OAAO,CAEX,CAhBK,IAA4BD,EAkBjC,OAAO,CACT,CC7EO,SAASovB,GAAkBhjB,EAAgBC,GAA+B,IAAfgjB,EAAK7lB,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,IAAAA,UAAA,GAIjExK,GAASswB,GAAqBljB,GAAK,EAAI,IAAMkjB,GAAqBjjB,GAAK,EAAI,GAO/E,OANc,IAAVrN,IACFA,EAAQoN,EAAEmjB,UAAYljB,EAAEkjB,UACV,IAAVvwB,IACFA,EAAQoN,EAAEgG,GAAK/F,EAAE+F,GAAK,EAAIhG,EAAEgG,GAAK/F,EAAE+F,IAAM,EAAI,IAG1Cid,EAAQrwB,GAASA,CAC1B,CCyBO,SAASwwB,GAAUC,GAKxB,MAAO5oB,EAAM6oB,EAAO3wB,GAAQ0wB,EAAKhvB,MAAM,KACvC,MAAO,CAAEoG,OAAM9H,OAAM2wB,QACvB,CAcO,SAASC,GAAe9oB,EAAc6oB,GAC3C,OAAOE,GAAU/oB,EAAM6oB,EAAO,QAChC,CAEO,SAASE,GAAU/oB,EAAc6oB,EAAyB3wB,GAC/D,OAAKA,QAAkBQ,IAAVmwB,OACAnwB,IAATR,EAA2B,GAAG8H,KAAQ6oB,IACnC,GAAG7oB,KAAQ6oB,GAAS,MAAM3wB,IAFQ8H,CAG3C,CAEO,SAASgpB,GAAsBC,GACpC,OAAQA,EAASC,MACf,IAAK,cACH,OAAID,EAASE,IAAY,GAClB,CAACF,EAASG,MAEnB,IAAK,OACH,MAAO,CAACH,EAAS5uB,KAAM4uB,EAASI,IAGtC,CA8HO,SAASZ,GAAqBQ,GACnC,MAAsB,SAAlBA,EAASC,MAGHD,EAASK,KAA2B,YAApBL,EAASM,SAExBN,EAASO,SAEtB,CCxNO,SAASC,GAAeC,GAC7B,OAAiB,IAAVA,CACT,CAEO,SAASC,GAAUC,GACxB,OAAO7hB,KAAK8hB,MAAMD,EAAK,IACzB,CCDc,IAAIze,IF4BuB,IAAIqD,IAAoC,CAC/E,QAAS,UAAW,mBAGe,IAAIA,IAAoC,CAC3E,mBAAoB,gBAAiB,mBAAoB,sBAAuB,YAAa,qGGtChF,SAASsb,GAAc3P,GACpC,OAGK,SAA2BA,GAEhC,IAAI4P,EAAW,EAEf,IAAK,MAAMtf,KAAO0P,EAChB,GAAIA,EAAI6P,eAAevf,KACrBsf,IACIA,EAVuB,GAWzB,OAAO,EAKb,OAAO,CACT,CAjBUE,CAAkB9P,EAC5B,iBCAA,MAAM+P,GAAuB,IAAI1b,IAAI,CAAC,aAAc,YAAa,iBAEjErX,eAAegzB,GAAcC,GAC3B,IACE,aAAaA,GACf,CAAE,MAAOjvB,GACP,GAAI+uB,GAAqBvb,IAAIxT,aAAK,EAALA,EAAO4E,MAAO,OACtC,MAAM5E,CACb,CACF,CCOO,MAAMkvB,WAAcC,GAAAA,GAKzBxoB,WAAAA,GACEyoB,MARY,UASZxoB,KAAKyoB,QAAQ,GAAGC,OAAO,CACrBC,KAAM,+DAER3oB,KAAKyoB,QAAQ,GAAGC,OAAO,CACrBE,eAAgB,cAElB5oB,KAAKyoB,QAAQ,GAAGC,OAAO,CACrBG,OAAQ,+BAEV7oB,KAAKyoB,QAAQ,GAAGK,SAASC,GAChBA,EAAGC,MAAM,UAAUpN,UAE5B5b,KAAKyoB,QAAQ,GAAGC,OAAO,CAErBC,KAAM,KAENC,eAAgB,MAEpB,EAGK,MAAMK,GAAQ,IAAIX,GAEZY,GAAkB,IDnCxB,MAGLnpB,WAAAA,CAAYipB,GACVhpB,KAAKgpB,MAAQA,CACf,CAEAG,GAAAA,GACE,OAAOnpB,KAAKgpB,MAAMI,SACpB,CAEAC,IAAAA,CAAKC,GACH,OAAOlB,IAAW,IACTpoB,KAAKgpB,MAAMM,MAAMA,GAAOF,WAEnC,CAEAG,GAAAA,CAAIC,GACF,OAAOpB,IAAW,IACTpoB,KAAKgpB,MAAMO,IAAIC,IAE1B,CAEAC,OAAAA,CAAQ/M,GACN,OAAO0L,IAAW,IACTpoB,KAAKgpB,MAAMS,QAAQ/M,IAE9B,CAEA5R,MAAAA,CAAOpC,EAAeoC,GACpB,OAAOsd,IAAW,IACTpoB,KAAKgpB,MAAMle,OAAOpC,EAAKoC,IAElC,CAEAsP,OAAO1R,GACL,OAAO0f,IAAW,IACTpoB,KAAKgpB,MAAM5O,OAAO1R,IAE7B,CAEAghB,WAAAA,CAAYJ,GACV,OAAOlB,IAAW,IACTpoB,KAAKgpB,MAAMM,MAAMA,GAAOlP,UAEnC,CAEAwB,KAAAA,GACE,OAAOwM,IAAW,IACTpoB,KAAKgpB,MAAMpN,SAEtB,GChB8CqN,GAAMJ,QCzCzCc,GAAgB,IAAI7pB,GAAAA,EAC3B8pB,GAGF,CACFC,aAAcC,EAAAA,IACdC,OAAQ,IAAKC,EAAAA,MASR50B,eAAe60B,GACpBpB,EACA3P,EACAgR,EACAL,EACAM,GAEA,MAAMC,EAAmC,GACnCC,EAAgBte,EAAqBme,GAAgB,GAAI,QAE/D,IAAK,MAAM,KAAE7C,KAASiD,KAAaJ,GAAgB,GAAI,CACrD,MAAMK,EAAcX,GAAYG,OAAO1C,GACvC,GAAIkD,EAAa,CACf,MAAMC,EAAQ,IAAKD,KAAgBD,GACnCV,GAAYG,OAAO1C,GAAQmD,EAC3BJ,EAAY5lB,KAAKgmB,EACnB,CACF,CAEA,IAAK,MAAMA,KAAS3B,EAAQ,CAC1B,MAAM,KAAExB,GAASmD,EAEXC,EAAcC,GAAoBF,EAAOH,EAD3BT,GAAYG,OAAO1C,IAGjCmD,EAAMnD,QAAQuC,KAClBO,GAAmB,GAGrBP,GAAYG,OAAOS,EAAMnD,MAAQoD,EAC7BD,EAAMxY,cACRoY,EAAY5lB,KAAKimB,EAErB,CAEIZ,IACFD,GAAYC,aAAeA,SAGvBX,GAAgBO,QAAQW,GAE1BD,GAAoBjR,GACtByR,GAAiBzR,EAErB,CAEA,SAASwR,GACPF,EACAH,EACAE,GAEA,OAAIA,EAEK,IACF1d,EAAc2d,EAAMI,cAAgBL,EAAcC,MAClD3d,EAAc2d,EAAMI,cAAgBJ,EAAQD,GAC/CM,MAAOL,EAAMK,OAASN,EAAYM,MAClCC,SAAUN,EAAMM,UAAYP,EAAYO,SACxCC,iBAAkBP,EAAMO,kBAAoBR,EAAYQ,kBAEjDP,EAAMnD,QAAQgD,EAChB,IACFG,KACAH,EAAcG,EAAMnD,OAGlBmD,CAEX,CAEO,SAASQ,KACd,OAAOpB,EACT,CAEO,SAASqB,GAAe5D,GAC7B,OAAOuC,GAAYG,OAAO1C,EAC5B,CAEO,SAAS6D,GAAkBlZ,GAChC,OAAOiZ,GAAeE,GAAe,MAAOnZ,GAC9C,CAEO,SAAS2Y,GAAiBzR,GAC/BA,EAAS,CACP/iB,KAAM,eACN0yB,OAAQe,GAAYG,OACpBF,aAAcD,GAAYC,cAE9B,CAEO,SAASsB,GAAe1N,EAAiB5T,GAE9C,MAAO,GAAG4T,KADU5T,EAAQzC,QAAQ,aAAc,IAAIlT,MAAM,EAAG,MAC9BmD,aACnC,CCvGA,MAAM+zB,GAA0B,IAC1BC,GAA0D,CAC9D,eAAgB,WAChB,eAAgB,WAChB,eAAgB,WAChB,eAAgB,OAChB,eAAgB,OAChB,eAAgB,OAChB,eAAgB,OAEhB,eAAgB,OAEhB,eAAgB,MAiBXj2B,eAAek2B,GAAiB7hB,EAAqBI,GAE1D,aAD+D0hB,GAAgB9hB,EAAS,eAAgB,CAAEI,aAC5F2hB,aAAa3hB,EAC7B,CAMOzU,eAAeq2B,GAAehiB,EAAqBiiB,GACxD,MAAQC,QAASC,EAAQJ,aAAcK,SAAsBN,GAG1D9hB,EAAS,gBAAiB,CAAEI,QAAS6hB,EAAUzzB,KAAK,OAEjD6zB,EAAyBpf,OAAOqf,YAAYH,EAAOrhB,KAAKyhB,GAAU,CACtEA,EAAMniB,QAAQxS,cACd40B,GAAgBD,EAAOH,OAGzB,OAAOnf,OAAOqf,YAAYL,EAAUnhB,KAAK2hB,IACvC,MAAMC,EAAanY,GAAakY,GAAc70B,cAC9C,MAAO,CACL60B,EACAJ,EAAuBK,IAAe,CACpCtiB,QAASqiB,EACTE,QAAS,GACTC,eAAe,EACfC,MAAO,GAEV,IAEL,CAEA,SAASL,GAAgBD,EAAoBH,GAC3C,MAAO,CACLhiB,QAASgiB,EAAYG,EAAMniB,SAAS0iB,cACpC9D,QAAS,gBAAiBuD,EAAQX,GAAYW,EAAMQ,kBAAe71B,EACnEy1B,QAAStkB,OAAOkkB,EAAMI,SACtBC,cAAgC,WAAjBL,EAAMxE,OACrB8E,MAAO,UAAWN,EAAQA,EAAMM,MAAQ,EACxCG,SAAUT,EAAMU,sBAAwB1F,GAAUgF,EAAMU,4BAAyB/1B,EACjFS,OAAQy0B,EAAYG,EAAMniB,SAASzS,aAAUT,EAEjD,CAmBO,SAAS40B,GAAyB9hB,EAAqBW,EAAcwB,GAC1E,MACMoY,EAAM,GADgB,YAAZva,EAAwBoI,EAAAA,IAAwBN,EAAAA,aAChCnH,IAEhC,OAAOua,EAAAA,GAAAA,IAAUX,EAAKpY,EAAM,CAC1B+F,QAASgb,GAAoBljB,IAEjC,CAEO,SAASkjB,GAAoBljB,GAClC,MAAM,WAAEiG,EAAU,oBAAEE,EAAmB,oBAAEG,GAAwBG,KAC3DwB,EAAqB,YAAZjI,EAAwBsG,EAAsBH,EAE7D,MAAO,IACFF,KACCgC,GAAU,CAAE,YAAaA,GAC7B,oBAAqBkb,EAAAA,IAEzB,iBCjHA,MAAMC,GAAY,IACZC,GAAe,IAErB,IAAIC,GAEJ,SAASC,GAAOvjB,GACd,IAAKsjB,GAAc,CACjB,MAAMpb,EAAU,IACXzB,KAAiBR,WACpB,eAAgB,oBAGlBqd,GAAe,CACb3b,QAAS,IAAI6b,GAAAA,GAAI,IAAIC,GAAAA,GAAW,CAC9BC,QAASC,EAAAA,IACTC,cAAe,CAAE1b,WACjB2b,YAAajJ,GAAAA,MAEfzS,QAAS,IAAIqb,GAAAA,GAAI,IAAIC,GAAAA,GAAW,CAC9BC,QAASI,EAAAA,IACTF,cAAe,CAAE1b,WACjB2b,YAAajJ,GAAAA,MAGnB,CAEA,OAAO0I,GAAatjB,EACtB,CAEOrU,eAAeo4B,GAAoB/jB,EAAqBsU,GAC7D,aAAciP,GAAOvjB,GAASgkB,SAASC,0BAA0B3P,EAAS,CACxE4P,qBAAsB,CAAC,qBACrBC,QACN,CAEOx4B,eAAey4B,GAAcpkB,EAAqBiiB,GACvD,aAAcsB,GAAOvjB,GAAS2d,IAAI0G,uBAAuB,CACvDC,YAAarC,KACXsC,SACN,wBCgBA,MAAMC,GAA0B,EAWhC,MAAMC,GAAgD,CACpDn5B,MAAQb,IACN,MAAMshB,EAASnd,GAAOC,KAAK,IAErB61B,EAAaA,CAACv5B,EAAUw5B,EAAWC,KACvC,GAAIA,GAfW,IAeAz5B,EAAEP,SAAS,GACxB,MAAM,IAAIE,MAAM,kCAQlB,OALA65B,EAAI/1B,GAAOwT,OAAO,CAACuiB,EAAGx5B,EAAEO,WAAWP,EAAE05B,cAAgB,KAC7B,IAApB15B,EAAE25B,gBACJH,EAAID,EAAWv5B,EAAE45B,UAAUC,aAAcL,GAAG,IAGvCA,CAAC,EAGV,OAAOD,EAAWj6B,EAAMs6B,UAAUC,aAAqBjZ,GAAQ,EAAK,EAEtEkZ,UAAWA,QAKPC,GAEF,CACFC,IAAK,QACL5wB,KAAM,OACN6wB,YAAa,OACbC,MAAO,QACPC,OAAQ,OACRlnB,SAAU,OACVmnB,uBAAwB,SA6CnB55B,eAAe65B,GAA4BL,GAEhD,OAAOziB,QADgB+iB,EAAAA,GAAAA,IAAmBN,GACpB,CACpB,OACA,cACA,SACA,WACA,QACA,aACA,0BAEJ,CAEOx5B,eAAe+5B,GACpB1lB,EACAI,EACAmF,GAEA,MAAM9a,EA2UR,SAAqB0X,GACnB,IAAI4J,EAEFA,EADkB,iBAAT5J,EACAvT,GAAOC,KAAKsT,EAAM,UAClBA,aAAgBvT,GAChBuT,EAEAvT,GAAOC,KAAKsT,GAGvB,IACE,OAAO8H,GAAK,KAAAC,QAAQ6B,GAAQ,GAAGiZ,YACjC,CAAE,MAAOj4B,GACP,GAAqB,mBAAjBA,aAAG,EAAHA,EAAKoC,SACP,MAAMpC,CAEV,CAEA,OAAO,IAAI44B,GAAAA,MAAM,IAAIC,GAAAA,UAAU,IAAIC,GAAAA,UAAU9Z,EAAQ,EAAmB,EAAhBA,EAAO7f,SAAc,GAC/E,CA9VgB45B,CAAYvgB,GACpB1C,EAA2B,CAAEnW,KAAM,UAAW6Y,UAEpD,OAAK9a,QAKAkB,eACLqU,EACAI,EACA3V,EACAs7B,EACAC,GAEA,IAAIC,EACJ,IAGE,GAFAA,EAASx7B,EAAMG,SAAS,IAEpBq7B,IAAW/yB,GAAAA,GAAO+Y,QAAS,CAG7B,MAAO,CAAEvf,KAAM,UAAWof,QAFXoa,GAAez7B,GACPS,SAAS,SAElC,CAAO,GAAI+6B,IAAW/yB,GAAAA,GAAOizB,UAAW,CAGtC,MAAO,CAAEz5B,KAAM,oBAAqB05B,iBAFrBF,GAAez7B,GACES,SAAS,UAE3C,CAAO,GAAIT,EAAMo6B,cAAgB,GAC/B,OAGF,MAAMla,EAAUlgB,EAAMO,YAAY,IAElC,OAAQi7B,GACN,KAAK9yB,GAAAA,GAAaiY,SAAU,KAAAib,EAC1B,MAAM9d,QAAqBM,GAAoB7I,EAASI,GAASqQ,OAAM,IAAM,KACvEmN,EAAO8D,GAAe,MAAOnZ,GAE7B+d,EAAS77B,EAAM87B,YACfC,EAAc/7B,EAAMg8B,cACpBC,EAAsBj8B,EAAMk8B,mBAElC,IAAKD,EACH,MAAO,CACLh6B,KAAM,+BACNie,UACA6b,YAAa7d,GAAgB6d,OAAat5B,EAAW8S,GACrDsmB,SACA1I,QAIJ,MAAM5S,EAAgBvgB,EAAMm8B,eACtB7b,EAAgBtgB,EAAM87B,YAC5B,IACIM,EADA5b,EAAiBxgB,EAAMm8B,eAG3B,IAAK3b,GAAkBxgB,EAAMo6B,cAAe,CAC1C,MAAM3Z,GAAU,IAAI9e,GAAAA,SAAU06B,UAAUr8B,EAAMs8B,SAASt8B,EAAMo6B,gBAC7DnhB,GAAM,EAAGjZ,EAAMq6B,eAAez2B,SAAQ,KACpC6c,EAAQS,SAASlhB,EAAMs6B,UAAU,IAEnC9Z,EAAiBC,EAAQU,SAC3B,CAEA,GAAIX,EAAgB,CAClB,MAAM+b,EAAsB/b,EAAe+Z,aACvCgC,EAAoBnC,cAAgB,KACtCgC,EAAuBG,EAAoBp8B,SAAS,IAExD,CAEA,MAAO,CACL8B,KAAM,kBACNie,UACA2b,SACAE,YAAa7d,GAAgB6d,OAAat5B,EAAW8S,GACrD0mB,oBAAqB/d,GAAgB+d,OAAqBx5B,EAAW8S,GACrEgL,cAAeA,aAAa,EAAbA,EAAeic,QAAQ/7B,SAAS,UAC/C6f,gBACAE,eAA8B,QAAhBob,EAAEpb,SAAc,IAAAob,OAAA,EAAdA,EAAgBY,QAAQ/7B,SAAS,UACjD27B,uBACAjJ,OACArV,eAEJ,CACA,KAAKnV,GAAAA,GAAU8zB,kBAAmB,KAAAC,EAChC,MAAMC,EAAW38B,EAAMg8B,cACjBC,EAAsBj8B,EAAMg8B,cAC5Bzb,EAAgBvgB,EAAMm8B,eACtB7b,EAAgBtgB,EAAM87B,YACtBtb,EAAiBoc,GAAuB58B,GACxCqhB,EAAUb,EAAiBqc,GAAYrc,EAAevgB,gBAAawC,EAEzE,IAAIywB,EACiB,CACnB,MAAM4J,QAA+ClL,MAC9CmL,SAAgBpD,GAAcpkB,EAAS,CAACI,IAC3ConB,IACF7J,EAAM8J,GAAiBznB,EAASwnB,EAAQD,GAE5C,CAEA,MAAO,CACL76B,KAAM,eACNie,UACAyc,SAAUze,GAAgBye,OAAUl6B,EAAW8S,GAC/C0mB,oBAAqB/d,GAAgB+d,OAAqBx5B,EAAW8S,GACrEgL,cAAeA,aAAa,EAAbA,EAAeic,QAAQ/7B,SAAS,UAC/C6f,gBACAE,eAAgBA,aAAc,EAAdA,EAAgBgc,QAAQ/7B,SAAS,UACjDw8B,WAAYtnB,EACZunB,QAAY,QAALR,EAAExJ,SAAG,IAAAwJ,OAAA,EAAHA,EAAK5yB,KACdopB,MACA7R,UAEJ,CACA,KAAK1Y,GAAAA,GAAUw0B,kBAAmB,CAChC,MAAMC,EAAYp9B,EAAMg8B,cAClBxb,EAAiBoc,GAAuB58B,GACxCqhB,EAAUb,EAAiBqc,GAAYrc,EAAevgB,gBAAawC,EAEzE,IAAIywB,EACiB,CACnB,MAAM4J,QAA+ClL,MAC9CmL,SAAgBpD,GAAcpkB,EAAS,CAACI,IAC3ConB,IACF7J,EAAM8J,GAAiBznB,EAASwnB,EAAQD,GAE5C,CAEA,MAAO,CACL76B,KAAM,yBACNie,UACAkd,UAAWlf,GAAgBkf,OAAW36B,EAAW8S,GACjD8L,UACA4b,WAAYtnB,EACZud,MAEJ,CACA,KAAKxqB,GAAAA,GAAa20B,KAAM,CACtB,MAAMvf,QAAqBM,GAAoB7I,EAASI,GAClDwd,EAAO8D,GAAe,MAAOnZ,GAE7B+d,EAAS77B,EAAM87B,YACfwB,EAAat9B,EAAMg8B,cACnBzb,EAAgBvgB,EAAMm8B,eACtBoB,EAAyBzf,IAAiB0f,EAAAA,IAEhD,MAAO,CACLv7B,KAAM,cACNie,UACA2b,SACAlmB,QAASuI,GAAgBof,OAAY76B,EAAW8S,GAChDgL,cAAeA,aAAa,EAAbA,EAAeic,QAAQ/7B,SAAS,UAC/C0yB,OACAoK,yBAEJ,CACA,KAAK30B,GAAAA,GAAoB60B,iBACvB,MAAO,CACLx7B,KAAM,gCACNie,WAGJ,KAAKtX,GAAAA,GAAoB80B,WACvB,MAAO,CACLz7B,KAAM,4BACNie,WAGJ,KAAKtX,GAAAA,GAAoB6Z,QAAS,CAChC,IAAIkb,EAIJ,OAHI39B,EAAMo6B,cAAgB,IACxBuD,EAAQ39B,EAAMO,YAAY,KAErB,CACL0B,KAAM,yBACNie,UACAyd,QAEJ,CACA,KAAK70B,GAAAA,GAAgB80B,aAAc,CACjC,MAAMxd,EAAYpgB,EAAMg8B,cAKxB,MAAO,CACL/5B,KAAM,wBACNie,UACAvK,cANQyhB,GAAiB7hB,EAAS6K,EAAUL,eAQhD,CACA,KAAKhX,GAAAA,GAAsB80B,SAEzB,MAAO,CACL57B,KAAM,4BACNie,UACA2b,OAJa77B,EAAM87B,aAOvB,KAAK/yB,GAAAA,GAAsB+0B,gBAAiB,CAC1C,MAAM1d,EAAYpgB,EAAMg8B,cAKxB,MAAO,CACL/5B,KAAM,oCACNie,UACAvK,cANQyhB,GAAiB7hB,EAAS6K,EAAUL,eAQhD,CACA,KAAKnX,GAAAA,GAAoBm1B,KAAM,CAC7B,MAAMC,EAAgBh+B,EAAMg8B,cACtBiC,EAAiBj+B,EAAMG,SAAS,IAChC+9B,EAAOl+B,EAAMm+B,UACbC,EAAmBp+B,EAAMm+B,UAE/B,MAAO,CACLl8B,KAAM,sBACNie,UACA8d,cAAe9f,GAAgB8f,GAAe,GAC9CC,iBACAC,OACAE,mBAEJ,CACA,KAAKp1B,GAAAA,GAAUq1B,aAAc,KAAAC,EAC3B,MAAMv0B,EAAO/J,EAAMiB,WAAW,IAAIR,SAAS,OACrCf,GACgC,QADrB4+B,EAAA9lB,OAAOiQ,QAAQlf,GAAAA,IAC7B4rB,MAAK9d,IAAA,IAAE,CAAEnV,GAAMmV,EAAA,OAAKtN,IAAS7H,CAAK,WAAC,IAAAo8B,OAAA,EADrBA,EACwB,KAAqB,UACxDle,EAAYpgB,EAAMg8B,cAClB94B,Q3BjEPhC,eAAgCqU,EAAqBI,GACnC,iBAAZA,IAAsBA,EAAU/U,GAAAA,QAAQC,MAAM8U,IAEzD,MAAM4oB,EAAWthB,GAAa1H,GAC3ByI,KAAK,IAAIwgB,GAAAA,EAAQ7oB,IAIdqE,GJzT+BykB,EIuTXvgB,UADJqgB,EAASG,cACmBD,mBAAmB,GJtT9DxkB,EAAAA,IAAckb,MAAMnb,GAASA,EAAK2kB,WAAaF,KADjD,IAAgCA,EI+TrC,MAAO,GAJMzkB,SAAAA,EAAM4kB,iBACTL,EAASM,0BACTN,EAASO,eAED9kB,aAAI,EAAJA,EAAME,SAAS,IACnC,C2BmDkB6kB,CAAiBxpB,EAAS6K,GAGpC,GAAI1gB,IAAa6C,GAAAA,GAAYG,OAAQ,CACnC,GAAI1C,EAAMq6B,cAAgB,EAAG,CAC3B,MAAM2E,EAAYh/B,EAAMs6B,UAAUC,aAClCv6B,EAAMi/B,WAEN,MAAMC,EAAcF,EAAUhD,cACxBmD,EAAQH,EAAU7+B,SAAS,GAMjC,MAAO,CACL8B,KAAM,oBACNie,UACAkf,OAAQ,CACNn9B,KAAM,SACNC,YARMk1B,GAAiB7hB,EAAS2pB,EAAYnf,eAS5Cof,SAEFj8B,SAEJ,CACE,MAAO,CACLjB,KAAM,oBACNie,UACAkf,OAAQ,CACNn9B,KAAM,SACNC,WAAOO,GAETS,SAGN,CAAO,GAAIlD,EAAMq6B,cAAgB,EAAG,CAClC,MAAMn4B,EAAQlC,EAAMs6B,UACpB,MAAO,CACLr4B,KAAM,oBACNie,UACAkf,OAAQ1/B,IAAa6C,GAAAA,GAAY88B,QAAU,CACzCp9B,KAAM,UACNuS,IAAKzK,EACL7H,MAAOA,EAAMs6B,QAAQ/7B,SAAS,WAC5B,CACFwB,KAAMvC,EACNwC,MAAOA,EAAMs6B,QAAQ/7B,SAAS,WAEhCyC,SAEJ,CACE,MAAO,CACLjB,KAAM,oBACNie,UACAkf,OAAQ1/B,IAAa6C,GAAAA,GAAY88B,QAAU,CACzCp9B,KAAM,UACNuS,IAAKzK,GACH,CACF9H,KAAMvC,GAERwD,SAGN,CACA,KAAKgG,GAAAA,GAAYo2B,mBAEf,MAAO,CACLr9B,KAAM,wBACNie,UACAqf,OAJav/B,EAAMiB,WAAW,IAAIR,SAAS,QAO/C,KAAKoI,GAAAA,GAAoB22B,eAGvB,MAAO,CACLv9B,KAAM,yBACNie,UACA2b,OALa77B,EAAM87B,YAMnB2D,QALcz/B,EAAM0/B,eAS5B,CAAE,MAAOp9B,GACP,GAAIq9B,EAAAA,IAAO,KAAAC,EACT,MAAMC,EAAgBtE,EAEhBuE,EAAY,KAAW,QAAXF,EAAKpE,SAAM,IAAAoE,OAAA,EAANA,EAAQn/B,SAAS,IAAIE,SAAS,EAAG,QACxDyE,EAAAA,EAAAA,IAAc,eAAgB06B,EAAWD,EAAe,KAAMv9B,EAChE,CACF,CAGF,CApUey9B,CAAkBxqB,EAASI,EAAS3V,IAAgBoY,EAF9CA,CAGrB,CA0VO,SAASykB,GAAY78B,GAC1B,KAAIA,EAAMo6B,cAAgB,KAIXp6B,EAAMG,SAAS,MACfsI,GAAAA,GAAO+Y,UAAaxhB,EAAMo6B,eAAkBp6B,EAAMq6B,eAKjE,OADeoB,GAAez7B,GAChBS,SAAS,QACzB,CAEA,SAASm8B,GAAuB58B,GAC9B,IAAIwgB,EAAiBxgB,EAAMm+B,WAAan+B,EAAMq6B,cAAgBr6B,EAAMs6B,eAAY73B,EAEhF,IAAK+d,GAAkBxgB,EAAMo6B,cAAe,CAC1C,MAAM3Z,GAAU,IAAI9e,GAAAA,SAAU06B,UAAUr8B,EAAMs8B,SAASt8B,EAAMo6B,gBAC7DnhB,GAAM,EAAGjZ,EAAMq6B,eAAez2B,SAAQ,KACpC6c,EAAQS,SAASlhB,EAAMs6B,UAAU,IAEnC9Z,EAAiBC,EAAQU,SAC3B,CAEA,OAAOX,QAAkB/d,CAC3B,CAEO,SAASg5B,GAAez7B,GAC7B,IAAIshB,EAASnd,GAAOyT,MAAM,GAE1B,KAAO5X,EAAMo6B,eAAiB,IAC5B9Y,EAASnd,GAAOwT,OAAO,CAAC2J,EAAQthB,EAAMiB,WAAWjB,EAAMo6B,cAAgB,KACnEp6B,EAAMq6B,gBACRr6B,EAAQA,EAAMs6B,UAAUC,aAM5B,OAAOjZ,CACT,CAEO,SAAS0e,GAAyBC,GAKvC,MAAM,GAAE3qB,EAAE,MAAEslB,EAAK,WAAEsF,GAAeD,EAElC,IAAIE,EACAC,EACAhoB,EAAyB,CAAC,EAIoC,IAAAioB,EAQ/CC,EAMiBC,GAjBhC3F,IAAOxiB,EAAOooB,SAAW5F,QAClBn4B,IAAP6S,IAAkB8C,EAAOqoB,UAAYnrB,GAErC4qB,GAAchuB,MAAMqH,QAAQ2mB,IAAeA,EAAWz+B,SACxD0+B,EAC4D,QADjDE,EAAGH,EACX/K,MAAMuL,GAAuC,cAAzBA,EAAUC,oBAA2B,IAAAN,OAAA,EAD9CA,EACgDn+B,MAE3DgR,QAAQ,gBAAiB,IACzB0tB,OACAz9B,cAECg9B,MACFC,EACuD,QADxCE,EAAGJ,EACf/K,MAAMuL,GAAuC,SAAzBA,EAAUC,oBAAsB,IAAAL,OAAA,EADrCA,EACuCp+B,MACtDiB,cAEHiV,EAAO+nB,YAAcA,EACD,aAAhBA,IACF/nB,EAAOyoB,uBACiD,QAD3BN,EAAGL,EAC7B/K,MAAMuL,GAAuC,UAAzBA,EAAUC,oBAAuB,IAAAJ,OAAA,EADxBA,EAC0Br+B,MACvDiB,eAIHiV,EAAOgoB,gBADe,SAApBA,GAA8C,WAAhBD,EACP,OAEA,QAG3B/nB,EAASO,EAAcP,IAI3B,OAAQyb,GAAczb,QAAmB3V,EAAT2V,CAClC,CAEO,SAAS4kB,GACdznB,EACAwnB,EACAD,GAEA,GAAKC,EAAOkD,SAIZ,IACE,MAAM,QACJtqB,EAAO,MACP2B,EAAK,WACLQ,EACAmoB,SAAUa,EAAW,SACrBC,EAAQ,KACRC,EAAI,MACJC,EAAK,MACLC,GACEnE,GAEE,KACJjzB,EAAI,MAAE8wB,EAAK,YAAED,EAAawG,YAAaC,EAAU,WAAElB,EAAU,OAAEmB,GAC7DP,EAYErC,EAAoB3mB,GAAcoG,GAAgBpG,EAAWnC,SAAS,EAAMJ,GAClF,IAAI+rB,GAAc,EAElB,IAAK7C,IAAsB3M,GAAyB2M,GAClD,IAAK,MAAMxQ,IAAQ,CAACnkB,EAAM6wB,GAAaliB,OAAOM,SACxCgZ,GAAiB9D,KACnBqT,GAAc,GAMpB,MAAMC,EAA0B,cAAVN,EAEhBO,EAASF,GAA+B,SAAhB3G,GAAoC,cAAVsG,EAClDQ,EAA0B,WAAfL,GAA2BI,EACtCE,EAAmBX,EAAU5L,MAAMnnB,GAAuB,cAAjBA,EAAE2zB,aAA6B7R,IACxE8R,EAAiBC,GAAkB/E,EAAwC2B,GAE3EwB,EAAW,CACfC,gBACIqB,GAAiBF,GAAU,CAAEA,QAAQS,EAAAA,GAAAA,IAAoBT,OACzD5C,IAAsBsD,EAAAA,IAAwB/B,GAAyBc,MACvEc,GAAkB,CAAEI,YAAapH,EAAO1nB,QAAQ+uB,EAAAA,IAAsC,gBAG5F,OAAOtpB,EAAsB,CAC3BrB,QACAxN,OACAo4B,aAAchB,EAAQhjB,GAAgBgjB,EAAMvrB,SAAS,EAAOJ,QAAW9S,EACvEkT,QAASuI,GAAgBvI,GAAS,EAAMJ,GACxCqlB,OAAOuH,EAAAA,GAAAA,IAAWT,GAAoB9G,GAAS,IAC/CwH,UAAWrB,EAAU5L,MAAMnnB,GAAuB,YAAjBA,EAAE2zB,aAA2B7R,IAC9DuS,SAAUtpB,QAAQioB,GAClBS,WACAD,SACA7G,iBACI7iB,GAAc,CAChB2mB,oBACA6D,eAAgBxqB,EAAWhO,KAC3By4B,aAAcX,GAAkBY,EAAAA,IAAyBnjC,SAASyY,EAAWnC,SAC7E8sB,eAAgBb,GAElB3B,YAEJ,CAAE,MAAO39B,GAEP,YADA8C,EAAAA,EAAAA,IAAc,WAAY9C,EAE5B,CACF,CAEO,SAASu/B,GACd/E,EACA2B,GACA,IAAAiE,EACA,QAAOjE,IACsD,QAAzDiE,EAAA5F,EAAuC2B,UAAkB,IAAAiE,OAAA,EAAzDA,EAA2DptB,MAAOqtB,EAAAA,GAExE,CChsBO,SAASC,GAAgBC,EAAWC,GACzC,MAAMC,SAAeF,EAErB,GAAIE,WADiBD,EAEnB,OAAO,EAIT,GAAc,WAAVC,GAAiC,OAAXF,GAA8B,OAAXC,EAC3C,OAAOD,IAAWC,EAGpB,MAAME,EAAW9wB,MAAMqH,QAAQspB,GAG/B,GAAIG,IAFa9wB,MAAMqH,QAAQupB,GAG7B,OAAO,EAGT,GAAIE,EAAU,CACZ,MAAMtpB,EAASmpB,EACTlpB,EAASmpB,EAEf,OAAIppB,EAAOjY,SAAWkY,EAAOlY,QAItBiY,EAAOupB,OAAM,CAACC,EAAS9/B,IAAMw/B,GAAaM,EAASvpB,EAAOvW,KACnE,CAEA,MAAM+/B,EAAUN,EACVO,EAAUN,EACVO,EAAQ7qB,OAAOL,KAAKgrB,GACpBG,EAAQ9qB,OAAOL,KAAKirB,GAE1B,QAAKC,EAAMJ,OAAOM,GAASH,EAAQrP,eAAewP,QAG7CD,EAAML,OAAOO,GAASL,EAAQpP,eAAeyP,MAI3CH,EAAMJ,OAAOM,GAASX,GAAaO,EAAQI,GAAOH,EAAQG,KACnE,iBCzCO,SAASE,GAA0Bhe,GAA2C,IAAAie,EAAAC,EACnF,OAAkC,QAA3BD,EAACje,EAAgBme,kBAAU,IAAAF,OAAA,EAA3BA,EAA6BG,eAAmC,QAAxBF,EAAKle,EAAgBqe,WAAG,IAAAH,OAAA,EAApBA,EAAsBE,cAAe,UAC1F,CCiCA,IAAIE,GAqDAC,GA9BG,SAASC,GAA8CjR,GAC5D,GAAsB,gBAAlBA,EAASC,KACX,OAAOD,EAGT,MAAM,kBACJkR,EAAiB,QAAE7iB,EAAO,WAAE8iB,EAAU,IAAEjR,GACtCF,EACJ,IAAI,SAAEiN,EAAW,CAAC,GAAMjN,EAExB,MAAMoR,EAAgBrrB,QAAQma,GACxBnC,EAAiBY,KACjB0S,IAAiBhjB,GdjBhB2P,GciB2C1a,MAAMguB,GAAOA,EAAGrxB,KAAKoO,KAGjEkjB,IAFsBF,IAAkBhjB,IAAW8iB,IACnDC,IAAiB/iB,EAAQle,cAAc9D,SAAS,YAEjD0yB,GAAiB1Q,KdOmB4M,EcPoB5M,EdQtDmjB,EAAAA,IAAkBvxB,KAAK+b,GAAUf,MADnC,IAAoCA,EcIzC,OARIiW,KAAqBnT,IACvBkP,EAAW,IAAKA,KAAalP,EAAemT,MAG1CG,GAAkBE,KACpBtE,EAASuB,QAAS,GAGb,IAAKxO,EAAUiN,WACxB,CAYO,SAASwE,GAAezf,GAC7B,OAAOgf,KAAoBhf,CAC7B,CA+TA,SAAS0f,GAAkB7a,GACzB,MAAM,GAAEvU,EAAE,QAAEC,GAAYsU,EACxB,MAAO,GAAGvU,SAAUC,GACtB,CAEArU,eAAeyjC,KACb,MAAMxsB,QAAa2Q,GAAiBnB,UAEpC,GAAIxP,SAAAA,EAAM1W,OAAQ,CAChB,MAAM+mB,EAAyB,GAE/B,IAAK,MAAMhU,KAAO2D,EAAM,CACtB,GAAI3D,EAAIC,WAAW,WACjB,SAGF,MAAMmwB,EAAY,UAAUpwB,IACtBtS,QAAc4mB,GAAiBzB,QAAQ7S,GAAmB,IAEhEqwB,EAAAA,GAAAA,QAAiBpiC,IAAVP,EAAqB,sBACtB4mB,GAAiBtB,QAAQod,EAAW1iC,GAC1C,MAAM4iC,QAAoBhc,GAAiBzB,QAAQud,IACnDC,EAAAA,GAAAA,GAAOjC,GAAa1gC,EAAO4iC,GAAc,4BAEzCtc,EAAMlY,KAAK,CAACkE,EAAKtS,GACnB,CAEA,IAAK,MAAOsS,EAAKtS,KAAUsmB,EAAO,CAChC,IAAIuc,GAAgB,QACdjc,GAAiBtB,QAAQhT,EAAmBtS,GAAO8jB,OAAM,KAC7D+e,GAAgB,CAAI,IAGlBA,UACIjc,GAAiBrB,WAAWjT,SAC5BsU,GAAiBtB,QAAQhT,EAAmBtS,GAEtD,CACF,CACF,CC3WA,MAAM8iC,GAA0B,qEAE1BC,GAAwB,iDAExBC,GAAyC,IAAI3sB,IAAmB,CAHtC,uEAuBzBrX,eAAeikC,GAAa5V,GACjC,MAAM,QACJha,EAAO,OAAEkD,EAAM,MAAE2sB,EAAK,YAAEC,EAAW,cAAEC,EAAa,kBAClDC,EAAiB,gBAAEC,EAAe,cAAEnmB,EAAa,aACjDomB,EAAY,aAAEC,GACZnW,EAEE7X,EAAmB,CACvBmS,QAAS,YAAapR,EAASA,EAAO9C,aAAUlT,EAChDkjC,UAAW,aAAcltB,EAASA,EAAOmtB,cAAWnjC,EACpD2iC,QACAS,YAAaP,GAAiB5R,GAAU4R,IAAmBC,EAAwB,EAAJ,GAC/EO,UAAWT,GAAe3R,GAAU2R,IAAiBG,EAAsB,EAAJ,GACvEO,KAAM,WACFN,aAAY,EAAZA,EAAchkC,SAAU,CAAEukC,YAAaP,EAAa1hC,KAAK,UACzD2hC,aAAY,EAAZA,EAAcjkC,SAAU,CAAEwkC,oBAAqBP,EAAa3hC,KAAK,QAMrEmiC,QAASC,EACT7O,aAAcK,EAAW,SACzBsI,EAAW,CAAC,SACJ5I,GAAiC9hB,EAAS,WAAYmC,GAGhE,OAAO0uB,GACL7wB,EACA8J,EACA8mB,EACAxO,EACAsI,QAPmDrO,KAUvD,CAwBO,SAASwU,GACd7wB,EACA8J,EACA8mB,EACAxO,EACAsI,EACAnD,EACAvJ,GAEA,MAAMhE,EAAwB,CAC5Bha,UACAoiB,cACAtY,gBACA4gB,WACAnD,yCACAvJ,aAEI8S,EAAa,GAEnB,IAAK,MAAMC,KAAUH,EACnBE,EAAW/1B,QAAQi2B,GAAYD,EAAQ/W,IAGzC,OAAO8W,CACT,CAEA,SAASE,GAAYD,EAAmB/W,GACtC,IAAInX,EAAsC,GAE1C,OAAQkuB,EAAOrkC,MACb,IAAK,eACHmW,EAAS,CAACouB,GAAiBF,EAAQ/W,IACnC,MAEF,IAAK,gBACHnX,EAAS,CAACquB,GAAkBH,EAAQ/W,IACpC,MAEF,IAAK,kBACHnX,EAAS,CAACsuB,GAAoBJ,EAAQ/W,IACtC,MAEF,IAAK,eACHnX,EAAS,CAACuuB,GAAiBL,EAAQ/W,IACnC,MAEF,IAAK,WACHnX,EAAS,CAACwuB,GAAaN,EAAQ/W,IAC/B,MAEF,IAAK,kBACHnX,EAAS,CAACyuB,GAAoBP,EAAQ/W,IACtC,MAEF,IAAK,cACHnX,EAAS,CAAC0uB,GAAgBR,EAAQ/W,IAClC,MAEF,IAAK,cACHnX,EAAS,CAAC2uB,GAAgBT,EAAQ/W,IAClC,MAEF,IAAK,gBACHnX,EAAS,CAAC4uB,GAAkBV,EAAQ/W,IACpC,MAEF,IAAK,mBACHnX,EAAS,CAAC6uB,GAAqBX,EAAQ/W,IACvC,MAEF,IAAK,2BACHnX,EAAS,CAAC8uB,GAA4BZ,EAAQ/W,IAC9C,MAEF,IAAK,cACHnX,EAAS,CAAC+uB,GAAgBb,EAAQ/W,IAClC,MAEF,IAAK,aACL,IAAK,aACL,IAAK,YACHnX,EAAS,CAACgvB,GAASd,EAAQ/W,IAC3B,MAEF,IAAK,cACHnX,EAAS,CAACivB,GAAgBf,EAAQ/W,IAClC,MAEF,IAAK,wBACHnX,EAASkvB,GAAsBhB,EAAQ/W,GACvC,MAEF,IAAK,yBACHnX,EAgeN,SAAgCkuB,EAAoC/W,GAClE,MAAM,YAAEoI,GAAgBpI,GAClB,QAAE6G,EAASA,SAAS,OAAEmR,EAAM,KAAEroB,EAAI,IAAEsoB,IAAUlB,EAI9CmB,EAAkB,IAFTC,GAAkBpB,EAAQ/W,EAASrQ,EAAMqoB,GAItDI,mBAAmB,EACnB1lC,KAAM,oBACN2lC,MAAO,CACLJ,IAAKK,GAAaL,KAIhBM,EAAeC,GAAsBzB,EAAQ,cAEnD,MAAO,CACL,IACKmB,EACH5L,OAAQjoB,OAAOwiB,EAAQ4R,UACvB7U,KAAM8U,GAAatQ,EAAavB,EAAQ8R,UAE1C,IACKT,EACHnyB,GAAIwyB,EACJnV,KAAMmV,EACNjM,OAAQjoB,OAAOwiB,EAAQ+R,UACvBhV,KAAM8U,GAAatQ,EAAavB,EAAQgS,UAG9C,CA/feC,CAAuB/B,EAAQ/W,GAK5C,IAAK,IAAInsB,EAAI,EAAGA,EAAIgV,EAAO3W,OAAQ2B,IAAK,KAAAklC,EACtC,MAAMtV,EAAW5a,EAAOhV,GACnB4vB,IAED,QAASA,GAAwB,QAAhBsV,EAAItV,EAASE,WAAG,IAAAoV,GAAZA,EAAc7G,WACrCzO,EAASuV,YAAa,GAGF,gBAAlBvV,EAASC,MAA2BD,EAASmR,aAC/CnR,EAAS2U,qBAAsB,GAGjCvvB,EAAOhV,GAAK6gC,GAAuBjR,GACrC,CAEA,OAAO5a,EAAOK,OAAOM,QACvB,CAEA,SAASytB,GAAiBF,EAA2B/W,GACnD,MAAM,QAAE6G,EAASA,SAAW7J,UAAWic,EAAW,OAAEjB,EAAM,YAAExL,EAAW,MAAE75B,IAAYokC,EAE/EjlB,GAAYmnB,GAAepS,EAAQ/U,cAAY5e,EAC/Ck5B,EAAoB6M,GAAepS,EAAQ/U,cAAY5e,EAE7D,MAAO,IACFilC,GAAkBpB,EAAQ/W,EAASgY,EAAQxL,EAAa75B,GAC3DixB,KAAMtf,EAAAA,IAAQsf,KACd9R,UACAsa,mBAEJ,CAEA,SAAS8K,GAAkBH,EAA4B/W,GACrD,MAAM,cAAElQ,GAAkBkQ,GACpB,QAAE6G,EAASA,SAAS,OAAEmR,EAAM,YAAExL,EAAW,MAAE75B,IAAYokC,EAEvDmC,EAASf,GAAkBpB,EAAQ/W,EAASgY,EAAQxL,EAAa75B,GACjEs5B,EAAS9oB,OAAO0jB,EAAQsS,QACxBH,GAAcE,EAAOtE,YAAc,CAAC17B,GAAAA,GAAOkgC,OAAQ1/B,GAAAA,GAAeK,IAAIjK,SAASm8B,GAErF,IAAIv5B,EAYJ,OAXImH,GAAAA,GAAgB/J,SAASm8B,GAC3Bv5B,EAAO,SAEEu5B,IAAW/yB,GAAAA,GAAOmgC,QAC3B3mC,EAAO,UACE,CAAC4G,GAAAA,GAAoB22B,eAAgB32B,GAAAA,GAAoBggC,cAAcxpC,SAASm8B,GACzFv5B,EAAO,iBACEwmC,EAAOroB,YAAcf,IAC9Bpd,EAAO,gBAGF,IACFwmC,EACHtV,KAAMtf,EAAAA,IAAQsf,KACdlxB,OACAsmC,aAEJ,CAEA,SAAS7B,GAAoBJ,EAA8B/W,GACzD,MAAQ6G,SAAS,OAAEmR,EAAM,YAAExL,IAAkBuK,EAE7C,GAAKiB,EAML,MAAO,IACFG,GAAkBpB,EAAQ/W,EAASgY,EAAQxL,GAC9C5I,KAAMtf,EAAAA,IAAQsf,KACdlxB,KAAM,iBACN0lC,mBAAmB,EACnBmB,IAAK,GAET,CAEA,SAASjC,GAAoBP,EAA8B/W,GACzD,MAAM,YAAEoI,GAAgBpI,GAClB,QACJ6G,EACAA,SACE2S,qBAAsBP,EACtBQ,gBAAiBxoB,EAAc,OAC/ByoB,EAAM,SACNC,EAAQ,OACRrN,IAEAyK,EAEEmC,EAASf,GAAkBpB,EAAQ/W,EAAS0Z,EAAQC,EAAUrN,IAC9D,WAAEsI,EAAU,UAAE/jB,EAAS,YAAE+oB,GAAgBV,EAEzCpnB,GAAYmnB,GAAepS,EAAQ/U,cAAY5e,EAC/Ck5B,EAAoB6M,GAAepS,EAAQ/U,cAAY5e,EACvDqb,EAAe6Z,EAAYvB,EAAQgT,OAAO/Q,cAC1ClF,EAAO8D,GAAe,MAAOnZ,GAC7ByqB,GAAcpE,GAAc3jB,IAAmBvY,GAAAA,GAErD,IAAIhG,EAeJ,OAdIme,IAAcipB,EAAAA,IAChBpnC,EAAO,OACEme,IAAckpB,EAAAA,IACvBrnC,EAAO,QACEknC,IAAgBG,EAAAA,IACzBrnC,EAAO,UACE6b,IAAiByrB,EAAAA,IAASzrB,eAC/BqrB,IAAgBK,EAAAA,IAClBvnC,EAAO,UACEme,IAAcopB,EAAAA,MACvBvnC,EAAO,UAIJ,IACFwmC,EACHtV,OACA9R,UACAsa,mBACA4M,aACAtmC,OAEJ,CAEA,SAAS6kC,GAAgBR,EAA0B/W,GACjD,MAAM,YAAEoI,GAAgBpI,GAClB,QACJ6G,EACAA,SAAS,SACP8S,EACAO,uBAAwBC,EAAe,OACvC7N,IAEAyK,EAEExoB,EAAe6Z,EAAYvB,EAAQgT,OAAO/Q,cAC1ClF,EAAO8D,GAAe,MAAOnZ,GAEnC,IAAI6rB,EACA1nC,EAA2B,OAkB/B,OAfE6b,IAAiB8rB,EAAAA,IAAW9rB,cACzBwoB,EAAOuD,SAAWvD,EAAOwD,cAG5B7nC,EAAO,iBACP0nC,EAAe,IACVjC,GAAkBpB,EAAQ/W,EAAS2Z,EAAUA,EAAU,GAC1D9oB,UAAWopB,EAAAA,IACXrF,YAAY,EACZD,kBAAmBsF,EAAAA,MAGrBG,EAAejC,GAAkBpB,EAAQ/W,EAASma,EAAiBR,EAAUrN,GAGxE,IACF8N,EACHxW,OACAlxB,OAEJ,CAEA,SAAS8kC,GAAgBT,EAA0B/W,GACjD,MAAM,QAAEha,GAAYga,GACd,QAAE6G,EAASA,SAAS,MAAE8K,EAAO6I,oBAAqBC,EAAY,OAAEnO,IAAayK,EAE7EnT,EAAO8D,GAAe,MAAO/Y,GAAgBkY,EAAQgT,OAAO,EAAM7zB,IAExE,MAAO,IACFmyB,GAAkBpB,EAAQ/W,EAAS2R,EAAO8I,EAAcnO,GAC3D1I,OACAlxB,KAAM,OAEV,CAEA,SAAS0kC,GAAiBL,EAA2B/W,GACnD,MAAM,SACJ0Q,EAAQ,cACR5gB,EAAa,YACbsY,EAAW,uCACXmF,GACEvN,GAGF0a,eAAgB3yB,EAChB4yB,SAAUC,EACVC,eAAgBC,EAChBC,UAAW3N,EACX4N,UAAWC,EACXxB,gBAAiBxoB,EACjBiqB,YAAaC,EAAU,MACvB/T,EACAgU,qBAAsB1O,EAAmB,YACzC2O,GACEtE,EAAOlQ,SAEL,IAAElD,EAAG,kBAAE2X,GAAsBC,GACjC7K,EACAkK,EACArN,EACAuN,QAAwB5nC,EACxB6U,QAAS7U,GAGX,IAAI8lC,GAAcrV,GAAOmX,EAmE3B,SAA4BA,EAA8BpK,GAAuB,IAAA8K,EAAAC,EAC/E,MAAMC,EAAmD,QAAjCF,EAAG9K,EAASoK,UAAqB,IAAAU,OAAA,EAA9BA,EAAgCG,WAAW,GACtE,OAAOD,SAAwB,QAAND,EAAlBC,EAAoBnhC,YAAI,IAAAkhC,OAAA,EAAxBA,EAA0B3rC,SAAS,oBAC5C,CAtEkD8rC,CAAmBd,EAAsBpK,QAAYx9B,EAKrG,GAAI+nC,GAAY7N,GAAYV,EAAqB,KAAAmP,EAAAC,EAC/C,MAAMC,EAAuC,QAAxBF,EAAGzT,EAAY6S,UAAS,IAAAY,OAAA,EAArBA,EAAuB/S,cACzCkT,EAAuC,QAAxBF,EAAG1T,EAAYgF,UAAS,IAAA0O,OAAA,EAArBA,EAAuBhT,cAE3CiT,IAAoBjsB,GAAiBksB,IAAoBlsB,IAC3DkpB,GAAa,EAEjB,CAEA,MAAMvV,EAAmC,IACpC0U,GAAkBpB,EAAQ/W,EAASib,GAAYL,EAAexN,GACjE4L,aACApV,KAAMtf,EAAAA,IAAQsf,KACdD,MACA7R,QAAUb,IAucWgrB,EAvcuBhrB,GAwcvCirB,EAAAA,GAAAA,IAAS,KACd,MAAM5rC,EAAO2f,GAAAA,KAAKksB,WAAWF,GAC7B,IAAI3rC,EAAK8rC,SACT,OAAO9O,GAAYh9B,EAAKI,UAAU,WA3c8BwC,EAChEmpC,aAAef,GAAqB3F,GAAuCxsB,IAAI4tB,EAAOlQ,QAAQgU,sBACzF3nC,GAqcT,IAAyB+oC,EAlcvB,GAAIxY,EAAS5S,YAAcipB,EAAAA,IACzBrW,EAAS/wB,KAAO,YACX,GAAIyoC,GAAc/T,EAAO,KAAAkV,EAC9B,MAAMC,GAAgC,QAArBD,EAAAlU,EAAYgF,UAAS,IAAAkP,OAAA,EAArBA,EAAuBxT,iBAAkBhZ,EAC1D2T,EAAS/wB,KAAO,WAChB+wB,EAASmR,YAAc2H,EACvB9Y,EAAS6I,OAASiQ,GAAYl4B,OAAO+iB,GAAS/iB,OAAO+iB,GACrD3D,EAAS4U,MAAQ,CACfgD,YAAaA,QAAenoC,EAEhC,CAEA,OAAOuwB,CACT,CAEA,SAAS4T,GAAaN,EAAuB/W,GAC3C,MAAM,SAAE0Q,EAAQ,uCAAEnD,GAA2CvN,GAEvD,MACJ2R,EACA+I,eAAgB3yB,EAChB4yB,SAAUC,EACVC,eAAgBC,GACd/D,EAAOlQ,SAEL,IAAElD,EAAG,kBAAE2X,GAAsBC,GACjC7K,EACAkK,EACArN,EACAuN,QAAwB5nC,EACxB6U,QAAS7U,GAGX,MAAO,IACFilC,GAAkBpB,EAAQ/W,EAAS2R,EAAOiJ,GAC7ChX,KAAMtf,EAAAA,IAAQsf,KACdD,MACAjxB,KAAM,OACN2pC,aAAef,GAAqB3F,GAAuCxsB,IAAI4tB,EAAOlQ,QAAQgU,sBACzF3nC,EAET,CAOA,SAASukC,GAAkBV,EAA4B/W,GACrD,MAAQ6G,SAAW2V,aAAcC,EAAM,KAAE9sB,EAAI,OAAE2c,IAAayK,EAE5D,MAAO,IACFoB,GAAkBpB,EAAQ/W,EAASyc,EAAQ9sB,EAAM2c,GACpD1I,KAAMtf,EAAAA,IAAQsf,KACdlxB,KAAM,QAEV,CAEA,SAASglC,GAAqBX,EAA+B/W,GAC3D,MAAM,YAAEoI,GAAgBpI,GAClB,QAAE6G,EAASA,SAAW2V,aAAcC,EAAM,OAAEnQ,IAAayK,EAGzDpnB,EAAOkX,EAAQlX,MAAQ8lB,GAU7B,MAAO,IACF0C,GAAkBpB,EAVFpnB,KAAQyY,EAAcpI,EAAU,IAChDA,EACHoI,YAAa,IACRA,EAEH,CAACzY,GAAO,CAAEmZ,cAAe4T,EAAAA,IAAa/oC,OAAQ,QAKLgc,EAAM8sB,EAAQnQ,GACzD1I,KAAMtf,EAAAA,IAAQsf,KACdlxB,KAAM,UACN0lC,kBAAwC,eAArBvR,EAAQ8V,WAA8B9V,EAAQ+V,WAErE,CAEA,SAASjF,GACPZ,EACA/W,GAEA,MAAQ6G,SAAW2V,aAAcC,EAAM,KAAE9sB,IAAWonB,EAEpD,MAAO,IACFoB,GAAkBpB,EAAQ/W,EAASyc,EAAQ9sB,EAAM,GACpDiU,KAAMtf,EAAAA,IAAQsf,KACdlxB,KAAM,iBAEV,CAEA,SAASklC,GAAgBb,EAAoB/W,GAAwC,IAAA6c,EAAAC,EACnF,MAAM,SAAEpM,EAAQ,UAAE1M,GAAchE,GAE9BuW,UAAWwG,EACXC,QAASC,EACTpW,SACEqW,uBACE5Q,OAAQ6Q,EACRtD,MAAOuD,GAETC,uBACE/Q,OAAQgR,EACRzD,MAAO0D,KAGTxG,EAEEyG,EAAgBJ,IAAsD,QAA7CP,EAAIY,GAAqBL,EAAW1M,UAAS,IAAAmM,OAAA,EAAzCA,EAA2Cz4B,WAAaE,EAAAA,IAAQF,SAC7Fs5B,EAAcH,IAAkD,QAA3CT,EAAIW,GAAqBF,EAAS7M,UAAS,IAAAoM,OAAA,EAAvCA,EAAyC14B,WAAaE,EAAAA,IAAQF,SAEvFu5B,EAAmBP,EAAYzuB,GAAgByuB,GAAW,QAAQlqC,EAClE0qC,EAAiBL,EAAU5uB,GAAgB4uB,GAAS,QAAQrqC,EAE5D2B,EAAO8oC,GAAoBA,IAAqBE,EAAAA,IAClDnW,GAAe,MAAOiW,GAAoBr5B,EAAAA,IAAQsf,KAChDC,EAAK+Z,GAAkBA,IAAmBC,EAAAA,IAC5CnW,GAAe,MAAOkW,GAAkBt5B,EAAAA,IAAQsf,KAEpD,MAAO,CACLF,KAAM,OACN3d,GAAIyyB,GAAsBzB,GAC1B7T,UAAWe,GAAe8Y,GAC1BloC,OACAsoC,WAAY54B,EAAUF,OAAO84B,GAAaK,GAC1C3Z,KACAyZ,SAAU/4B,EAAUF,OAAOi5B,GAAWI,GACtCI,WAAY,IACZC,QAAS,IACTC,OAAQ,IACRja,OAAQC,EAAY,UAAYiZ,EAAY,YAAc,SAC1DgB,OAAQ,GACRC,oBAAqBnH,EAAOoH,0BAA4BpH,EAAOqH,oBAC/DhG,mBAAmB,EAEvB,CAEA,SAASP,GACPd,EACA/W,GAEA,MAAM,SAAE0Q,EAAQ,uCAAEnD,GAA2CvN,GACrD6G,SAAS,OAAEmR,EAAM,MAAE6B,IAAY9C,GAEjC,IAAEpT,GAAQ4X,GAAkB7K,EAAUmJ,EAAOtM,GAEnD,IAAI76B,EACJ,GAAoB,eAAhBqkC,EAAOrkC,KAAuB,CAChC,MAAQ2rC,SAAUC,GAAYvH,EAAOlQ,QAAQl0B,MAC7B,kBAAZ2rC,EACF5rC,EAAO,mBACc,mBAAZ4rC,EACT5rC,EAAO,gBACc,sBAAZ4rC,EACT5rC,EAAO,mBACc,oBAAZ4rC,IACT5rC,EAAO,sBAEX,MAIEA,EAHgB,cAAhBqkC,EAAOrkC,MACa,eAAhBqkC,EAAOrkC,MAAyBqkC,EAAOlQ,QAAQrsB,KAAK1E,SAAS4/B,IAE1D,WAEA,YAGT,MAAO,IACFyC,GAAkBpB,EAAQ/W,EAASgY,EAAQ6B,EAAO,GACrDjW,KAAMtf,EAAAA,IAAQsf,KACdlxB,OACAixB,MAEJ,CAEA,SAASmU,GAAgBf,EAA0B/W,GACjD,MAAM,SAAE0Q,EAAQ,uCAAEnD,GAA2CvN,GACvD,QAAE6G,GAAYkQ,GAEd,OACJwH,EAAM,QACNC,EACA9D,eAAgB3yB,EAChB4yB,SAAUC,EACVC,eAAgBC,GACdjU,GAEE,IAAElD,GAAQ4X,GACd7K,EACAkK,QAAiB1nC,EACjBq6B,EACAuN,QAAwB5nC,EACxB6U,QAAS7U,GAGX,MAAO,IACFilC,GAAkBpB,EAAQ/W,EAASue,EAAQC,EAAS3X,EAAQyF,QAC/D1I,KAAMtf,EAAAA,IAAQsf,KACdlxB,KAAM,aACNixB,MAEJ,CAEO,SAASoU,GACdhB,EACA/W,GAEA,MAAM,YAAEoI,GAAgBpI,GAClB,QAAE6G,EAASA,SAAS,OAAEmR,EAAM,KAAEroB,EAAM8uB,sBAAuBC,EAAkB,IAAEzG,IAAUlB,EAIzFmB,EAAkB,IAFTC,GAAkBpB,EAAQ/W,EAASgY,EAAQroB,GAAQ+uB,GAIhEhsC,KAAM,mBACN2lC,MAAO,CACLJ,IAAKK,GAAaL,KAIhBnB,EAAuC,CAAC,IACzCoB,EACH5L,QAASjoB,OAAOwiB,EAAQ4R,UAAY,IACpC7U,KAAM8U,GAAatQ,EAAavB,EAAQ8R,WAI1C,GAAyB,OAArB9R,EAAQ+R,SAAmB,CAC7B,MAAM7yB,EAAKyyB,GAAsBzB,EAAQ,cACzCD,EAAW/1B,KAAK,IACXm3B,EACHnyB,KACAqd,KAAMrd,EACNumB,QAASjoB,OAAOwiB,EAAQ+R,UACxBhV,KAAM8U,GAAatQ,EAAavB,EAAQgS,UAE5C,CAEA,OAAO/B,CACT,CAmCA,SAAS4B,GAAatQ,EAA0BM,GAC9C,OAAOA,EAAahB,GAAe,MAAOU,EAAYM,GAAYI,eAAiBxkB,EAAAA,IAAQsf,IAC7F,CAEA,SAASuU,GACPpB,EACA/W,EACA2e,EACAC,GAEA,IADAC,EAA6B1hC,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,EAEhC,MAAM4I,EAAKyyB,GAAsBzB,IAC3B,cAAEjnB,EAAa,QAAE9J,EAAO,YAAEoiB,EAAW,UAAEpE,GAAchE,EACrD4Z,EAAcxR,EAAYuW,GAAgB7V,cAC1CjY,EAAYuX,EAAYwW,GAAc9V,cACtC8L,EAAa/jB,IAAcf,EAC3B6kB,EAAoBhmB,GAAgBimB,EAAagF,EAAc/oB,GAAW,EAAM7K,GAChFsmB,EAASsI,EAAavwB,OAAOw6B,IAAiBx6B,OAAOw6B,GAC3D,MAAO,CACLnb,KAAM,cACN3d,KACAqd,KAAMrd,EACNmd,UAAWe,GAAe8S,EAAOR,WACjC2H,oBAAqBnH,EAAOoH,0BAA4BpH,EAAOqH,oBAC/D7E,IAAK,GACLK,cACA/oB,YACA+jB,aACAD,oBACArI,SACAtI,UAAWA,QAAa9wB,EAE5B,CAEA,SAASqoC,GACPuD,EACAlE,EACArN,EACAuN,EACA/yB,GAEA,IACE,MAAMg3B,EAAcC,GAAiCpE,EAAekE,EAAa,aAEjF,IAAKC,EACH,MAAO,CAAEzD,mBAAmB,GAG9B,MAAM,KAAE/gC,EAAI,YAAE6wB,EAAW,MAAEiN,GAAU0G,EACrC,IAAI,MAAE1T,GAAU0T,EAChB,MAAMjN,EAASuG,SAAAA,EAAOvG,QAASS,EAAAA,GAAAA,IAAoB8F,EAAMvG,aAAU5+B,EAE7Dw6B,EAAa/e,GAAgBisB,GAAe,GAC5Cc,EAAqBZ,EACvBkE,GAAuClE,EAAsBgE,EAAa,wBAC1E5rC,EACEg8B,EAAoB4L,EAAuBnsB,GAAgBmsB,GAAsB,QAAQ5nC,EAGzFS,GAAS0kC,aAAK,EAALA,EAAO1kC,SAAU4G,GAAQ,IAChCkQ,KAAMw0B,EAAYn0B,KAAMo0B,GAAe10B,GAAiB7W,IAAW,CAAC,EAE5E,GAAIsrC,KAAgB/P,IAAsB7D,GAoBxC,MAnB+B,QAA3B4T,EAAWt0B,SAAS,KACtB0gB,EAAQ,GAAG8T,EAAAA,MAAoBD,KAkB1B,CAAEvb,IAfGva,EAAsB,CAChCrB,MAAO5E,OAAO4E,GACdxN,KAAM5G,EACNyS,QAASsnB,EAETmF,WAAWwF,aAAK,EAALA,EAAO+G,gBAAiB/T,EACnCA,MAAOA,EACPD,cACA0H,UAAU,EACV5D,kBAAmBA,GAAqB+P,EAAW7P,SACnD2D,eAAgBkM,EAAWlM,eAC3BrC,SAAU,IACJoB,GAAU,CAAEA,cAMtB,IAAIC,GAAc,EAElB,IAAK7C,IAAsB3M,GAAyB2M,GAClD,IAAK,MAAMxQ,IAAQ,CAACnkB,EAAM6wB,GAAaliB,OAAOM,SACxCgZ,GAAiB9D,KACnBqT,GAAc,GAKpB,MAAME,EAASF,EACTG,EAAkC,YAAvBmG,aAAK,EAALA,EAAOzG,cAA4BK,EAC9CI,EAAiBC,GAAkB/E,EAAwC2B,GAC3EmQ,EAAYnQ,IAAsBsD,EAAAA,GAClC8M,EAAajU,GAAQuH,EAAAA,GAAAA,IAAWvH,QAASn4B,EAEzC2/B,GAAYwF,aAAK,EAALA,EAAO+G,gBAAiBE,EA6B1C,MAAO,CAAE3b,IA3BWva,EAAsB,CACxCrB,MAAO5E,OAAO4E,GACdxN,KAAMA,EACN6L,QAASsnB,EACTmF,YACAxH,MAAOiU,EACPlU,cACA0H,UAAU,EACVZ,WACAxB,SAAU,IACJ2B,GAAkB,CACpBI,YAAapH,EAAO1nB,QAAQ+uB,EAAAA,IAAsC,kBAIhE2M,GAAa5O,GAAyB,CACxC1qB,GAAI5C,OAAO4E,GAAS,GAAK,EAAGsjB,QAAOsF,WAAY0H,aAAK,EAALA,EAAO1H,iBAGtDzB,GAAqB,CACvBA,oBACA6D,eAAgB2I,aAAkB,EAAlBA,EAAoBnhC,KACpCy4B,aAAcX,GAAkBY,EAAAA,IAAyBnjC,SAASgrC,GAClE5H,eAAgBb,KAKtB,CAAE,MAAOt/B,GAEP,OADA8C,EAAAA,EAAAA,IAAc,oBAAqB9C,GAC5B,CAAC,CACV,CACF,CAEA,SAAS0qC,GAAqB/U,EAAoBgI,GAChD,MAAMniB,EAAeI,GAAgB+Z,GAAY,GAC3C9E,EAAO8D,GAAe,MAAOnZ,GAC7BwY,EAAQS,GAAe5D,GAE7B,GAAImD,EACF,OAAOA,EAGT,MAAMwY,EAAiBP,GAAsCtW,EAAYgI,EAAU,kBAEnF,OAAK6O,EAIE,CACLhxB,eACAqV,OACA5J,MAAO,MACPzf,KAAMglC,EAAehlC,KACrB+wB,OAAQiU,EAAejU,OACvBD,MAAOkU,EAAelU,MACtBjnB,SAAUjB,OAAOo8B,EAAelH,MAAOj0B,gBAXzC,CAaF,CAEA,SAAS46B,GACPtW,EACAgI,EACAh+B,GACe,IAAA8sC,EACf,MAAMr3B,EAAOuoB,EAAShI,GACtB,GAAKvgB,GAASA,EAAKs3B,WACnB,OAAsB,QAAtBD,EAAOr3B,EAAKwzB,kBAAU,IAAA6D,OAAA,EAAfA,EAAiB5Z,MAAM8Z,GAAcA,EAAUhtC,OAASA,GACjE,CAUA,SAAS8lC,GAAsBzB,EAAmBrkC,GAGhD,MAAM2wB,EAAQ,GAAG0T,EAAO4I,YAAY5I,EAAOX,YAC3C,OAAO7S,GACLwT,EAAO6I,UAAY7I,EAAOoH,0BAA4BpH,EAAOqH,oBAC7D/a,EACA3wB,EAEJ,CAEO,SAASmtC,GAAsB95B,GACpC,MAAQvL,KAAMslC,EAAO,MAAEzc,GAAUF,GAAUpd,IACpCg6B,EAAS1J,GAAYhT,EAAOjvB,MAAM,KACzC,MAAO,CAAE0rC,UAASC,UAAS1J,WAC7B,CAEA,SAASiC,GAAa0H,GACpB,OAAQA,GACN,IAAK,SACH,MAAO,SACT,IAAK,SACL,IAAK,YACH,MAAO,OACT,QACE,OAEN,CCl+BO,SAASC,KACd,MAAMC,EAAY,IAAIl3B,IAUtB,SAASm3B,EAAevb,GACtBsb,EAAUvpB,OAAOiO,EACnB,CAYA,MAAO,CACLwb,aAXF,WAA8C,QAAArqB,EAAA5Y,UAAAjL,OAArBwZ,EAAI,IAAA/I,MAAAoT,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJtK,EAAIsK,GAAA7Y,UAAA6Y,GAC3BkqB,EAAU7rC,SAASwgB,IACjBA,KAAYnJ,EAAK,GAErB,EAQE20B,YAxBF,SAAqBzb,GAGnB,OAFAsb,EAAUj+B,IAAI2iB,GAEP,KACLub,EAAevb,EAAG,CAEtB,EAmBEub,iBACAG,aARF,WACE,OAAO92B,QAAQ02B,EAAUv7B,KAC3B,EAQF,CC5BA,MAAM47B,GAAiBN,KAEvB,IAAIO,IAAY,EAOT,SAASC,GAAkBrc,EAAYsc,EAAiB9b,GAC7D,IAAI+b,EAEJ,MAAMC,EAASA,KACbD,IACA/b,GAAI,EAmBN,OAfA+b,GAAUE,EAAAA,EAAAA,IAAsBzc,GAAI,KAClC,GAAIoc,GACFI,QACK,CAEL,MAAME,EAAmBP,GAAeF,YAAYO,GAC9CG,GAAsBF,EAAAA,EAAAA,IAAsBH,EAAUtc,EAAIwc,GAChED,EAAUA,KACRG,IACAC,GAAqB,CAEzB,KAIK,IAAMJ,GACf,CAKO,SAASK,GAAgB5c,EAAY6c,GAC1C,OAAO,IAAIxkC,SAAeC,IACxB+jC,GAAkBrc,EAAI6c,EAAkBvkC,EAAQ,GAEpD,CAEO,SAASwkC,GAAgBC,GAC9BX,GAAYW,EAERA,GACFZ,GAAeH,cAEnB,gBCtDO,MAAMgB,GAAM,IACNC,GAAS,GAAKD,GACdE,GAAe,IACfC,GAA2B,GAE3BC,GAAa,WCObC,GAAqB,CAChCC,eAAe,EACfC,eAAgB,CAAEC,QAASR,GAAKS,WAAY,EAAIT,IAChDU,yBAA0B,EAAIV,GAC9BW,qBAAsB,CAAEH,QAAS,IAAMR,GAAKS,WAAY,GAAKT,IAC7DY,kBAAmB,CAAEJ,QAASP,GAAQQ,WAAY,EAAIR,KAG3CY,GAAuB,CAClCP,eAAe,EACfC,eAAgB,CAAEC,QAAS,EAAIR,GAAKS,WAAY,GAAKT,IACrDU,yBAA0B,EAAIV,GAC9BW,qBAAsB,CAAEH,QAAS,GAAKR,GAAKS,WAAYR,IACvDW,kBAAmB,CAAEJ,QAAS,EAAIP,GAAQQ,WAAY,EAAIR,KAmBrD,SAASa,GAAWp6B,GAMC,IAEtBq6B,GAR2B,OAC/B1yB,EAAM,SACN2yB,EAAW,EAAC,gBACZC,EAAe,QACfC,EAAUA,IAAM7lC,QAAQC,UAAyB,KACjD6lC,GACwBz6B,EACpB06B,GAAY,EAEhB,MAAMC,EAAuB,IAAIpmC,GAAAA,EAG3BqmC,GAAYxtC,EAAAA,EAAAA,KAASvD,UAAY,IAAAgxC,EACrC,GAAIH,EACF,OAGS,QAAXG,EAAAR,SAAW,IAAAQ,GAAXA,IACA,MAAMC,QAAqBH,EAAqBjmC,QAEhD,IAEmB,eADM+lC,EAAKK,KAE1BJ,GAAY,EAEhB,CAAE,QACKA,GACHK,GAEJ,KACC,IACM7B,MAAmB8B,GAAWV,MAGvC,SAASS,IAAoB,IAAAE,EAChB,QAAXA,EAAAZ,SAAW,IAAAY,GAAXA,IACAZ,EAAc1B,MAAqBqC,GAAWrzB,GAASizB,EACzD,CAgBA,OAdKJ,IAAUU,MAAMJ,IACfJ,IAIJC,EAAqB/lC,QAAQkmC,GAEzBP,EACFQ,IAEAH,IACF,IAGK,CACLH,KAAMG,EACNO,IAAAA,GAAO,IAAAC,EACLV,GAAY,EACD,QAAXU,EAAAf,SAAW,IAAAe,GAAXA,GACF,EAEJ,CAUO,SAASC,GACdC,EACArM,GAEA,IACIsM,EADAb,GAAY,EAGhB7wC,eAAe2xC,EAAYC,EAAuB73B,GAAY,IAAA83B,EAC3C,QAAjBA,EAAAH,SAAiB,IAAAG,GAAjBA,IAEA,IACE,aAAazM,EAAOwM,KAAkB73B,EACxC,CAAE,QACiD,IAAA+3B,GAA5CjB,GAAae,EAAgBH,EAAOlxC,SACtB,QAAjBuxC,EAAAJ,SAAiB,IAAAI,GAAjBA,IACAJ,GAAoBxC,EAAAA,EAAAA,IAClBuC,EAAOG,IACP,IAAMD,EAAYC,EAAgB,EAAG73B,KAG3C,CACF,CAEA,MAAO,CAELg4B,GAAAA,GACElB,GAAY,EAAM,QAAAzsB,EAAA5Y,UAAAjL,OADbwZ,EAAI,IAAA/I,MAAAoT,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJtK,EAAIsK,GAAA7Y,UAAA6Y,GAET,OAAOstB,EAAY,EAAG53B,EACxB,EAEAi4B,MAAAA,GAAS,IAAAC,EACPpB,GAAY,EACK,QAAjBoB,EAAAP,SAAiB,IAAAO,GAAjBA,GACF,EAEJ,CAEO,SAASd,GAAWrzB,GACzB,GAAsB,iBAAXA,EACT,MAAO,CAACA,EAAQA,GAGlB,MAAM,QAAEmyB,EAAO,WAAEC,GAAepyB,EAChC,MAAO,CAACmyB,EAASC,EACnB,CCxIO,MAAMgC,GACX,GAEA,GAEA,IAAe,EAEfvnC,WAAAA,CAAYwnC,EAA4B9jB,GACtCzjB,MAAK,EAAWyjB,EAEZ8jB,EACFvnC,MAAK,IAELA,MAAK,IAGHyjB,EAAQ+jB,aACVxnC,MAAK,GAET,CAGOynC,eAAAA,GACDznC,MAAK,IACTA,MAAK,IACLA,MAAK,IACP,CAGO0nC,kBAAAA,GACD1nC,MAAK,GACTA,MAAK,GACP,CAGO2nC,eAAAA,GACD3nC,MAAK,GACTA,MAAK,GACP,CAEOsZ,OAAAA,GAAU,IAAAsuB,EACf5nC,MAAK,GAAe,EACK,QAAzB4nC,EAAA5nC,MAAK,SAAoB,IAAA4nC,GAAzBA,EAAA9sB,KAAA9a,KACF,CAGA,IAAQrH,EAAAA,EAAAA,KAASvD,UACf,IAAI4K,MAAK,EAET,UACQA,MAAK,EAASgmC,MACtB,CAAE,MAAOxvC,IACP2C,EAAAA,GAAAA,GAAY3C,EACd,KACC,IACMiuC,MAAmB8B,GAAWvmC,MAAK,EAAS6nC,iBAIrD,KAAmB,IAAAC,EACQ,QAAzBA,EAAA9nC,MAAK,SAAoB,IAAA8nC,GAAzBA,EAAAhtB,KAAA9a,MAEA,MAAM,kBAAE+nC,EAAiB,cAAEC,GAAkBhoC,MAAK,EAE5CioC,EAAgBA,KACpBjoC,MAAK,EAAuBkkC,MAAqBqC,GAAWyB,GAAgBC,GAC5EjoC,MAAK,GAAO,EAGdA,MAAK,GAAuBskC,EAAAA,EAAAA,IAAsByD,EAAmBE,EACvE,CAGA,KAAyB,IAAAC,EACE,QAAzBA,EAAAloC,MAAK,SAAoB,IAAAkoC,GAAzBA,EAAAptB,KAAA9a,MAEA,MAAMmoC,EAAWA,KACf,MAAM,oBAAEC,GAAwBpoC,MAAK,EACrCA,MAAK,EAAuBkkC,MAAqBqC,GAAW6B,IAAsB,KAChFD,IACAnoC,MAAK,GAAO,GACZ,EAGJmoC,GACF,EC3Fa,MAAME,GACnB,GAEA,GAGA,IAAe,EAEf,GAAyB,EAGzB,GAEA,GAAiC,GAEjC,GAAsB3E,KAEtB,GAAoBA,KAEpB,GAAuBA,KAEvB3jC,WAAAA,CAAYikB,GACVhkB,MAAK,EAAOgkB,EAAIrvB,WAChBqL,MAAK,GACP,CAMOsoC,IAAAA,CAAK1vC,GACNoH,MAAK,GAAWA,MAAK,EACvBA,MAAK,EAAgBpH,GAErBoH,MAAK,EAAiBwE,KAAK5L,EAE/B,CAMA,eAAW2vC,GACT,OAAOvoC,MAAK,CACd,CAGOwoC,SAAAA,GACLxoC,KAAKyoC,QACLzoC,MAAK,GACP,CAGOya,SAAAA,CAAUnC,GACf,OAAOtY,MAAK,EAAoB8jC,YAAYxrB,EAC9C,CAMOowB,SAAAA,CAAUpwB,GACf,OAAOtY,MAAK,EAAkB8jC,YAAYxrB,EAC5C,CAMOqwB,YAAAA,CAAarwB,GAClB,OAAOtY,MAAK,EAAqB8jC,YAAYxrB,EAC/C,CAGOmwB,KAAAA,GACLzoC,MAAK,IAEDA,MAAK,IACPA,MAAK,GAAe,EACpBA,MAAK,EAAqB6jC,cAAa,GAE3C,CAEA,KACE7jC,MAAK,IAELA,MAAK,EAAU,IAAI4oC,UAAU5oC,MAAK,GAClCA,MAAK,EAAQ6oC,WAAa,cAE1B7oC,MAAK,EAAQ8oC,QAAU,KAAMxvC,EAAAA,EAAAA,IAAc,wBAAyB0G,MAAK,GACzEA,MAAK,EAAQ+oC,OAAS/oC,MAAK,EAC3BA,MAAK,EAAQgpC,QAAUhpC,MAAK,EAC5BA,MAAK,EAAQipC,UAAYjpC,MAAK,EAG9BA,MAAK,GAAiBskC,EAAAA,EAAAA,IAAsB7yB,EAAAA,KAAiB,IAAMzR,MAAK,EAAmB,gBAC7F,CAEA,KAAc,IAAAkpC,EACO,QAAnBA,EAAAlpC,MAAK,SAAc,IAAAkpC,GAAnBA,EAAApuB,KAAA9a,MAEKA,MAAK,IAIVA,MAAK,EAAQ8oC,QAAU,KACvB9oC,MAAK,EAAQ+oC,OAAS,KACtB/oC,MAAK,EAAQgpC,QAAU,KACvBhpC,MAAK,EAAQipC,UAAY,KACzBjpC,MAAK,EAAQyoC,QAEbzoC,MAAK,OAAUrJ,EACjB,CAEA,GAAgBiC,GACd,IAAKoH,MAAK,EAAS,MAAM,IAAIzL,MAAM,oBACnCyL,MAAK,EAAQsoC,KAAK5tB,KAAKhY,UAAU9J,GACnC,CAEA,GAAoBuwC,KAAM,IAAAC,EAMxB,KALAC,EAAAA,EAAAA,IAAS,mBAAoBrpC,MAAK,GAEf,QAAnBopC,EAAAppC,MAAK,SAAc,IAAAopC,GAAnBA,EAAAtuB,KAAA9a,MACAA,MAAK,EAAyB,EAEvBA,MAAK,EAAiBrK,QAC3BqK,MAAK,EAAgBA,MAAK,EAAiByE,SAGxCzE,MAAK,IACRA,MAAK,GAAe,EACpBA,MAAK,EAAkB6jC,eACzB,EAGF,GAAsByF,IACN,gBAAVA,GACFhwC,EAAAA,EAAAA,IAAc,2BAEdA,EAAAA,EAAAA,IAAc,gCAAiCgwC,EAAMC,KAAMD,EAAMjwC,OAAQiwC,EAAME,UAGjFxpC,MAAK,IAELA,MAAK,IACL,MAAMypC,EAAiBzjC,KAAKmQ,IAvJH,IAuJ8BnW,MAAK,EAtJpC,KAyJxB,GAFAA,MAAK,GAAiBskC,EAAAA,EAAAA,IAAsBmF,GAAgB,IAAMzpC,MAAK,MAEnEA,MAAK,EAAc,CACrB,GAAc,gBAAVspC,EACF,MAAM,IAAI/0C,MAAM,8CAGlByL,MAAK,GAAe,EACpBA,MAAK,EAAqB6jC,cAAa,EACzC,GAGF,GAAuBt4B,IAAkD,IAAjD,KAAEK,GAA0CL,EAClEvL,MAAK,EAAoB6jC,aACvBj4B,aAAgB89B,YACZ99B,EACA8O,KAAK3lB,MAAM6W,GAChB,ECtKL,MAGM+9B,GAAgB,GAAK9E,GAIrB+E,GAAe,EAAI/E,GAEnBgF,GAAiE,CAAC,EA4CxE,MAAMC,GACJ,GAEA,GAGA,GAA6C,CAAC,EAE9C,GAA2C,GAG3C,GAAuB,IAAIr9B,IAM3B,GAAmB,EAEnB,GACA,GAEA1M,WAAAA,CAAY0J,GACVzJ,MAAK,EAAWyJ,CAClB,CAEOsgC,YAAAA,CACLre,GAMe,IALf,gBACEse,EAAe,UACftB,EAAS,aACTC,GAC8E/nC,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,CAAC,EAEpF,MAAM4I,EAAKxJ,MAAK,IACViqC,EAAiC,CACrCzgC,KACAkiB,YACA6c,aAAa,EACbyB,kBACAtB,YACAC,eACArvB,QAAStZ,MAAK,EAAsBkc,KAAKlc,KAAMwJ,IAIjD,OAFAxJ,MAAK,EAAgBwE,KAAKylC,GAC1BjqC,MAAK,IACEiqC,CACT,CAGA,GAAsBC,GACpB,MAAM1+B,EAAQxL,MAAK,EAAgBmqC,WAAWF,GAAYA,EAAQzgC,KAAO0gC,IACrE1+B,GAAS,IACXxL,MAAK,EAAgBoqC,OAAO5+B,EAAO,GACnCxL,MAAK,IAET,CASA,IAAmBrH,EAAAA,EAAAA,KAAS,KAMnB,IAAA0xC,EALHrqC,MAAK,KACPA,MAAK,IAAYA,MAAK,IAClBA,MAAK,EAAQuoC,aACfvoC,MAAK,MAGK,QAAZqqC,EAAArqC,MAAK,SAAO,IAAAqqC,GAAZA,EAAc5B,QACdzoC,MAAK,OAAUrJ,EACjB,GA/HwB,IAgIF,GAExB,KACE,MAAMqtB,EAgOV,SAAsBva,GACpB,MAAMua,EAAM,IAAIC,IAAgB,YAAZxa,EAAwBoI,EAAAA,IAAwBN,EAAAA,KAIpE,OAHAyS,EAAItwB,SAAW,OACfswB,EAAIsmB,SAAW,uBACfzlB,GAA6Bb,GACtBA,CACT,CAtOgBumB,CAAavqC,MAAK,GACxBwqC,EAAS,IAAInC,GAAgErkB,GAInF,OAHAwmB,EAAO/vB,UAAUza,MAAK,GACtBwqC,EAAO9B,UAAU1oC,MAAK,GACtBwqC,EAAO7B,aAAa3oC,MAAK,GAClBwqC,CACT,CAEA,GAAgE5xC,IAAY,IAAA6xC,EACrD,QAArBA,EAAAzqC,MAAK,SAAgB,IAAAyqC,GAArBA,EAAA3vB,KAAA9a,MAEI,WAAYpH,GACS,eAAnBA,EAAQ4uB,QACVxnB,MAAK,EAAkBpH,GAIvB,SAAUA,IACS,sBAAjBA,EAAQzC,OACVyC,EAAU,IACLA,EACHzC,KAAM,kBACNikC,QAAS,GACT5O,aAAc,CAAC,EACf2I,SAAU,CAAC,IAKM,YAAjBv7B,EAAQzC,MAAuC,oBAAjByC,EAAQzC,MACnC6J,MAAK,EAAkBpH,GAEhC,EAGF,GAAuB8xC,KAAM,IAAAC,EACf,QAAZA,EAAA3qC,MAAK,SAAO,IAAA2qC,GAAZA,EAAcrC,KAAK,CACjBsC,UAAW,YACXC,sBAAsB,EACtBC,kBAAkB,IAEpB9qC,MAAK,IAELA,MAAK,GAAY,EAGnB,GAA0B+qC,KAAM,IAAAC,EAC9BhrC,MAAK,EAAqB4b,QACZ,QAAdovB,EAAAhrC,MAAK,SAAS,IAAAgrC,GAAdA,EAAAlwB,KAAA9a,MAEA,IAAK,MAAMiqC,KAAWjqC,MAAK,EACrBiqC,EAAQ1B,cACV0B,EAAQ1B,aAAc,EAClB0B,EAAQtB,eAAchJ,EAAAA,GAAAA,GAASsK,EAAQtB,cAE/C,EAGF,GAAkB/vC,GAChB,IAAK,MAAMqxC,KAAWjqC,MAAK,EAGrBpH,EAAQ4Q,IAAM5C,OAAOhO,EAAQ4Q,IAAMygC,EAAQzgC,IAI1CygC,EAAQ1B,cACX0B,EAAQ1B,aAAc,EAClB0B,EAAQvB,YAAW/I,EAAAA,GAAAA,GAASsK,EAAQvB,WAG9C,CAGA,IAAoBuC,EAAAA,EAAAA,KAAkB71C,UACpC,MAAM81C,EAA8B,oBAAjBtyC,EAAQzC,KACrBg1C,EAAwBvyC,EAAQgpC,yBAChCwJ,QA2JVh2C,eAAkCqU,EAAqB7Q,EAA+ByyC,GACpF,MAAMC,EAuBR,SAA+BlR,EAAsBvO,GACnD,MAAM0f,EAAyC,CAAC,EAEhD,IAAK,MAAM/Q,KAAUJ,EACnB,IAAK,MAAMjO,KAAcqO,EAAO/M,SAAW,KAAA+d,EACzC,MAAM3hC,GAAiC,QAAvB2hC,EAAA3f,EAAYM,UAAW,IAAAqf,OAAA,EAAvBA,EAAyBjf,gBAAiBJ,EAC1Dof,EAAU1hC,KAAa,GACvB0hC,EAAU1hC,GAASrF,KAAKg2B,EAC1B,CAGF,OAAO+Q,CACT,CAnC2BE,CAAsB7yC,EAAQwhC,QAASxhC,EAAQ4yB,cAClE4f,EAAqD,CAAC,EACtDpa,QAA+ClL,KAErD,IAAK,MAAOjc,EAASuwB,KAAY1tB,OAAOiQ,QAAQ2uB,GACzCD,EAAiBz+B,IAAI/C,KAI1BuhC,EAAoBvhC,GAAWywB,GAC7B7wB,EACAI,EACAuwB,EACAxhC,EAAQ4yB,aACR5yB,EAAQu7B,SACRnD,EACiB,oBAAjBp4B,EAAQzC,OAIZ,OAAOi1C,CACT,CAjLsCM,CAAmB1rC,MAAK,EAAUpH,EAASoH,MAAK,GAAqB,IACjG2rC,EAAoB3rC,MAAK,EAC7BmrC,EACAz+B,OAAOL,KAAK++B,GACZF,GAGF,IAAK,MAAMjB,KAAWjqC,MAAK,EACzB,GAAK4rC,GAA+B3B,GAIpC,IAAK,MAAMpgC,KAAWogC,EAAQve,UACvBigB,EAAkB/+B,IAAI/C,KAI3B81B,EAAAA,GAAAA,IAAS,IAAMsK,EAAQD,gBAAgB,CACrCngC,UACAshC,wBACAD,aACA3Q,WAAY6Q,EAAoBvhC,IAAY,MAGlD,IAGF,KAGE,MAAMgiC,EAAYn0C,OAAOsI,MAAK,KAExB8rC,EAAe9rC,MAAK,EACpB+rC,EAAe/rC,MAAK,IACpBgsC,EAAmBr+B,GAAem+B,EAAcC,GAChDE,EAAiBt+B,GAAeo+B,EAAcD,GAEhDE,EAAiBr2C,QACnBqK,MAAK,EAASsoC,KAAK,CACjBsC,UAAW,cACXlf,UAAWsgB,IAIXC,EAAet2C,QACjBqK,MAAK,EAASsoC,KAAK,CACjBsC,UAAW,YACXphC,GAAIqiC,EACJngB,UAAWugB,EACXC,MAAO,CAAC,UAAW,qBAIvBlsC,MAAK,EAAuB+rC,CAC9B,CAEA,KACE,OAAO/rC,MAAK,EAAgBwK,MAAMy/B,GAAYA,EAAQve,UAAU/1B,QAClE,CAEA,GAAqBw2C,GACnB,MAAMC,EAAmB,IAAI3/B,IAE7B,IAAK,MAAMw9B,KAAWjqC,MAAK,EACzB,IAAImsC,GAAgCP,GAA+B3B,GAInE,IAAK,MAAMpgC,KAAWogC,EAAQve,UAC5B0gB,EAAiB1mC,IAAImE,GAIzB,OAAOuiC,CACT,CAEA,KAAa,IAAAC,EACG,QAAdA,EAAArsC,MAAK,SAAS,IAAAqsC,GAAdA,EAAAvxB,KAAA9a,MAEA,MAAMssC,EAAiBC,aAAY,KAAM,IAAAC,EAAAC,EAC3B,QAAZD,EAAAxsC,MAAK,SAAO,IAAAwsC,GAAZA,EAAclE,KAAK,CAAEsC,UAAW,SAEX,QAArB6B,EAAAzsC,MAAK,SAAgB,IAAAysC,GAArBA,EAAA3xB,KAAA9a,MACAA,MAAK,GAAmBskC,EAAAA,EAAAA,IAAsBsF,IAAc,KAAM,IAAA8C,EACpD,QAAZA,EAAA1sC,MAAK,SAAO,IAAA0sC,GAAZA,EAAclE,WAAW,GACzB,GACDmB,IAEH3pC,MAAK,EAAY,IAAM2sC,cAAcL,EACvC,CASA,GACEnB,EACAyB,EACAC,GAEA,MAAMC,EAAqB9sC,MAAK,EAAiBmrC,IAA0B,GACrE4B,EAA+B,GAC/BpB,EAAoB,IAAIl/B,IAI9B,IAAK,MAAM5C,KAAWijC,EACpBnB,EAAkBjmC,IAAImE,GAGxB,IAAK,MAAMA,KAAW+iC,EACpBjB,EAAkBjmC,IAAImE,GAGlBgjC,GACFE,EAAmBvoC,KAAKqF,GAU5B,OANIkjC,EAAmBp3C,OACrBqK,MAAK,EAAiBmrC,GAAyB4B,SAExC/sC,MAAK,EAAiBmrC,GAGxBQ,CACT,EAcK,SAASqB,GAAsBliC,GACpC,OAAQA,EAAOogC,aAAepgC,EAAOyvB,WAAW5kC,MAClD,CAgDA,SAASi2C,GACP3B,GAIA,OAAOA,EAAQ1B,eAAiB0B,EAAQD,eAC1C,CC1ZO,SAASiD,GACdC,EACAC,GAIA,MAAMC,EAAoG,CAAC,EAErGC,EAAkBpvC,IACtBmvC,EAAcnvC,KAAU,CAAC,EACzBmvC,EAAcnvC,GAAMqvC,gBAAiBhJ,EAAAA,EAAAA,IAAsB4I,GAAS,YAC3DE,EAAcnvC,GAAMqvC,aAC3B,MAAM,SAAEC,GAAaH,EAAcnvC,GAC/BsvC,GACFJ,EAAU,CAACI,GACb,GACA,EAGJ,OAAQziC,IACN,MAAM7M,EAAO6M,EAAOqgC,sBAEe,IAAAqC,EAAAC,EAA/BT,GAAsBliC,IAEL,QAAnB0iC,EAAAJ,EAAcnvC,UAAK,IAAAuvC,GAAc,QAAdC,EAAnBD,EAAqBF,oBAAY,IAAAG,GAAjCA,EAAA3yB,KAAA0yB,UACOJ,EAAcnvC,GACrBkvC,EAAU,CAACriC,KACDsiC,EAAcnvC,IAMxBmvC,EAAcnvC,GAAMsvC,SAAWziC,EAC/BuiC,EAAepvC,KALfkvC,EAAU,CAACriC,IACXuiC,EAAepvC,GAKjB,CAEJ,CChCA,MACMyvC,GAAiB,CAAErI,QAASR,GAAKS,WAAY,EAAIT,IACjD8I,GAAsB,EAAI9I,GAC1B+I,GAAiB,CAAEvI,QAAS,IAAMR,GAAKS,WAAY,GAAKT,IACxDgJ,GAAwB,CAAExI,QAASP,GAAQQ,WAAY,EAAIR,IAqB1D,MAAMgJ,GACX,GACA,GAEA,GAEA,GAuLF,WAEE,IAAIC,EAA4C,GAShD,MAAMC,EAAiB,IAAIvhC,IAwB3B,SAASwhC,EAAuBC,GAC9B,IAAK,MAAMjwC,KAAQiwC,OACJv3C,IAATsH,GACF+vC,EAAetoC,IAAIzH,IAOzB,WAIE,IAAK,MAAMA,KAAQ+vC,EAAgB,CACjC,GAAIA,EAAe5lC,MAlQS,IAmQ1B,MAGF4lC,EAAe5zB,OAAOnc,EACxB,CACF,CAdEkwC,EACF,CAeA,MAAO,CACL,OAAIhlB,GACF,OAAO4kB,CACT,EACAjjC,OAjDF,SACEsjC,EACAC,EACAC,GAEAL,EAAuBvgC,GAAW0gC,EAAqB,wBACnDE,GACFL,EAAuBvgC,GAAW4gC,EAAe3hC,OAAOqgC,IAAwB,0BAG9EqB,EACFN,EAAoBM,EACXC,IACTP,EAmEN,SACEQ,EACAC,GAEA,IAAKA,EAAc74C,OACjB,OAAO44C,EAGT,MAAME,EAAiB,IAAIhiC,IACzBiB,GAAW8gC,EAAe,0BAG5B,MAAO,IACFD,EAAyB5hC,QACzBua,IAAcunB,EAAe7hC,IAAIsa,EAASya,0BAE1C6M,EAAcE,SAAS5jC,GAAWA,EAAOogC,WAAapgC,EAAOyvB,WAAa,MAC7EN,KAAKzT,GACT,CArF0BmoB,CAAuBZ,EAAmBO,IAGhEP,EAAoBA,EAAkBphC,QAAOpB,IAAA,IAAC,oBAAEo2B,GAAqBp2B,EAAA,QACnEo2B,GACGqM,EAAephC,IAAI+0B,GACvB,GACH,EA+BF,CAvPuBiN,GAErB,GAEA,GAEA,GAAmBlL,KACnB,GAAoBA,KAGpB,IAA4B,EAG5B,GAA8C,GAE9C,IAAe,EAEf3jC,WAAAA,CACE0J,EACAI,EACAglC,EACArH,GAEAxnC,MAAK,EAAWyJ,EAChBzJ,MAAK,EAAW6J,EAChB7J,MAAK,EAAoC6uC,EAEzC7uC,MAAK,EF2RF,SAA4ByJ,GAEjC,OADAogC,GAAiBpgC,KAAa,IAAIqgC,GAAgBrgC,GAC3CogC,GAAiBpgC,EAC1B,CE9R0BqlC,CAAmBrlC,GAASsgC,aAChD,CAAClgC,GACD,CACE6+B,UAAW1oC,MAAK,EAChB2oC,aAAc3oC,MAAK,EACnBgqC,gBAAiBiD,GA/DK,IA+DiDjtC,MAAK,KAIhFA,MAAK,EAA4BA,MAAK,EAAeuoC,YAErDvoC,MAAK,EAA4B,IAAIsnC,GAAyBtnC,MAAK,EAAeuoC,YAAa,CAC7Ff,cACAK,aAAc6F,GACd3F,kBAAmB4F,GACnB3F,cAAe4F,GACfxF,oBAAqByF,GACrB7H,KAAMhmC,MAAK,GAEf,CAMOkZ,QAAAA,CAASZ,GACd,OAAOtY,MAAK,EAAiB8jC,YAAYxrB,EAC3C,CAMOy2B,eAAAA,CAAgBz2B,GACrB,OAAOtY,MAAK,EAAkB8jC,YAAYxrB,EAC5C,CAEOgB,OAAAA,GACLtZ,MAAK,GAAe,EACpBA,MAAK,EAAesZ,UACpBtZ,MAAK,EAA0BsZ,SACjC,CAEA,GAAuBoxB,KAGrB1qC,MAAK,GAA4B,EACjCA,MAAK,EAA0BynC,iBAAiB,EAGlD,GAA0BsD,KACxB/qC,MAAK,GAA4B,EACjCA,MAAK,EAA0B0nC,oBAAoB,EAGrD,GAA8BsH,IAC5B,GAAIhvC,MAAK,EAAc,OAEvB,MAAMsuC,EAAiBU,EAAQriC,QAAQ7B,GAAWA,EAAOogC,aACnDkD,EAAsBY,EACzBriC,QAAQ7B,IAAYA,EAAOogC,aAC3BwD,SAAS5jC,GAAWA,EAAOyvB,aAC3BN,KAAKzT,IAEFyoB,EAA6BjvC,MAAK,EAA4B,GAAKouC,EACnEc,EAA6BlvC,MAAK,EAA4BouC,EAAsB,GAI1FpuC,MAAK,EAA6BwC,WAAW0sC,GAC7ClvC,MAAK,EAAqBivC,OAA4Bt4C,EAAW23C,EAAe,EAIlF,GAAQl5C,UACN,IACE4K,MAAK,EAAkB6jC,cAAa,GAEpC,MAAOkK,EAAmBoB,SAAgCjvC,QAAQipB,IAAI,CACpEimB,GAAsBpvC,MAAK,EAAUA,MAAK,GAC1CA,MAAK,MAGP,GAAIA,MAAK,EAAc,OAEvBA,MAAK,EAgJX,SACEqvC,EACAC,GACA,IAAAC,EACA,MAAMC,GAAmD,QAAnBD,EAAAF,EAAiB,UAAE,IAAAE,OAAA,EAAnBA,EAAqB5oB,aAAa,IAClE8oB,EAAkC,GAExC,IAAK,MAAMvoB,KAAYooB,EAAkB,CACvC,GAAIpoB,EAASP,WAAa6oB,EACxB,MAGFC,EAAiBjrC,KAAK0iB,EACxB,CAIA,OAFAuoB,EAAiBjrC,QAAQ6qC,GAElBI,CACT,CAjKQC,CACEP,EACAnvC,MAAK,EAA6BoqC,OAAO,IAE3C2D,GAGF/tC,MAAK,GAA4B,CACnC,CAAE,QACKA,MAAK,GACRA,MAAK,EAAkB6jC,cAAa,EAExC,GAGF,OAAM,GACJ,MAAQ7jC,MAAK,GACX,IACE,aAAaq5B,GAAa,CACxB5vB,QAASzJ,MAAK,EACd2M,OAAQ,CAAE9C,QAAS7J,MAAK,GACxBuT,cAAevT,MAAK,EACpBw5B,cAAex5B,MAAK,EACpBs5B,MAAO0L,IAEX,CAAE,MAAOxuC,GAGP,IAFA8C,EAAAA,EAAAA,IAAc,6BAA8B9C,GAExCwJ,MAAK,IAAiBA,MAAK,EAC7B,YAGIykC,MAAmB8B,GAAWmH,IACtC,CAGF,MAAO,EACT,CAGA,GACEU,EACAC,EACAC,IAGKF,EAAoBz4C,QAAY04C,GAAwBC,SAAAA,EAAgB34C,UAIzEy4C,EAAoBz4C,SACtBqK,MAAK,EAAoCouC,EAAoB,GAAGznB,WAElE3mB,MAAK,EAAmB8K,OAAOsjC,EAAqBC,EAAsBC,GAC1EtuC,MAAK,EAAiB6jC,aAAauK,EAAqBpuC,MAAK,EAAmBmpB,KAClF,EAGF/zB,eAAeg6C,GAAsB3lC,EAAqBI,GACxD,IACE,aT7DGzU,eAAmCqU,EAAqBI,GAC7D,MAAM,QACJuwB,EACA5O,aAAcK,EAAW,SACzBsI,EAAW,CAAC,SACJ5I,GAAiC9hB,EAAS,kBAAmB,CACrEsU,QAASlU,IAKX,OAAOywB,GACL7wB,EACAI,EACAuwB,EACAvO,EACAsI,QAPmDrO,MASnD,EAEJ,CSyCiB6pB,CAAoBlmC,EAASI,EAC5C,CAAE,MAAOrT,GAEP,YADA8C,EAAAA,EAAAA,IAAc,wBAAyB9C,EAEzC,CACF,CCrNOpB,eAAew6C,GAAkBnsB,GAStC,MAAM,QACJha,EAAO,QACPI,EAAO,MACPyvB,EAAK,YACLC,EAAW,cACXC,EAAa,kBACbC,EAAiB,gBACjBC,GACEjW,EAEE7X,QAGI2f,GAAgB9hB,EAAS,gBAAiB,CAClDsU,QAASlU,EACTyvB,QACAS,YAAaP,GAAiB5R,GAAU4R,IAAmBC,EAAwB,EAAJ,GAC/EO,UAAWT,GAAe3R,GAAU2R,IAAiBG,EAAsB,EAAJ,GACvEO,KAAM,UAIN4V,aAAcC,EACdtkB,aAAcK,GACZjgB,EAEJ,OAAKkkC,EAAgBn6C,OAIdm6C,EACJvlC,KAAKwlC,GAAUC,GAAoBvmC,EAASsmC,EAAOlkB,KACnDokB,OALM,EAMX,CAEO,SAASD,GACdvmC,EACAsmC,EACAlkB,GAEA,MAAM,IACJjT,EAAG,KACH3a,EACAiyC,WAAYC,EACZthB,aACEuhB,YACEt9B,UAAWu9B,KAGbN,EAEEppB,EAAkB,IAAN/N,EACZyf,IAAe0X,EAAMO,OAAO7U,SAAWsU,EAAMQ,SAAS56C,OACtD66C,EAAYT,EAAMO,OAAOryC,KACzBwyC,EAA6BpY,EAAa,CAAC0X,EAAMO,QAAUP,EAAMQ,SAEvE,IAAKE,EAAK96C,OAAQ,MAAO,GAEzB,MAAM+6C,EAAY5oC,OAAOqoC,GAAaroC,OAAO2oC,EAAK96C,QAE5Ck6C,EAAyC,GA4C/C,OA1CAY,EAAK34C,SAAQ,CAAC64C,EAAKr5C,KACjB,MAAM,OACJmkC,EAAM,YACNxL,EAAW,MACX75B,EACAw6C,QAASC,EAAM,OACfjU,EACA3+B,KAAM6yC,EAAO,QACbC,GACEJ,EAEJ,IAAK1gB,EAEH,OAGF,MAAMoN,EAAcxR,EAAY4P,GAASlP,cACnCjY,EAAYuX,EAAYoE,GAAa1D,cACrC6L,EAAoBhmB,GAAgBimB,EAAaoD,EAAUxL,GAAa,EAAMxmB,GAC9EuzB,EAAM0T,EAAY5oC,OAAO+oC,GAAU,GAEnC9nB,EAA6Blc,EAAc,CAC/Cga,KAAM4pB,EAAK96C,OAAS,EAAIqxB,GAAU/oB,EAAM3G,GAAK0vB,GAAU/oB,GACvD0oB,YACA0R,aACAgF,cACA/oB,YACAyb,OAAQsI,EAAavwB,OAAO1R,IAAW0R,OAAO1R,GAC9CixB,KAAMtf,EAAAA,IAAQsf,KACd2V,MACAgU,gBAAiB3Y,OAAa1hC,EAAY65C,EAC1CpY,oBACAqE,aAAY4T,QAAkB15C,EAC9BsH,OACAyxB,OAAQ9oB,OAAOg2B,SAAWjmC,EAC1Bm6C,UACA36C,KAAM46C,EAAU,eAAYp6C,IAG9Bk5C,EAAarrC,KAAKukB,EAAG,IAGhB8mB,CACT,CClHOz6C,eAAe67C,GAAexnC,EAAqBI,EAAiBqnC,GAOzE,IAAI95C,EAiBAghC,EAfJ,Q9CdmCzhC,IAA5BsX,G8CWsBpE,GAGf,CACZ,MAAMsnC,QAiCV/7C,eAAsCqU,EAAqBrS,GACzD,IACE,MAAMg6C,EAAYnjC,GAAiB7W,GACnC,IAAKg6C,EACH,OAGF,MAAM9kC,QAAepU,EAAAA,GAAAA,IACnBiZ,GAAa1H,GACb2nC,EAAUljC,KAAK2kB,SACfue,EAAU7iC,KACV9X,GAAAA,GAAYG,QAGd,KAAM0V,aAAkBxX,GAAAA,SACtB,OAGF,OAAOsd,GAAgB9F,OAAQ3V,EAAW8S,EAC5C,CAAE,MAAOjT,GAAU,IAAA66C,EACjB,GAAgB,QAAZA,EAAC76C,EAAIoC,eAAO,IAAAy4C,IAAXA,EAAa99C,SAAS,aACzB,MAAMiD,EAER,MACF,CACF,CA1DkC86C,CAAuB7nC,EAASI,GAC9D,IAAKsnC,EACH,MAAO,iBAMT,GAHA/5C,EAASyS,EACTA,EAAUsnC,GAELD,EAAqB,CACxB,MAAMrlB,QjBJLz2B,eAAgCqU,EAAqBiiB,GAC1D,MAAM6lB,EAAS15C,GAAM6zB,EAAWN,IAQhC,aANsBlrB,QAAQipB,IAAIooB,EAAOhnC,KAAKinC,GACrCjmB,GAAgB9hB,EAAS,eAAgB,CAC9CI,QAAS2nC,QAIErmC,QAAO,CAACqC,EAAKpX,IACnBsW,OAAOsN,OAAOxM,EAAKpX,IACzB,CAAC,EACN,CiBRgCq7C,CAAiBhoC,EAAS,CAACI,IACrDA,EAAUgiB,EAAYhiB,GAAS0iB,aACjC,CACF,CAGA,IACE6L,EAAoBsZ,GAAiB7nC,EACvC,CAAE,MACA,MAAO,gBACT,CACA,MAAM8nC,EAAQ5rB,GAAoBqS,GAElC,OAAIuZ,EACK,CACL9nC,aACG8nC,EACH3zC,KAAM5G,GAAUu6C,EAAM3zC,MAInB,CAAE6L,UAAS7L,KAAM5G,EAC1B,CA6BO,SAASs6C,GAAiB7nC,EAAiBJ,GAChD,OAAO2I,GAAgBvI,GAAS,EAAMJ,EACxC,wBChEO,MAAMmoC,IAAuB7/B,EAAAA,GAAAA,IAClC3c,MAAOqU,EAAqBooC,WACZC,GAAcroC,EAASooC,IAAkBxlB,gBAI9C0lB,IAAwBhgC,EAAAA,GAAAA,IAAe3c,MAAOqU,EAAqBI,KAC9E,MAAM,cAAEwiB,EAAa,QAAE5D,SAAkBqpB,GAAcroC,EAASI,GAChE,OAAOwiB,GAAiB5D,OAAU9xB,CAAS,IACzCP,QAAoBO,IAAVP,IAEP,SAAS47C,GACdvoC,EACAwoC,EACAC,GAGA,OAAO9/B,GADQ+/B,GAAYF,EAAWC,GACRroC,SAAS,EAAOJ,EAChD,CAEO,SAAS0oC,GAAYF,EAAgCC,GACjC,iBAAdD,IACTA,EAAYrjC,GAAWqjC,IAGzB,MAAMG,EAAc3hC,GAAeyhC,GACnC,IAAKE,EACH,MAAM,IAAI79C,MAAM,wCAAwC29C,MAG1D,OAAOE,EAAYC,OAAO,CACxBJ,UAAW55C,GAAOC,KAAK25C,GACvBK,UAAWj2C,GAAAA,IAEf,CAEOjH,eAAe08C,GAAcroC,EAAqBooC,GACvD,MAAMhoC,EAAqC,iBAApBgoC,EACnBA,EACAz/B,GAAgBy/B,EAAgBhoC,aAASlT,EAAW8S,GAExD,aAAcgiB,GAAehiB,EAAS,CAACI,KAAWA,EACpD,CAEOzU,eAAem9C,GAAgB9oC,EAAqBI,GAOzD,MAAM+B,QAAauF,GAAa1H,GAAS+oC,eAAe3oC,IAElD,KAAE0/B,EAAI,MAAEvd,GAAUpgB,EAElB6mC,EAAcp6C,GAAOC,WAAWkW,GAAOO,GAAcw6B,KAAQ50C,SAAS,OACtE+9C,EAAehmC,OAAOa,OAAOzP,GAAAA,IAAgBurB,MAAMspB,GAASA,EAAK10C,OAASw0C,IAE1EG,EAAWrJ,GAAQ71B,GAAAA,KAAKksB,WAAW2J,GAAMtrC,OAAOtJ,SAAS,OAM/D,MAAO,CACL03B,cAL8B,WAAVL,EAMpB6mB,SALyB,WAAV7mB,GAAqB0mB,aAAY,EAAZA,EAAcv8C,QAASkH,GAAAA,GAAazG,YAASD,EAMjFwI,cALoBuzC,aAAY,EAAZA,EAAcvzC,cAMlCuzC,eACAE,WAEJ,CAEOx9C,eAAe09C,GAAkBxpC,GACtC,MAAM,QAAEG,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GAE/C,OAAOypC,GAAiBtpC,EAASI,EACnC,CAEOzU,eAAe29C,GAAiBtpC,EAAqBooC,GAC1D,aAAcC,GAAcroC,EAASooC,IAAkBzlB,OACzD,CAEOh3B,eAAe49C,GAAevpC,EAAqBooC,GACxD,MAAM,MAAEvlB,SAAgBwlB,GAAcroC,EAASooC,GAC/C,OAAOvlB,GAAS,CAClB,CAEOl3B,eAAe69C,GAAexpC,EAAqBwoC,GAMxD,MAAMiB,QAAmBC,GAAsB1pC,EAASwoC,GAClDmB,EAAgBF,EAAWvmC,QAAOpB,IAAA,IAAC,QAAEkd,GAASld,EAAA,OAAKkd,IAAY4qB,EAAAA,GAAsB,IAAE,GAE7F,GAAID,EAAc3mB,SAChB,OAAO2mB,EAGT,MAAME,EAAqBJ,EAAW/nC,QAAyC,CAACooC,EAAMC,IAC7EA,EAAQpnB,UAAWmnB,aAAI,EAAJA,EAAMnnB,UAAW,IAAMonB,EAAUD,QAC1D58C,GAEH,GAAI28C,EACF,OAAOA,EAGT,MAAMG,EhD4BD,SAAqBzmC,EAAiB0mC,GAC3C,IAAIC,EAAS3mC,EAAMrX,OAEnB,KAAOg+C,KACL,GAAID,EAAU1mC,EAAM2mC,IAClB,OAAO3mC,EAAM2mC,EAKnB,CgDtCqBC,CAASV,GAAYW,IAAA,IAAC,SAAEpnB,GAAUonB,EAAA,QAAOpnB,CAAQ,IAEpE,GAAIgnB,EACF,OAAOA,EAIT,MAAMK,EAAWZ,EAAW7pB,MAAK0qB,IAAA,IAAC,QAAEtrB,GAASsrB,EAAA,MAAiB,SAAZtrB,CAAkB,IAEpE,aAD+B+E,GAAoB/jB,EAASqqC,EAASjqC,UAChDlU,OAAS,EACrBm+C,EAGFV,CACT,CAEOh+C,eAAe+9C,GACpB1pC,EACAwoC,GAGA,MAAMv1B,GAFyB9b,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG1E,GAAAA,IAEXqO,KAAKke,IAC1B,MAAM9qB,EAASw0C,GAAYF,EAAWxpB,GAEtC,MAAO,CAAE9qB,SAAQkM,QADDuI,GAAgBzU,EAAOkM,SAAS,EAAOJ,GAC7Bgf,UAAS,IAG/BurB,QAAoBvoB,GAAehiB,EAASiE,GAAWgP,EAAO,YAEpE,OAAOA,EAAMnS,KAAKif,IACT,IACFwqB,EAAYxqB,EAAK3f,UAAY,CAC9BuiB,QAAS,GACTC,eAAe,MAEd7C,KAGT,CAEO,SAASyqB,GACdxqC,EACAwoC,GAOA,OAN+BrxC,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG1E,GAAAA,IAMlBqO,KAAKke,IACnB,MAAM9qB,EAASw0C,GAAYF,EAAWxpB,GAGtC,MAAO,CACL9qB,SACAkM,QAJcuI,GAAgBzU,EAAOkM,SAAS,EAAOJ,GAKrDgf,UACD,GAEL,CAEOrzB,eAAe8+C,GAAmB5qC,EAAmB6qC,GAC1D,MAAMx2C,QAAey2C,GAAa9qC,EAAW6qC,GAE7C,OAAO78B,EAAAA,GAAAA,aACJ+8B,eAAcC,EAAAA,GAAAA,gBAAe32C,EAAO4b,OACpClE,SACL,CAEO,SAASk/B,GAAoB9qC,EAAqBwoC,EAAuBpoC,GAK9E,OAJAA,EAAUuI,GAAgBvI,GAAS,EAAOJ,GAEvBwqC,GAAkBxqC,EAASwoC,GAE5B5oB,MAAMmrB,GAAMA,EAAE3qC,UAAYA,GAC9C,CAEOzU,eAAeg/C,GAAa9qC,EAAmBmrC,GACpD,MAAM,UAAExC,EAAS,QAAExpB,GAAYgsB,SAAmB92B,GAAqBrU,GACvE,IAAK2oC,EACH,MAAM,IAAI19C,MAAM,yBAGlB,OAAO49C,GAAYF,EAAWxpB,EAChC,CC/LO,SAASisB,KACd,OAAOC,EAAAA,kBACT,CAEO,SAASC,GAAiBjrC,GAC/B,OAAOgrC,EAAAA,iBAAgChrC,EACzC,CAEO,SAASkrC,GAAuBC,GACrC,OAAOC,IAAAA,KAAUC,QAAQC,SAASrmC,GAAWkmC,GAC/C,CAEO1/C,eAAe8/C,GAAgB5rC,EAAmBkW,EAAkBzB,GACzE,IACE,MAAQo3B,UAAWC,SAAqBC,GAAa/rC,EAAWkW,EAAUzB,IAAY,CAAC,EAEvF,OAAOq3B,CACT,CAAE,MAAO5+C,GAIP,YAFA8+C,QAAQl8C,MAAM5C,EAGhB,CACF,CAEOpB,eAAeigD,GAAa/rC,EAAmBkW,EAAkBzB,GACtE,IACEA,EAAUA,SAAiBL,GAA2CpU,GACtE,MAAMK,QAAiB+X,GAAYpY,EAAWkW,EAAUzB,GACxD,IAAKpU,EACH,OAGF,OAAID,EAAqBC,GAChBkrC,GAAuBlrC,EAAS,IACb,UAAjBoU,EAAQ5nB,KACVo/C,GAAuB5rC,SAEjBgrC,EAAAA,kBAAiChrC,EAElD,CAAE,MAAOnT,GAGP,YAFA8C,EAAAA,EAAAA,IAAc,eAAgB9C,EAGhC,CACF,CAEOpB,eAAeogD,GAAQlsC,EAAmBkW,EAAkBi2B,GACjE,MAAML,QAAmBF,GAAgB5rC,EAAWkW,GACpD,GAAK41B,EAML,OAAOzmC,GAFWomC,IAAAA,KAAUW,SAAS9mC,GAAW6mC,GAAUL,GAG5D,CAEO,SAASO,GACdlsC,EACAE,EACA8e,GAEA,MAAM,UAAEwpB,GAAcsD,GAAuB5rC,GAC7C,OAAOisC,GAAkB3D,EAAWxoC,EAASgf,EAC/C,CAEOrzB,eAAeygD,GACpBlsC,EACAF,EACAgf,GAEA,MAAM,UAAEwpB,SAAoB0C,EAAAA,kBAAiChrC,GAC7D,OAAOisC,GAAkB3D,EAAWxoC,EAASgf,EAC/C,CAEO,SAASqtB,GACdV,EACA3rC,EACAgf,GAEA,MAAM,UAAEwpB,GAAc4C,GAAuBO,GAC7C,OAAOQ,GAAkB3D,EAAWxoC,EAASgf,EAC/C,CAEArzB,eAAewgD,GACb3D,EACAxoC,EACAgf,GAEA,IAAI9qB,EACA8uB,EACAhE,EACF9qB,EAASw0C,GAAYF,EAAWxpB,KAE7B9qB,SAAQ8qB,UAASgE,kBAAmBwmB,GAAexpC,EAASwoC,IAGjE,MAAMpoC,EAAUuI,GAAgBzU,EAAOkM,SAAS,EAAOJ,GAGvD,MAAO,CACLtT,KAAM,MACN87C,UAJmBtjC,GAAWsjC,GAK9BpoC,UACA4e,UACAjd,MAAO,EACPihB,WAEJ,CAEA,SAAS8oB,GAAuB5rC,GAC9B,MAAMosC,EAAUz2B,EAAAA,GAAyB3V,EAAS1R,KAAK,OAC/CyQ,IAAK0sC,GAAeY,EAAiBt8C,GAAAA,GAAgBq8C,EAAQphD,SAAS,QAC9E,OAAOogD,IAAAA,KAAUC,QAAQC,SAASG,EACpC,CAEO,SAASa,GACdxsC,EACA9L,EACAu4C,GAEA,IAAKv4C,EAAOs0C,UACV,MAAM,IAAI19C,MAAM,gCAKlB,MAAO,CACL4B,KAAM,MACN0T,QAHiBmoC,GAAmBvoC,EADpBmF,GAAWjR,EAAOs0C,WACsBiE,GAIxDjE,UAAWt0C,EAAOs0C,UAClBxpB,QAASytB,EACT1qC,MAAO7N,EAAO6N,MAElB,CAEOpW,eAAe+gD,GACpB1sC,EACA2sC,GAEA,MAAMjF,QAAwBF,GAAexnC,EAAS2sC,GAAiB,GACvE,GAAwB,mBAApBjF,EAAsC,MAAO,CAAE/3C,MAAOi9C,EAAAA,GAAaC,mBACvE,GAAwB,mBAApBnF,EAAsC,MAAO,CAAE/3C,MAAOi9C,EAAAA,GAAaE,gBACvE,MAAMpqB,EAAaglB,EAAgBtnC,SAE5B2sC,EAAYvE,SAAmB/xC,QAAQipB,IAAI,CAChD2oB,GAAcroC,EAAS0iB,GACvBxZ,GAAmBlJ,EAAS0iB,KAG9B,MAAO,CACLsqB,MAAOtF,EAAgBnzC,KACvBL,OAAQkP,EAA4B,CAClC1W,KAAM,MACN87C,UAAWA,EAAYtjC,GAAWsjC,QAAat7C,EAC/CkT,QAAS2sC,EAAW3sC,QAGpB4e,SAAS+tB,aAAU,EAAVA,EAAY/tB,UAAW4qB,EAAAA,IAChC7nC,MAAO,EACP6gB,eAAemqB,aAAU,EAAVA,EAAYnqB,iBAAiB,IAGlD,CCtLO,SAASqqB,GAAmCj5B,GACjD,OAAOk5B,EAAAA,IAAal5B,EACtB,CC4HO,SAASm5B,GAAqBC,GACnC,MAAyB,cAAlBA,EAAOrvB,OAAyB,GAAMqvB,EAAO9mB,QAAU,EAChE,CC7H0BrjB,OAAOqf,YAC/Brf,OAAOiQ,QAAQg6B,EAAAA,KAAcpsC,KAAIgB,IAAA,IAAEkS,GAAO,YAAEq5B,IAAcvrC,EAAA,MAAK,CAACurC,EAAYzvB,KAAM5J,EAAM,+DCe1F,SAASs5B,GAAe94C,GACtB,GAAIA,EAAKtI,OAAS,GAAI,MAAM,IAAIpB,MAChC,MAAMmU,EAAMzK,EAAK/J,MAAM,EAAG,IACpB8rB,EAAK/hB,EAAK/J,MAAM,GAAI,IAM1B,OAAO,IAAI8iD,KAAAA,gBAAsBC,KAAIvuC,EAAKsX,EAC5C,CAUA,SAASk3B,GAAe1zC,EAAeC,GACrC,OA9BFrO,eAA0BsT,EAAiBkD,GACzC,MAAMurC,EAAW,CAAEn5C,KAAM,OAAQC,KAAM,WACjCm5C,QAAgB/uC,OAAOqG,OAAOkR,UAAU,MAAOlX,EAAKyuC,GAAU,EAAO,CAAC,SACtEE,QAAkBhvC,OAAOqG,OAAO4oC,KAAKH,EAAUC,EAASxrC,GACxDU,EAAS,IAAI/D,WAAW8uC,GAC9B,GAAsB,KAAlB/qC,EAAO3W,OAAoB,MAAM,IAAIpB,MACzC,OAAO+X,CACT,CAuBSirC,CAAW/zC,EAAGC,EACvB,CAuCOrO,eAAeoiD,GACpBjiC,EACAkiC,EACAC,EACAC,EACAC,GAEA,IAAKriC,IAAYA,EAAQ5f,OAAQ,MAAM,IAAIpB,MAAM,iBAErB,KAAxBojD,EAAahiD,SACfgiD,EAAeA,EAAazjD,MAAM,EAAG,KAGvC,MAAM2jD,GAAe,IAAIh4B,aAAcC,OAAOvK,GAExCmK,GAAO,IAAIG,aAAcC,OAAO1N,GAAgBwlC,GAAe,IAE/DE,QA/BD1iD,eACLwW,EAAkB6rC,EAAyBC,EAA4BtC,EAAwB11B,GAE/F,MAAMq4B,QAAqBC,EAAAA,GAAAA,iBAAgB5C,EAAYsC,GAEjDj3B,QAbRrrB,eAA+BwW,EAAkBmsC,EAA0Br4B,GACzE,MAAMu4B,EA5BR,SAAyBC,GACvB,MAAMC,GAAiBC,GAAkBF,GAAe,IAAMA,EACxDD,EAAS5vC,OAAOC,gBAAgB,IAAIC,WAAW4vC,IAErD,GADAF,EAAO,GAAKE,GACPA,EAAeD,GAAc,IAAO,EAAG,MAAM,IAAI3jD,MACtD,OAAO0jD,CACT,CAsBiBI,CAAgBzsC,EAAKjW,QAC9B2iD,EAAW,IAAI/vC,WAAW0vC,EAAOtiD,OAASiW,EAAKjW,QAGrD,OAFA2iD,EAAS3iC,IAAIsiC,EAAQ,GACrBK,EAAS3iC,IAAI/J,EAAMqsC,EAAOtiD,QAnB5BP,eAAqCwW,EAAkBmsC,EAA0Br4B,GAC/E,GAAI9T,EAAKjW,OAAS,IAAO,EAAG,MAAM,IAAIpB,MACtC,MACMgkD,SADiBrB,GAAex3B,EAAM9T,IACpB1X,MAAM,EAAG,IAE3B0e,EAAM,IAAIrK,WAAWqD,EAAKjW,OAAS,IACzCid,EAAI+C,IAAI4iC,EAAQ,GAEhB,MACM93B,EAAYs2B,SADWG,GAAea,EAAcQ,IACTp4B,QAAQvU,GAGzD,OAFAgH,EAAI+C,IAAI8K,EAAW,IAEZ7N,CACT,CAOS4lC,CAAsBF,EAAUP,EAAcr4B,EACvD,CAO0B+4B,CAAgB7sC,EAAMmsC,EAAcr4B,GACtDg5B,EAAoB,IAAInwC,WAAWkvC,EAAY9hD,OAAS8qB,EAAU9qB,QACxE,IAAK,IAAI2B,EAAI,EAAGA,EAAImgD,EAAY9hD,OAAQ2B,IACtCohD,EAAkBphD,GAAKogD,EAAepgD,GAAKmgD,EAAYngD,GAGzD,OADAohD,EAAkB/iC,IAAI8K,EAAWg3B,EAAY9hD,QACtC+iD,CACT,CAmB+BC,CAAYd,EAAcJ,EAAaC,EAAgBC,EAAcj4B,GAE5F5F,EAAU,IAAIvR,WAAWuvC,EAAeniD,OAAS,GAEjD6f,EAASnd,GAAOyT,MAAM,GAM5B,OALA0J,EAAO7J,cAAchP,GAAAA,GAAOizB,WAE5B9V,EAAQnE,IAAIH,EAAQ,GACpBsE,EAAQnE,IAAImiC,EAAgB,GAErBh+B,CACT,CA4CO1kB,eAAewjD,GACpBn3B,EAA2Bg2B,EAAyBE,EAA0BC,GAElD,KAAxBD,EAAahiD,SACfgiD,EAAeA,EAAazjD,MAAM,EAAG,KAGvC,MAAMwrB,GAAO,IAAIG,aAAcC,OAAO1N,GAAgBwlC,GAAe,IAE/DiB,QAvBDzjD,eAA2BwW,EAAkBqmC,EAAuBmD,EAAwB11B,GACjG,GAAI9T,EAAKjW,OAASs8C,EAAUt8C,OAC1B,MAAM,IAAIpB,MAAM,wCAElB,MAAMmjD,EAAiB,IAAInvC,WAAW0pC,EAAUt8C,QAChD,IAAK,IAAI2B,EAAI,EAAGA,EAAI26C,EAAUt8C,OAAQ2B,IACpCogD,EAAepgD,GAAKsU,EAAKtU,GAAK26C,EAAU36C,GAE1C,MAAMygD,QAAqBC,EAAAA,GAAAA,iBAAgB5C,EAAYsC,GAGvD,aAvBFtiD,eACEqsB,EAA2Bs2B,EAA0Br4B,GAErD,GAAI+B,EAAc9rB,OAAS,GAAI,MAAM,IAAIpB,MAAM,wCAC/C,GAAIktB,EAAc9rB,OAAS,IAAO,EAAG,MAAM,IAAIpB,MAAM,uDACrD,MAAMgkD,EAAS92B,EAAcvtB,MAAM,EAAG,IAChC0X,EAAO6V,EAAcvtB,MAAM,IAC3B4kD,QAAuB5B,GAAea,EAAcQ,GACpD3lC,QAxBRxd,eACE0jD,EAA4BP,EAAoB92B,EAA2B/B,GAE3E,MAAMq5B,EAAgBhC,GAAe+B,GAAgB13B,QAAQK,GAEvDu3B,SADiB9B,GAAex3B,EAAMq5B,IACjB7kD,MAAM,EAAG,IACpC,GAAIqkD,EAAOtgD,KAAK,OAAS+gD,EAAU/gD,KAAK,KACtC,MAAM,IAAI1D,MAAM,oCAElB,MAAM4jD,EAAeY,EAAc,GACnC,GAAIZ,EAAeY,EAAcpjD,QAAUwiD,EAAe,GACxD,MAAM,IAAI5jD,MAAM,0CAElB,OAAOwkD,EAAc7kD,MAAMikD,EAC7B,CAUoBc,CAAUH,EAAgBP,EAAQ3sC,EAAM8T,GAC1D,OAAO9M,CACT,CAY0BsmC,CAAgBttC,EAAK1X,MAAM+9C,EAAUt8C,QAASoiD,EAAcr4B,EAEtF,CAW+By5B,CAAY13B,EAAeg2B,EAAaE,EAAcj4B,GACnF,OAAO,IAAI2B,aAAcC,OAAOu3B,EAClC,CCrKA,MAAMO,GAAa,UCAbA,GAAa,UCQZhkD,eAAeikD,GACpB/jD,EACAqI,EACA/E,EACA0gD,GAEA,MAAM,QACJzvC,EAAO,KACP0P,GACE5b,EAEJ,IAAI47C,EACAhgC,UAAejkB,EAAOkkD,mBAAmB3vC,KAC3C0vC,EAAahgC,GAGf,MAAMkgC,GAAMC,EAAAA,GAAAA,UAAS,CACnBpyB,GAAIzd,EACJ0P,KAAMggC,EAAa,CACjBhQ,KAAMgQ,EAAWhQ,KACjB39B,KAAM2tC,EAAW3tC,WACfjV,EACJytB,KAAMxrB,IAGF7E,GAAOujB,EAAAA,GAAAA,aACVgF,OAAMq9B,EAAAA,GAAAA,cAAaF,IACnBpkC,UAEGukC,EAA8B,OAAhBN,EAEdxI,EAAU/8C,EAAKkK,OAAOtJ,SAAS,UAC/BklD,EAuBR,SAAsCjhD,GAWpC,OAVa0e,EAAAA,GAAAA,aACV1C,UAAU,EAAG,GACbA,UAAU,EAAG,GACbG,aAAanc,EAAQ+5C,KAAKmH,MAC1BllC,UAAU,EAAG,GACbO,UAAS,GACTA,UAAS,GACTC,SAASxc,EAAQwrB,MACjB/O,UAESpX,OAAOtJ,SAAS,SAC9B,CAnC4BolD,CAA6BN,GACjDO,EAAkBphD,EAAQqF,OAAOtJ,SAAS,UAC1CslD,EAAMlmD,EAAK28B,QAAQ/7B,SAAS,UAElC,IAAIulD,EACJ,GAAIN,EAAa,CACf,MAAMttC,QD5CH,SAA6B2tC,GAClC,OAAOz2B,GACL,GAAG41B,gBAAyB,CAAEa,MAAKE,YAAY,GAAQ,CAAEt2B,aAAa,GAE1E,CCwCyBu2B,CAAoBH,GACzCC,EAAc5tC,EAAO4tC,WACvB,MAAO,GAAoB,WAAhBZ,EAA0B,CACnC,MAAMhtC,QF/CH,SAAuB2tC,GAC5B,OAAOz2B,GACL,GAAG41B,aAAsB,CAAEa,MAAKE,YAAY,GAAQ,CAAEt2B,aAAa,GAEvE,CE2CyBw2B,CAAcJ,GACnCC,EAAc5tC,EAAO4tC,WACvB,YACQ5kD,EAAOglD,SAASL,GAGxB,MAAO,CACLA,MACAnJ,QAAS8I,EAAcI,EAAkBlJ,EACzC+I,oBACAK,cAEJ,CC1DA,MAAMK,GAAiC,CAAC,EAClChP,GAAsC,CAAC,EAEtCn2C,eAAeolD,GAA6B/wC,EAAqBI,GACtE,MAAMnB,EAAM,GAAGe,KAAWI,IACpB4wC,EAAclP,GAAU7iC,GAExBc,EAAKmP,KACL+hC,EAAkB,IAAI56C,GAAAA,EAQ5B,OAPAyrC,GAAU7iC,GAAOgyC,EACjBH,GAAK/wC,GAAMkxC,EAEPD,SACIA,EAAYx6C,QAGb,CAAEuJ,KAAIkxC,kBACf,CAEO,SAASC,GAAmBnxC,GACjC,OAAO+wC,GAAK/wC,EACd,iBCbOpU,eAAewlD,GACpBnxC,EACA8J,EACAsmC,EACAgB,GAEA,MAAM,MAAEC,EAAK,YAAEjvB,SCRVz2B,eAA0BquB,GAS/B,MAAM,QAAEha,EAAO,kBAAEowC,EAAiB,gBAAEgB,GAAoBp3B,EAElD7I,QAAiB2Q,GACrB9hB,EACAoxC,EAAkB,iBAAmB,UACrC,CACE,CAACA,EAAkB,eAAiB,YAAahB,EACjDkB,iBAAiB,IAIrB,MAAO,CACLD,MAAOlgC,EAASogC,OAAO,GACvBnvB,YAAajR,EAAS4Q,aACtB2I,SAAUvZ,EAASuZ,SAEvB,CDjBuC8mB,CAAW,CAAExxC,UAASowC,oBAAmBgB,oBAE9E,OAAOC,GAASI,GAAW,CACzBzxC,UACA8J,gBACA6mB,QAAS0gB,EAAM1gB,QACf+gB,YAAaL,EAAMA,MACnBjvB,cACAgkB,aAAciL,EAAMjL,cAExB,CAEO,SAASqL,GAAWz3B,GAQzB,MAAM,QACJha,EAAO,cACP8J,EAAa,QACb6mB,EAAO,YACP+gB,EAAW,YACXtvB,EACAgkB,aAAcC,GACZrsB,EAEEosB,EAAenjC,OAAOa,OAAOuiC,GAChCvlC,KAAKwlC,GAAUC,GAAoBvmC,EAASsmC,EAAOlkB,KACnDokB,OAEGmL,EAAiBvL,E1DlCL1kC,QAAO,CAACc,EAAwBC,KAChD,MAAMmvC,EAAWnvC,EAAU,KAQ3B,OANKD,EAAMovC,GAGTpvC,EAAMovC,GAAU72C,KAAK0H,GAFrBD,EAAMovC,GAAY,CAACnvC,GAKdD,CAAK,GACX,CAAC,G0D0BJ,IAAIqvC,EAAY,GACZC,EAAgB,GAChBC,EAAkB,GAEtB,MAAMC,EAAwC,GAE9C,IAAIC,GAA2B,EAiE/B,OA/DA,SAASC,EAAaC,EAA2BC,GAC/C,MAAM59C,EAAO29C,EAAaE,QACpBC,EAAMX,EAAOn9C,IAAS,GAE5B,GAAKy9C,IACHA,EAA2BK,EAAIvxC,MAAKe,IAG9B,IAH+B,YACnC8xB,EAAW,WACXhF,GACD9sB,EACC,OAAO8xB,IAAgB9pB,IAAkB8kB,CAAU,IAIhDqjB,GAMP,IAAK,MAAOpkD,EAAGyxB,KAAOgzB,EAAIp/B,UAAW,CACnC,MAAM,YACJ0gB,EAAW,UACX/oB,EAAS,OACTyb,EAAM,WACNsI,EAAU,IACV2E,EAAG,QACH8T,EAAO,KACP36C,GACE4yB,EAEEvd,EAAQqwC,GAAUvkD,EAElBkU,KAASiwC,EASbA,EAAmBjwC,GAAOk2B,OAAOh8B,IAAIzH,GAPrCw9C,EAAmBj3C,KAAK,CACtBk9B,OAAQ,IAAIj1B,IACZuvC,KAAM,GACNC,SAAU,GACV1a,WAAY,KAMZlE,IAAgB9pB,GAAkB8kB,EAK3B/jB,IAAcf,GAAiB8kB,GAAuB,YAATliC,IACtDslD,EAAmBjwC,GAAOywC,UAAYrzC,EAAUmnB,GAChDwrB,GAAiB3yC,EAAUmnB,KAN3B0rB,EAAmBjwC,GAAOwwC,MAAQpzC,EAAUmnB,GAC5C0rB,EAAmBjwC,GAAO+1B,WAAavE,EACvCse,GAAa1yC,EAAUmnB,GACvByrB,GAAmBxe,GAMrB,MAAMkf,EAAQN,EAAaO,SAAS9yB,MAAKwqB,IAAA,IAAC,YAAEuI,GAAavI,EAAA,OAAKuI,IAAgBtL,CAAO,IACjFoL,GACFP,EAAaO,EAAO1wC,EAExB,MA5CIowC,EAAaO,SAASrkD,QAAQ6jD,EA6CpC,CAEAA,CAAaR,GAEN,CACL/gB,UACA+gB,cACAtvB,cACA4vB,qBACAH,YACAC,gBACAC,kBAEJ,CE5GA,MAAMa,GAAyB,IAEzBC,GAAsB,EACtBC,GAAoB1X,GAEb2X,IAAsBzqC,EAAAA,GAAAA,IAAe3c,MAAOqU,EAAqBI,KAC5E,MAAMgmC,QAAqBD,GAAkB,CAC3CnmC,UACAI,UACAyvB,MAAO,IAET,OAAOrsB,QAAQ4iC,EAAal6C,OAAO,IAG9BP,eAAeqnD,GACpBnzC,EACAozC,EACAnjB,EACAC,EACAF,EACAG,GAEA,MAAM,QAAEhwB,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GAE/C,OAAKozC,SAWsBrjB,GAAa,CACpC5vB,UACAkD,OAAQ,CACN9C,QAAS6yC,IAAc30C,EAAAA,IAAQsf,KAC3Bxd,QACMiI,GAA0BrI,EAASI,EAASohB,GAAeyxB,GAAW1qC,eAElFuB,cAAe1J,EACfyvB,MAAOA,GAAS+iB,GAChB7iB,gBACAD,cACAE,uBAGgB9sB,QAAQua,GAAaD,GAAsBC,GAAU3zB,SAASmpD,KAxBzErjB,GAAa,CAClB5vB,UACAkD,OAAQ,CAAE9C,WACV0J,cAAe1J,EACfyvB,MAAOA,GAAS+iB,GAChB7iB,gBACAD,cACAE,qBAmBN,CAgBOrkC,eAAeunD,GACpBrzC,EACA4d,GAEA,MAAM,QAAEzd,GAAYJ,EAAeC,IAC3BO,QAAS0J,SAAwBoK,GAAqBrU,GAC9D,IAAIgD,EAGJ,IAAK,IAAIswC,EAAU,EAAGA,EAAUN,KAAwBhwC,EAAQswC,IAAW,CACrEA,EAAU,SACNC,EAAAA,EAAAA,IAAMN,IAGd,MAAMO,QAAoBlC,GACxBnxC,EACA8J,EACA2T,EAASya,oBACTjb,GAAqBQ,IAElB41B,IAILxwC,EAASywC,GAAyB71B,EAAU41B,GAC9C,CAMA,OAJKxwC,IACHhT,EAAAA,EAAAA,IAAc,iCAAkC4tB,EAAS1d,IAGpD8C,CACT,CAEO,SAASywC,GACd71B,EACA41B,GAEA,MAAM,SAAEhjB,GAAawJ,GAAsBpc,EAAS1d,KAC9C,QAAE4wB,EAAO,mBAAEqhB,GAAuBqB,EAElCtiB,EAASJ,EAAQ/Q,MAAK9d,IAAA,IAAC,UAAEsuB,GAAWtuB,EAAA,OAAKsuB,IAAcC,CAAQ,IACrE,IAAKU,EAEH,OAGF,MAAMwiB,EAAe,IAAIvwC,IAAI+tB,EAAOqV,eAE9B,KACJmM,EAAI,SACJC,EAAQ,WACR1a,GACEka,EAAmBpyB,MAAMG,G5DkFxB,SAAyBtnB,EAAWc,GACzC,MAAMsJ,EAAS,IAAIG,IACnB,IAAK,MAAMwwC,KAAQj6C,EACbd,EAAE0K,IAAIqwC,IACR3wC,EAAO5G,IAAIu3C,GAGf,OAAO3wC,CACT,C4DzFW4wC,CAAa1zB,EAAKkY,OAAQsb,GAAc50C,OAGjD,IAAIkE,EAuBJ,OApBEA,EADoB,SAAlB4a,EAASC,KAwBf,SAAwB1D,GAQtB,MAAM,OAAE+W,EAAM,WAAE+G,EAAU,SAAE0a,EAAQ,KAAED,EAAMc,aAAa,QAAE1iB,IAAc3W,EACzE,IAAI,SAAEyD,GAAazD,EAEnB,MAAM,QAAE6G,GAAYkQ,EAEpB,IAAI2iB,EAAanB,EACboB,EAASnB,EAER3xB,EAAQ+yB,SAGD/yB,EAAQgzB,YAElBF,GAAUt1C,OAAOwiB,EAAQwW,sBAAsB/Q,SAH/CotB,GAAcr1C,OAAOwiB,EAAQqW,sBAAsB5Q,QAMrD,MAAMwtB,EAAUhc,EAAa4b,EAAaC,EAO1C,IAAI3b,EACJ,GANAva,EAAW,IACNA,EACHqa,WAAYv5B,EAAUu1C,IAInBjzB,EAAQ+yB,SAQN,CACL,MAAMG,EAAepjB,EAAQ/Q,MAAMo0B,GACT,oBAAjBA,EAAQtnD,MAA8BsnD,EAAQnzB,QAAQ4S,kBAAoB/gC,GAAAA,KAE/EqhD,IACF/b,EAAS35B,OAAO01C,EAAalzB,QAAQyF,QAEzC,KAfuB,CACrB,MAAMytB,EAAepjB,EAAQ/Q,MAAMo0B,GAET,kBAAjBA,EAAQtnD,MAA4ByQ,OAAO62C,EAAQnzB,QAAQsS,UAAYjgC,GAAAA,GAAOkgC,SAEnF2gB,IACF/b,EAAS35B,OAAO01C,EAAalzB,QAAQl0B,OAEzC,CASA,GAAIqrC,EAAQ,CACV,MAAMic,EAAUzyB,GAAe/D,EAAS5uB,MACxC4uB,EAASua,OAASz5B,EAAUy5B,EAAQic,aAAO,EAAPA,EAAS71C,SAC/C,CAIA,cAFOqf,EAAS2U,kBAET,CAAE3U,WAAUi2B,aAAYC,SACjC,CAhFaO,CAAe,CACtBb,cAAa51B,WAAUsT,OAAQA,EAAsBwhB,OAAMC,WAAU1a,eAiF3E,SAA+B9d,GAQ7B,MAAM,OACJ+W,EAAM,SACNyhB,EAAQ,KACRD,EACAc,aAAa,YACXjxB,EAAW,UACXyvB,EAAS,cACTC,EAAa,gBACbC,IAEA/3B,EAEJ,IAAI,SAAEyD,EAAQ,WAAEqa,GAAe9d,EAC3B05B,EAAanB,EACboB,EAASnB,EAEb,OAAQzhB,EAAOrkC,MACb,IAAK,eACL,IAAK,gBACHgnD,GAAcr1C,OAAO0yB,EAAOlQ,QAAQl0B,OACpC,MAEF,IAAK,eACCokC,EAAOlQ,QAAQqU,cACjBwe,GAAcr1C,OAAO0yB,EAAOlQ,QAAQO,QAEtC,MAEF,IAAK,gBACHsyB,GAAcr1C,OAAO0yB,EAAOlQ,QAAQyF,QACpC,MAEF,IAAK,mBACHqtB,GAAUt1C,OAAO0yB,EAAOlQ,QAAQyF,QAChC,MAEF,IAAK,wBAAyB,CAG5B,MAAM6tB,EAAsB91C,OAAO0zB,GAAsBhB,EAAQ,CAC/D3O,cAEApiB,QAAS,UACT8J,cAAe,GACf4gB,SAAU,CAAC,EACXnD,uCAAwC,CAAC,IACxCr7B,QAEH4rC,EAAaia,EAAkBoC,EAC/BT,EAAa7B,EAAYsC,EACzBR,EAAS7B,EAAgBqC,EAEpBpjB,EAAOlQ,QAAQ8R,QAER5B,EAAOlQ,QAAQgS,UACzB6gB,GAAcr1C,OAAO0yB,EAAOlQ,QAAQ+R,UAAY,IAAMuhB,GAFtDT,GAAcr1C,OAAO0yB,EAAOlQ,QAAQ4R,UAAY,IAAM0hB,EAIxD,KACF,CACA,IAAK,yBACEpjB,EAAOlQ,QAAQ8R,QAER5B,EAAOlQ,QAAQgS,UACzB8gB,GAAUt1C,OAAO0yB,EAAOlQ,QAAQ+R,WAFhC+gB,GAAUt1C,OAAO0yB,EAAOlQ,QAAQ4R,UAKlCihB,GAAc,GACdC,GAAU,GAKd,MAAMG,EAAUhc,EAAa4b,EAAaC,EAS1C,OAPAl2B,EAAW,IACNA,EACH8V,IAAKugB,UAGAr2B,EAAS2U,kBAET,CAAE3U,WAAUi2B,aAAYC,SACjC,CAxKaS,CAAsB,CAC7Bf,cAAa51B,WAAUsT,SAAQwhB,OAAMC,WAAU1a,gBAInD8H,EAAAA,EAAAA,IAAS,gCAAiC,CACxCvP,SAAUU,EAAOX,UACjB8H,oBAAqBza,EAASya,oBAC9Bla,UAAWf,GAAqBQ,GAChCqa,WAAYv5B,EAAUu5B,GACtBgc,QAASv1C,EAAU81C,GAAmBxxC,EAAO4a,WAC7Ci2B,WAAYn1C,EAAUsE,EAAO6wC,YAC7BC,OAAQp1C,EAAUsE,EAAO8wC,QACzB9yB,QAASkQ,EAAOlQ,UAGXhe,CACT,CAyJO,SAASwxC,GAAmB52B,GACjC,MAAyB,SAAlBA,EAASC,KAAkBvf,EAAYsf,EAASqa,WAAYx5B,EAAAA,IAAQF,UAAYqf,EAAS8V,GAClG,CCnTO5nC,eAAe2oD,GACpBt0C,EACA9L,EACAqgD,EACA3xB,GAEA,MAAM4tB,EAyHR,SAA0Bt8C,EAAmBymB,EAAYiI,GACvD,MAAM4xB,GAAkBvE,EAAAA,GAAAA,UAAS,CAC/BpyB,GAAI3pB,EAAOkM,QACX0P,KAAO8S,OAGH11B,EAHmB,CACrB4yC,KAAM5rC,EAAO4b,KAAKgwB,KAClB39B,KAAMjO,EAAO4b,KAAK3N,MAEpBwY,SAGF,OAAO9M,EAAAA,GAAAA,aACJgF,OAAMq9B,EAAAA,GAAAA,cAAasE,IACnB5oC,UACAqb,QACA/7B,SAAS,SACd,CAxIcupD,CAAiBvgD,EAAQqgD,EAAa3xB,GAC5C8xB,QCZD/oD,eAAiCqU,EAAqBwwC,GAC3D,MAAM9sB,EAAsB,YAAZ1jB,EAAwBoI,EAAAA,IAAwBN,EAAAA,IAkBhE,aAhBuB8S,EAAAA,GAAAA,IAAe,GAAG8I,gCAAuC,CAC9EvJ,OAAQ,OACRjS,QAAS,IACJgb,GAAoBljB,GACvB,eAAgB,oBAElB2a,KAAM1J,KAAKhY,UAAU,CACnBu3C,MACAmE,eAAe,EACfC,mBAAmB,EACnBC,cAAc,EACdzT,sBAAsB,EACtBC,kBAAkB,OAINrmB,MAClB,CDR0B85B,CAAkB90C,EAASwwC,GAGnD,OAkBF,SACExwC,EACA8J,EACA4qC,EACAntB,GAEA,MAAM8rB,EAAc5B,GAAW,CAC7BzxC,UACA8J,gBACA6mB,QAAS+jB,EAAU/jB,QACnB+gB,YAAagD,EAAUrD,MACvBjvB,YAAasyB,EAAU3yB,aACvBqkB,aAAcsO,EAAUtO,eAGpB2O,EAAgBlkB,GACpB7wB,EACA8J,EACA4qC,EAAU/jB,QACV+jB,EAAU3yB,aACV2yB,EAAUhqB,SACVnD,GAGIytB,EAAkC,GACxC,IAAIC,EAAe,GACfC,EAAc,GAElB,IAAK,IAAIz3B,KAAYs3B,EACnB,KACEt3B,EAASuV,YACW,gBAAlBvV,EAASC,MACND,EAASmW,cAAgB9pB,GACzB2T,EAAS5S,YAAcf,GAJ9B,CASA,GAAI2T,EAAS2U,kBAAmB,CAC9B,MAAMvvB,EAASywC,GAAyB71B,EAAU41B,GAC9CxwC,GACF4a,EAAW5a,EAAO4a,SAClBy3B,GAAeryC,EAAO8wC,SAEtB9jD,EAAAA,EAAAA,IAAc,yCAA0C4tB,EAAS1d,GAErE,CAEAi1C,EAAiBj6C,KAAK0iB,GACtBw3B,GAAgBZ,GAAmB52B,EAbnC,CAoBF,OAJIy3B,GAkBN,SAA2BprC,EAAuBgnB,EAA2B6iB,GAC3E,MAAM5xC,EAAQ+uB,EAAW4P,WAAWjjB,GACT,gBAAlBA,EAASC,MAA4C,WAAlBD,EAAS/wB,OAGrD,IAAe,IAAXqV,EAAc,CAChB,MAAMozC,EAAiBrkB,EAAW6P,OAAO5+B,EAAO,GAAG,GACnD+uB,EAAW/1B,KAAK,IACXo6C,EACH7uB,OAAQ6uB,EAAe7uB,OAASqtB,GAEpC,MACE7iB,EAAW/1B,KAAK,CACdgF,GAAIy7B,GACJpe,KAAMoe,GACNte,UAAW4T,EAAWA,EAAW5kC,OAAS,GAAGgxB,UAC7CQ,KAAM,cACN4I,OAAQqtB,EACR/1B,KAAMtf,EAAAA,IAAQsf,KACd+Q,kBAAmBmF,EAAAA,IACnBF,YAAaE,EAAAA,IACbjpB,UAAWf,EACX8kB,YAAY,EACZ2E,IAAK,GACL7mC,KAAM,UAGZ,CA5CI0oD,CAAkBtrC,EAAekrC,EAAkBE,GAGxB,IAAzBH,EAAc7oD,OAvEpB,SAA8BwoD,GAC5B,MAAMW,EAAcpyC,OAAOa,OAAO4wC,EAAUtO,cAAc1kC,QAAO,CAACqC,EAAKub,KACrE,MAAQmnB,WAAYC,GAAcpnB,EAClC,OAAOvb,EAAM1F,OAAOqoC,EAAU,GAC7B,IAEH,MAAO,CACL5O,WAAYud,EACZ7C,SAAU,GACVR,mBAAoB,GACpBlhB,WAAY,GACZgjB,QAASuB,EAEb,CA4DWC,CAAqBZ,GAGvB,CACL5c,WAAYub,EAAYtB,gBACxBS,SAAUa,EAAYvB,cACtBE,mBAAoBqB,EAAYrB,mBAChClhB,WAAYkkB,EACZlB,QAASmB,EAEb,CAtFSM,CAAev1C,EAFA2I,GAAgBzU,EAAOkM,SAAS,EAAOJ,GAEf00C,QADOr4B,KAEvD,wBEiCO1wB,eAAe6pD,GACpBx1C,EACA4zB,EACArrB,EACAktC,GAEA,MAAM,UAAE5qC,EAAS,QAAEwF,GAAYolC,EAEzB10B,EAAQU,GAAkBlZ,GAChC,GAAuB,iBAAZ8H,GAAyB0Q,UAAAA,EAAO20B,oBACzC,OAAOD,EAGT,MAAME,QAAsBjwB,GAAmB1lB,EAAS6K,EAAWwF,GACnE,GAA2B,oBAAvBslC,EAAcjpD,KAChB,MAAM,IAAI5B,MAAM,mBAGlB,MAAM,qBACJ8qD,EAAoB,kBACpBC,EAAiB,UACjBC,EAAS,cACT9qC,SACQ+qC,GAAkB,CAC1B/1C,UACA+gB,QACA6S,cACA9qB,mBAAoB2sC,EAAS5qC,YAG/B,IAAK+qC,GAAwBC,EAC3B,OAAOJ,EAGT,MAAMO,EAAavrC,GAAuB,CACxCI,UAAW8qC,EAAcnvB,YACzB7b,QAASgrC,EAAchrC,QACvBC,YAAa+qC,EAAcrvB,OAC3Bvb,cAAe4qC,EAAc5qC,cAC7BE,eAAgBhB,GAAAA,KAAKksB,WAAWwf,EAAc1qC,gBAC9CH,gBAAiB6qC,EAAcjvB,oBAC/B1b,cAAef,GAAAA,KAAKksB,WAAWnrB,KAGjC,MAAO,IACFyqC,EACHK,UAAWA,EAAY7rC,GAAAA,KAAKksB,WAAW2f,QAAa5oD,EACpDmjB,QAAS2lC,EACTC,iBAAiB,EAErB,CAEOtqD,eAAeuqD,GAAmBl8B,GAUvC,MAAM,QACJha,EAAO,aACPuI,EAAY,YACZqrB,EAAW,UACX/oB,EAAS,OACTyb,EAAM,mBACN6vB,EAAkB,cAClBprC,EAAgBva,GAAAA,IACdwpB,EACJ,IAAI,QAAE3J,GAAY2J,EAElB,MAAMlR,QAA2BT,GAA0BrI,EAAS4zB,EAAarrB,GAC3EwY,EAAQU,GAAkBlZ,IAE1B,sBACJ6tC,UAAiC9N,GAAsBtoC,EAAS8I,GAAoB,kBACpF+sC,EAAiB,qBACjBD,EAAoB,cACpB5qC,EAAa,UACb8qC,SACQC,GAAkB,CAC1B/1C,UAAS4zB,cAAa7S,QAAOjY,qBAAoBqtC,uBAGnD,GAAIC,GAEE7tC,UAD2BM,GAAoB7I,EAAS8I,GAE1D,MAAM,IAAIhe,MAAM,oBAIpBulB,EAAU5F,GAAuB,CAC/BG,YAAa0b,EACbzb,YACAE,gBACAE,eAAgBoF,EAChBvF,gBAAiB8oB,EACjB5oB,cAAeA,EAAgBf,GAAAA,KAAKksB,WAAWnrB,QAAiB9d,IAIlE,IAAMo5B,OAAQ+vB,EAAa,WAAEC,GAAeC,GAC1Cx1B,EAAOvd,QAAQoyC,KAA0BC,GAO3C,OAJI9qC,EAAgBva,GAAAA,KAClB6lD,GAAiBtrC,GAGZ,CACLub,OAAQ+vB,EACRC,aACAzrC,UAAW/B,EACXuH,UACAylC,UAAWA,EAAY7rC,GAAAA,KAAKksB,WAAW2f,QAAa5oD,EACpD0oD,uBACAQ,wBAEJ,CAEOzqD,eAAe6qD,GAA4Bx2C,EAAqBy2C,EAAwBluC,GAC7F,MAAMO,QAA2BT,GAA0BrI,EAASy2C,EAAgBluC,GAC9EwY,EAAQU,GAAkBlZ,IAE1B,sBACJ6tC,UAAiC9N,GAAsBtoC,EAAS8I,GAAoB,qBACpF8sC,SACQG,GAAkB,CAC1B/1C,UAAS4zB,YAAa6iB,EAAgB11B,QAAOjY,uBAG/C,OAAO4tC,GAAkC12C,EAAS8I,EAAoBstC,EAAuBR,EAC/F,CAEOjqD,eAAe+qD,GACpB12C,EACA8I,EACAstC,GAEA,IADAR,EAAoBz+C,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,GAEnBwrB,EAAU,GAOd,OANIyzB,IACFzzB,S1D0FG,SAAyB3iB,EAAqB8J,GAEnD,OADoBpC,GAAa1H,GAASyI,KAAK,IAAIO,GAAAA,EAAa3d,GAAAA,QAAQC,MAAMwe,KAC3D6sC,kBACrB,C0D7FqBC,CAAgB52C,EAAS8I,IAExC8sC,IACFjzB,GAAWizB,GAENjzB,CACT,CAEAh3B,eAAeoqD,GAAkB/7B,GAO/B,MAAM,QACJha,EAAO,YAAE4zB,EAAW,MAAE7S,EAAK,mBAAEjY,EAAkB,mBAAEqtC,GAC/Cn8B,EAGJ,IAAIo8B,EACAprC,EACA8qC,EAEAD,EACAD,EAEJ,GAR0B70B,EAAM20B,sBAQRS,IACtBC,UAAiC9N,GAAsBtoC,EAAS8I,GAChE+sC,EAAoBO,SA4BjBzqD,eAAiDqU,EAAqB8I,GAG3E,aAFkBpB,GAAa1H,GAC5B62C,UAAUxrD,GAAAA,QAAQC,MAAMwd,GAAqB,eACrCtc,MAAMsqD,aACnB,CAhCuDC,CAAkC/2C,EAAS8I,IAEzF+sC,GAAmB,CACtB,MAAM1zC,QA+BZxW,eAA4C+pD,EAA6Bt1C,GACvE,MAAMsiB,EAAanY,GAAanK,GAEhC,aAAcqlB,EAAAA,GAAAA,IAAmB,GAAGiwB,YAA8BhzB,KAAcjS,OAAM,KAAe,GASvG,CA3CyBumC,CAA6Bj2B,EAAM20B,oBAAsB9hB,GACtEqjB,GAAY90C,GACd7K,KAAK6X,MAAQ,IAAI7X,KAA+C,IAA1C6F,OAAOgF,EAAK+0C,gBAAgBC,aAAoBC,UAGtEj1C,IAAS80C,IACXjsC,EAAgB7I,EAAKk1C,eACrBzB,EAAuBv3C,OAAO8D,EAAK+0C,gBAAgB5wB,QAE9C8vB,IACHN,EAAY3zC,EAAKm1C,YAGvB,CAGF,MAAO,CACLlB,wBACAP,oBACAD,uBACA5qC,gBACA8qC,YAEJ,CAsBOnqD,eAAe4rD,GAAWv3C,EAAqBI,GAGpD,OAAOo3C,GAAqBp3C,Q/BrLvBzU,eAAmCqU,EAAqBI,GAC7D,MAAM,QAAEq3C,S3BoBH,SAA6Bz3C,EAAqBI,GAEvD,OADiBsH,GAAa1H,GAASyI,KAAK,IAAIC,GAAAA,GAAard,GAAAA,QAAQC,MAAM8U,KAC3Ds3C,eAClB,C2BvB4BC,CAAoB33C,EAASI,GAEvD,IAAIsqB,EAEJ,MAAMjgC,EAAQgtD,EAAQ/sD,UAGtB,GAFeD,EAAMG,SAAS,KAEf45B,GAAyB,CACtC,MACMozB,EADQ1xB,GAAez7B,GACJS,SAAS,SAClCw/B,QAAiBlF,GAA4BoyB,EAC/C,MAEEltB,QAWG/+B,eAA0ClB,GAC/C,MAAMotD,EAAOptD,EAAMqtD,SAAS5pC,GAAW,WAAAE,KAAKxf,OAAO,IAAK61B,IAElDtb,EAAgD,CAAC,EAEvD,IAAK,MAAOlK,EAAKtS,KAAUsW,OAAOiQ,QAAQgS,IAA4B,KAAA6yB,EACpE,MAAMC,EAAYppD,GAAOC,WAAWkW,GAAOnW,GAAOC,KAAKoQ,EAAK,WACtDwB,EAAyB,QAAtBs3C,EAAGF,EAAK9mC,IAAIinC,UAAU,IAAAD,OAAA,EAAnBA,EAAqB7sD,SAASyB,GAEtC8T,IACF0I,EAAIlK,GAA+BwB,EAEvC,CAEA,OAAO0I,CACT,CA1BqB8uC,CAA2BxtD,GACxCigC,EAASvF,MAGXuF,EAAW,UADoBlF,GAA4BkF,EAASvF,QAC/BuF,IAIzC,OAAOA,CACT,C+B4JyBwtB,CAAoBl4C,EAASI,GAGtD,CAEA,SAASo3C,GAAqBp3C,EAAiBsqB,GAC7C,MAAM,KACJn2B,EAAI,OACJ+wB,EAAM,MACND,EACA8yB,WAAYC,EAAS,SACrBh6C,EACAmnB,uBAAwBmwB,GACtBhrB,EAEJ,MAAO,CACL9M,KAAM8D,GAAe,MAAOthB,GAC5B7L,OACA+wB,SACAlnB,cAAuBlR,IAAbkR,EAAyB9L,GAAAA,GAAmB6K,OAAOiB,GAC7D4V,MAAO,MACPzL,aAAcnI,EACdilB,MAAQA,IAASuH,EAAAA,GAAAA,IAAWvH,IAAY+yB,I/BrPTj2C,E+BqPyCi2C,G7DjS7C7yC,E8B6CMpD,E9B5C5BvT,GAAOC,KAAK0W,EAAQ,UAAUra,SAAS,U8B6C9BpB,SAAS,QAChB,6BAA6BqY,IAE/B,yBAAyBA,W+BgPyDjV,EACvFwoD,uB/BtPG,IAA4BvzC,E9B5CJoD,C6DoS/B,CASO,SAASgxC,GAA4Bx1B,EAAiBs3B,GAC3D,IAAI/xB,EAAS,GACTgwB,EAAa,GAkBjB,OAhBIv1B,EAAMnD,OAAS06B,EAAAA,KACjBhyB,GAAUl2B,GAAAA,GACVkmD,GAAc/lD,GAAAA,IACLwwB,EAAMw3B,QACfjyB,GAAUl2B,GAAAA,GACVkmD,GAAchmD,GAAAA,KAEdg2B,GAAUn2B,GAAAA,GACVmmD,GAAcjmD,GAAAA,IAGZgoD,IACF/xB,GAAU71B,GAAAA,GACV6lD,GAAc7lD,GAAAA,IAGT,CAAE61B,SAAQgwB,aACnB,CAEO3qD,eAAe6sD,GACpBx4C,EACAI,EACAqP,GAEA,MAAMgpC,QAvTR9sD,eAAgCqU,EAAqBI,GAEnD,aAD0B2jB,GAAoB/jB,EAASI,IACpCU,KAAK6hB,GAG1B,SAA2B3iB,EAAqB04C,GAC9C,GAAKA,EAAWC,OAIhB,IACE,MAAM,QAAEh2B,EAAO,OAAEg2B,EAAQC,eAAgB9uC,GAAkB4uC,EAErD33B,EAAQy2B,GADO7uC,GAAgBgwC,EAAOv4C,SAAS,EAAMJ,GACV24C,GAEjD,MAAO,CACL/6B,KAAMmD,EAAMnD,KACZ+E,QAAStkB,OAAOskB,GAChB5B,QACA0T,aAAc9rB,GAAgBmB,EAAc1J,aAASlT,EAAW8S,GAEpE,CAAE,MAAOjT,GAEP,YADA8C,EAAAA,EAAAA,IAAc,oBAAqB9C,EAErC,CACF,CAvBsC8rD,CAAkB74C,EAAS2iB,KAAUzf,OAAOM,QAClF,CAoT8Bs1C,CAAiB94C,EAASI,GAChDgf,EAA8Bq5B,EAAc33C,KAAIgB,IAAA,IAAC,MAAEif,GAAOjf,EAAA,MAAM,IACjEif,EACHK,MAAO,EACPC,SAAU,EACVC,iBAAkB,EACnB,IAGD,aAFMd,GAAapB,EAAQ3P,SC/VtB9jB,eAAiCqU,EAAqB+4C,EAAsBtpC,SAC3EyQ,GAAc1pB,QACpB,MAAMwiD,EAAez3B,KAAiBjB,OAEhC24B,EAAgBF,EAAWr3C,QAA4B,CAACu3C,EAAehG,KAC3E,MAAMlyB,EAAQi4B,EAAa/F,GAW3B,OARElyB,GACmB,QAAhBA,EAAM/M,QACL+M,EAAMooB,UACP,CAAC,KAAM,SAAU,QAAQpoC,MAAMm4C,GAAWn4B,EAAMuE,OAAO6zB,cAAcrvD,SAASovD,MAEjFD,EAAcl+C,KAAKgmB,GAGdk4B,CAAa,GACnB,IAEH,IAAKA,EAAc/sD,OACjB,OAGF,MAAMktD,EAAkB92C,EAAqB22C,EAAe,gBAE5D,IACE,MAAM92B,QlCqDHx2B,eAAgCqU,EAAqBiiB,GAC1D,MAAQ+B,SAAU7B,SAAiBL,GAGhC9hB,EAAS,iBAAkB,CAAEI,QAAS6hB,EAAUzzB,KAAK,OAElD6qD,EAAep2C,OAAOqf,YAAYL,EAAUnhB,KAAKV,GAAY,CAACmK,GAAanK,GAAUA,MAC3F,IAAK,MAAMmiB,KAASJ,EAClBI,EAAMniB,QAAUi5C,EAAa92B,EAAMniB,QAAQxS,eAE7C,OAAO0U,EAAqB6f,EAAQ,UACtC,CkChEyBm3B,CAAiBt5C,EAASi5C,EAAcn4C,KAAKigB,GAAUA,EAAMxY,gBAElF,IAAK,MAAMnI,KAAW6C,OAAOL,KAAKuf,GAC3Bi3B,EAAgBh5C,KACrBg5C,EAAgBh5C,GAAS+oC,SAAWv6C,GAAOC,KAAKszB,EAAO/hB,GAASm5C,UAAW,UAAUruD,SAAS,cAG1Fs1B,GAAavd,OAAOa,OAAOs1C,GAAiBl2C,QAAQ6d,GAAUA,EAAMooB,WAAW15B,EACvF,CAAE,MAAO1iB,IACP8C,EAAAA,EAAAA,IAAc,kDAAmD9C,EACnE,CACF,CD2TQysD,CAAkBx5C,EAASof,EAAOte,KAAKigB,GAAUA,EAAMnD,OAAOnO,GAC7DxM,OAAOqf,YAAYm2B,EAAc33C,KAAIspC,IAAA,IAAC,KAAExsB,EAAI,QAAE+E,GAASynB,EAAA,MAAK,CAACxsB,EAAM+E,EAAQ,IACpF,wBEjSA,MAAM82B,GAAwBpe,GACxBqe,GAAate,GAEbue,GAAgC,WAChCC,GAA6B,IAE7BC,GAAqD,CACzD97B,OAAQ,gBACR+7B,aAAc,GACdC,aAAc,GACdjG,QAAS,IAGJnoD,eAAequD,GACpBhgC,GAEA,MAAM,UACJna,EAAS,OACTymB,EAAS,GAAE,aACX/d,EAAY,cACZ0xC,EAAa,aACbC,EACApE,UAAWqE,EAAe,cAC1BpvC,EAAa,aACbqvC,GACEpgC,EACJ,IAAI,UAAEnP,EAAS,KAAE1I,GAAS6X,EAE1B,MAAM,QAAEha,GAAYJ,EAAeC,GAEnC,IAAIgD,EAAyC,CAAC,EAE9C,IAEE,GADAA,QAAew3C,GAAer6C,EAAS6K,GACnC,UAAWhI,EACb,OAAOA,EAGTgI,EAAYhI,EAAO6kC,gBAEnB,MAAM,cAAE9kB,SAAwBkmB,GAAgB9oC,EAAS6K,GAEzD,GAAIsvC,IAAoBD,EACtB,MAAO,IACFr3C,EACHlT,MAAO2qD,EAAAA,GAAyBC,qBAIpC,IAAIzE,EAEJ,GAAIqE,EACF,IACErE,EAAY7rC,GAAAA,KAAKksB,WAAWgkB,EAC9B,CAAE,MACA,MAAO,IACFt3C,EACHlT,MAAO2qD,EAAAA,GAAyBE,iBAEpC,CAGF,GAAI33C,EAAOsH,eAAiByY,IAAkBkzB,EAE5C,OADAjzC,EAAO43C,sBAAyB1H,GAAoB/yC,EAAS6K,GACtD,IACFhI,EACHlT,MAAO2qD,EAAAA,GAAyBI,kBAMpC,GAFA73C,EAAO6kC,gBAAkB78B,EAErByb,EAAS,GACX,MAAO,IACFzjB,EACHlT,MAAO2qD,EAAAA,GAAyBK,eAIpC,MAAMzmD,QAAey2C,GAAa9qC,GAMlC,GAJoB,iBAATsC,GAAqB+3C,IAC9B/3C,EAAOmD,GAAcnD,IAGnBA,GAAwB,iBAATA,GAAqB83C,UACZ/wC,GAAmBlJ,EAAS6K,GAEpD,MAAO,IACFhI,EACHlT,MAAO2qD,EAAAA,GAAyBM,sBAKtC,MAAM,QAAEx6C,EAASwiB,cAAei4B,SAA8B3mC,GAAqBrU,GAMnF,IAAIw2C,EAJAl0C,GAAwB,iBAATA,IAAsB+3C,IACvC/3C,EAAO0J,GAAe1J,IAIxB,MAAM24C,QAAuBxR,GAAiBtpC,EAAS9L,GACvD,IAAIyuB,EACA4Q,EACAugB,EAEJ,GAAKvrC,EASE,CACL,MAAMwyC,QAAsB7E,GAAmB,CAC7Cl2C,UACAuI,eACAqrB,YAAaxzB,EACbyK,YACAyb,SACAjW,QAASlO,EACT4I,oBAECub,OAAQ+vB,EAAexrC,YAAWwF,QAASlO,GAAS44C,GACvD,MAAQzE,WAAY0E,EAAiB,sBAAE5E,EAAqB,qBAAER,GAAyBmF,EAIvFxnB,EAAM8iB,EACNvC,EAAUkH,EAEV,MAAMlyC,EAAqB+B,EAC3B8X,QAAgB+zB,GACd12C,EAAS8I,EAAoBstC,EAAuBR,EAExD,MA9BEjzB,EAAUm4B,EACVzE,EAAgB/vB,EAChBiN,EAAM,GACNugB,EAAU,GAEN3xC,aAAgBrD,aAClBqD,EAAO83C,EAAgBltC,GAAiC5K,GAAQqJ,GAAiBrJ,IA0BrF,MAAM84C,GAAqB1yC,GAAgBuyC,IAAmBx0B,GACxD,YAAEiuB,SAAsB2G,GAAgB,CAC5Cl7C,UACA9L,SACA2W,YACAyb,OAAQ+vB,EACRhmC,QAASlO,EACT2zC,YACAqF,cAAeF,EACfhB,mBAGI,WAAEniB,GAAesjB,SACfC,GAA+Br7C,EAAS9L,EAAQqgD,EAAasG,IAQrE,IAAIS,EAEJ,GARA/nB,GAAOuE,EACPgc,GAAWhc,EACXj1B,EAAO0wB,IAAMA,EACb1wB,EAAOixC,QAAUA,EACjBjxC,EAAOuqC,OAASyM,GAIXtxC,EAEE,CACL,MAAMgzC,EAAsBT,GAAkBvnB,EAE1C6mB,IACFv3C,EAAOuqC,aAAeoO,GAAU,CAC9B37C,YACA0I,eACAgzC,sBACAT,iBACAW,aAAc94B,KAKhB24B,Ed5HmB,mBADOlO,Ec4HNvqC,EAAOuqC,Qd3HnBrvB,aAAgD7wB,IAAlBkgD,EAAO9mB,Oc4H3BA,EAAS6mB,GAAqBtqC,EAAOuqC,SAAWzqB,EAEhD44B,GAAuBj1B,GAAU3D,CAEvD,MAnBE24B,EAAkBR,GAAkBvnB,GAAO0nB,EAAoB,GAAK30B,GAqBtE,OAAOg1B,EAAkBz4C,EAAS,IAC7BA,EACHlT,MAAO2qD,EAAAA,GAAyBoB,oBAEpC,CAAE,MAAO3uD,GACP,MAAO,KACF4uD,EAAAA,GAAAA,IAAkB5uD,MAClB8V,EAEP,Cd5IK,IAA2BuqC,Cc6IlC,CAmBOzhD,eAAe0uD,GAAer6C,EAAqB6K,GACxD,MAAMhI,EAOF,CAAC,EAECjM,QAAiB4wC,GAAexnC,EAAS6K,GAC/C,GAAiB,mBAAbjU,EAA+B,MAAO,IAAKiM,EAAQlT,MAAO2qD,EAAAA,GAAyBzN,mBACvF,GAAiB,mBAAbj2C,EAA+B,MAAO,IAAKiM,EAAQlT,MAAO2qD,EAAAA,GAAyBsB,kBACvF/4C,EAAOg5C,YAAcjlD,EAASrC,KAC9BsO,EAAO6kC,gBAAkB9wC,EAASwJ,QAClCyC,EAAOi5C,eAAiBllD,EAASklD,eACjCj5C,EAAOopB,OAASr1B,EAASq1B,OACzBphB,EAAYjU,EAASwJ,QAErB,MAAM,eAAEoN,EAAc,WAAEuuC,EAAU,aAAE5xC,GAAiB5e,GAAasf,GAElEhI,EAAOsH,aAAeA,EAEtB,MACM6xC,GADQ,QACWt+C,KAAKmN,GAE9B,OAAK2C,IAAmBwuC,GAA0B,YAAZh8C,GAAyB+7C,EACtD,IACFl5C,EACHlT,MAAO2qD,EAAAA,GAAyB2B,sBAI7Bp5C,CACT,CAEOlX,eAAeuwD,GAAeliC,GACnC,MAAM,UACJna,EAAS,SACTkW,EAAQ,OACRuQ,EAAM,aACN/d,EAAY,cACZ0xC,EAAa,aACbC,EAAY,cACZnvC,GACEiP,EACJ,IAAI,UAAE87B,GAAc97B,GAEhB,UAAEnP,EAAS,KAAE1I,GAAS6X,EAE1B,MAAM,QAAEha,GAAYJ,EAAeC,GAEnC,IACE,MAAMyU,QAAgBL,GAA2CpU,IACzDO,QAASwzB,EAAW,cAAEhR,GAAkBtO,EAAQF,IAClDlgB,QAAey2C,GAAa9qC,EAAWyU,EAAQF,MAC/C,UAAEo0B,EAAS,UAAEkD,SAAqBE,GAAa/rC,EAAWkW,EAAUzB,GAE1E,IAAI8R,EAQAiwB,EANgB,iBAATl0C,KACNkO,QAASlO,EAAMikB,0BAA2B+1B,GAAgB,CAC3Dn8C,UAAS6K,YAAW+oB,cAAazxB,OAAMupC,YAAWlD,YAAWyR,gBAAeC,kBAM3E3xC,IAQD+d,OAAQ+vB,EACRxrC,YACAwF,QAASlO,EACT2zC,mBACQI,GAAmB,CAC3Bl2C,UACAuI,eACAqrB,cACA/oB,YACAyb,SACAjW,QAASlO,EACT4I,oBAlBFsrC,EAAgB/vB,EAEZnkB,aAAgBrD,aAClBqD,EAAO83C,EAAgBltC,GAAiC5K,GAAQqJ,GAAiBrJ,KAmBrF,MAAM,gBAAE8uC,SAA0BF,GAA6B/wC,EAAS4zB,GAElEknB,QAAuBxR,GAAiBtpC,EAAS9L,GACjD+mD,GAAqB1yC,GAAgBuyC,IAAmBx0B,GAExD,MAAEzD,EAAK,YAAE0xB,SAAsB2G,GAAgB,CACnDl7C,UACA9L,SACA2W,YACAyb,OAAQ+vB,EACRhmC,QAASlO,EACT2zC,YACAnK,WAAYD,EACZyP,cAAeF,EACfhB,mBAGI,WAAEniB,SAAqBujB,GAA+Br7C,EAAS9L,EAAQqgD,EAAa3xB,GAM1F,KAJwBq4B,EACpBH,EAAiBhjB,EACjBgjB,GAAkBzE,EAAgBve,GAGpC,MAAO,CAAEnoC,MAAOysD,EAAAA,GAAoBV,qBAGtC,MAAM7vD,EAAS6b,GAAa1H,IACtB,QAAEqnC,EAAO,IAAEmJ,EAAG,kBAAEJ,SAA4BR,GAAa/jD,EAAQqI,EAAQqgD,GAI/E,OAFK8H,GAAar8C,EAAS4zB,EAAa4c,EAAK3tB,EAAOouB,GAE7C,CACL3qB,SACAzD,QACAuD,mBACAvb,YACAw8B,UACA+I,oBACAiG,gBAEJ,CAAE,MAAOtpD,GAGP,OAFA8C,EAAAA,EAAAA,IAAc,iBAAkB9C,GAEzB,CAAE4C,MAAO2sD,GAAwBvvD,GAC1C,CACF,CAEOpB,eAAe4wD,GAAyBviC,GAW7C,IACE,MAAM,UACJnP,EAAS,OACTyb,EAAM,UACNzmB,EAAS,SACTkW,EAAQ,aACRxN,EAAY,cACZ0xC,EAAa,aACbuC,EAAY,mBACZC,GACEziC,EAEJ,IAAI,KAAE7X,GAAS6X,EAEf,MAAM,QAAEha,GAAYJ,EAAeC,KAE1BO,QAASwzB,EAAW,QAAE5U,GAAWusB,SAAiB90C,QAAQipB,IAAI,CACrExL,GAAqBrU,GACrB+rC,GAAa/rC,EAAWkW,MAGpB,UAAEyyB,EAAS,UAAEkD,GAAcH,EAEjC,IAAInlB,EAEgB,iBAATjkB,KACNkO,QAASlO,EAAMikB,0BAA2B+1B,GAAgB,CAC3Dn8C,UAAS6K,YAAW+oB,cAAazxB,OAAMupC,YAAWlD,YAAWyR,mBAIjE,MAAMyC,EAAgC,OAC9BxG,GAAmB,CACvBl2C,UACAuI,eACAqrB,cACA/oB,YACAyb,SACAjW,QAASlO,KAyBb,OArBKs6C,GACHC,EAAS3hD,WACDm7C,GAAmB,CACvBl2C,UACAuI,eACAqrB,cACA/oB,UAAW8xC,EAAAA,IACXr2B,OAAQk2B,EACRrG,oBAAoB,EACpB9lC,S5DnFD,IAAIjkB,GAAAA,SACR+e,UAAUjY,GAAAA,GAAOkgC,OAAQ,IACzBxnB,a4D6FM,UAPcgxC,GAAoB,CACvC/8C,YACAkW,WACA2mC,WACAG,WAAW,IAKXz2B,mBACA02B,cAA2B,OAAZ99B,EAEnB,CAAE,MAAOjyB,GAGP,OAFA8C,EAAAA,EAAAA,IAAc,2BAA4B9C,GAEnC,CAAE4C,MAAO2sD,GAAwBvvD,GAC1C,CACF,CAEApB,eAAewwD,GAAer6C,GAczB,IACCuO,EACA+V,GAhByB,QAC7BpmB,EAAO,UAAE6K,EAAS,KAAE1I,EAAI,cAAE83C,EAAa,UAAEzR,EAAS,UAAEkD,EAAS,YAAE9X,EAAW,aAAEsmB,GAU7Ep4C,EAOC,GAAKK,EAEE,GAAI+3C,EACT7pC,E5D5UG,SAAqB9K,GAC1B,IACE,OAAO0E,GAAAA,KAAKksB,WAAW5wB,EACzB,CAAE,MAAOxY,GAEP,OADA8C,EAAAA,EAAAA,IAAc,cAAe9C,GACtB+R,WAAWjQ,KAAKD,GAAOC,KAAK0W,EAAQ,UAC7C,CACF,C4DqUcw3C,CAAY56C,QACjB,GAAI83C,EAAe,CACxB,MAAM+C,QAAqB9zC,GAAmBlJ,EAAS6K,GACvDwF,QAAgB09B,GAAsB5rC,EAAMqmC,EAAWwU,EAAatR,EAAW9X,GAC/ExN,EAAmBx3B,GAAOC,KAAKwhB,EAAQ5lB,MAAM,IAAIS,SAAS,SAC5D,MACEmlB,EAAUxE,GAAe1J,QARzBkO,OAAUnjB,EAWZ,MAAO,CAAEmjB,UAAS+V,mBACpB,CAEO,SAASk2B,GAAwB3sD,GACtC,GAAIA,aAAiBstD,GAAAA,GAAgB,CACnC,GAAIttD,EAAMR,QAAQrF,SAAS,gBACzB,OAAOsyD,EAAAA,GAAoBc,oBACtB,GAAyB,MAArBvtD,EAAMwtD,WACf,OAAOxtD,EAAMR,QACR,GAAIQ,EAAMytD,aACf,OAAOztD,EAAMytD,YAEjB,CACA,OAAOhB,EAAAA,GAAoBiB,mBAC7B,CAEA1xD,eAAeuvD,GAAe9Q,GAsB3B,IAtB4B,QAC7BpqC,EAAO,OACP9L,EAAM,UACN2W,EAAS,OACTyb,EAAM,QACNjW,EAAO,UACPylC,EAAS,WACTnK,EAAU,cACVwP,EAAa,SACbmC,EAAQ,cACRrD,GAYD7P,EACC,MAAM,MAAEvnB,SAAgBwlB,GAAcroC,EAAS9L,GAE1Cy3C,GAGH/L,EAAAA,EAAAA,IAAS,uBAAwB,CAAE/c,QAAOhY,YAAWyb,WAFrDqlB,EAAa,IAAI7sC,WAAW,IAKzBw+C,IACHA,EAAW/gD,KAAK/D,MAAMlB,KAAK6X,MAAQ,KAAQrc,GAAAA,IAGzCud,aAAmBvR,aACrBuR,EAAU4pC,EACNltC,GAAiCsD,GACjC7E,GAAiB6E,EAAS,IAGhC,MAAMP,EAAOgmC,GAAYyH,EAAAA,GAAAA,eACvBzH,EAAUprD,gBACRwC,EAEEswD,GAAYrC,EACdsC,GAAAA,SAASC,4BACTD,GAAAA,SAASE,oBAAsBF,GAAAA,SAASG,cAEtCC,EAAiB,CACrBh7B,QACA6oB,UAAW98C,GAAOC,KAAK88C,GACvB+Q,SAAU,EAACoB,EAAAA,GAAAA,UAAS,CAClBnxD,MAAO25B,EACPzI,GAAIhT,EACJ8P,KAAMtK,EACNP,OACAiuC,OAAQxyD,GAAasf,GAAWV,gBAElCqzC,WACAz1C,QAASu1C,GAMX,MAAO,CAAEz6B,QAAO0xB,aAJsB9sC,GAAAA,mBAClCvT,EAAO8pD,eAAeH,IAI5B,CAEOlyD,eAAesyD,GAAyBp+C,GAC7C,MAAM,QAAEG,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GAE/C,OLtiBKlU,eAAmCqU,EAAqBI,GAC7D,MAAMgmC,QAAqBD,GAAkB,CAC3CnmC,UACAI,UACAyvB,MAAO,IAGT,GAAKuW,EAAal6C,OAIlB,OAAOk6C,EAAa,GAAGhpB,IACzB,CK0hBS8gC,CAAoBl+C,EAASI,EACtC,CAEOzU,eAAewyD,GACpBt+C,EACA68C,EACA0B,GAEA,IAAIC,EAAsB,GAE1B,MAAM,QAAEr+C,GAAYJ,EAAeC,GAC7BmrC,QAAkB92B,GAAqBrU,IACvC,cAAE+iB,EAAa,QAAE5D,GAAYgsB,EAEnC,IACE,IAAK,MAAM,UAAEngC,EAAS,OAAEyb,KAAYo2B,EAAU,CAC5C,GAAIp2B,EAAS,GACX,MAAO,CAAE32B,MAAO2qD,EAAAA,GAAyBK,eAG3C,MAAM2D,EAAwB,YAAZt+C,GACZ,QAAEqN,EAAO,WAAE0uC,GAAexwD,GAAasf,GAE7C,IAAKwC,GAAYixC,GAAavC,EAC5B,MAAO,CAAEpsD,MAAO2qD,EAAAA,GAAyBsB,kBAG3CyC,GAAe/3B,CACjB,CAGA,MAAM,4BAAEi4B,EAA2B,eAAEC,SA6BzC7yD,eACEqU,EACA8J,EACA4yC,GAKA,MAAM+B,QAA8BhoD,QAAQipB,IAC1Cg9B,EAAS57C,KAAInV,UAAkC,IAA3B,QAAE0kB,EAAO,UAAExF,GAAWy/B,EACxC,IAAKj6B,EAAS,MAAO,CAAEquC,iBAAaxxD,EAAWyoD,mBAAezoD,GAE9D,IACE,MAAMyxD,EAAkBC,GAAuB,CAAEvuC,UAAS4lC,iBAAiB,IAAShvB,QAAQ/7B,SAAS,UAC/FyqD,QAAsBjwB,GAAmB1lB,EAAS6K,EAAW8zC,GAEnE,MAA4B,qBAAxBhJ,aAAa,EAAbA,EAAejpD,MACV,CACLgyD,YAAa,CACXn2C,aAAcotC,EAAcptC,aAC5B+d,OAAQqvB,EAAcrvB,QAExBqvB,iBAIG,CAAE+I,iBAAaxxD,EAAWyoD,gBACnC,CAAE,MAAOpmD,IAEPM,EAAAA,EAAAA,IAAc,6BAA8B,wBAAyBN,EACvE,CAEA,MAAO,CAAEmvD,iBAAaxxD,EAAWyoD,mBAAezoD,EAAW,KAKzD2xD,EAAgD,CAAC,EACjDL,EAAiBC,EAAsB39C,KAAK+B,GAAWA,aAAM,EAANA,EAAQ8yC,gBAErE,IAAK,MAAM9yC,KAAU47C,EACnB,GAAI57C,SAAAA,EAAQ67C,YAAa,CACvB,MAAM,aAAEn2C,EAAY,OAAE+d,GAAWzjB,EAAO67C,YACnCG,EAAsBt2C,KACzBs2C,EAAsBt2C,GAAgB,IAExCs2C,EAAsBt2C,IAAiB+d,CACzC,CAGF,MAAMw4B,EAAiB77C,OAAOL,KAAKi8C,GACnC,GAA8B,IAA1BC,EAAe5yD,OACjB,MAAO,CAAEqyD,6BAA6B,EAAOC,kBAG/C,MAAM/F,QAAsBhiD,QAAQipB,IAClCo/B,EAAeh+C,KAAKyH,GAClBiuC,GAA4Bx2C,EAAS8J,EAAevB,MAKxD,IAAK,IAAI1a,EAAI,EAAGA,EAAIixD,EAAe5yD,OAAQ2B,IAAK,CAC9C,MACMkxD,EAAiBF,EADFC,EAAejxD,IAIpC,GAFyB4qD,EAAc5qD,GAEhBkxD,EACrB,MAAO,CAAER,6BAA6B,EAAMC,iBAEhD,CAEA,MAAO,CAAED,6BAA6B,EAAOC,iBAC/C,CAtGkEQ,CAC5Dh/C,EACAgrC,EAAU5qC,QACVs8C,GAGIxoD,QAAey2C,GAAa9qC,EAAWmrC,IACvC,QAAEroB,SAAkB0lB,GAAcroC,EAAS9L,IAE3C,YAAEqgD,SAAsB0K,GAAqB,CAAEj/C,UAAS9L,SAAQwoD,WAAU19B,YAI1Enc,EAAS,CAAE6xC,UAHC0G,SACVC,GAA+Br7C,EAAS9L,EAAQqgD,EAAa3xB,IAEzC47B,kBAItBU,GAA6Bd,GAAcz7B,EAAU07B,EAAcx7C,EAAO6xC,UAAU5c,WAE1F,OAAIymB,GAA+BW,EAC1B,IAAKr8C,EAAQlT,MAAO2qD,EAAAA,GAAyBoB,qBAG/C74C,CACT,CAAE,MAAO9V,GACP,OAAO4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CAuFOpB,eAAeixD,GAAmBuC,GAE6B,IAF5B,UACxCt/C,EAAS,SAAEkW,EAAQ,SAAE2mC,EAAQ,SAAEY,EAAQ,UAAET,GACdsC,EAC3B,MAAM,QAAEn/C,GAAYJ,EAAeC,GAE7ByU,QAAgBL,GAA2CpU,IACzDO,QAASwzB,EAAW,cAAEhR,EAAa,QAAE5D,GAAY1K,EAAQF,KAC3D,gBAAE68B,SAA0BF,GAA6B/wC,EAAS4zB,GAExE,IACE,MAAM1/B,QAAey2C,GAAa9qC,EAAWyU,EAAQF,KAC/Cu3B,QAAmBF,GAAgB5rC,EAAWkW,EAAUzB,GAE9D,IAAI+pC,EAAc,GAClB3B,EAASruD,SAASc,IAChBkvD,GAAehgD,OAAOlP,EAAQm3B,OAAO,IAGvC,MAAM,QAAE3D,SAAkB0lB,GAAcroC,EAAS9L,GAE3C27C,EAAcgN,EAAwB,OAAZ79B,EAAmB,KAAO,cAAW9xB,EAC/D4vD,EAAgC,OAAhBjN,GAEhB,MAAEhtB,EAAK,YAAE0xB,SAAsB0K,GAAqB,CACxDj/C,UAAS9L,SAAQwoD,WAAU19B,UAAS2sB,aAAY2R,WAAUR,kBAG5D,IAAKD,EAAW,CACd,MAAM,WAAE/kB,SAAqBujB,GAA+Br7C,EAAS9L,EAAQqgD,EAAa3xB,GAC1F,GAAID,EAAU07B,EAAcvmB,EAC1B,MAAO,CAAEnoC,MAAOysD,EAAAA,GAAoBV,oBAExC,CAEA,MAAM7vD,EAAS6b,GAAa1H,IACtB,QAAEqnC,EAAO,IAAEmJ,EAAG,YAAEC,EAAW,kBAAEL,SAA4BR,GAC7D/jD,EAAQqI,EAAQqgD,EAAa1E,GAG1BgN,EAIH5L,EAAgBv6C,UAHX2lD,GAAar8C,EAAS4zB,EAAa4c,EAAK3tB,EAAOouB,GAMtD,MAAMmO,EAAkB1C,EAAS57C,KAAK3R,GACL,iBAApBA,EAAQkhB,cAAmD,IAApBlhB,EAAQkhB,QACjDvN,EAAK3T,EAAS,CAAC,YAEjBA,IAGT,MAAO,CACL0zB,QACAyD,OAAQ+3B,EAAYnzD,WACpBwxD,SAAU0C,EACV5O,MACAnJ,UACA+I,oBACAK,cACAqM,gBAEJ,CAAE,MAAO/vD,GAIP,OAHAkkD,EAAgBv6C,WAEhB7G,EAAAA,EAAAA,IAAc,sBAAuB9C,GAC9B,CAAE4C,MAAO2sD,GAAwBvvD,GAC1C,CACF,CAEApB,eAAeszD,GAAoBI,GAiBhC,IAjBiC,QAClCr/C,EAAO,OACP9L,EAAM,SACNwoD,EAAQ,QACR19B,EAAO,WACP2sB,EAAU,SACV2R,EAAQ,cACRR,GAUDuC,EACC,MAAM,MAAEx8B,SAAgBwlB,GAAcroC,EAAS9L,GAE1Cy3C,GAGH/L,EAAAA,EAAAA,IAAS,sBAAuB,CAC9B/c,QACA65B,SAAUA,EAAS57C,KAAKomC,GAAQxkC,EAAKwkC,EAAK,CAAC,YAAa,eAJ1DyE,EAAa,IAAI7sC,WAAW,IAQzBw+C,IACHA,EAAW/gD,KAAK/D,MAAMlB,KAAK6X,MAAQ,MAAS2tC,EAAgBlD,GAA6B9mD,GAAAA,KAG3F,IAAIwsD,GAAa,EAEjB,MAAMC,EAAmB7C,EAAS57C,KAAK3R,IACrC,MAAM,OACJm3B,EAAM,UAAEzb,EAAS,UAAEirC,EAAS,gBAAEG,GAC5B9mD,EACJ,IAAI,QAAEkhB,GAAYlhB,EAElBkhB,EAAUuuC,GAAuB,CAAEvuC,UAAS4lC,oBAE5C,MAAMnmC,EAAOgmC,GAAYyH,EAAAA,GAAAA,eACvBzH,EAAUprD,gBACRwC,EAMJ,OAJKoyD,GAAcjvC,IACjBivC,GAAa,IAGRxB,EAAAA,GAAAA,UAAS,CACdnxD,MAAO25B,EACPzI,GAAIhT,EACJ8P,KAAMtK,EACN0tC,OAAQxyD,GAAasf,GAAWV,aAChC2F,QACA,IAGY,OAAZkP,GAEFugC,EAAiBhxD,UAGnB,MAAMsvD,EAAiB,CACrB2B,SAAU1C,EAAgB,gBAAsB5vD,EAChD21B,QACA6oB,UAAW98C,GAAOC,KAAK88C,GACvB+Q,SAAU6C,EACV/B,SAAUC,GAAAA,SAASE,mBAAqBF,GAAAA,SAASG,cACjD71C,QAASu1C,GAOX,MAAO,CAAEz6B,QAAO0xB,aAJsB9sC,GAAAA,mBAClCvT,EAAO8pD,eAAeH,IAI5B,CAEAlyD,eAAe0wD,GACbr8C,EACAI,EACAowC,EACA3tB,EACAouB,GAEA,MAAMvnC,EAAYhC,GAAa1H,GACzBy/C,EAAYnoD,KAAK6X,MAAQsqC,GAE/B,KAAOniD,KAAK6X,MAAQswC,GAAW,CAC7B,MAAO9vD,EAAOo9C,SAAoBt2C,QAAQipB,IAAI,CAC5ChW,EAAUmnC,SAASL,GAAK//B,OAAO1jB,GAAQkB,OAAOlB,KAC9Cs7C,GAAcroC,EAASI,GAASqQ,OAAM,KAAe,MAIvD,GAAI9gB,SAAAA,EAAOwnB,MAAM,2EACf,MAIF,GAAI41B,GAAcA,EAAWlqB,MAAQA,EACnC,YAGIuwB,EAAAA,EAAAA,IAAMsG,GACd,CAEAzI,SAAAA,EAAiBv6C,SACnB,CAEA/K,eAAe0vD,GACbr7C,EACA9L,EACAqgD,EACA3xB,GAEA,IAEE,MAAO,CAAE88B,YAAY,WADGpL,GAAmBt0C,EAAS9L,EAAQqgD,EAAa3xB,GAE3E,CAAE,MAAO71B,IACP8C,EAAAA,EAAAA,IAAc,kCAAmC9C,EACnD,CAKA,MAAM,KAAE+yC,EAAO,KAAI,KAAE39B,EAAO,MAAUygB,EAA8B,CAAC,EAAf1uB,EAAO4b,MACrD6vC,YAAaC,SAAel4C,GAAa1H,GAAS6/C,2BAA2B3rD,EAAOkM,QAAS,CACnGua,KAAM45B,EACNuL,SAAUhgB,EACVigB,SAAU59C,EACV69C,iBAAiB,IAGnB,MAAO,CAAEN,YAAY,EAAM5nB,WADRz5B,OAAOuhD,EAAKK,WAAaL,EAAKM,YAAcN,EAAKO,QAAUP,EAAKzY,SAErF,CAEOx7C,eAAey0D,GAAkBvgD,EAAmB1Q,EAA4BkxD,GACrF,MAAM,QAAErgD,GAAYJ,EAAeC,IAC3BO,QAASwzB,EAAW,UAAE4U,EAAS,QAAExpB,SAAkB9K,GAAqBrU,GAC1EhU,EAAS6b,GAAa1H,GACtB9L,EAASw0C,GAAYF,EAAYxpB,IACjC,OAAEzZ,EAAM,MAAEsd,GAAU1zB,EACpB8hD,EAAkBoP,EAAoBnP,GAAmBmP,QAAqBnzD,EAEpF,IACE,MAAM,IAAEsjD,EAAG,kBAAEJ,SAA4BR,GAAa/jD,EAAQqI,EAAQ+V,GAAAA,KAAKksB,WAAW5wB,IAItF,OAFK82C,GAAar8C,EAAS4zB,EAAa4c,EAAK3tB,EAAOouB,GAE7C,CAAET,MAAKJ,oBAChB,CAAE,MAAOrjD,GAEP,MADAkkD,SAAAA,EAAiBv6C,UACX3J,CACR,CACF,CAEOpB,eAAe20D,GAAmBzgD,EAAmB68C,GAC1D,MAAM,QAAE18C,GAAYJ,EAAeC,IAC3BO,QAASwzB,EAAW,UAAE4U,EAAS,QAAExpB,SAAkB9K,GAAqBrU,GAC1EhU,EAAS6b,GAAa1H,GACtB9L,EAASw0C,GAAYF,EAAYxpB,GAEjCuhC,EAAWluD,GAAAA,GAAWqqD,EAASxwD,OACrC,IAGIs0D,EAHAz+C,EAAQ,EACRoxC,EAAU,EAId,MAAMsN,EAAgC,GACtC,IAAIxP,EAEJ,KAAOlvC,EAAQ26C,EAASxwD,QAAUinD,EAAUoN,GAAU,CACpD,MAAM,OAAEh7C,EAAM,MAAEsd,GAAU65B,EAAS36C,GACnC,MACKkvC,yBAA0BF,GAA6B/wC,EAAS4zB,IAEnE,MAAM,IAAE4c,EAAG,kBAAEJ,SAA4BR,GAAa/jD,EAAQqI,EAAQ+V,GAAAA,KAAKksB,WAAW5wB,IACtFk7C,EAAoB1lD,KAAKq1C,GAEX,IAAVruC,IACFy+C,EAAWhQ,GAGR6L,GAAar8C,EAAS4zB,EAAa4c,EAAK3tB,EAAOouB,GAEpDlvC,GACF,CAAE,MAAOhV,GAAK,IAAA2zD,EACG,QAAfA,EAAAzP,SAAe,IAAAyP,GAAfA,EAAiBhqD,WACjB7G,EAAAA,EAAAA,IAAc,qBAAsB9C,EACtC,CACAomD,GACF,CAEA,MAAO,CAAEwN,cAAe5+C,EAAOy+C,WAAUC,sBAC3C,CAEO90D,eAAei1D,GACpB/gD,EAAmBumB,EAA0BwN,EAAqB7d,GAElE,MAAMw1B,QAAgBK,GAAa/rC,EAAWkW,GAC9C,IAAKw1B,EACH,OAGF,MAAM,UAAEG,EAAS,UAAElD,GAAc+C,EAIjC,OAAO4D,GAFQvgD,GAAOC,KAAKu3B,EAAkB,UAERoiB,EAAWkD,EAAW9X,EAC7D,CAKO,SAASitB,GACdhhD,EAAmB0I,GAEnB,OAAOizC,GAAU,CACf37C,YACA0I,eAEAgzC,qBAAqB,GAEzB,CAKA5vD,eAAe6vD,GAASsF,GAakB,IAbjB,UACvBjhD,EAAS,aACT0I,EAAY,oBACZgzC,EAAmB,eACnBT,EAAc,aACdW,GAQDqF,EACC,MAAM,QAAE9gD,GAAYJ,EAAeC,GACnC,GAAgB,YAAZG,EAAuB,OAAO65C,GAElC,MAAMkH,QAAwB7sC,GAAqBrU,GAC7C3L,QAAey2C,GAAa9qC,EAAWkhD,GAEvChgC,EAAQU,GAAkBlZ,GAChC,IAAKwY,EAAMigC,mBAAqBjgC,EAAMkgC,eAAgB,OAAOpH,GAE7D,MAAM,QAAEz5C,EAAO,QAAE4e,GAAY+hC,EAC7BjG,UAAyBxR,GAAiBtpC,EAAS9L,GACnD,MAAMq/B,EA8CR,SAA6BxS,GAC3B,MAAMmgC,GAAWngC,EAAMigC,kBAAoBjgC,EAAMkgC,eACjD,IAAI,OAAE36B,EAAQgwB,WAAYxC,GAAYyC,GAA4Bx1B,GAAO,GAazE,OARKmgC,IACH56B,GAAU,GACVwtB,GAAW,IAGbxtB,GAAU66B,EAAAA,IACVrN,GAAWqN,EAAAA,IAEJ,CAAE76B,SAAQwtB,UAASoN,UAC5B,CA9DcE,CAAoBrgC,GAC1BsgC,EAAgB9tB,EAAIjN,OAASw0B,EAEnC,GAAIA,GAAkBnB,IAAiC0H,GAAiB,GAAI,OAAOxH,GAEnF,MAAMyH,QAv0BR,SACElhD,EACAmI,EACA8tC,EACAkL,EACAL,GAEA,OAAOjmC,GAKJ,mBAAoB,CACrB7a,UAASmI,eAAc8tC,gBAAekL,OAAML,WAEhD,CAwzB0BM,CACtBphD,EACAmI,EACAhK,EAAU8iD,GACE,OAAZriC,EACAuU,EAAI2tB,SAEA9T,EAAuC,CAC3CrvB,OAAQujC,EAAUvjC,OAClBuI,YAA6Bp5B,IAArBo0D,EAAUh7B,YACdp5B,EACAiR,EAAYmjD,EAAUh7B,OAA6B,cAArBg7B,EAAUvjC,OAAyB,EAAIgD,EAAM3iB,UAC/E07C,aAAcuH,EACdtH,aAAce,EACdhH,QAASvgB,EAAIugB,SAGTlpC,EAAcuiC,GAAqBC,GACzC,GAAoB,KAAhBxiC,EACF,OAAOwiC,EAGTqO,UAAuBjF,GAA4Bx2C,EAASI,EAASmI,GACrE,MAAMk5C,EAAehG,GAAgB7wC,EAC/B82C,EAA+Bl+C,QACnC89C,EAAUK,kBACPrqD,KAAK6X,MAAQ,IAAI7X,KAAKgqD,EAAUK,kBAAkBvK,UAAYwC,GAA6Bxe,IAKhG,OAD0BmgB,GAAuBkG,GAAiBC,EACzCtU,EAASyM,EACpC,CA2BA,SAASuB,GAAgCwG,GAavC,MAPI,uBALJA,EAAa,IACRA,EACH9pB,WAAYx4B,EAAuBsiD,EAAW9pB,WAAYtlC,GAAAA,QAI1DovD,EAAW5P,mBAAqB4P,EAAW5P,mBAAmBlxC,KAAKyzC,IAAW,IACzEA,EACHzc,WAAYx4B,EAAuBi1C,EAAYzc,WAAYtlC,GAAAA,SAIxDovD,CACT,CAEA,SAAShD,GAAsBiD,GAEX,IADlB,QAAExxC,EAAO,gBAAE4lC,GAAyE4L,EAEpF,QAAgB30D,IAAZmjB,EAAJ,CAIA,GAAIA,aAAmBpG,GAAAA,KACrB,OAAOoG,EAGT,GAAuB,iBAAZA,EACT,OAAI4lC,EACKhsC,GAAAA,KAAKksB,WAAW9lB,GAIlBjE,GAAqBP,GAAewE,IAG7C,GAAIA,aAAmBvR,WACrB,OAAOuR,EAAQnkB,OAASkgB,GAAqBiE,QAAWnjB,EAG1D,MAAM,IAAIsQ,UAAU,kCAAkC6S,EAnBtD,CAoBF,wBCrpCO1kB,eAAem2D,GAAejiD,EAAmBgB,EAAiBgvB,GACvE,MAAM,QAAE7vB,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GACzC0nB,QAA+ClL,KAE/C0lC,QnCSDp2D,eAAgCqU,EAAqBI,EAAiB4Z,GAK3E,MAAM,WAAEzX,EAAU,OAAE1B,EAAM,MAAEgvB,GAAU7V,GAAW,CAAC,EAElD,aAAcuJ,GAAOvjB,GAASgkB,SAASg+B,mBACrC5hD,EACA,CACES,OAAQA,GAAU,EAClBgvB,MAAOA,GAASzM,GAChB6+B,oBAAoB,EACpB1/C,gBAEDgiB,SACL,CmCzBwB29B,CAAiBliD,EAASI,EAAS,CAAES,SAAQgvB,UACnE,OAAOvsB,EAAQy+C,EAAQjhD,KAAK0mB,GAAWC,GAAiBznB,EAASwnB,EAAQD,KAC3E,CAEO57B,eAAew2D,GAAkBtiD,EAAmB6nB,GACzD,MAAM,QAAE1nB,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GACzC2nB,QnCoBD,SAA2BxnB,EAAqB0nB,GACrD,OAAOnE,GAAOvjB,GAAS2d,IAAIykC,oBAAoB16B,EACjD,CmCtBuB26B,CAAkBriD,EAAS0nB,GAG1C/J,EAAM8J,GAAiBznB,EAASwnB,QAFenL,MAIrD,OAAOjc,KAAYud,aAAG,EAAHA,EAAKgP,aAC1B,CAEOhhC,eAAe22D,GAAcziD,EAAmB0iD,GAAiB,IAAAC,EACtE,MAAM,QAAExiD,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GACzC0nB,QAA+ClL,KAE/ComC,QnCWD92D,eAAkCqU,EAAqBI,EAAiBmiD,GAC7E,aAAch/B,GAAOvjB,GAASgkB,SAAS0+B,iBAAiBtiD,EAAS,CAC/DyvB,MAAgBxM,GAChBs/B,WAAYJ,KACVE,MACN,CmChBuBG,CAAmB5iD,EAASI,EAASmiD,GAC1DA,GAAmB,QAATC,EAAAC,EAAO,UAAE,IAAAD,OAAA,EAATA,EAAWtlC,YAAaqlC,EAClCE,EAAOl0D,UACP,MAAMg3C,EAA0B,GAEhC,IAAK,MAAM1F,KAAS4iB,EAClB,IAAK,MAAM1xB,KAAU8O,EAAMlP,QAAS,CAClC,IAAI9S,EACA6J,EACAF,EACJ,MAAM2N,IAAepE,EAAO8xB,YAE5B,GAAI9xB,EAAO+xB,gBAAiB,CAC1B,MAAM,OAAEpvB,EAAM,UAAEqvB,EAAWplC,IAAKiX,GAAkB7D,EAAO+xB,gBACzD,IAAKpvB,IAAWqvB,EAAW,SAC3BllC,EAAKklC,EAAU3iD,QACfsnB,EAAa/e,GAAgBisB,GAAe,EAAM50B,EACpD,KAAO,KAAI+wB,EAAO8xB,YAShB,SAT6B,CAC7B,MAAM,MAAEG,GAAUjyB,EAAO8xB,YAGzB,GAFAhlC,EAAKmlC,EAAM5iD,QACXonB,EAASuJ,EAAO8xB,YAAYllC,KACvB6J,EACH,SAEFE,EAAa/e,GAAgB6e,EAAOpnB,SAAS,EAAMJ,EACrD,CAEA,CAEA,GAAI3U,GAAAA,QAAQC,MAAMuyB,GAAIolC,OAAO53D,GAAAA,QAAQC,MAAM8U,KAKzC,GAJKonB,KACFA,SAAgBpD,GAAcpkB,EAAS,CAAC0nB,KAGvCF,EAAQ,CACV,MAAM7J,EAAM8J,GAAiBznB,EAASwnB,EAAQD,GAE1C5J,GACF4nB,EAAQxqC,KAAK,CACXrO,KAAM,cACNmT,YACA6nB,aACA/J,OAGN,OACUwX,SAAoBmT,GAAsBtoC,EAAS6d,GAC7D0nB,EAAQxqC,KAAK,CACXrO,KAAM,kBACNmT,YACA6nB,eAGF6d,EAAQxqC,KAAK,CACXrO,KAAM,UACNmT,YACA6nB,aACAsO,gBAAiBnY,GAGvB,CAGF,MAAO,CAAC0kC,EAAShd,EACnB,CAEO55C,eAAeu3D,GAAsBlpC,GAM1C,MAAM,UAAEna,EAAS,KAAEqf,EAAI,QAAEpT,GAAYkO,EACrC,IAAI,UAAEnP,GAAcmP,EAEpB,MAAM,QAAEha,GAAYJ,EAAeC,IAC3BO,QAASwzB,SAAsB1f,GAAqBrU,GAEtDgD,QAA+Cw3C,GAAer6C,EAAS6K,GAC7E,GAAI,UAAWhI,EACb,OAAOA,EAGTgI,EAAYhI,EAAO6kC,gBAEnB,MAAMgV,EAAWx9B,EACdz0B,MAAM,EAAG04D,EAAAA,KACTriD,KAAK6c,GAAQylC,GAAwBzlC,EAAKiW,EAAa/oB,EAAWiB,KAE/Du3C,QAAoBlF,GAA2Bt+C,EAAW68C,GAEhE,GAAI2G,EAAY3O,UAAW,CAEzB,MAAM4O,EAAWD,EAAY3O,UAAU5c,WACvCj1B,EAAO0wB,IAAMgwB,GAAwBrkC,EAAKhzB,OAAQwwD,EAASxwD,OAAQo3D,EAAU5yD,GAAAA,IAC7EmS,EAAOixC,QAAUyP,GAAwBrkC,EAAKhzB,OAAQwwD,EAASxwD,OAAQo3D,EAAU3yD,GAAAA,GACnF,CAMA,MAJI,UAAW0yD,IACbxgD,EAAOlT,MAAQ0zD,EAAY1zD,OAGtBkT,CACT,CAEOlX,eAAe63D,GAAmBxpC,GAOvC,MAAM,UACJna,EAAS,SAAEkW,EAAQ,KAAEmJ,EAAI,UAAErU,EAAS,QAAEiB,GACpCkO,GACI5Z,QAASwzB,SAAsB1f,GAAqBrU,GAE5D,OAAO+8C,GAAoB,CAAE/8C,YAAWkW,WAAU2mC,SADjCx9B,EAAKpe,KAAK6c,GAAQylC,GAAwBzlC,EAAKiW,EAAa/oB,EAAWiB,MAE1F,CAEA,SAASs3C,GAAwBzlC,EAAaiW,EAAqB/oB,EAAmBiB,GAOpF,MAAO,CACLuE,QAPoBsN,EAAIuL,oBAAsBu6B,EAAAA,KAC1C54C,IAAcipB,EAAAA,MAAgB4vB,EAAAA,IAAmB55D,SAAS+gB,GAG5D84C,GAAwB/vB,EAAa/oB,EAAWiB,GAStD,SAAqC8nB,EAAqBlM,EAAoBk8B,GAC5E,MAAMC,EAAax4D,GAAAA,QAAQC,MAAMo8B,GAAYlzB,KAAKsvD,aAAe,EAQjE,OAAOH,GAAwB/vB,EAPb8vB,EAAAA,IAAmBG,IAErB,IAAIz3D,GAAAA,SACjB+e,UAAU,WAAY,IACtBA,UAAUy4C,EAAU,IACpBh4C,UAE6Dm4C,EAAAA,IAClE,CApBMC,CAA4BpwB,EAAajW,EAAIvd,QAASud,EAAI5b,OAK5DukB,OAAQ51B,GAAAA,GACRma,UAAW8S,EAAIvd,QAEnB,CAcA,SAASujD,GACP/vB,EACA/oB,EACAwF,GAEA,IASIpF,EAVJF,EAAa5T,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGvG,GAAAA,GAEZsa,GAAU,IAAI9e,GAAAA,SACf+e,UAAU/X,GAAAA,GAAU8zB,kBAAmB,IACvC/b,UAAUzE,KAAmB,IAC7B4E,aAAajgB,GAAAA,QAAQC,MAAMuf,IAC3BS,aAAajgB,GAAAA,QAAQC,MAAMsoC,IAC3BloB,UAAS,GACTL,WAAWN,GAqBd,OAjBIsF,IAIApF,EAHqB,iBAAZoF,EAGQ7E,GAFHK,GAAewE,GACX9T,KAAK8hB,OAAOnT,EAAQO,cAAgB5a,GAAAA,IAA2B,IAGhEwf,GAIjBpF,aAA0BnM,YAC5BoM,EAAQQ,SAAS,GACjBR,EAAUA,EAAQ7e,YAAYuC,GAAOC,KAAKoc,KAE1CC,EAAUA,EAAQK,cAAcN,GAG3BC,EAAQU,SACjB,CAEO,SAAS23C,GACdU,EAEAC,EAEAC,EAEAC,GAGA,IAAIC,EAAqBJ,EAAgBC,EAmBzC,OARIG,EAAqB,GAAKA,EAAqBH,IACjDG,GAAsB,GAGG/kD,EACzB6kD,GAjBqB5nD,KAAK8hB,MAAM4lC,EAAgBC,GAkB9BA,EAAqBG,GAAsBH,GAEnC7lD,OAAO4lD,GAAiBG,CACtD,CClQO,SAASE,GACdj0C,GAEA,MAAyB,qBAAlBA,aAAO,EAAPA,EAAS3jB,OAAgD,kCAAlB2jB,aAAO,EAAPA,EAAS3jB,KACzD,CAGO,SAAS63D,GAA4BjwC,GAC1C,MAAM,KAAE5nB,EAAM0nB,KAAK,QAAE4K,IAAc1K,EAEnC,MAAa,WAAT5nB,EACKsG,GAAAA,GACc,OAAZgsB,EACF/rB,GAAAA,GAEAF,GAAAA,EAEX,CChBOpH,eAAe64D,GAAqB3kD,EAAmB4kD,GAC5D,MACMC,EAAcH,SADEpwC,GAAsBtU,IAEtC8kD,EAAmBpoD,KAAKgQ,KAAKk4C,EAAav4D,OAASw4D,GAEnDhI,EAAW+H,EACdh6D,MAAM,EAAGi6D,GACT5jD,IAAI8jD,IAED/hD,QAAes7C,GAA2Bt+C,EAAW68C,GAE3D,MAAI,UAAW75C,EACNA,EAMF,CAAEixC,QAHWhjD,GAAAA,GAAQc,UAAYyM,OAAOomD,EAAav4D,QAC9B2W,EAAO6xC,UAAU5c,WAAaz5B,OAAOsmD,GAGrE,CAEOh5D,eAAgBk5D,GAAiBhlD,EAAmBkW,EAAkB0uC,GAC3E,MAEMK,EAAa12D,GAAMq2D,EADLF,SADEpwC,GAAsBtU,KAI5C,IAAK,MAAMklD,KAAYD,EAAY,CACjC,MAAMpI,EAAgCqI,EAASjkD,IAAI8jD,SAE7C,CACJ3iC,UAAW8iC,EACXliD,aAAc+5C,GAAoB,CAAE/8C,YAAWkW,WAAU2mC,aAE7D,CACF,CAEO/wD,eAAeq5D,GAA0BnlD,EAAmB6nB,EAAoBtnB,GACrF,MAAMyC,QAAes7C,GAA2Bt+C,EAAW,CAAColD,GAAkBv9B,EAAYtnB,KAE1F,MAAI,UAAWyC,EACNA,EAGF,CAAEixC,QAASjxC,EAAO6xC,UAAU5c,WAAahnC,GAAAA,GAAQc,UAC1D,CAEO,SAASszD,GAAsBrlD,EAAmBkW,EAAkB2R,EAAoBtnB,GAC7F,OAAOw8C,GAAoB,CACzB/8C,YACAkW,WACA2mC,SAAU,CAACuI,GAAkBv9B,EAAYtnB,KAE7C,CAEA,SAASwkD,GAAiBl9B,GACxB,MAAO,CACL7c,UAAW6c,EACXrX,QAAS4Y,GAAAA,EAAQk8B,qBACjB7+B,OAAQx1B,GAAAA,GAAQc,UAEpB,CAEA,SAASqzD,GAAkBv9B,EAAoB09B,GAC7C,MAAO,CACLv6C,UAAW6c,EACXrX,QAAS4Y,GAAAA,EAAQo8B,4BAA4BD,GAC7C9+B,OAAQx1B,GAAAA,GAAQc,UAEpB,CCpEA7H,KAAKu7D,YAAc,CAAC,kBCKb,MAAMC,GACXjvD,WAAAA,CAAqB8J,EAA2B0P,GAAmC,KAA9D1P,QAAAA,EAAgB,KAAW0P,KAAAA,CAAoC,CAEpF,wBAAOjG,CAAkBzJ,GACvB,OAAO,IAAImlD,GAAcnlD,EAC3B,CAEA,uBAAOolD,CAAiBC,EAA6B3lB,GAA2B,IAAf+I,EAAS1xC,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,EAC3E,MACM2Y,EAAO,CAAEgwB,OAAM39B,MAZhB0L,EAAAA,GAAAA,aAAYjC,WAajB,OAAO,IAAI25C,IAAcG,EAAAA,GAAAA,iBAAgB7c,EAAW/4B,GAAOA,EAC7D,CAEA,uBAAM61C,CAAkBhvB,GAKtB,aAJkBA,EAAS5lB,IAAI,kBAAmB,KACzBvkB,MAAOo5D,YACQ3yC,MAEtBnS,KAAKmS,IACrB,MAAM4yC,EAAa5yC,EAAMnS,KAAKnU,IAAK,CAAQD,KAAM,MAAgBC,YAC3Dm5D,EAAQ,IAAIC,GAAAA,YAAYF,GAExBrxD,EAAOsxD,EAAMx8C,gBAAgBpe,SAAS,IAAIE,SAAS,GAAI,KAM7D,MAAO,CACLgV,QANc/U,GAAAA,QAAQC,MAAM,KAAKkJ,KAOjC8xB,OANaw/B,EAAMx8C,gBAOnB08C,qBAN2BF,EAAMx8C,gBAOjC28C,kBANwBziD,QAAQsiD,EAAMj5D,cAOvC,GAEL,ECjDF,IAAIq5D,GACJ,MAAMC,GAA6B,IAAI9vD,GAAAA,EAEjC+vD,GAA6C,CAAC,EAEpD,IAAIC,GACJ,MAAMC,GAAiB,IAAIjwD,GAAAA,EAEpB,SAASkwD,GAAgB1mD,EAAmBO,GACjD,OAAOgmD,GAAa,GAAGvmD,KAAaO,MAAc,CAAC,CACrD,CAEO,SAASomD,GAAmB3mD,EAAmBO,EAAiByU,GACrE,MAAM5V,EAAM,GAAGY,KAAaO,IAC5BgmD,GAAannD,GAAO,IAAKmnD,GAAannD,MAAS4V,EACjD,CAOOlpB,eAAe86D,KAEpB,aADMN,GAA2B3vD,QAC1B0vD,EACT,CAQOv6D,eAAe+6D,KAEpB,aADMJ,GAAe9vD,QACd6vD,EACT,wBCvCA,IAAIM,GAEGh7D,eAAei7D,KAGpB,GAFAD,SAAiBvyD,GAAQ0d,QAAQ,aAE5B60C,GAAU,CACbA,GAAW/3D,GAAOC,KAAK6P,EAAY,KAAKxT,SAAS,OAEjD,MAAM27D,QAAiBzyD,GAAQ0d,QAAQ,YACnC+0C,IAAUF,GAAW,GAAGA,MAAYE,WAElCzyD,GAAQ6d,QAAQ,WAAY00C,GACpC,CACA,OAAOA,EACT,CC0COh7D,eAAem7D,GAAgBjnD,EAAmBymB,EAAgB/D,GACvE,IAAI1f,EAEJ,OAAQ0f,EAAM71B,MACZ,IAAK,aACH,GAAI45B,EAASx1B,GAAAA,GAAQC,gBACnB,MAAO,CAAEpB,MAAO2qD,EAAAA,GAAyBK,eAG3C93C,QAAem3C,GAAsB,CACnCn6C,YACAgL,UAAW0X,EAAM5Y,KACjB2c,OAAQA,EAASx1B,GAAAA,GAAQC,gBACzBoR,KAAMhQ,GAAAA,KAEJ,QAAS0Q,GAAUA,EAAO0wB,MAC5B1wB,EAAO0wB,IAAMziC,GAAAA,GAAQC,gBAAkB8R,EAAO0wB,KAEhD,MAEF,IAAK,SACH1wB,QAAem3C,GAAsB,CACnCn6C,YACAgL,UAAW6rB,EAAAA,IACXpQ,OAAQA,EAASx1B,GAAAA,GAAQG,YACzBkR,KAAM8K,OAEJ,QAASpK,GAAUA,EAAO0wB,MAC5B1wB,EAAO0wB,IAAMziC,GAAAA,GAAQG,YAAc4R,EAAO0wB,KAE5C,MAEF,IAAK,SAAU,CACb,MAAM,UAAE0f,EAAS,KAAEtpC,EAAI,OAAEF,GAAW8Y,GAC9B,aAAEha,GAAiBiZ,GAAeyxB,GAExCpwC,QAAem3C,GAAsB,CACnCn6C,YACAgL,UAAWlB,EACXpB,eACA+d,SACAnkB,KAAMyH,GAAAA,GAAYm9C,aAAat9C,GAC/BsB,cAAeja,GAAAA,GAAQK,sBAEzB,KACF,CACA,IAAK,SACH0R,QAAem3C,GAAsB,CACnCn6C,YACAgL,UAAWopB,EAAAA,IACX1rB,aAAcyrB,EAAAA,IAASzrB,aACvB+d,SACAvb,cAAeja,GAAAA,GAAQgB,qBAM7B,OAAO+Q,CACT,CAEOlX,eAAeq7D,GAAkBnnD,EAAmBymB,EAAgB/D,GACzE,MAAM,QAAEviB,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GACzConD,QAAmBR,KAEzB,IAAI5jD,EACA+H,EAEJ,OAAQ2X,EAAM71B,MACZ,IAAK,aACHmW,QAAem3C,GAAsB,CACnCn6C,YACAgL,UAAW0X,EAAM5Y,KACjB2c,OAAQx1B,GAAAA,GAAQE,kBAChBmR,KAAM/P,GAAAA,KAER,MAEF,IAAK,SAAU,CACb,GAAIk0B,EAAS/D,EAAMI,QACjB,MAAO,CAAEhzB,MAAO2qD,EAAAA,GAAyBoB,qBAEzC9wC,EADS0b,IAAW/D,EAAMI,QACZJ,EAAMk5B,aAENr8C,EAAqBknB,EAAQ2gC,EAAWC,OAAOC,aAG/D,MAAMz8C,QAAe08C,GAA2BpnD,EAASI,EAASwK,GAElE/H,QAAem3C,GAAsB,CACnCn6C,YACAgL,UAAWH,EAAOG,UAClByb,OAAQ5b,EAAO4b,OACfnkB,KAAMuI,EAAO2F,UAEf,KACF,CACA,IAAK,SACHzF,EAAc0b,EAEdzjB,QAAem3C,GAAsB,CACnCn6C,YACAgL,UAAW0X,EAAM8kC,mBACjB/gC,OAAQx1B,GAAAA,GAAQS,eAChB4Q,KAAMuL,GAA0B4Y,GAAQ,KAE1C,MAEF,IAAK,SACH,GAAIA,EAAS/D,EAAMI,QACjB,MAAO,CAAEhzB,MAAO2qD,EAAAA,GAAyBoB,qBAEzC9wC,EADS0b,IAAW/D,EAAMI,QACZJ,EAAMk5B,aAGNr8C,EAAqBknB,EADV,YAAZtmB,EAAwB,EAAIinD,EAAWK,OAAOC,MAI7D1kD,QAAem3C,GAAsB,CACnCn6C,YACAgL,UAAWwpB,EAAAA,IAAW9rB,aACtB+d,OAAQ1b,EACRrC,aAAc8rB,EAAAA,IAAW9rB,aACzBwC,cAAeja,GAAAA,GAAQkB,uBAM7B,MAAO,IACF6Q,EACHnW,KAAM61B,EAAM71B,KACZke,cAEJ,CAEOjf,eAAe67D,GACpB3nD,EACAkW,EACAuQ,EACA/D,GAEA,IAAI1f,EAEJ,MAAM,QAAE7C,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GAE/C,OAAQ0iB,EAAM71B,MACZ,IAAK,aACHmW,QAAeq5C,GAAe,CAC5Br8C,YACAkW,WACAlL,UAAWlC,GAAgB4Z,EAAM5Y,MAAM,EAAM3J,GAC7CsmB,OAAQA,EAASx1B,GAAAA,GAAQC,gBACzBoR,KAAMhQ,GAAAA,KAER,MAEF,IAAK,SACH0Q,QAAeq5C,GAAe,CAC5Br8C,YACAkW,WACAlL,UAAW6rB,EAAAA,IACXpQ,OAAQA,EAASx1B,GAAAA,GAAQG,YACzBkR,KAAM8K,OAER,MAEF,IAAK,SAAU,CACb,MAAM,UAAEgmC,EAAS,KAAEtpC,EAAI,OAAEF,GAAW8Y,GAC9B,aAAEha,GAAiBiZ,GAAeyxB,GAExCpwC,QAAeq5C,GAAe,CAC5Br8C,YACAkW,WACAlL,UAAWlB,EACXpB,eACA+d,SACAnkB,KAAMyH,GAAAA,GAAYm9C,aAAat9C,GAC/BsB,cAAeja,GAAAA,GAAQK,sBAEnB,UAAW0R,IACfA,EAAOgI,UAAYlB,GAErB,KACF,CACA,IAAK,SACH9G,QAAeq5C,GAAe,CAC5Br8C,YACAkW,WACAlL,UAAWopB,EAAAA,IACX1rB,aAAcyrB,EAAAA,IAASzrB,aACvB+d,SACAvb,cAAeja,GAAAA,GAAQgB,qBAU7B,MAJM,UAAW+Q,GACf2jD,GAAmB3mD,EAAWO,EAAS,CAAEqnD,SAAUnwD,KAAK6X,QAGnDtM,CACT,CAEOlX,eAAe+7D,GACpB7nD,EACAkW,EACAuQ,EACA/D,GAEA,MAAM,QAAEviB,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GAE/C,IAAIgD,EAEJ,OAAQ0f,EAAM71B,MACZ,IAAK,aACHmW,QAAeq5C,GAAe,CAC5Br8C,YACAkW,WACAlL,UAAWlC,GAAgB4Z,EAAM5Y,MAAM,EAAM3J,GAC7CsmB,OAAQx1B,GAAAA,GAAQE,kBAChBmR,KAAM/P,GAAAA,KAER,MAEF,IAAK,SAAU,CACb,MAAMu1D,EAAQplC,EAAMqlC,iBAEhB9vD,EAAAA,GAAqB+vD,QADrB/vD,EAAAA,GAAqBgwD,SAGnBp9C,QAAe08C,GAA2BpnD,EAASI,EAASkmB,EAAQqhC,GAE1E9kD,QAAeq5C,GAAe,CAC5Br8C,YACAkW,WACAlL,UAAWH,EAAOG,UAClByb,OAAQ5b,EAAO4b,OACfnkB,KAAMuI,EAAO2F,UAEf,KACF,CACA,IAAK,SACHxN,QAAeq5C,GAAe,CAC5Br8C,YACAkW,WACAlL,UAAW0X,EAAM8kC,mBACjB/gC,OAAQx1B,GAAAA,GAAQS,eAChB4Q,KAAMuL,GAA0B4Y,GAAQ,KAE1C,MAEF,IAAK,SACHzjB,QAAeq5C,GAAe,CAC5Br8C,YACAkW,WACAlL,UAAWwpB,EAAAA,IAAW9rB,aACtB+d,SACA/d,aAAc8rB,EAAAA,IAAW9rB,aACzBwC,cAAeja,GAAAA,GAAQkB,uBAEnB,UAAW6Q,IACfA,EAAOklD,oBAAsB,CAC3BnqC,KAAMyW,EAAAA,IAAWzW,KACjB0I,OAAQ,GACRzb,UAAWwpB,EAAAA,IAAW9rB,eAM9B,OAAO1F,CACT,CAEOlX,eAAey7D,GACpBpnD,EACAI,EACAkmB,GAE4B,IAD5BqhC,EAA0BxwD,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGW,EAAAA,GAAqB+vD,QAElD,MAAM/+C,QAA2BT,GAA0BrI,EAASI,EAAS6nB,EAAAA,KAEvE5X,EpEzED,SAAwC2J,GAO7C,MAAM,QACJrP,EAAO,OAAE2b,EAAM,gBAAExb,EAAe,iBAAEk9C,EAAgB,WAAEC,GAClDjuC,EAEEhP,EAYD,SAAiDg9C,EAA4BC,GAClF,OAAO,IAAI77D,GAAAA,SACR+e,UAAUhO,OAAO6qD,GAAmB,GACpC78C,UAAUhO,OAAO8qD,GAAa,GAC9B37D,QACL,CAjBwB47D,CAAwCF,EAAkBC,GAEhF,OAAO,IAAI77D,GAAAA,SACR+e,UAAUhY,GAAAA,GAAa20B,KAAM,IAC7B3c,UAAUR,GAAW,EAAG,IACxBU,WAAWib,GACXhb,aAAajgB,GAAAA,QAAQC,MAAMwf,IAC3BY,SAAS,GACTC,SAASX,GACT1e,QACL,CoEoDkB67D,CAA+B,CAC7C7hC,SACAxb,gBAAiB1K,EACjB6nD,WAAYN,IAAS7vD,EAAAA,GAAqBswD,QAC1CJ,iBAAkBL,IAAS7vD,EAAAA,GAAqBgwD,WAGlD,MAAO,CACLxhC,OAAQx1B,GAAAA,GAAQI,cAChB2Z,UAAW/B,EACXuH,UAEJ,CAYO1kB,eAAe08D,GACpBxoD,EACAonD,EACAqB,EACAnkC,GAEA,MAAM,QAAEnkB,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,IAEzC,YACJ0oD,EAAW,oBACXC,EACA97D,KAAM+7D,GACJH,EAEEtuC,EAA+B,CACnCna,YACAyoD,eACArB,aACA7mD,UACAmoD,cACAvoD,UACAmkB,YAGIukC,EAAuC,GAE7C,IAAK,MAAMC,KAAc1B,EAAW2B,YACrBlnC,GAAe,MAAOinC,EAAW5nC,SAClCoD,GACVukC,EAAS3tD,KAAK8tD,GAAiB7uC,EAAS2uC,IAY5C,OARIH,GAAuC,eAAhBC,IACzBC,EAAS3tD,KAsDbpP,eAAmCy+C,GAKe,IAAA0e,EAAAC,EAAA,IALd,QAClC/oD,EAAO,QACPI,EAAO,aACPkoD,EAAY,WACZrB,GACoB7c,EACpB,MAAMznB,EAAU2lC,EAAa3lC,SACrBviB,QAASuJ,EAAI,IAAEq/C,GAAQV,EAAaW,eAEtCC,EAAsB5xD,KAAK6X,MAAQ83C,EAAWkC,UAAUC,OACxDzlD,EAAQulD,EAAsBjC,EAAWzuD,MAAMmL,MAAQsjD,EAAWkC,UAAUxlD,MAC5EC,EAAMslD,EAAsBjC,EAAWzuD,MAAM4wD,OAASnC,EAAWkC,UAAUC,OAEjF,IAAIC,EAEJ,GAA0B,eAAtBf,EAAa57D,KAAuB,CACtC,MAAMyI,EAAgBuS,GAAa1H,GAASyI,KAAK,IAAI88C,GAAcl6D,GAAAA,QAAQC,MAAMqe,KAC3E2/C,QAAmBn0D,EAAcwwD,oBACjC4D,EAAgBl+D,GAAAA,QAAQC,MAAM8U,GACpCipD,EAAmBC,EAAW1pC,MAAM70B,GAAMA,EAAEqV,QAAQ6iD,OAAOsG,IAC7D,CAEA,MAAO,CACL78D,KAAM,aACNqT,GAAI,aACJkzC,UAAW30C,EAAAA,IAAQsf,KACnB+E,QAAS0mC,EAAmB1mC,EAAU,GACtC6mC,YAAaR,EACbS,UAAW,MACX9/C,OACAhG,QACAC,MACAoiD,sBAAsC,QAAhB8C,EAAAO,SAAgB,IAAAP,OAAA,EAAhBA,EAAkB9C,uBAAwB,GAChE0D,qBAAsC,QAAhBX,EAAAM,SAAgB,IAAAN,GAAhBA,EAAkB9C,kBAAoBtjC,EAAU,GAE1E,CAzFkBgnC,CAAqB3vC,MAGjCga,EAAAA,IAASpW,QAAQuG,IAAc8iC,EAAWK,OAAOsC,aAAcx/B,EAAAA,KACjEs+B,EAAS3tD,KAgKbpP,eAAgCquB,GAC9B,MAAM,QACJha,EAAO,SAAEmkB,EAAU/jB,QAAS0J,EAAa,WACzCm9C,EAAYA,YAAcK,QAAQ,IAAE0B,EAAG,YAAEa,IACzCvB,cAAgBhB,QAAQ,WAAEwC,KACxB9vC,EAEEutC,EAAmB,YAAZvnD,EAAwB,EAAIinD,EAAWK,OAAOC,KAErD79C,EAAYhC,GAAa1H,GACzB+pD,QAA4B1hD,GAA0BrI,EAAS8J,EAAeuqB,EAAAA,IAAW9rB,cACzFyhD,EAAetgD,EAAUjB,KAAKwhD,GAAAA,EAAapgD,kBAAkBxe,GAAAA,QAAQC,MAAMy+D,MAC3E,cAAEG,EAAa,WAAEC,SAAqBH,EAAaI,kBAEnD3O,EAAet3B,EAASkQ,EAAAA,IAAWzW,OAAS,GAC5C+E,EAAUrjB,EAAuBm8C,EAAc8L,GAC/CmC,EAAuBpqD,EAAuB4qD,EAAe3C,GAE7DhlC,EAA+B,CACnCxiB,GAAI,SACJrT,KAAM,SACNumD,UAAWjf,EAAAA,IAASpW,KACpB6rC,UAAW,MACXD,YAAaM,EAAaD,EAAcb,EACxCqB,oBAAqBrB,EACrBsB,oBAAqBT,EACrBlnC,UACAhZ,KAAMsqB,EAAAA,IACNwnB,eACAiO,uBACAQ,gBACAC,WAAYA,GAAcD,EAA6B,IAAbC,OAAoBj9D,EAC9D68D,uBAQF,YAJmB78D,IAAf48D,GCviBC,SAAiCvnC,GACtC,OAAO/e,QACL+e,EAAMI,SACHJ,EAAMmnC,sBACL,qBAAsBnnC,GAASA,EAAMgoC,iBAAmBC,EAAAA,IAEhE,CDiiBmCC,CAAwBloC,KACvDA,EAAMinC,YAAcK,GAGftnC,CACT,CAzMkBmoC,CAAiB1wC,IAG1B,CAAC2wC,GAAiB3wC,YAAmBvjB,QAAQipB,IAAIgpC,GAC1D,CAEA,SAASiC,GAAgB7oD,GAOgB,IAAA8oD,EAAA,IAPf,UACxB/qD,EAAS,QACTO,EAAO,aACPkoD,EAAY,WACZrB,EAAU,YACVsB,EAAW,SACXpkC,GACoBriB,EACpB,MAAM,YAAEqlD,GAAgBF,EAAWC,OAE7BzL,EAAet3B,EADHzC,GAAe,MAAOuG,EAAAA,OACI,GACtCyhC,EAAuBvrD,GAA+B,QAAnBysD,EAAAtC,EAAapB,cAAM,IAAA0D,OAAA,EAAnBA,EAAqBlB,uBAAwB,GAEhFtD,EAAeG,GAAgB1mD,EAAWO,GAC1CqnD,EAAWlrD,KAAKsuD,IAAIzE,EAAaqB,UAAY,EAAGa,EAAab,UAAY,GAGzEqD,EADmBxzD,KAAK6X,MAAQs4C,EAAWsD,EAAAA,OJja1ChhE,KAAKu7D,aAAe,CAAC,GIia+D0F,sBAChD/D,EAAWC,OAAO+D,UAAY,IACnE,MAAEtnD,EAAK,IAAEC,GAmLjB,SAAmCqjD,GACjC,MAAM,UAAEkC,EAAW3wD,MAAO0yD,GAAiBjE,EACrC93C,EAAM7X,KAAK6X,MACXg8C,EAAcC,EAAAA,IAEd5yD,EAGH2W,EAAMg6C,EAAUC,QAAUj6C,EAAMg6C,EAAUC,OAAS+B,IAAgBlE,EAAWC,OAAO3kD,YACnF4M,GAAOg6C,EAAUC,OAAS+B,EAC3BD,EAAe/B,EAEnB,MAAO,CACLxlD,MAAOnL,EAAMmL,MACbC,IAAKpL,EAAM4wD,OAAS+B,EAExB,CAnMyBE,CAA0BpE,GAEjD,IAAIqE,EAAYrE,EAAWC,OAAO8B,IAC9BT,GAAeA,KAAetB,EAAWC,OAAOqE,aAClDD,EAAYrE,EAAWC,OAAOqE,WAAWhD,IAG3C,MACM5lC,EAAUrjB,EADQm8C,EAAeiO,EACiBvC,GAExD,MAAO,CACLz6D,KAAM,SACNqT,GAAI,SACJkzC,UAAW30C,EAAAA,IAAQsf,KACnBjU,KAAM+sB,EAAAA,IACN/T,UACA6mC,YAAa8B,EACb7B,UAAW,MACXhO,eACAiO,uBACA9B,iBAAkBkD,EAClBnnD,QACAC,MAEJ,CAuCAjY,eAAek9D,GACb7uC,EACArQ,GAEA,MAAM,QAAE3J,GAAYga,GAIlBrQ,KAAMH,EACNuX,MAAOxY,EAAY,WACnBogD,GACEh/C,GAEE,SAAEvL,EAAUwf,KAAMq1B,GAAcxxB,GAAkBlZ,IAGlD,IAAEijD,EAAG,cAAEC,GAAkB/8C,GAAYi6C,IACrC,gBAAE+C,GAAoBzoD,OAAOa,OAAO2nD,GAAgB,GACpDt8C,EAAM5S,KAAK8hB,MAAM/mB,KAAK6X,MAAQ,KAEpC,IAAIw8C,EAAsB,GAC1B,IAAK,MAAM,UAAEC,EAAS,QAAEC,EAAO,kBAAEC,KAAuB7oD,OAAOa,OAAO4nD,GAChEE,EAAYz8C,GAAO08C,EAAU18C,IAC/Bw8C,GAAeG,GAInB,MAAMC,EEtgBO,SAA6BjqD,GAMzC,IAN0C,IAC3C0pD,EAAG,YAAEG,EAAW,SAAEvtD,GAKnB0D,EACC,IAAK0pD,EACH,OAAO,EAGT,MAAMO,EAAMttD,EAAMktD,EAAavtD,GAC5BvE,IAAI4E,EAAM+sD,EAAKptD,IACf1B,IAAI4+B,IACJ5+B,IAAI,KACJE,QAAQ,GAEX,OAAOO,OAAO4uD,EAChB,CFofcC,CAAqB,CAAER,MAAKG,cAAavtD,cAG/C,QAAEgC,EAAO,SAAE+jB,GAAanK,EACxBiyC,EAAetiD,EAAKuiD,QAAQ,GAC5BC,EAAkBzqC,GAAe,MAAOuqC,EAAalrC,OAErDqrC,QAAoB7iD,GAAyBvJ,EAASwJ,EAAayiD,EAAaxiD,OAAQrJ,GAE9F,IAEI4N,EAFAu8C,EAAmB,GACnB5nC,EAAU,GAGd,GAAIwpC,KAAmBhoC,EAAU,CAC/B,MAAMkoC,QAAmBD,EAAYE,iBAAiB77C,OAAM,KAAe,IAE3E,GAAI47C,EAAY,CACd,MAAME,QAA0BlkD,GAA0BrI,EAASwJ,EAAajB,GAC1EikD,EAAUziD,GAAAA,GAAY0iD,oBAAoBJ,EAAY1D,GAC5D4B,GAAoBiC,GAAWA,EAAQD,KAAuB,GAC9D5pC,EAAU0pC,EAAWK,cACrB1+C,EAAc/K,OAAOL,KAAK4pD,EAC5B,CACF,CAoBA,MAlBqC,CACnC9/D,KAAM,SACNqT,GAAIyJ,EACJG,KAAMH,EACNjB,eACA0qC,YACAuW,YAAauC,EACbtC,UAAW,MACX9mC,UACA4nC,mBACAv8C,cACAq5C,mBAAoB1+C,GAAgByjD,EAAYhsD,SAAS,GACzDwK,YAAa,GACb4gD,MACAG,cACAliD,OAAQwiD,EAAaxiD,OAIzB,CA+DO9d,eAAeghE,GAAuB9sD,GAC3C,MAAM,QAAEO,SAAkB8T,GAAqBrU,GACzC0iB,QAWD52B,eAAwCyU,GAC7C,MAAMumD,QAAiBC,KACjBgG,QAAqB3xC,GAAe,kBAAkB7a,SAAWlT,EAAW,CAChF,iBAAkBy5D,IAMpB,GAHAiG,EAAajqC,QAAUxkB,EAAYyuD,EAAajqC,SAChDiqC,EAAaC,YAAc1uD,EAAYyuD,EAAaC,cvE9mB/C,SAA4BzsD,GACjC,OAAO0sD,EAAAA,IAAc/rD,MAAMgsD,GAAa3sD,EAAQtQ,SAASi9D,IAC3D,CuE8mBOC,CAAmBJ,EAAa3D,eAAe7oD,SAClD,MAAMtV,MAAM,wDAGd,OAAO8hE,CACT,CAzBsBK,CAAyB7sD,GAC7C,MAAO,IACFmiB,EACH0mC,eAAgB,IACX1mC,EAAM0mC,eACTtlD,MAAoC,IAA7B4e,EAAM0mC,eAAetlD,MAC5BC,IAAgC,IAA3B2e,EAAM0mC,eAAerlD,KAGhC,CAkBO,SAASspD,GACdrtD,EACAkW,EACAwM,GAEA,OAAO25B,GAAe,CACpBr8C,YACAkW,WACAlL,UAAW0X,EAAM8kC,mBACjB/gC,OAAQx1B,GAAAA,GAAQW,aAChB0Q,KAAM4L,GAAwBwU,EAAMvU,cAExC,CAEOriB,eAAewhE,GACpBttD,EACAkW,EACAwM,GAEA,MAAM,QAAEniB,SAAkB8T,GAAqBrU,GAEzCgD,QAAeq5C,GAAe,CAClCr8C,YACAkW,WACAlL,UAAW0X,EAAMwnC,oBACjBzjC,OAAQx1B,GAAAA,GAAQmB,oBAChBkQ,KAAM8nD,GAAAA,EAAamD,0BAA0B,CAC3CC,aAAc9qC,EAAM2nC,cACpBrsC,GAAIxyB,GAAAA,QAAQC,MAAM+oC,EAAAA,IAAW9rB,cAC7BuC,gBAAiBzf,GAAAA,QAAQC,MAAM8U,GAC/BktD,iBAAkBx8D,GAAAA,GAAQoB,+BAe9B,MAXM,UAAW2Q,IACfA,EAAOklD,oBAAsB,CAC3Br7D,KAAM,UACN45B,OAAQ/D,EAAMmnC,qBACd96B,YAAY,EACZhR,KAAMoW,EAAAA,IAASpW,KACfgW,YAAaK,EAAAA,IACbppB,UAAWzK,IAIRyC,CACT,wBGzrBO,SAAS0qD,GAAiBl9C,GAC/B,IAAI/lB,EAAO,IAAI2f,GAAAA,KAiBf,OAhBIoG,IACEA,aAAmBpG,GAAAA,KACrB3f,EAAO+lB,EACqB,iBAAZA,EACZA,EAAQnkB,OAAS,IACnB5B,GAAO,IAAI8B,GAAAA,SACR+e,UAAU,EAAG,IACbqiD,gBAAgBn9C,GAChB/jB,UAGLhC,GAAO,IAAI8B,GAAAA,SACRC,YAAYuC,GAAOC,KAAKwhB,IACxB/jB,UAGAhC,EAAK28B,QAAQ/7B,SAAS,SAC/B,CAEOS,eAAe8hE,GAAqBztD,GACzC,IAEE,aADM0H,GAAa1H,GAAS0tD,sBACrB,CACT,CAAE,MAAO3gE,GACP,OAAO,CACT,CACF,CClBA,MAAM4gE,GAAgB,CAACC,EAAAA,IAAkBjR,EAAAA,KACnCkR,GAAkB,YAEjBliE,eAAemiE,GACpB9tD,EACAI,EACA8P,EACA69C,GAEA,MAAMz+B,EAASA,CAAC0+B,EAAoB7+D,MAClC8+D,EAAAA,GAAAA,GAAeD,EAAW7+D,EAAS,CACjC6Q,UAASI,UAAS8P,UAAS69C,aAC3B,EAGJz+B,EAAOy+B,EAAU7hE,QAAU,EAAG,sBAE9B,MAAOgiE,EAAcC,GAAeJ,EAEpC,GAAI79C,EAAQrhB,OAASyP,EAAAA,IAAQgnB,OAAQ,CACnC,MAAM8oC,EAAYjwD,EAAY+R,EAAQinB,YAAch5B,EAAY+R,EAAQ8nB,QAAU61B,IAC5E,cAAEn4D,EAAa,SAAEyzC,SAAmBL,GAAgB9oC,EAASkuD,EAAarjD,WAEhFykB,IAAS55B,EAAe,8BAA8ByzC,KACtD7Z,EAAO4+B,EAAa5nC,QAAU8nC,EAAW,mCAErCD,IACF7+B,EAAO6+B,EAAY7nC,QAAU4nC,EAAa5nC,OAAQ,kCAClDgJ,EAAO6+B,EAAY7nC,OAAS4nC,EAAa5nC,OAAS8nC,EAAW,2BAC7D9+B,EAAOq+B,GAAc7jE,SAAS6e,GAAgBwlD,EAAYtjD,WAAW,IAAS,mCAElF,KAAO,CACL,MAAMkW,EAAQU,GAAkBvR,EAAQrhB,MACxCygC,IAASvO,EAAO,wBAEhB,MAAMqtC,EAAYjwD,EAAY+R,EAAQinB,WAAYpW,EAAM3iB,UACpDD,EAAY+R,EAAQ8nB,QAAU,EAAGjX,EAAM3iB,UACvCD,EAAY+R,EAAQm+C,WAAa,EAAGttC,EAAM3iB,UACxCkwD,EAAeT,GAEf/jD,QAAsBzB,GAA0BrI,EAASI,EAAS2gB,EAAMxY,cACxEotC,QAAsBjwB,GAAmB1lB,EAASkuD,EAAarjD,UAAWqjD,EAAa79C,SAE7Fif,EAAO4+B,EAAarjD,YAAcf,EAAe,yDACjDwlB,EAAOg1B,GAAuB3O,GAAgB,iDAE9C,MAAQrvB,OAAQ1b,EAAW,YAAE4b,GAAgBmvB,EAC7CrmB,EAAO1kB,GAAewjD,EAAW,yCAEjC9+B,EAAO4+B,EAAa5nC,OAASgoC,EAAc,uCAE3C,MAAM,cAAE54D,SAAwBozC,GAAgB9oC,EAASwmB,GAIzD,GAFA8I,IAAS55B,EAAe,0DAEpBy4D,EAAa,CACf,MAAMI,QAAmB7oC,GAAmB1lB,EAASmuD,EAAYtjD,UAAWsjD,EAAY99C,SAExFif,EAAO6+B,EAAY7nC,OAAS4nC,EAAa5nC,OAASgoC,EAAc,+BAChEh/B,EAAO6+B,EAAYtjD,YAAcf,EAAe,wDAChDwlB,EAAOg1B,GAAuBiK,GAAa,gDAE3C,MAAQjoC,OAAQkoC,EAAgBhoC,YAAaioC,GAAmBF,EAEhEj/B,EAAO1kB,EAAc4jD,GAAkBJ,EAAW,iCAClD9+B,EAAOq+B,GAAc7jE,SAAS6e,GAAgB8lD,GAAgB,IAAS,sCACzE,CACF,CACF,CCrDO,SAASC,GAAmBC,GACjC,MAAO,IACFA,EACH5uD,IvDwB+B6uD,EuDxBRD,EAAK5uD,GvDyBvBwd,GAAUqxC,OAAW1hE,EAAW,iBuDxBrCwwB,KAAM,OACN7uB,KAAMggE,GAAgBF,EAAMA,EAAK9/D,MACjCgvB,GAAIgxC,GAAgBF,EAAMA,EAAK9wC,IAC/BuU,mBAAoBu8B,EAAK7wC,KvDoBtB,IAA4B8wC,CuDlBnC,CAEO,SAASC,GAAgB9uC,EAA0B8T,GACxD,OAAIA,IAAUv1B,EAAAA,IAAQgnB,OACbhnB,EAAAA,IAAQsf,KAEbmC,EAAKjC,KACwB,QAAxBgxC,EAAArtC,GAAkBoS,UAAM,IAAAi7B,OAAA,EAAxBA,EAA0BlxC,OAAQiW,EAEpCnS,GAAe,MAAOmS,GAHf,IAAAi7B,CAIhB,CAEOnjE,eAAeojE,GAAc/0C,GAOlC,MAAM,QACJ5Z,EAAO,OAAE4pB,EAAM,UAAE/P,EAAS,QAAEotB,EAAO,MAAE13C,GACnCqqB,QACED,GAAgB,iBAAiB3Z,KAAW4pB,WAAiB,CACjEglC,YAAaC,EAAAA,IACb5nB,UACA13C,SACC,CACDwqB,OAAQ,QACRF,aAEJ,CC3DA,MAAMi1C,GAA6B,EAC7BC,GAA0B/zB,GAC1Bg0B,GAA2B,IAG1BzjE,eAAe0jE,GACpBxvD,EACAixB,EACAmiB,EACAqc,GAEA,IACEx+B,QASJnlC,eAA0CkU,EAAmBixB,GAC3D,IACE,MAAM,QAAE9wB,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GAE/C,IAAI0vD,EAAoBz+B,EACrB5tB,QAAQua,GAAaA,EAAS4Y,eAC9Bv1B,KAAK2c,GAAaoc,GAAsBpc,EAAS1d,IAAIswB,WAExD,IAAK,IAAI8iB,EAAU,EAAGA,EAAU+b,IAA8BK,EAAkBrjE,OAAQinD,KACtFvT,EAAAA,EAAAA,IAAS,iCAAiCuT,EAAU,IAAKoc,SACnDnc,EAAAA,EAAAA,IAAM+b,MAETr+B,aAAYy+B,2BAA4BC,GACzCxvD,EACAI,EACA0wB,EACAy+B,GAGN,CAAE,MAAOxiE,IACP8C,EAAAA,EAAAA,IAAc,6BAA8B9C,EAC9C,CAEA,OAAO+jC,CACT,CAlCuB2+B,CAA2B5vD,EAAWixB,GACzDA,QDgDGnlC,eACLkU,EACAixB,EACAlT,EACA0xC,GAEA,IAAKx+B,EAAW5kC,QAAgD,YAAtC0T,EAAeC,GAAWG,UA4DtD,SAAwB4d,EAA0BkT,GAChD,OAAIlT,EACK8xC,EAAAA,IAAsBvsD,IAAIya,GAG5BkT,EAAW/vB,MAAM0c,GACfD,GAAsBC,GAAU1c,MAAM6c,GACpC8xC,EAAAA,IAAsBvsD,IAAIya,MAGvC,CAtEgF+xC,CAAe/xC,EAAMkT,GACjG,OAAOA,EAGT,IACE,MAAQ1c,KAAK,QAAEhU,GAAY,CAAC,SAAY6T,GAAmBpU,GAC3D,IAAKO,EACH,OAAO0wB,EAGT,MAAM8+B,EAAiB9+B,EAAW,GAAG5T,UAC/B2yC,EAAgB/+B,EAAWA,EAAW5kC,OAAS,GAAGgxB,WAEjD4yC,EAAUC,GAAUH,EAAiBC,EACxC,CAACD,EAAgBN,EAAUh4D,KAAK6X,MAAQ0gD,GACxC,CAACA,EAAeP,EAAUh4D,KAAK6X,MAAQygD,GAErC33B,EAASnH,EAAWhwB,KAAIgB,IAAA,IAAC,GAAE/B,GAAI+B,EAAA,OAAKqb,GAAUpd,GAAIvL,IAAI,IAEtDw7D,QAtFH,SAAwB5vD,EAAiBsK,GAQ9C,OAAOqP,GAAgB,iBAAiB3Z,IAAW,IAC9CsK,EACHskD,YAAaC,EAAAA,KAEjB,CA0EwBgB,CAAe7vD,EAAS,CAC1C2vB,cAAe+/B,EACfhgC,YAAaigC,EACbl8B,MAAOjW,EAAO4D,GAAe5D,GAAMrV,cAAgBjK,EAAAA,IAAQgnB,YAASp4B,EACpE+qC,SACAi4B,OAAO,IAGT,IAAKF,EAAM9jE,OACT,OAAO4kC,EAGT,MAAMjuB,EAAwB,GACxBstD,EAAgB,IAAIntD,IAE1B,IAAK,MAAM2rD,KAAQqB,EACjBrB,EAAK12B,OAAO5pC,SAASmG,GAAS27D,EAAcl0D,IAAIzH,KAE7Bm6D,EAAKzxC,UAAY4yC,GAAYnB,EAAKzxC,UAAY6yC,GAE/DltD,EAAO9H,KAAK2zD,GAAmBC,IAInC,IAAK,MAAMlxC,KAAYqT,EACC,gBAAlBrT,EAASC,MAA0ByyC,EAAchtD,IAAIga,GAAUM,EAAS1d,IAAIvL,MAC9EqO,EAAO9H,KAAK,IAAK0iB,EAAUuV,YAAY,IAEvCnwB,EAAO9H,KAAK0iB,GAMhB,OAFA5a,EAAO2tB,KAAKzT,IAELla,CACT,CAAE,MAAO9V,GAEP,OADA8C,EAAAA,EAAAA,IAAc,2BAA4B9C,GACnC+jC,CACT,CACF,CChHuBs/B,CAAyBvwD,EAAWixB,EAAYmiB,EAAWqc,EAChF,CAAE,MAAOviE,IACP8C,EAAAA,EAAAA,IAAc,mBAAoB9C,EACpC,CAEA,OAAO+jC,CACT,CA6BAnlC,eAAe6jE,GACbxvD,EACAI,EACA0wB,EACAy+B,GAEA,MAAMc,EAAkBjiE,GAAMmhE,EAAmBH,IAY3CkB,SAVqB75D,QAAQipB,IAAI2wC,EAAgBvvD,KAAInV,gBACxBikC,GAAa,CAC5C5vB,UACAkD,OAAQ,CAAEmtB,SAAUkgC,GACpBzmD,cAAe1J,EACfyvB,MAAOu/B,MAEiBlsD,QAAQua,IAAcA,EAAS4Y,mBAGnBmQ,OAExC,GAAI8pB,EAAmBpkE,OAAQ,CAC7B,MAAMskE,EAAcluD,EAAqBguD,EAAoB,MACvDG,EAAoBH,EAAmBxvD,KAAK2c,GAAaoc,GAAsBpc,EAAS1d,IAAIswB,WAElGS,EAAaA,EAAWhwB,KAAK2c,GAAa+yC,EAAY/yC,EAAS1d,KAAO0d,IACtE8xC,EAAoBrrD,GAAeqrD,EAAmBkB,EACxD,CAEA,MAAO,CAAE3/B,aAAYy+B,oBACvB,CC/BA,MAAMmB,GACJ,GAGA,GAEA,GAA2C,GAM3C,GAAmB,EAEnBp6D,WAAAA,CAAY0J,GACVzJ,MAAK,EAAWyJ,CAClB,CAEOsgC,YAAAA,CACLpe,GAMe,IALf,cACEyuC,EAAa,UACb1xB,EAAS,aACTC,GAC4E/nC,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,CAAC,EAElF,MAAM4I,EAAKxJ,MAAK,IACViqC,EAAiC,CACrCzgC,KACAmiB,UACA4c,aAAa,EACb6xB,gBACA1xB,YACAC,eACArvB,QAAStZ,MAAK,EAAsBkc,KAAKlc,KAAMwJ,IAIjD,OAFAxJ,MAAK,EAAgBwE,KAAKylC,GAC1BjqC,MAAK,IACEiqC,CACT,CAGA,GAAsBC,GACpB,MAAM1+B,EAAQxL,MAAK,EAAgBmqC,WAAWF,GAAYA,EAAQzgC,KAAO0gC,IACrE1+B,GAAS,IACXxL,MAAK,EAAgBoqC,OAAO5+B,EAAO,GACnCxL,MAAK,IAET,CASA,IAAmBrH,EAAAA,EAAAA,KAASvD,UAC1B,MAAM,mBAAEilE,SAA6BlK,KAO9B,IAAA9lB,EALHgwB,GAAsBr6D,MAAK,KAC7BA,MAAK,IAAYA,MAAK,IAClBA,MAAK,EAAQuoC,aACfvoC,MAAK,MAGK,QAAZqqC,EAAArqC,MAAK,SAAO,IAAAqqC,GAAZA,EAAc5B,QACdzoC,MAAK,OAAUrJ,EACjB,GA3GwB,IA4GF,GAExB,KACE,MAAMqtB,EAgHV,SAAsBva,GACpB,MAAMua,EAAM,IAAIC,IAAIC,EAAAA,KAIpB,OAHAF,EAAItwB,SAA4B,SAAjBswB,EAAItwB,SAAsB,KAAO,MAChDswB,EAAIsmB,WAA2B,YAAZ7gC,EAAwB,WAAa,IAAxC,KAChBob,GAA6Bb,GACtBA,CACT,CAtHgBumB,CAAavqC,MAAK,GACxBwqC,EAAS,IAAInC,GAAsErkB,GAIzF,OAHAwmB,EAAO/vB,UAAUza,MAAK,GACtBwqC,EAAO9B,UAAU1oC,MAAK,GACtBwqC,EAAO7B,aAAa3oC,MAAK,GAClBwqC,CACT,CAEA,GAAmE5xC,IACjE,OAAQA,EAAQzC,MACd,IAAK,aACH6J,MAAK,EAAkBpH,GACvB,MACF,IAAK,cACHoH,MAAK,EAAmBpH,GAE5B,EAGF,GAAuB8xC,KACrB1qC,MAAK,GAA6B,EAGpC,GAA0B+qC,KACxB,IAAK,MAAMd,KAAWjqC,MAAK,EACrBiqC,EAAQ1B,cACV0B,EAAQ1B,aAAc,EAClB0B,EAAQtB,eAAchJ,EAAAA,GAAAA,GAASsK,EAAQtB,cAE/C,EAGF,GAAkB/vC,GAChB,IAAK,MAAMqxC,KAAWjqC,MAAK,EAGrBpH,EAAQ4Q,GAAKygC,EAAQzgC,IAIpBygC,EAAQ1B,cACX0B,EAAQ1B,aAAc,EAClB0B,EAAQvB,YAAW/I,EAAAA,GAAAA,GAASsK,EAAQvB,WAG9C,CAEA,GAAmB9vC,GACjB,MAAM0hE,EAAmB,IAAI7tD,IAAI7T,EAAQ8yB,WAEzC,IAAK,MAAM,QAAEC,EAAO,YAAE4c,EAAW,cAAE6xB,KAAmBp6D,MAAK,EAGzD,GAAKuoC,GAAgB6xB,EAIrB,IAAK,MAAMz8D,KAAUguB,EAEjBhuB,EAAO8f,QAAU7kB,EAAQ6kB,OACtB68C,EAAiB1tD,IAAIjP,EAAOkM,UAC5BlM,EAAOuuD,OAAO34D,SAAS,cAI1BosC,EAAAA,GAAAA,IAAS,IAAMy6B,EAAcz8D,IAIrC,CAEA,KAGE,MAAM+tB,EAAY1rB,MAAK,EAAqB,CAAC,aACvC6rC,EAAY7rC,MAAK,IAEvBA,MAAK,EAASsoC,KAAK,CACjBnyC,KAAM,YACNqT,GAAIqiC,EACJngB,UAAWA,EAAUnhB,KAAKV,IAAO,IAC5BA,EACHqiD,OAAQ,CAAC,iBAGf,CAEA,KACE,OAAOlsD,MAAK,EAAgBwK,MAAMy/B,GAAYA,EAAQte,QAAQh2B,QAChE,CAGA,GAAqBu2D,GACnB,MAAMxgC,EAAoD,GAE1D,IAAK,MAAMue,KAAWjqC,MAAK,EACzB,IAAK,MAAMrC,KAAUssC,EAAQte,QACtBhuB,EAAOuuD,OAAO1hD,MAAM8+B,GAAU4iB,EAAO34D,SAAS+1C,MAInD5d,EAAUlnB,KAAK,CACbiZ,MAAO9f,EAAO8f,MACd5T,QAASlM,EAAOkM,UAKtB,OAAO6hB,CACT,EAWF,MAAM6uC,GAA6D,CAAC,EC5M7D,MAAMC,GACX,GAEA,GAEA,GAEA,IAAe,EAGf,GAEAz6D,WAAAA,CAAY0jB,GDmMP,IAA0Bha,EClM7BzJ,MAAK,EAAWyjB,EAEhBzjB,MAAK,GDgMwByJ,EChMUga,EAAQha,QDiMjD8wD,GAAe9wD,KAAa,IAAI0wD,GAAc1wD,GACvC8wD,GAAe9wD,IClMoCsgC,aACtD,CAAC,CACCtsB,MAAOgG,EAAQhG,MACfyuC,OAAQ,CAAC,YACTriD,QAAS4Z,EAAQ5Z,UAEnB,CACEuwD,cAAep6D,MAAK,GACpB0oC,UAAW1oC,MAAK,EAChB2oC,aAAc3oC,MAAK,IAIvBA,MAAK,EAA4B,IAAIsnC,GAAyBtnC,MAAK,EAAeuoC,YAAa,CAC7Ff,YAAa/jB,EAAQ0hB,cACrB0C,aAAcpkB,EAAQ2hB,eACtB2C,kBAAmBtkB,EAAQ8hB,yBAC3ByC,cAAevkB,EAAQ+hB,qBACvB4C,oBAAqB3kB,EAAQgiB,kBAC7BO,KAAMhmC,MAAK,IAEf,CAEOsZ,OAAAA,GACLtZ,MAAK,GAAe,EACpBA,MAAK,EAAesZ,UACpBtZ,MAAK,EAA0BsZ,SACjC,CAEA,IAA2BmhD,KACzBz6D,MAAK,GAAiB,EACtBA,MAAK,KACLA,MAAK,EAA0B2nC,iBAAiB,EAGlD,GAAuB+C,KACrB1qC,MAAK,KACLA,MAAK,EAA0BynC,iBAAiB,EAGlD,GAA0BsD,KACxB/qC,MAAK,EAA0B0nC,oBAAoB,EAGrD,IAA8BgzB,KAC5B16D,MAAK,KAAmB,EACxBA,MAAK,IAAoB,EAG3B,KAAqBrH,EAAAA,EAAAA,KAASvD,UAC5B,QAA4BuB,IAAxBqJ,MAAK,EACP,OAKF,SADM68C,EAAAA,EAAAA,IAzGoB,IA0GtB78C,MAAK,EAAc,OAEvB,MAAM26D,EAAc36D,MAAK,EACzBA,MAAK,OAAiBrJ,QAChBqJ,MAAK,EAASkZ,SAASyhD,EAAY,IACxC,KACD,MAAO9yC,EAAIsc,GAAWoC,GAAWvmC,MAAK,EAASolC,gBAC/C,OAAOX,GACL5c,EAlHwB,GAmHxBsc,EAnHwB,GAoHzB,IC1HE,MAAMy2B,GAAcl3B,KCEpB,MAAMm3B,GACX,IAAgB,IAAIpuD,IACpB,IAEA1M,WAAAA,CAAY+6D,GACV96D,MAAK,GAAY86D,CACnB,CAEA,QAAIC,GACF,OAAO/6D,MAAK,GAAcoI,KAAO,CACnC,CAEA4yD,EAAAA,CAAGxxC,GACDxpB,KAAKi7D,OAAOzxC,GAAM,EACpB,CAEA0xC,GAAAA,CAAI1xC,GACFxpB,KAAKi7D,OAAOzxC,GAAM,EACpB,CAEAyxC,MAAAA,CAAOzxC,EAAS2xC,GACd,MAAMC,EAAWp7D,KAAK+6D,KACtB/6D,MAAK,GAAcm7D,EAAW,MAAQ,UAAU3xC,GAChD,MAAM6xC,EAAWr7D,KAAK+6D,KAElBK,IAAaC,GACfr7D,MAAK,GAAUq7D,EAEnB,ECnBK,MAAMC,GACX,IAGA,IAA8C,GAE9C,GAwFF,WAEE,IAAIvtB,EAA4C,GAE5CwtB,EAAyC,GAoB7C,MAAO,CAEL,OAAIpyC,GACF,MAAO,IAAI4kB,KAAsBwtB,GAAyBthC,KAAKzT,GACjE,EACAg1C,qBAvB2BA,CAACptB,EAAoCqtB,KAChE,MAAMC,EAAkB,IAAIjvD,IAAIiB,GAAW0gC,EAAqB,wBAEhEmtB,EAA0B,IACrBA,KACAxtB,EAAkBphC,QAAQua,GAAaw0C,EAAgB9uD,IAAIsa,EAASya,wBACvE1H,KAAKzT,IAEPunB,EAAoB0tB,CAAoB,EAgBxCE,sBAb6BC,IAC7B,MAAMF,EAAkB,IAAIjvD,IAAIiB,GAAWkuD,EAAwB,wBAEnEL,EAA0BA,EACvB5uD,QAAQua,IAAcw0C,EAAgB9uD,IAAIsa,EAASya,sBAAqB,EAW/E,CAxHuBiN,GAErB,IAAa,IAAIisB,IAA0BgB,GAAc77D,MAAK,EAAkB6jC,aAAag4B,KAE7F,GAAmBn4B,KACnB,IAyHF,SAAoCxqB,GAClC,IAAI4iD,EAAgD,GAEpD,MAAO,CAAC3sB,EAAwBpB,KpFlC3B,IAAiCngC,EAAsBC,GoFmCtDshC,EAAuBx5C,SpFnC+BkY,EoFmCwBkgC,GpFnC9CngC,EoFmCuBkuD,GpFlClDnmE,SAAWkY,EAAOlY,QAItBiY,EAAOupB,OAAM,CAAC3N,EAAMlyB,IAAMkyB,IAAS3b,EAAOvW,OoF+B7C4hB,EAASi2B,EAAwBpB,GAGnC+tB,EAAwB/tB,CAAiB,CAE7C,CAnI4BguB,CAA2B/7D,MAAK,EAAiB6jC,cAC3E,GAAoBH,KAEpB,IAAe,EAEf,IAEA3jC,WAAAA,CACEuJ,EACA0yD,GAEAh8D,MAAK,GAAasJ,EAElBtJ,MAAK,GAAa,CAChBg8D,EAAkB9iD,SAASlZ,MAAK,IAChCg8D,EAAkBjtB,iBAAiB8sB,GAAc77D,MAAK,GAAWi7D,OAAO,MAAOY,KAEnF,CAMO3iD,QAAAA,CAASZ,GACd,OAAOtY,MAAK,EAAiB8jC,YAAYxrB,EAC3C,CAMOy2B,eAAAA,CAAgBz2B,GACrB,OAAOtY,MAAK,EAAkB8jC,YAAYxrB,EAC5C,CAEOgB,OAAAA,GACLtZ,MAAK,GAAe,EAEpB,IAAK,MAAMi8D,KAAej8D,MAAK,GAC7Bi8D,GAEJ,CAEA,IAA+CC,CAAC9tB,EAAqBL,KACnE/tC,MAAK,EAAmBw7D,qBAAqBptB,EAAqBL,GAClE/tC,MAAK,GAAkB,IAEnBouC,EAAoBz4C,SACtBqK,MAAK,GAA6BwC,WAAW4rC,GAC7CpuC,MAAK,KACP,EAIF,KAA6BrH,EAAAA,EAAAA,KAASvD,UACpC,IAAI4K,MAAK,EAET,IACEA,MAAK,GAAWg7D,GAAG,UAEnB,MAAMY,EAAyB57D,MAAK,GACpCA,MAAK,GAA+B,GACpC,MAAMm8D,QAAgCrD,GAAiB94D,MAAK,GAAY47D,OAAwBjlE,GAAW,GAE3GqJ,MAAK,EAAmB27D,sBAAsBC,GAC9C57D,MAAK,GAAkBm8D,EACzB,CAAE,QACAn8D,MAAK,GAAWk7D,IAAI,SACtB,IACC,GAEH,IAAkB9sB,GACXpuC,MAAK,GACRA,MAAK,GAAwBouC,EAAqBpuC,MAAK,EAAmBmpB,IAE9E,ECnDF,MAAMizC,GAA0B,EAAIv3B,GAC9Bw3B,GAAoB,CAAEh3B,QAAS,EAAIR,GAAKS,WAAY,GAAKT,IACzDy3B,GAAmB,CAAEj3B,QAASP,GAAQQ,WAAY,EAAIR,IACtDy3B,GAA0B,CAAEl3B,QAASP,GAAQQ,WAAY,EAAIR,IAC7D03B,GAAmB,CAAEn3B,QAAS,EAAIR,GAAKS,WAAY,GAAKT,IACxD43B,GAAoB,CAAEp3B,QAAS,EAAIP,GAAQQ,WAAY,GAAKR,IAC5D43B,GAAmB,CAAEr3B,QAAS,GAAKR,GAAKS,WAAYR,IACpD63B,GAAmB,CAAEt3B,QAAS,GAAKR,GAAKS,WAAY,EAAIR,IAExD83B,GAAoB,CAAEv3B,QAASP,GAAQQ,WAAY,EAAIR,IACvD+3B,GAAyB,EAAIh4B,GAE7Bi4B,GAAgC,GAEhCC,IAAmCC,EAAAA,EAAAA,MAElC,SAASC,GACd3zD,EACAyU,EACA7E,EACAgkD,EACAC,GAEA,KAAM,QAASp/C,KAAaA,EAAQF,IAClC,MAAO,OAGT,MAAMu/C,EA4CR,SACE9zD,EACA4P,EACAgkD,GAEA,MAAMG,EAAiBC,GAA4Bh0D,EAAW4P,EAAUgkD,GAQxE,MAAO,IANSv3B,GAAY,CAC1BzyB,OAAQopD,GACRz2B,SAAUw2B,GACVr2B,KAAMq3B,EAAevyD,SAKrByyD,YAAaF,EAAe7iD,IAEhC,CA7DkCgjD,CAC9Bl0D,EACA4P,EACAgkD,EAAuBhhD,UAAKvlB,EAAW,YAEnC8mE,EAqIR,SACEn0D,EACAO,EACA6zD,EACAH,EACAI,EACAzkD,EACAgkD,GAEA,IACIlB,EACA4B,EAFA33B,GAAY,EAIhB,MAAM43B,EAAmB9wD,EAAQL,OAAOa,OAAOmwD,IAC/C,IAAI7uB,EAAmCgvB,EAAiBloE,OAASqQ,KAAKsuD,OAAOuJ,QAAoBlnE,EAejG,SAASmnE,EAAgB1vB,GACnBA,EAAoBz4C,QACtBgoE,GAEJ,CAEA,SAASI,EAAiB3vB,EAAoCL,GAC5DK,EAAoBl6C,QAAQ8D,UAAUF,SAASovB,IAC7C0zC,GAAY/2B,aAAa3c,EAAS,IAGpChO,EAAS,CACP/iB,KAAM,gBACNsnB,MAAO,MACP8c,WAAY6T,EACZL,oBACAzkC,aAEJ,CA0BA,MAxBK,WACH,MAAM00D,OAAuDrnE,IAArCk4C,EACpBmvB,IACFnvB,QApCJz5C,iBACE,IACE8nE,GAAuB,GACvB,MAAM1a,EAAa91C,OAAOL,WAAWkxD,KACrC,aA2JNnoE,eAA8CkU,EAAmBk5C,EAAsBtpC,GACrF,MAAM+kD,GAAqBjB,EAAAA,EAAAA,IAAgBF,IAErC/yC,EAAwC,CAAC,EAC/C,IAEIm0C,EAFAC,EAAgC,GAIpC,MAAMC,EAAoBH,EAAmBI,MAAKjpE,UAChD,IACE,MAAMsnD,EAAYr1B,IAAStf,EAAAA,IAAQsf,KAAOA,OAAO1wB,EACjD,IAAI4jC,QAAmBkiB,GAAmBnzC,EAAWozC,OAAW/lD,OAAWA,EAAWquC,IAEtFzK,QAAmBu+B,GAAiBxvD,EAAWixB,EAAYlT,GAAM,GAE7DA,IAAStf,EAAAA,IAAQsf,MAAQkT,EAAW5kC,SAGtCuoE,EAA0B3jC,EAAW,GAAG5T,UAGxCw3C,EAAiB5jC,EACjBA,EAAaA,EAAW5tB,QAAQua,GAAaD,GAAsBC,GAAU3zB,SAASwU,EAAAA,IAAQsf,SAGhG0C,EAAO1C,GAAQkT,CACjB,CAAE,MAAO/jC,IAEP8C,EAAAA,EAAAA,IAAc,oBAAqB+tB,EAAM7wB,EAC3C,KAaF,aAVM0J,QAAQo+D,WAAW9b,EAAWj4C,IAAI6zD,IAExCllD,EAAS,CACP/iB,KAAM,oBACNsnB,MAAO,MACPnU,YACA60D,iBACAp0C,WAGKm0C,CACT,CAtMmBK,CAA+Bj1D,EAAWk5C,EAAYtpC,EACrE,CAAE,MAAO1iB,GAEP,YADA8C,EAAAA,EAAAA,IAAc,iCAAkC9C,EAElD,CAAE,QACA0mE,GAAuB,EACzB,CACF,CAyB6CsB,GACzCb,KAGE13B,IAEJ+1B,EAAoB,IAAIluB,GACtBzkC,EAAeC,GAAWG,QAC1BI,EACAglC,GAECmvB,GAGHJ,EAAqB,IAAItC,GAAmBhyD,EAAW0yD,GAEvDA,EAAkB9iD,SAAS4kD,GAC3BF,EAAmB1kD,SAAS6kD,GAC5BH,EAAmB7uB,gBAAgBmuB,GACpC,EAtBI,GAwBE,KAAM,IAAAuB,EAAAC,EACXz4B,GAAY,EACM,QAAlBw4B,EAAAb,SAAkB,IAAAa,GAAlBA,EAAoBnlD,UACH,QAAjBolD,EAAA1C,SAAiB,IAAA0C,GAAjBA,EAAmBplD,SAAS,CAEhC,CAnN8BqlD,CAC1Br1D,EACAyU,EAAQF,IAAIhU,QACZszD,EACAC,EAAwBG,aAY1BnoE,uBAIQynD,EAAAA,EAAAA,IAAMuf,IAGZgB,EAAwBp3B,OACxB44B,EAAW54B,OACX64B,EAA4B74B,MAC9B,GApBE9sB,EACAgkD,EAAuBhhD,UAAKvlB,EAAW,eAEnCioE,EA4MR,SAAyBt1D,EAAmB4P,GAC1C,IAAI4lD,EAAa94D,KAAK/D,MAAMlB,KAAK6X,MAAQ,KAIzC,MAAMmmD,EAAgBn4B,GACpB,CAACi2B,KACDznE,UACE,IACE,MAAM4pE,QAAkBjT,GAAcziD,EAAWw1D,GAAY5kD,MAAM+kD,IAEnE,GAAID,EAAW,CACb,IAAIE,GACHJ,EAAYI,GAAcF,EAC3BE,EACGvyD,QAAQ7B,KAA6B,gBAAhBA,EAAO3U,MAA0B2U,EAAOsc,IAAIuO,YACjE79B,QAAQohB,EACb,CACF,CAAE,MAAO1iB,IACP8C,EAAAA,EAAAA,IAAc,gCAAiC9C,EACjD,KAIE2oE,EAAcx5B,GAAY,CAC9BzyB,OAAQ0pD,GACR,UAAM52B,GACJ+4B,EAAc33B,SAEd,IACE,MAAMze,QAAa4iC,GAAejiD,GAAW4Q,MAAM+kD,IAE/Ct2C,IACFm2C,EAAa94D,KAAK/D,MAAMlB,KAAK6X,MAAQ,KACrCM,EAAS,CACP/iB,KAAM,aACNmT,YACAqf,SAGN,CAAE,MAAOnyB,IACP8C,EAAAA,EAAAA,IAAc,6BAA8B9C,EAC9C,CACF,IAGF,MAAO,CACLwvC,MAAMrtC,EAAAA,EAAAA,IACJomE,EAAc53B,KACd,IAAM1C,MAAmB8B,GAAW81B,OAEtC31B,IAAAA,GACEq4B,EAAc33B,SACd+3B,EAAYz4B,MACd,EAEJ,CApQqB04B,CAAgB91D,EAAW4P,GACxC2lD,EAkfR,SAA0Cv1D,GACxC,OAAOq8B,GAAY,CACjBzyB,OAAQqpD,GACR12B,SAAUw2B,GACV,UAAMr2B,GACJ,IACE,MAAMroC,QAAeggB,GAAqBrU,GAE1C,GAAI3L,EAAO0uB,cACT,MAAO,OAGT,MAAM,QAAE5iB,GAAYJ,EAAeC,GAEnC,IAAI+1D,EAEJ,GAH2B1hE,EAAOs0C,UAW3B,CACL,MAAM5lB,QAAsBulB,GAAqBnoC,EAAS9L,EAAOkM,SAC7DwiB,IACFgzC,EAAe,CAAEhzC,iBAErB,KAbuB,CAErB,MAAMizC,QAAsBnpB,GAAqB1sC,EAAS9L,EAAOkM,WAC3D,UAAWy1D,IAAkBA,EAAc3hE,OAAO0uB,gBAGtDgzC,EAAelzD,EAAKmzD,EAAc3hE,OAAQ,CAAC,gBAAiB,YAAa,YAE7E,CAOI0hE,StElhBLjqE,eAAqCkU,EAAmBgV,GAE7D,OAAOD,GAAoB/U,EAAW,CACpCuU,IAAK,UAFiBF,GAAqBrU,MAItCgV,IAGT,CsE2gBgBihD,CAAsBj2D,EAAW+1D,EAE3C,CAAE,MAAO7oE,IACP8C,EAAAA,EAAAA,IAAc,4BAA6B9C,EAC7C,CACF,GAEJ,CAzhBsCgpE,CAAiCl2D,GAC/Dm2D,EA4VR,SAAoCn2D,EAAmB4P,GACrD,MAAM,QAAEzP,GAAYJ,EAAeC,GACnC,IAAIo2D,EAEJ,OAAO/5B,GAAY,CACjBzyB,OAAQupD,GACR,UAAMz2B,GACJ,IACE,MAAQ7vC,KAAMwpE,EAAa9hD,IAAK42B,SAAoB/2B,GAAmBpU,GACvE,GAAoB,UAAhBq2D,IAA4BlrB,EAAW,MAAO,OAElD,MAAM,UAAExC,EAAS,QAAExpB,EAAO,cAAE4D,GAAkBooB,EAE9C,IAAKxC,EAAW,CACd,IAAK5lB,EAEH,OAUF,OANAnT,EAAS,CACP/iB,KAAM,uBACNmT,YACAs2D,eAAgBn3C,EAChBo3C,SAAU,KAEL,MACT,CAEA,MAAMC,EAAiBlxD,GAAWqjC,GAC5B4tB,GAA4B,WAAhBF,EAA2BI,EAAAA,IAAyBC,EAAAA,KACnErzD,QAAQvW,GAAUA,IAAUqyB,IACzBw3C,QAAsB9sB,GAC1B1pC,EAASq2D,EAAgBD,GAGrBK,EAAmBD,EAAa11D,KAAIgB,IAAA,IAAC,OAAE5N,KAAWioB,GAAMra,EAAA,OAAKqa,CAAI,IAElEkR,GAAampC,EAAcP,KAC9BA,EAAaO,EACb/mD,EAAS,CACP/iB,KAAM,uBACNmT,YACAs2D,eAAgBn3C,EAChBo3C,SAAUK,IAGhB,CAAE,MAAO1pE,IACP8C,EAAAA,EAAAA,IAAc,6BAA8B9C,EAC9C,CAGF,IACCkwC,IACL,CAlZmCy5B,CAA2B72D,EAAW4P,GACjEknD,EAmZR,SAA4B92D,EAAmB4P,GAC7C,IAAIwmD,EAEJ,OAAO/5B,GAAY,CACjBzyB,OAAQypD,GACR,UAAM32B,GACJ,IACE,MAAM15B,QjBnaPlX,eAA4BkU,GACjC,MAAM,QAAEG,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GACzCsC,QAAa8Y,GAA8C,kBAAmB,CAAE7a,YAChFmnB,QAA+ClL,KAE/Cu6C,EAA8C,CAAC,EAC/CC,EAAiD,CAAC,EAClD33C,EAA+B,CAAC,EActC,OAZAjc,OAAOL,KAAKT,GAAM9T,SAASq5B,IACzB,MAAM,eAAEovC,EAAc,cAAE1R,EAAeznC,IAAK6J,GAAWrlB,EAAKulB,GAC5DkvC,EAAoBlvC,GAAc,IAAIpwB,KAAKw/D,GAAgB1f,UAAYvgD,GAAAA,GACnEuuD,IACFyR,EAAuBnvC,GAAc09B,GAEvC,MAAMznC,EAAM8J,GAAiBznB,EAASwnB,EAAQD,GAC1C5J,IACFuB,EAAKwI,GAAc/J,EACrB,IAGK,CACLi5C,sBACAC,yBACA33C,OAEJ,CiBwY6B63C,CAAal3D,GAE7BwtB,GAAaxqB,EAAQozD,KACxBA,EAAapzD,EAEb4M,EAAS,CACP/iB,KAAM,0BACNmT,eACG6C,EAAKG,EAAQ,CACd,sBACA,yBACA,WAIR,CAAE,MAAO9V,IACP8C,EAAAA,EAAAA,IAAc,qBAAsB9C,EACtC,CACF,IACCkwC,IACL,CA9a4B+5B,CAAmBn3D,EAAW4P,GAClDwnD,EAkQR,SAA6Bp3D,EAAmBi0D,EAA8CrkD,GAC5F,GAAIynD,EAAAA,KAA6D,YAAtCt3D,EAAeC,GAAWG,QACnD,MAAO,OAGT,IAAIm3D,EAEJ,OAAOj7B,GAAY,CACjBzyB,OAAQspD,GACR,UAAMx2B,GACJ,IACE,MAAOrJ,EAAQ/O,EAAUmkC,SAAsB7xD,QAAQipB,IAAI,CACzD+mC,KACAqN,IACAnH,GAAuB9sD,KAEnBsiB,QAAekmC,GAAiBxoD,EAAWqzB,EAAQo1B,EAAcnkC,IAEjE,oBAAEqkC,EAAmB,YAAEqE,GAAgBvE,EAExCj7B,GAAalL,EAAQg1C,KACxBA,EAAah1C,EACb1S,EAAS,CACP/iB,KAAM,gBACNmT,YACAsiB,SACA0qC,cACArE,wBAGN,CAAE,MAAOz7D,IACP8C,EAAAA,EAAAA,IAAc,sBAAuB9C,EACvC,CACF,IACCkwC,IACL,CArS6Bm6B,CAAoBv3D,EAAW8zD,EAAwBG,YAAarkD,GACzF4nD,EA8aR,SAA6Bx3D,EAAmB4P,GAC9C,GAAI6nD,EAAAA,IACF,MAAO,OAGT,IAAIC,EAEJ,OAAOr7B,GAAY,CACjBzyB,OAAQwpD,GACR,aAAM32B,GACJ,MAAM,iBAAEk7B,SAA2B9Q,KACnC,OAAO8Q,CACT,EACA,UAAMj7B,CAAKk7B,GACT,IAAKA,EACH,MAAO,OAGT,IACE,MAAMC,QC3hBP/rE,eAA6BkU,GAClC,MAAM,QAAEG,GAAYJ,EAAeC,GAC7B83D,EAAwB,YAAZ33D,GACZ,QAAEI,SAAkB8T,GAAqBrU,GAE/C,OAAOob,GAAiC,YAAY7a,IAAW,CAAEu3D,aACnE,CDqhBkCC,CAAc/3D,GAEnCwtB,GAAakqC,EAAiBG,KACjCH,EAAkBG,EAClBjoD,EAAS,CACP/iB,KAAM,gBACNmT,YACA63D,gBAGN,CAAE,MAAO3qE,IACP8C,EAAAA,EAAAA,IAAc,sBAAuB9C,EACvC,CAGF,IACCkwC,IACL,CAld6B46B,CAAoBh4D,EAAW4P,GAc1D,MAAO,KACLkkD,EAAwB12B,OACxB+2B,IACAmB,EAAWl4B,OACX+4B,IACAW,IACAM,IACAI,GAAoB,CAExB,CAqBA,SAASxD,GACPh0D,EACA4P,EACAgkD,GAEA,MAAM,QAAEzzD,GAAYJ,EAAeC,GACnC,IAAIskB,EAEA2zC,EADAC,EAAmB,IAAI1hE,GAAAA,EA+C3B1K,eAAeqsE,EAA4B53D,GAEzC,MAAM,QAAEuiB,EAAO,OAAEh1B,GAAS,SAAgB06C,GAAcroC,EAASI,GAYjE,OAVIzS,IAAWmqE,IACbroD,EAAS,CACP/iB,KAAM,gBACNmT,YACAmU,MAAO,MACPrmB,WAEFmqE,EAAanqE,GAGRg1B,CACT,CAEA,MAAO,CAAE5R,IA7DTplB,iBAEE,aADMosE,EAAiBvhE,QAChB2tB,CACT,EA0Dc9iB,OAxDd1V,iBACE8nE,SAAAA,GAAyB,GAEzB,IACE,MAAMv/D,QAAeggB,GAAqBrU,IACnCo4D,EAAYxf,SAAuBhiD,QAAQipB,IAAI,CACpDs4C,EAA4B9jE,EAAOkM,SACnCo4C,GAAkBx4C,EAAS9L,EAAOkM,QAASqP,KAGvCyoD,EAAc,CAClB,CAAC55D,EAAAA,IAAQsf,MAAOq6C,KACbxf,GAEC0f,GAAc9qC,GAAalJ,EAAU+zC,GAC3C/zC,EAAW+zC,EAEPC,GACF1oD,EAAS,CACP/iB,KAAM,iBACNmT,YACAmU,MAAO,MACPmQ,aAIJ4zC,EAAiBrhE,SACnB,CAAE,MAAO3J,IACP8C,EAAAA,EAAAA,IAAc,sCAAuC9C,GAIrDgrE,EAAiBphE,OAAO5J,GACxBgrE,EAAmB,IAAI1hE,GAAAA,CACzB,CAAE,QACAo9D,SAAAA,GAAyB,EAC3B,CACF,EAoBF,CA+NA,SAAS+B,GAAazoE,IACpB8C,EAAAA,EAAAA,IAAc,gBAAiB9C,EAGjC,CA6HO,SAASqrE,GACdv4D,EACAyU,EACA7E,GAEA,KAAM,QAAS6E,KAAaA,EAAQF,IAClC,MAAO,OAGT,MAAMw/C,EAAiBC,GAA4Bh0D,EAAW4P,GAExD4oD,EAAgB,IAAItH,GAAc,IACnC90B,GACHjoB,MAAO,MACPhU,QAASJ,EAAeC,GAAWG,QACnCI,QAASkU,EAAQF,IAAIhU,QACrBqP,SAAU6jD,GAAiCsB,MAAKjpE,gBACxCioE,EAAevyD,QAAQ,MAIjC,MAAO,KACLg3D,EAAcxoD,SAAS,CAE3B,iBEtkBA,IAAI9I,GAEJ,MAAMuxD,GAGA,CAAC,EAEDC,GAActrB,GAAe,QAE5B,SAASurB,KAA+C,IAAjCx4D,EAAmB7I,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,UAYlD,OAXK4P,KACHA,GAAkB,CAChBY,QAAS,IAAI8wD,GAAAA,QAAQ,CACnBC,SAAUH,GAAY5wD,QAAQgxD,SAEhCxwD,QAAS,IAAIswD,GAAAA,QAAQ,CACnBC,SAAUH,GAAYpwD,QAAQwwD,WAK7B5xD,GAAgB/G,EACzB,CAEOrU,eAAeitE,GAAmB54D,GACvC,KAAMA,KAAWs4D,IAAsB,CACrC,MAAMO,QAAwBL,GAAcx4D,GAAS84D,IAAIF,qBACnDG,EAAgBF,EAAgBj5C,MAAMo5C,GAAwB,iBAAdA,EAAM/5D,MAAyBtS,MAC/EssE,EAAmBJ,EAAgBj5C,MAAMo5C,GAAwB,sBAAdA,EAAM/5D,MAA8BtS,MAC7F2rE,GAAoBt4D,GAAW,CAAE+4D,gBAAeE,mBAClD,CAEA,OAAOX,GAAoBt4D,EAC7B,CC1BOrU,eAAeutE,GACpBr5D,EACA+d,EACAkS,EACAC,EACAF,GAEA,MAAM,QAAE7vB,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkBiU,GAAsBxU,GAEhD,GAAI+d,IAASu7C,EAAAA,IAAIv7C,KAAM,CACrB,MAAMyoB,QAqDV16C,eACEqU,EACAI,GAagB,IAZhBg5D,EAWCjiE,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,CAAC,EAEL,MAAMusB,EAAUupB,GAAe,QAAQjtC,GAAS24D,OAC1Cp+C,EAAM,IAAIC,IAAI,GAAGkJ,iBAAuBtjB,kBAI9C,aAFqB8a,EAAAA,GAAAA,IAAUX,EAAIrvB,WAAYkuE,IAEjCj3D,IAChB,CA3EkCk3D,CAAmBr5D,EAASI,EAAS,CACjEk5D,cAAevpC,EAAgBA,EAAgB,SAAO7iC,EACtDqsE,cAAezpC,EAAcA,EAAc,SAAO5iC,EAClD2iC,QACA2pC,iBAAiB,IAEnB,OAAOnzB,EAAgBvlC,KAAKwlC,GAuEhC,SAAgClmC,EAAiBkmC,GAC/C,MACEmzB,SAAUhoD,EACVioD,KAAMt8C,EACNu8C,WAAYC,EACZC,QAASC,EACTC,gBAAiB78C,GACfopB,EAEE0zB,EAAavoD,EAAQuX,SAAS,GAAGixC,UAAUttE,MAC3C25B,EAASjoB,OAAO27D,EAAW1zC,QAAU,GACrCsN,EAAc6kC,GAAQ,QAAAr4D,QAAQ85D,QAAQF,EAAWG,eACjDtvD,EAAY4tD,GAAQ,QAAAr4D,QAAQ85D,QAChCF,EAAWI,YAAcJ,EAAWK,kBAAoBL,EAAWM,kBAI/D1rC,EAAa/jB,IAAczK,EAMjC,MAAO,CACLL,GAAIqd,EACJM,KAAM,cACNN,OACAF,YACA0W,cACA/oB,YACAyb,OAAQsI,EAAatI,GAAUA,EAC/B1I,KAfWu7C,EAAAA,IAAIv7C,KAgBfgR,aACAD,kBAfwBC,EAAagF,EAAc/oB,EAgBnD0oB,IAfUl1B,OAAOu7D,EAAYE,GAgB7BptE,KAfwC,yBAA7B+kB,EAAQuX,SAAS,GAAGt8B,KAAkC,oBAAiBQ,EAgBlF8lC,WAf8C,0BAA7BvhB,EAAQuX,SAAS,GAAGt8B,KAiBzC,CA7G0C6tE,CAAuBn6D,EAASkmC,KAAQpjC,OAAOM,QACvF,CAAO,CACL,MAAM,aAAE+E,GAAiBiZ,GAAe5D,GAClCyoB,QA4GV16C,eACEqU,EACAI,GAagB,IAZhBg5D,EAWCjiE,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,CAAC,EAEL,MAAMusB,EAAUupB,GAAe,QAAQjtC,GAAS24D,OAC1Cp+C,EAAM,IAAIC,IAAI,GAAGkJ,iBAAuBtjB,wBAI9C,aAFqB8a,EAAAA,GAAAA,IAAUX,EAAIrvB,WAAYkuE,IAEjCj3D,IAChB,CAlIkCq4D,CAAqBx6D,EAASI,EAAS,CACnEk6D,iBAAkB/xD,EAClB+wD,cAAevpC,EAAgBA,EAAgB,SAAO7iC,EACtDqsE,cAAezpC,EAAcA,EAAc,SAAO5iC,EAClD2iC,UAEF,OAAOwW,EAAgBvlC,KAAKwlC,GA8HhC,SAAkClmC,EAAiBkmC,GACjD,MACEm0B,eAAgBr9C,EAChB28C,gBAAiB78C,EACjBruB,KAAM+kC,EACN/V,GAAIhT,EAAS,MACble,EACAgpC,WAAY+D,GACV4M,EAEEhgB,EAASjoB,OAAO1R,GAEhBiiC,EAAa/jB,IAAczK,EAIjC,MAAO,CACLL,GAAIqd,EACJM,KAAM,cACNN,OACAF,YACA0W,cACA/oB,YACAyb,OAAQsI,EAAatI,GAAUA,EAC/B1I,KAbW8D,GAAey3C,EAAAA,IAAInlD,MAAO0lB,EAAUt5B,SAc/CwuB,aACAD,kBAbwBC,EAAagF,EAAc/oB,EAcnD0oB,IAbU,GAed,CA3J0CmnC,CAAyBt6D,EAASkmC,IAC1E,CACF,CAEO36C,eAAegvE,GACpB96D,EACAiwB,EACAD,EACAkpB,GAEA,MAAMjR,SAAgBrxC,QAAQipB,IAAI,CAChCw5C,GAAyBr5D,EAAWs5D,EAAAA,IAAIv7C,KAAMkS,OAAa5iC,EAAW2iC,MACnEkpB,EAAWj4C,KAAK8c,GAASs7C,GAC1Br5D,EAAW+d,EAAMkS,OAAa5iC,EAAW2iC,QAEzC3sB,QAAQ6kC,GAAUA,EAAM77C,SAE5B,IAAK47C,EAAO57C,OACV,MAAO,GAKT,MAAM0uE,EAAY9yB,EAAOpmC,QAAO,CAACm5D,EAAW9yB,IACtC8yB,EAAU3uE,OAAS67C,EAAM77C,OAAe2uE,EACxCA,EAAU3uE,OAAS67C,EAAM77C,QACzB2uE,EAAUA,EAAU3uE,OAAS,GAAGgxB,UAAY6qB,EAAMA,EAAM77C,OAAS,GAAGgxB,UAD5B6qB,EAErC8yB,GACN,IAEG9qC,EAAgB6qC,EAAUA,EAAU1uE,OAAS,GAAGgxB,WAE/C49C,KAAaC,GAAejzB,EAEnC,OAAOkzB,GAAgBF,KAAaC,GACjC73D,QAAOpB,IAAA,IAAC,UAAEob,GAAWpb,EAAA,OAAKob,GAAa6S,CAAa,GACzD,CAyHO,SAASirC,GAAgBC,GAC9B,MAAMp4D,EAAwB,GACxBq4D,EAAc,IAAIl4D,IAClBm4D,EAAY74D,EAAqB24D,EAAQ,MAAM,QAAAlrD,EAAA5Y,UAAAjL,OAHGkvE,EAAQ,IAAAz+D,MAAAoT,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAARorD,EAAQprD,EAAA,GAAA7Y,UAAA6Y,GAKhE,IAAK,MAAMqrD,KAAeD,EACxB,IAAK,MAAME,KAAWD,EAAa,CAGjC,GAAIH,EAAY/3D,IAAIm4D,EAAQv7D,IAC1B,SAGFm7D,EAAYj/D,IAAIq/D,EAAQv7D,IACxB8C,EAAO9H,KAAKugE,GAEZ,MAAMC,EAAQJ,EAAUG,EAAQv7D,IACX,gBAAjBu7D,EAAQ59C,MAA0C,iBAAhB69C,aAAK,EAALA,EAAO79C,QAC3C49C,EAAQ/nC,IAAMgoC,EAAMhoC,IAExB,CAGF,IAAK,MAAMgoC,KAASN,EACdC,EAAY/3D,IAAIo4D,EAAMx7D,MAIP,gBAAfw7D,EAAM79C,MAA0B69C,EAAM1wD,aACxCqwD,EAAYj/D,IAAIs/D,EAAMx7D,IACtB8C,EAAO9H,KAAKwgE,IAIhB,OAAO14D,EAAO2tB,KAAKzT,GACrB,CC1NOpxB,eAAe29C,GAAiBtpC,EAAqBI,GAC1D,MAAMo7D,EAAUhD,GAAcx4D,GAC9B,OAAO3B,aAAam9D,EAAQ1C,IAAI2C,sBAAsBr7D,GACxD,CAEOzU,eAAe+vE,GAAgB17D,EAAqBuI,EAAsBnI,GAC/E,MAAMyC,QAWDlX,eACL6vE,EACAp7D,EACAu7D,GAGA,IAFA3B,EAAiB7iE,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,GACpBykE,EAAqBzkE,UAAAjL,OAAA,EAAAiL,UAAA,QAAAjK,EAErB,IACE,MAAM2V,QAAe24D,EAAQK,mBAAmBC,qBAC9C17D,EACAu7D,EACA,CAAEI,aAAa,GACf/B,EACA4B,GAEF,OAAO/4D,GAAUA,EAAOA,OAASA,EAAOm5D,gBAAkB,EAC5D,CAAE,MAAOjvE,GAEP,OADA8C,EAAAA,EAAAA,IAAc,eAAgB9C,GACvB,EACT,CACF,CA/BuBkvE,CAAazD,GAAcx4D,GAAUuI,EAAc,qBAAsB,CAC5F,CAAE7b,KAAM,UAAWC,MAAOyT,IACzBA,GAEH,OAAKyC,EAAO3W,OAILmS,OAAO,KAAKwE,EAAO,MAHjB,EAIX,CCDA,MAAMywD,IAAmCC,EAAAA,EAAAA,MAElC,SAASC,GACd3zD,EACAyU,EACA7E,EACAgkD,EACAC,GAEA,KAAM,SAAUp/C,KAAaA,EAAQC,KACnC,MAAO,OAGT,MAAM,QAAEnU,GAAYkU,EAAQC,KAEtB2nD,EAAiBC,GACrBt8D,EACAO,EACAqP,EACAgkD,EAAuBhhD,UAAKvlB,EAAW,YAEnCkvE,EA0FR,SACEv8D,EACA6zD,EACAjkD,EACAgkD,GAEA,MAAM,QAAEzzD,GAAYJ,EAAeC,IAC7B,YAAEw8D,GAAgBpvB,GAAe,QAAQjtC,GACzCs8D,EAAW56C,GAAe,OAAQ26C,GAClCE,EAAQ,CAACpD,EAAAA,IAAIv7C,KAAM0+C,GAkBzB,MAAO,CAAEj7D,OAhBT1V,iBACE8nE,GAAuB,GAEvB,IAEIC,EADEp1C,GAAco1C,SA2CxB/nE,eACEkU,EACAk5C,EACAtpC,GAEA,MAAM5M,EAAgC,CAAC,EACjCyd,EAAwC,CAAC,EAEzCwnB,QAAerxC,QAAQipB,IAAIq5B,EAAWj4C,KAAInV,UAAgB,IAAA6wE,EAC9D,IAAI1rC,QAAkCooC,GACpCr5D,EAAW+d,OAAM1wB,OAAWA,EAAWquC,IAQzC,OALAzK,QAAmBu+B,GAAiBxvD,EAAWixB,EAAYlT,GAAM,GAEjE/a,EAAO+a,GAAqB,QAAhB4+C,EAAG1rC,EAAW,UAAE,IAAA0rC,OAAA,EAAbA,EAAet/C,UAC9BoD,EAAO1C,GAAQkT,EAERA,CAAU,MAGZgqC,KAAaC,GAAejzB,EAC7B4sB,EAAiBsG,GAAgBF,KAAaC,GAcpD,OAZArG,EAAejqE,QAAQ8D,UAAUF,SAASkmD,IACxC4c,GAAY/2B,aAAama,EAAY,IAGvC9kC,EAAS,CACP/iB,KAAM,oBACNsnB,MAAO,OACPnU,YACA60D,iBACAp0C,WAGKzd,CACT,CA/EyCkyD,CAAsBl1D,EAAW08D,EAAO9sD,SAiFjF9jB,eACEkU,EACA6zD,EACA3a,EACAtpC,GAEA,MAAM5M,EAAgC,CAAC,EAEjCilC,QAAerxC,QAAQipB,IAAIq5B,EAAWj4C,KAAInV,UAAgB,IAAA8wE,EAC9D,IAAIhI,EAA0Bf,EAAyB91C,GACvD,MAAMkT,QAAkCooC,GACtCr5D,EAAW+d,OAAM1wB,EAAWunE,EAAyBl5B,IAKvD,OAFAk5B,GAAuC,QAAbgI,EAAA3rC,EAAW,UAAE,IAAA2rC,OAAA,EAAbA,EAAev/C,YAAau3C,EACtD5xD,EAAO+a,GAAQ62C,EACR3jC,CAAU,MAGZgqC,KAAaC,GAAejzB,EACnC,IAAIhX,EAAakqC,GAAgBF,KAAaC,GAkB9C,OAhBAjqC,QAAmBu+B,GAAiBxvD,EAAWixB,OAAY5jC,GAAW,GAEtE4jC,EAAWrmC,QAAQ8D,UAAUF,SAASovB,IACpC0zC,GAAY/2B,aAAa3c,EAAS,IAGhCqT,EAAW5kC,OAAS,GACtBujB,EAAS,CACP/iB,KAAM,gBACNsnB,MAAO,OACP8c,aACAwT,kBAAmB,GACnBzkC,cAIGgD,CACT,CAtHyC65D,CAAkB78D,EAAW6zD,EAA0B6I,EAAO9sD,EAEnG,CAAE,MAAO1iB,IACP8C,EAAAA,EAAAA,IAAc,8BAA+B9C,EAC/C,CAAE,QACA0mE,GAAuB,EACzB,CACF,EAGF,CAtH0ByB,CACtBr1D,EACA6zD,EACAjkD,EACAgkD,EAAuBhhD,UAAKvlB,EAAW,eAGzC,IAAIyvE,GAAgB,EAoBpB,MAAMtE,EAAgB,IAAItH,GAAc,IACnCt1B,GACHznB,MAAO,OACPhU,QAASJ,EAAeC,GAAWG,QACnCI,UACAqP,SAvBF9jB,eAA4BulE,GACtBA,GAAeyL,QACXlmE,QAAQipB,IAAI,CAChBw8C,EAAe76D,SACf+6D,EAAgB/6D,iBAKc66D,EAAe76D,gBAEvC+6D,EAAgB/6D,SAI1Bs7D,GAAgB,CAClB,IAUA,MAAO,KACLtE,EAAcxoD,SAAS,CAE3B,CAEA,SAASssD,GACPt8D,EACAO,EACAqP,EACAgkD,GAEA,MAAM,QAAEzzD,GAAYJ,EAAeC,IAC7B,YAAEw8D,GAAgBpvB,GAAe,QAAQjtC,GACzCs8D,EAAW56C,GAAe,OAAQ26C,GAExC,IAAIl4C,EAqCJ,MAAO,CAAE9iB,OAlCT1V,iBACE8nE,SAAAA,GAAyB,GAEzB,IACE,MAAOmJ,EAAYC,SAAqBpmE,QAAQipB,IAAI,CAClD4pB,GAAiBtpC,EAASI,GAC1Bs7D,GAAgB17D,EAASq8D,EAAaj8D,KAElC83D,EAAc,CAClB,CAACiB,EAAAA,IAAIv7C,MAAOg/C,EACZ,CAACN,GAAWO,GAER1E,GAAc9qC,GAAalJ,EAAU+zC,GAY3C,OAXA/zC,EAAW+zC,EAEPC,GACF1oD,EAAS,CACP/iB,KAAM,iBACNmT,YACAmU,MAAO,OACPmQ,aAIGg0C,CACT,CAAE,MAAOprE,IACP8C,EAAAA,EAAAA,IAAc,6BAA8B9C,EAC9C,CAAE,QACA0mE,SAAAA,GAAyB,EAC3B,CAEA,OAAO,CACT,EAGF,CAgCO,SAAS2E,GACdv4D,EACAyU,EACA7E,GAEA,KAAM,SAAU6E,KAAaA,EAAQC,KACnC,MAAO,OAGT,MAAM,QAAEnU,GAAYkU,EAAQC,KAEtB2nD,EAAiBC,GAAoBt8D,EAAWO,EAASqP,GAEzD4oD,EAAgB,IAAItH,GAAc,IACnC90B,GACHjoB,MAAO,OACPhU,QAASJ,EAAeC,GAAWG,QACnCI,UACAqP,SAAU6jD,GAAiCsB,MAAKjpE,gBACxCuwE,EAAe76D,QAAQ,MAIjC,MAAO,KACLg3D,EAAcxoD,SAAS,CAE3B,CClMO,MAAMitD,GAAW,CACtBC,uBAAwB,WAGbC,GAAU,gCCgBvB,MAAMC,GAAiB,GAEhBtxE,eAAequD,GACpBhgC,GAEA,MAAM,UACJna,EAAS,OAAEymB,EAAM,UAAEzb,EAAS,aAAEtC,GAC5ByR,GACE,QAAEha,GAAYJ,EAAeC,GAE7B27D,EAAUhD,GAAcx4D,GACxB6C,EAAyC,CAAC,EAEhD,IACE,IAAK24D,EAAQ0B,UAAUryD,GACrB,MAAO,CAAElb,MAAO2qD,EAAAA,GAAyBsB,kBAG3C/4C,EAAO6kC,gBAAkB78B,EAEzB,MAAM,QAAEzK,SAAkBiU,GAAsBxU,IACzC+8D,EAAYO,GAAW,cAAEpE,EAAa,iBAAEE,UAA4BxiE,QAAQipB,IAAI,CACrF4pB,GAAiBtpC,EAASI,GAC1Bo7D,EAAQ1C,IAAIsE,aAAah9D,GACzBw4D,GAAmB54D,KAGrB,IAAIuzB,EAEJ,GAAIhrB,EACFgrB,QAyGN5nC,eAAwC6vE,EAAkBxhD,GAQxD,MAAM,QACJha,EAAO,aAAEuI,EAAY,UAAEsC,EAAS,cAAEkuD,EAAa,YAAEnlC,GAC/C5Z,EAEJ,IAAI,OAAEsM,GAAWtM,EACjB,MAAMyhC,QAAqBigB,GAAgB17D,EAASuI,EAAcqrB,GAElE,IAAK6nB,EACH,OAAOqhB,GAASC,6BAGH7vE,IAAXo5B,GAAwBA,EAASm1B,KACnCn1B,EAAS,IAKX,MAAQ+2C,gBAAiBC,SAAyB9B,EAAQK,mBAAmB0B,eAC3Eh1D,EACA,4BACA,CAAC,EACD,CACE,CAAE7b,KAAM,UAAWC,MAAOke,GAC1B,CAAEne,KAAM,UAAWC,MAAOwQ,OAAOmpB,KAEnCsN,GAGF,OAAOv1B,OAAO06D,EAAgBuE,EAChC,CA9IkBE,CAAyBhC,EAAS,CAC5Cx7D,UACA6K,YACAtC,eACA+d,SACAyyC,gBACAnlC,YAAaxzB,QAEV,CAGL,MAAOm0C,EAAajgC,SAAiB7d,QAAQipB,IAAI,CAC/C87C,EAAQK,mBAAmB4B,QAAQ5yD,EAAW1N,OAAOmpB,GAAU,GAAIlmB,GACnEo7D,EAAQ1C,IAAI4E,WAAW7yD,KAGnBlM,EAAO,GAAS/P,GAAOC,KAAK0lD,EAAYopB,aAAc,OAAOC,WAAaX,GAChF1pC,EAAM4pC,EAAYx+D,EAAO,GAAKN,OAAOM,GAAQN,OAAO46D,QAG5B/rE,IAApBonB,EAAQqO,UACV4Q,GAAOypC,GAEX,CAcA,OAZAn6D,EAAO0wB,IAAMA,EACb1wB,EAAOixC,QAAUvgB,EAGGqpC,IADFr0D,EAAegrB,GAAOjN,GAAU,IAAMiN,KAItD1wB,EAAOlT,MAAQ2qD,EAAAA,GAAyBoB,qBAKnC74C,CACT,CAAE,MAAO9V,GAEP,OADA8C,EAAAA,EAAAA,IAAc,6BAA8B9C,GACrC,KACF4uD,EAAAA,GAAAA,IAAkB5uD,MAClB8V,EAEP,CACF,CAEOlX,eAAeuwD,GAAeliC,GACnC,MAAM,UACJna,EAAS,SAAEkW,EAAQ,UAAElL,EAAS,OAAEyb,EAAM,IAAEiN,EAAM,GAAE,aAAEhrB,GAChDyR,GAEE,QAAEha,GAAYJ,EAAeC,GAEnC,IACE,MAAM27D,EAAUhD,GAAcx4D,GAExBsU,QAAgBL,GAA2CpU,IAC3D,QAAEO,GAAakU,EAA4BC,KAMjD,WALyB+0B,GAAiBtpC,EAASI,KAEjCmI,EAAegrB,EAAMA,EAAMjN,IAI3C,MAAO,CAAE32B,MAAOysD,EAAAA,GAAoBV,qBAKtC,MAAMx7C,QAAiB+X,GAAYpY,EAAWkW,EAAUzB,GAClDq3B,EAAa6vB,EAAQqC,aAAa39D,EAAU1R,KAAK,MAAMm9C,WAAWlhD,MAAM,GAE9E,GAAI8d,EAAc,CAChB,MAAM,YAAEgsC,SAsEd5oD,eAAkC6vE,EAAkBxhD,GAOlD,MAAM,OACJsM,EAAM,aAAE/d,EAAY,UAAEsC,EAAS,SAAEizD,EAAQ,YAAElqC,GACzC5Z,GAEE,YAAEu6B,SAAsBinB,EAAQK,mBAAmBC,qBACvDvzD,EACA,4BACA,CAAEu1D,SAAU3gE,OAAO2gE,IACnB,CACE,CAAEpxE,KAAM,UAAWC,MAAOke,GAC1B,CAAEne,KAAM,UAAWC,MAAOwQ,OAAOmpB,KAEnCsN,GAGF,MAAO,CAAE2gB,cACX,CA7FoCwpB,CAAmBvC,EAAS,CACxD3wD,YAAWtC,eAAc+d,SAAQw3C,SAAUvqC,EAAKK,YAAaxzB,IAGzD49D,QAAiBxC,EAAQ1C,IAAIjrB,KAAK0G,EAAa5I,GAGrD,MAAO,CAAErlB,SAAQzb,YAAWuS,YAFPo+C,EAAQ1C,IAAImF,mBAAmBD,IAEXzpB,YAAYmlB,KACvD,CAAO,CACL,MAAM72D,QAAe24D,EAAQ1C,IAAIoF,gBAAgBrzD,EAAW1N,OAAOmpB,GAAS,CAC1EqlB,eAGF,GAAI,SAAU9oC,MAAY,WAAYA,KAAUA,EAAOA,QAAS,CAC9D,MAAMlT,EAAQ,YAAakT,GAAUA,EAAO1T,QC1H7C,SAAqBiW,GAC1B,IAAIvC,EAAS,GACb,IAAK,IAAIhV,EAAI,EAAGA,EAAIuX,EAAIlZ,OAAQ2B,GAAK,EACnCgV,GAAU5U,OAAOC,aAAauT,SAAS2D,EAAI3a,MAAMoD,EAAGA,EAAI,GAAI,KAG9D,OAAOgV,CACT,CDoHYs7D,CAAYt7D,EAAO1T,SACnB0T,EAAOi9B,KAAK50C,WAIhB,OAFA2E,EAAAA,EAAAA,IAAc,iBAAkB,CAAEF,QAAOkT,WAElC,CAAElT,QACX,CAEA,MAAO,CAAE22B,SAAQzb,YAAWuS,KAAMva,EAAO0xC,YAAYmlB,KACvD,CACF,CAAE,MAAO3sE,GAEP,OADA8C,EAAAA,EAAAA,IAAc,iBAAkB9C,GACzB,CAAE4C,MAAOysD,EAAAA,GAAoBiB,oBACtC,CACF,CEhJO,SAASnR,GAA2BlsC,EAAqBE,GAC9D,MAAM,QAAEE,EAAO,UAAEooC,GAAcgwB,GAAcx4D,GAAS69D,aAAa39D,EAAS1R,KAAK,MACjF,MAAO,CACL9B,KAAM,OACN0T,UACAooC,YACAzmC,MAAO,EAEX,CAEO,SAAS0rD,GAAqBztD,GACnC,MAAM8+B,EAAc05B,GAAcx4D,GAAS8+B,cAC3C,OAAOt7B,QAAQs7B,EACjB,CCnBA,UACE1qB,IAAG,EACHG,KAAIA,GCMA6pD,GAED,CAAC,EAQCzyE,eAAe0yE,GAAgC9pE,GAAwC,QAAAwb,EAAA5Y,UAAAjL,OAA5BwZ,EAAI,IAAA/I,MAAAoT,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJtK,EAAIsK,EAAA,GAAA7Y,UAAA6Y,GACpE,IAAK,MAAMsuD,KAAQF,GAAM7pE,IAAS,GAChC,UAEQ+pE,KAAQ54D,EAChB,CAAE,MAAO3Y,IACP8C,EAAAA,EAAAA,IAAc,aAAa0E,IAAQxH,EACrC,CAEJ,CCzBOpB,eAAe4yE,KACpB,aAAcnqE,GAAQ0d,QAAQ,iBAAoBuO,EAAAA,GACpD,CAEO,SAASm+C,GAAgBC,GAC9B,OAAOrqE,GAAQ6d,QAAQ,eAAgBwsD,EACzC,CCXA,IAAIC,GACJ,MAAMC,GAAiB,IAAIloE,SAAeC,IACxCgoE,GAAiBhoE,CAAO,IAGnB,SAASkoE,KACdF,IACF,CAEO/yE,eAAekzE,WACdF,EACR,CCLA,MAAM,IAAEvqD,IAAQ0qD,GAIT,SAASvnB,GAAW13C,EAAmBO,GAC5C,MAAM,QAAEJ,GAAYJ,EAAeC,GACnC,OAAOuU,GAAImjC,WAAWv3C,EAASI,EACjC,CAEO,SAASiI,GAA0BrI,EAAqBI,EAAiBmI,GAG9E,OAFcu2D,GAAO1qD,IAER/L,0BAA0BrI,EAASI,EAASmI,EAC3D,CAEO,SAASM,GAAoB7I,EAAqB8I,GAGvD,OAFcg2D,GAAO1qD,IAERvL,oBAAoB7I,EAAS8I,EAC5C,CAEO,SAASi2D,GAA0Bx2D,EAAsB8vC,GAC9D,MAAMrkC,EAAQ8qD,GAAO1qD,IACf2M,EAAQU,GAAkBlZ,GAEhC,OAAOyL,EAAMuiC,4BAA4Bx1B,EAAOs3B,EAClD,CCNA,IAAI5oC,GAEJ,MAAQ2E,IAAG,QAAEG,IAASuqD,GAEf,SAASE,GAAiBC,GAC/BxvD,GAAWwvD,CACb,CAEOtzE,eAAeqnD,GACpBnzC,EACAmU,EACA4J,EACAmS,EACAF,GAEA,IAAIiB,EAEJ,IAaE,OAXEA,EADY,QAAV9c,QACiB8qD,GAAO9qD,GAAOg/B,mBAC/BnzC,EAAW+d,EAAMmS,OAAe7iC,EAAW2iC,SAG1BivC,GAAO9qD,GAAOklD,yBAC/Br5D,EAAW+d,EAAMmS,OAAe7iC,EAAW2iC,GAI/CiB,QAAmBu+B,GAAiBxvD,EAAWixB,EAAYlT,GAEpDkT,CACT,CAAE,MAAO/jC,GAEP,OADA8C,EAAAA,EAAAA,IAAc,qBAAsB9C,IAC7B4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CAEOpB,eAAeuzE,GACpBr/D,EACAgwB,EACAC,EACAqvC,GAEA,IACE,MAAM7qD,QAAgBL,GAAmBpU,IAElCu/D,EAAeC,SAAwB5oE,QAAQipB,IAAI,CACxD,QAASpL,EAAUF,GAAI4+B,mBAAmBnzC,OAAW3S,EAAW4iC,OAAa5iC,EAAW2iC,GAAS,GACjG,SAAUvb,EAAUC,GAAKomD,uBAAuB96D,EAAWiwB,EAAaD,EAAOsvC,GAAkB,KAG7FruC,E7EyFH,SAAkC3sB,EAAuBC,GAC9D,IAAKD,EAAOjY,SAAWkY,EAAOlY,OAC5B,MAAO,GACF,IAAKiY,EAAOjY,QAAUkY,EAAOlY,OAClC,OAAOkY,EACF,IAAKA,EAAOlY,QAAUiY,EAAOjY,OAClC,OAAOiY,EAGT,MAAM4rB,EAAgBxzB,KAAKsuD,IACzB1mD,EAAOA,EAAOjY,OAAS,GAAGgxB,UAC1B9Y,EAAOA,EAAOlY,OAAS,GAAGgxB,WAG5B,MAAO,IAAI/Y,KAAWC,GACnBlB,QAAOi8C,IAAA,IAAC,UAAEjiC,GAAWiiC,EAAA,OAAKjiC,GAAa6S,CAAa,IACpDS,KAAKzT,GACV,C6E1GuBuiD,CAAyBF,EAAeC,GAE3D,aAAahQ,GAAiBxvD,EAAWixB,EAC3C,CAAE,MAAO/jC,GAEP,OADA8C,EAAAA,EAAAA,IAAc,wBAAyB9C,IAChC4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CAEO,SAASitD,GAAsBhmC,EAAiBgG,GACrD,OAAO8kD,GAAO9qD,GAAOgmC,sBAAsBhgC,EAC7C,CAEOruB,eAAeuwD,GACpBloC,EACAgG,GAE4F,IAD5FulD,IAAyBpoE,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,KAAAA,UAAA,GAEzB,MAAM,UACJ0I,EAAS,SACTkW,EAAQ,UACRlL,EAAS,OACTyb,EAAM,aACN/d,EAAY,QACZuD,EAAO,IACPynB,EAAG,QACHugB,EAAO,cACPmG,EAAa,aACbC,EAAY,WACZkE,EAAU,aACV5B,EAAY,mBACZC,GACEziC,EACE87B,EAAyC,iBAAtB97B,EAAQ87B,UAAyB7rC,GAAAA,KAAKksB,WAAWnc,EAAQ87B,WAAa97B,EAAQ87B,UAEjGliB,QAAoB7f,GAAmBlU,EAAWmU,GAExD,IAAInR,EA6BJ,GA1BEA,EADEu7C,GAAwB,QAAVpqC,QACDI,GAAImoC,yBAAyB,CAC1C18C,YACAkW,WACAlL,YACAyb,SACA/d,aAAcA,EACdpG,KAAM2J,EACNmuC,gBACAuC,aAAcA,EACdC,6BAGaqiB,GAAO9qD,GAAOkoC,eAAe,CAC1Cr8C,YACAkW,WACAlL,YACAyb,SACA/d,eACApG,KAAM2J,EACNmuC,gBACAC,eACApE,YACAviB,QAIA,UAAW1wB,EACb,OAAOA,EAGT,IAAK08D,EACH,OAAO18D,EAGT,MAAM+a,EAAOrV,EACTmZ,GAAe1N,EAAOzL,GACtB0kC,GAAej5B,GAAOq5B,YAAYzvB,KAEtC,IAAI4hD,EAEJ,GAAI,YAAa38D,EAAQ,CACvB,MAAM,iBAAEujB,EAAgB,kBAAEgqB,GAAsBvtC,GAC/C28D,GAAiBC,GAAwB5/D,EAAWmU,EAAO,CAAC,CAC3DoJ,KAAMgzB,EACN9pB,SACAsN,cACA/oB,YACAiB,QAASmuC,OAAgB/sD,EAAY4e,EACrCsa,mBACAmN,IAAKugB,GAAW,GAChBl2B,OACAsa,oBAAqBkY,EACrB/d,MAAO,IACD,kBAAmBxvB,GAAU,CAAEi6C,cAAej6C,EAAOi6C,mBAGzD,gBAAiBj6C,GAAUA,EAAO4tC,aACpChhC,GAAS,CAAE/iB,KAAM,UAAW6tB,IAAK1X,EAAO4tC,YAAaivB,YAAY,GAErE,KAAO,CACL,MAAM,KAAEtiD,GAASva,GAChB28D,GAAiBC,GAAwB5/D,EAAWmU,EAAO,CAAC,CAC3DoJ,OACAkJ,SACAsN,cACA/oB,YACAiB,UACAynB,IAAKugB,GAAW,GAChBl2B,SAEJ,CAEA,MAAO,IACF/a,EACHua,KAAMoiD,EAAcpiD,KAExB,CAEOzxB,eAAeg0E,GAAgC9/D,GACpD,MAAM,QAAEG,GAAYJ,EAAeC,IAC7B,QAAEO,SAAkB8T,GAAqBrU,GAE/C,aAAckxC,GAA6B/wC,EAASI,IAAUL,EAChE,CAEOpU,eAAei0E,GACpB//D,EACA1Q,EACAkxD,GAEA,MAAM,kBAAEjQ,SAA4Bh8B,GAAIgsC,kBAAkBvgD,EAAW1Q,EAASkxD,IAEvEmf,GAAiBC,GAAwB5/D,EAAW,MAAO,CAAC,IAC9D1Q,EAAQqwE,cACXpiD,KAAMgzB,EACNlY,oBAAqBkY,KAGvB,OAAOovB,EAAcpiD,IACvB,CAEO,SAASyiD,GAAsB9/D,GAAY,IAAA+/D,EAC1B,QAAtBA,EAAA5uB,GAAmBnxC,UAAG,IAAA+/D,GAAtBA,EAAwBppE,SAC1B,CAEO,SAASkqD,GAAe/gD,EAAmBumB,EAA0BwN,EAAqB7d,GAG/F,OAFc+oD,GAAO1qD,IAERwsC,eAAe/gD,EAAWumB,EAAkBwN,EAAa7d,EACxE,CAEO,SAAS0pD,GACd5/D,EACAmU,EACAtJ,GAEA,MAAM,QAAE1K,GAAYJ,EAAeC,GAE7BkgE,EAAoBr1D,EAAO5J,KAAI,CAACk/D,EAAWj+D,KAC/C,MAAM,UAAE8I,GAAcm1D,EAEtB,IAAIrxC,EASJ,OAPEA,EADEqxC,EAAUrxC,kBACQqxC,EAAUrxC,kBACX,QAAV3a,EACWI,GAAI6zB,iBAAiBp9B,EAAW7K,GAEhC6K,EjE7MnB,SACLH,EACAikB,EACAtR,GAEA,MAAM,OAAEiJ,KAAW25C,GAAev1D,EAC5B0S,EAAOE,GAAe5S,EAAO0S,MAAQ1S,EAAOwtB,oBAAsB7a,GAExE,OAAOqR,GAAuB,CAC5B3uB,GAAIqd,EACJY,WAAW,EACXN,KAAM,cACNR,UAAW5lB,KAAK6X,MAChByf,YAAY,EACZtI,QAASA,EACTqI,uBACGsxC,EACH7iD,QAEJ,CiE6LW8iD,CAAsBF,EAAWrxC,EAAmB5sB,EAAM,IAWnE,OARIg+D,EAAkB7zE,QACpBujB,GAAS,CACP/iB,KAAM,qBACNokC,WAAYivC,EACZlgE,cAIGkgE,CACT,CAEO,SAASlf,GAAoBhhD,EAAmB0I,GAGrD,OAFcu2D,GAAO1qD,IAERysC,oBAAoBhhD,EAAW0I,EAC9C,CAEO5c,eAAew0E,GAAwBtgE,EAAmB4d,GAC/D,MAAM5a,QAAei8D,GAAO1qD,IAAI8+B,qBAAqBrzC,EAAW4d,GAChE,OAAO5a,aAAM,EAANA,EAAQ4a,WAAYA,CAC7B,CAMO,SAAS2iD,GACdvgE,EACAmU,EACAo8B,EACAiwB,GAEA,MAAMC,EAAiC,GACvC,IAAIC,EAAqB,EA4BzB,OA1BAF,EAAoBhyE,SAASovB,IAC3B,GAAIA,EAASuV,YAAcvV,EAAS1d,KAAOy7B,GACzC,OAGF,MAAMgkC,EA2BV,SACE/hD,EACA2yB,EACAruC,EACAiS,EACAnU,GAEA,MAAM2gE,EAAYljD,GAAe8yB,EAAmBruC,GAEpD,GAAsB,gBAAlB0b,EAASC,KAAwB,CACnC,IAAIiR,EAAoBlR,EAASkR,kBACjC,IAAKA,GAA+B,QAAV3a,GAAmBnU,EAAW,CACtD,MAAM,QAAEG,GAAYJ,EAAeC,GACnC8uB,EAAoBmwC,GAAO1qD,IAAI6zB,iBAAiBxqB,EAAS5S,UAAW7K,EACtE,CAEA,MAAO,IACFyd,EACH1d,GAAIygE,EACJpjD,KAAMojD,EACNtjD,UAAW5lB,KAAK6X,MAChB+oB,oBAAqBkY,EACrBzhB,kBAAmBA,GAAqBlR,EAASkR,kBACjD3Q,WAAW,EAEf,CACE,MAAO,IACFP,EACH1d,GAAIygE,EACJtjD,UAAW5lB,KAAK6X,MAChB+oB,oBAAqBkY,EACrBryB,OAAQ,UAGd,CA7D0B0iD,CACpBhjD,EACA2yB,EACAmwB,EACAvsD,EACAnU,GAGFygE,EAAgBvlE,KAAKykE,GAErBe,GAAoB,IAGlBD,EAAgBp0E,QAClBujB,GAAS,CACP/iB,KAAM,qBACNokC,WAAYwvC,EACZzgE,cAIGygE,CACT,CC/RA,MAAQlsD,IAAGA,IAAK0qD,GAET,SAAS4B,KAChB,CAEO,SAAS5Z,GAAgBjnD,EAAmBymB,EAAgB/D,GACjE,OAAOnO,GAAI0yC,gBAAgBjnD,EAAWymB,EAAQ/D,EAChD,CAEO,SAASykC,GAAkBnnD,EAAmBymB,EAAgB/D,GACnE,OAAOnO,GAAI4yC,kBAAkBnnD,EAAWymB,EAAQ/D,EAClD,CAEO52B,eAAe67D,GACpB3nD,EACAkW,EACAuQ,EACA/D,EACAuxB,GAEA,MAAQ1zC,QAASwzB,SAAsB1f,GAAqBrU,GAEtDgD,QAAeuR,GAAIozC,YACvB3nD,EAAWkW,EAAUuQ,EAAQ/D,GAG/B,GAAI,UAAW1f,EACb,OAAO,EAGT,IAAI28D,EA0BJ,OAxBIj9C,EAAM0wB,UAAc30C,EAAAA,IAAQsf,MAC7B4hD,GAAiBC,GAAwB5/D,EAAW,MAAO,CAAC,CAC3Dud,KAAMva,EAAOutC,kBACb9pB,SACAsN,cACA/oB,UAAWhI,EAAOgI,UAClB0oB,IAAKugB,GAAW,GAChBpnD,KAAM,QACNkxB,KAAM2E,EAAM0wB,UACZ/a,oBAAqBr1B,EAAOutC,qBAezB,IACFvtC,EACHua,KAAMoiD,EAAcpiD,KAExB,CAEOzxB,eAAe+7D,GACpB7nD,EACAkW,EACAuQ,EACA/D,EACAuxB,GAEA,MAAQ1zC,QAASwzB,SAAsB1f,GAAqBrU,GAEtDgD,QAAeuR,GAAIszC,cAAc7nD,EAAWkW,EAAUuQ,EAAQ/D,GACpE,GAAI,UAAW1f,EACb,OAAO,EAGT,MAAO28D,GAAiBC,GAAwB5/D,EAAW,MAAO,CAAC,CACjEud,KAAMva,EAAOutC,kBACb9pB,OAAQzjB,EAAOwzC,cACfziB,cACA/oB,UAAWhI,EAAOgI,UAClB0oB,IAAKugB,GAAW,GAChBpnD,KAAM,iBACNkxB,KAAMtf,EAAAA,IAAQsf,KACdsa,oBAAqBr1B,EAAOutC,qBACzBvtC,EAAOklD,uBAGZ,MAAO,IACFllD,EACHua,KAAMoiD,EAAcpiD,KAExB,CAEOzxB,eAAeg1E,GAAkB9gE,GACtC,MAAQuU,IAAK42B,SAAoB/2B,GAAmBpU,GACpD,OAAKmrC,EACE/vB,GAAe,oBAAoB+vB,EAAU5qC,WAD7B,EAEzB,CAEOzU,eAAei1E,KACpB,IACE,MAAMl3D,EAAYhC,GAAa,WACzByJ,QAAiB8J,GAAyC,mBAE1D9Y,EAA6B,IAC9BgP,EACH+1C,OAAQ,IACH/1C,EAAS+1C,OACZ+D,UAAW9sD,EAAYgT,EAAS+1C,OAAO+D,YAEzCrC,kBAAmBnyD,QAAQipB,IAAIvO,EAASy3C,YAAY9nD,KAAInV,UACtD,MAAMk1E,EAAen3D,EAAUjB,KAAKmB,GAAAA,GAAYC,kBAAkBxe,GAAAA,QAAQC,MAAMqe,EAAKA,QAC/Eg/C,QAAmBkY,EAAavU,iBACtC,MAAO,IACF3iD,EACHg/C,aACD,MAGLxmD,EAAK3J,MAAMmL,OAAS,IACpBxB,EAAK3J,MAAMoL,KAAO,IAClBzB,EAAK3J,MAAM4wD,QAAU,IACrBjnD,EAAKgnD,UAAUxlD,OAAS,IACxBxB,EAAKgnD,UAAUvlD,KAAO,IACtBzB,EAAKgnD,UAAUC,QAAU,I9B/HtB,SAA+BjnD,GACpC+jD,GAAqB/jD,EACrBgkD,GAA2BzvD,SAC7B,C8B8HIoqE,CAAsB3+D,EACxB,CAAE,MAAOpV,IACP8C,EAAAA,EAAAA,IAAc,8BAA+B9C,EAC/C,CACF,CAEOpB,eAAeo1E,GACpBlhE,EACAkW,EACAwM,EACAuxB,GAEA,MAAQ1zC,QAAS0J,SAAwBoK,GAAqBrU,GAE9D,IAAIgD,EAEJ,OAAQ0f,EAAM71B,MACZ,IAAK,SACHmW,QAAeuR,GAAI84C,wBAAwBrtD,EAAWkW,EAAUwM,GAChE,MAEF,IAAK,SACH1f,QAAeuR,GAAI+4C,0BAA0BttD,EAAWkW,EAAUwM,GAKtE,GAAI,UAAW1f,EACb,OAAOA,EAGT,MAAO28D,GAAiBC,GAAwB5/D,EAAW,MAAO,CAAC,CACjEud,KAAMva,EAAOutC,kBACb9pB,OAAQzjB,EAAOyjB,OACfsN,YAAa9pB,EACbe,UAAWhI,EAAOgI,UAClB0oB,IAAKugB,GAAW,GAChBl2B,KAAMtf,EAAAA,IAAQsf,KACdsa,oBAAqBr1B,EAAOutC,qBACzBvtC,EAAOklD,uBAGZ,MAAO,IACFllD,EACHua,KAAMoiD,EAAcpiD,KAExB,wBCtLA,MAAM4jD,GAAepyE,GAAOC,KAAK,oCAE1B,SAAS4+D,GAAqBz5C,EAAiBhU,GACpD,OAAO8+D,GAAO9qD,GAAOy5C,qBAAqBztD,EAC5C,CAEOrU,eAAes1E,GAAoBphE,EAAmBkW,GAC3D,MAAMmrD,QAAsBhtD,GAAqBrU,GACjD,IAAI,UAAEoa,GAAcinD,EACpB,MAAM,UAAE14B,EAAS,cAAE5lB,GAAkBs+C,EAErC,IAAKjnD,EAAW,CACd,MAAM0xB,QAAmBmzB,GAAO1qD,IAAIq3B,gBAAgB5rC,EAAWkW,GACzD63B,EAAYtC,IAAAA,KAAUW,SAAS+0B,GAAcr1B,GACnD1xB,EAAYrrB,GAAOC,KAAK++C,GAAW1iD,SAAS,gBAEtC0pB,GAAoB/U,EAAW,CACnCuU,IAAK,IACA8sD,EACHjnD,cAGN,CAMA,OAJK2I,IACH3I,GAAa,IAAIuuB,KAGZvuB,CACT,CAEOtuB,eAAew1E,KACpB,IACE,MAAOn9C,EAAUo9C,EAAcC,SAA4B5qE,QAAQipB,IAAI,CACrE/K,KACAvgB,GAAQ0d,QAAQ,gBAChB1d,GAAQ0d,QAAQ,wBAGlB,OAAOb,KAAKhY,UAAU,CAAE+qB,WAAUo9C,eAAcC,sBAClD,CAAE,MAAOt0E,GAGP,YAFA8C,EAAAA,EAAAA,IAAc,yCAA0C9C,EAG1D,CACF,CAEO,SAASu0E,KACd,OAAO,CACT,CAEO,SAASC,GAAyB1hE,EAAmBO,EAAiByU,GAC3E2xC,GAAmB3mD,EAAWO,EAASyU,EACzC,CAIOlpB,eAAe61E,GAAoBxtD,EAAiB5T,EAAiBqhE,GAC1E,IACE,aAAaxmD,GAAgC,cAAe,CAC1DjH,QACA5T,UACAqhE,SAEJ,CAAE,MAAO10E,GAGP,OAFA8C,EAAAA,EAAAA,IAAc,sBAAuB9C,IAE9B4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CCjDA,MAAMqnB,GAAM0qD,GAAO1qD,IAEnB,IAAI3E,GAEG,SAASiyD,GAASzC,GACvBxvD,GAAWwvD,CACb,CAEOtzE,eAAeg2E,GACpB9hE,EACAkW,EACA7F,GAEA,MAAM,QAAElQ,GAAYJ,EAAeC,GAC7Boa,QAAkBgnD,GAAoBphE,EAAWkW,IAEjD,QAAE3V,EAAO,QAAE4e,SAAkB9K,GAAqBrU,GACxDqQ,EAAQu4B,cAAgBzpB,EAExB,MAAM,GAAEjf,EAAE,UAAEguD,SAAoB6T,GAAU3nD,EAAW/J,GAE/C2xD,EAAe9T,EAAUjtD,KAAK20C,IAAQ,IACvCA,EACHnvB,OAAQjoB,OAAOo3C,EAASnvB,QACxB2vB,iBAAiB,MAGnB,UACQ7hC,GAAI05C,yBAAyB9tD,EAASI,EAAS8P,EAAS2xD,GAE9D,MAAMh/D,QAAeuR,GAAI+pC,2BAA2Bt+C,EAAWgiE,EAAc3xD,EAAQ4xD,iBAErF,MAAI,UAAWj/D,SACPksD,GAAc,CAClB3uD,UAAS4pB,OAAQjqB,EAAIka,YAAWtqB,MAAOkT,EAAOlT,QAEzCkT,GAGF,IAAKA,EAAQ9C,KAAIguD,YAC1B,CAAE,MAAOhhE,GAIP,YAHMgiE,GAAc,CAClB3uD,UAAS4pB,OAAQjqB,EAAIka,YAAWtqB,MAAOoyE,GAAch1E,KAEjDA,CACR,CACF,CAEOpB,eAAeq2E,GACpBniE,EACAkW,EACAg4C,EACAkU,EACAplB,GAEA,MAAM7yB,EAASi4C,EAAYliE,GACrBirC,QAAkB92B,GAAqBrU,IAEvC,QAAEO,GAAY4qC,EACd/wB,EAAY+wB,EAAU/wB,iBAAmBgnD,GAAoBphE,EAAWkW,GAE9E,IACE,MAAM8rD,EAAoC9T,EAAUjtD,KAAK20C,IAAQ,IAC5DA,EACHnvB,OAAQjoB,OAAOo3C,EAASnvB,QACxB2vB,iBAAiB,MAGfgsB,EAAYpzE,OAASyP,EAAAA,IAAQgnB,SAC/Bu8C,EAAa,SAAWztD,GAAIohC,sBAAsB,UAAWp1C,EAAS6hE,EAAYpzE,KAAMgzE,EAAa,KAGvG,MAAMh/D,QAAeuR,GAAIwoC,oBAAoB,CAC3C/8C,YACAkW,WACA2mC,SAAUmlB,EACVhlB,cAGF,GAAI,UAAWh6C,EAIb,aAHMksD,GAAc,CAClB3uD,UAAS4pB,SAAQ/P,YAAWtqB,MAAOkT,EAAOlT,QAErCkT,SAGFA,EAAO65C,SAAS,GAAG5G,UAE1B,MAAMjnD,EAAOggE,GAAgBoT,EAAaA,EAAYpzE,MAChDgvB,EAAKgxC,GAAgBoT,EAAaA,EAAYpkD,IAE9C8wC,EAAwB,IACzBsT,EACHliE,GAAIud,GAAeza,EAAOutC,mBAC1BvhD,OACAgvB,KACAH,KAAM,OACNwa,oBAAqBr1B,EAAOutC,kBAC5B/d,MAAOjvB,EAAc,CACnB05C,cAAej6C,EAAOi6C,iBAgB1B,OAZArtC,GAAS,CACP/iB,KAAM,qBACNmT,YACAixB,WAAY,CAAC69B,WAGTI,GAAc,CAClB3uD,UAAS4pB,SAAQ/P,YAAWotB,QAASxkC,EAAOwkC,UAGzCg3B,GAAS,gBAAiBx+D,EAAW8uD,EAAKzxC,UAAY,GAEpD,CAAEglD,WAAYvT,EAAK5uD,GAC5B,CAAE,MAAOhT,GAIP,YAHMgiE,GAAc,CAClB3uD,UAAS4pB,SAAQ/P,YAAWtqB,MAAOoyE,GAAch1E,KAE7CA,CACR,CACF,CAEA,SAASg1E,GAAch1E,GACrB,MAAsB,iBAARA,EAAmBA,EAAMA,EAAIP,KAC7C,CAEOb,eAAew2E,GAAWtiE,EAAmBuiE,GAClD,MAAM,QAAEhiE,SAAkB8T,GAAqBrU,GACzCwiE,QAAgB5rE,QAAQo+D,WAC5BuN,EAAIthE,KAAKf,GzB9IN,SAA4BK,EAAiBL,GAClD,OAAOkb,GAAe,iBAAiB7a,KAAWL,IAAM,CACtDivD,YAAaC,EAAAA,KAEjB,CyB0IoBqT,CAAmBliE,EAASL,EAAGpC,QAAQ,QAAS,QAG5D4kE,EAA2B,GAE3BvS,EAAQqS,EACXvhE,KAAI,CAAC+B,EAAQhV,KACZ,GAAsB,aAAlBgV,EAAOkb,OAOX,OAAO2wC,GAAmB7rD,EAAOlW,OAN3BkW,EAAOjT,kBAAkBqtD,GAAAA,IAA+C,MAA7Bp6C,EAAOjT,OAAOutD,YAC3DolB,EAAexnE,KAAKqnE,EAAIv0E,GAKW,IAExCqV,OAAOM,SAEV,MAAO,CAAE++D,iBAAgBvS,QAC3B,CAEOrkE,eAAe62E,GACpB3iE,EACAqQ,GAEA,MAAMu4B,SAAuBv0B,GAAqBrU,IAAYmf,QAE9D,OAAOjF,GAAgB,qBAAsB,IACxC7J,EACH8+C,YAAaC,EAAAA,IACbxmB,iBACC,CACDvuB,mBAAmB,GAEvB,CAEO,SAAS0nD,GAAU3nD,EAAmB/J,GAC3C,OAAO6J,GAAgB,kBAAmB,IACrC7J,EACH8+C,YAAaC,EAAAA,IACbwT,eAAe,GACd,CACDxoD,aAEJ,CAEO,SAASyoD,KACd,OAAOznD,GAAe,eACxB,CAEO,SAAS0nD,KACd,OAAO1nD,GAAe,mBACxB,CAEO,SAAS2nD,GAAaC,GAC3B,OAAO5nD,GAAe,cAAe,CAAE4Y,MAAOgvC,GAChD,CAEO,SAASC,GACd5yD,GAEA,OAAO6J,GACL,qBACA7J,EACA,CAAEgK,mBAAmB,GAEzB,CAEO,SAAS6oD,GAAuBr4D,GAIrC,OAAOuQ,GAAe,6BAA8BvQ,EACtD,CAEO/e,eAAeq3E,GACpBnjE,EACAkW,EACA7F,GAKA,MAAM+J,QAAkBgnD,GAAoBphE,EAAWkW,IAEjD,KAAE44C,SAAe50C,GAAqD,8BAA+B,IACtG7J,EACH8+C,YAAaC,EAAAA,KACZ,CACDh1C,cAGIwD,EAAWixC,GAAmBC,GAUpC,OARAl/C,GAAS,CACP/iB,KAAM,gBACNmT,YACAixB,WAAY,CAACrT,KAGV4gD,GAAS,gBAAiBx+D,EAAW8uD,EAAKzxC,UAAY,GAEpD,CAAEyxC,OAAMlxC,WACjB,CAEO9xB,eAAes3E,GAAcjvD,EAAiBkvD,EAA2Cl5C,GAC9F,MAAMnnB,QAAeq5C,GAAeloC,EAAOkvD,GAAiB,GAE5D,GAAc,QAAVlvD,GAAmB,YAAanR,EAAQ,CAC1C,MAAM,UAAEhD,EAAS,SAAEkW,GAAamtD,GAC1B,QAAE9iE,SAAkB8T,GAAqBrU,GACzCoa,QAAkBgnD,GAAoBphE,EAAWkW,SACjDg5C,GAAc,CAAE3uD,UAAS6Z,YAAWotB,QAASxkC,EAAOwkC,QAASrd,UACrE,CAEA,OAAOnnB,CACT,CCvPA,MAAMsgE,GAAmB,GAAK/nC,GACxBgoC,GAAwB/nC,GACxBgoC,GAAsB,GAAKjoC,GAE3BkoC,GAA0B,CAAE1nC,QAASP,GAAQQ,WAAY,GAAKR,IAE9DkoC,GAAkB,IAExB,IAAI9zD,GACA+zD,GACAC,GACJ,MAAMC,GAAyBC,EAAAA,IAoQ/B,WACE,MAAMC,EAAoD,CAAC,EAC3D,IAAIC,EAqEJ,SAASC,EAAoBjkE,EAAmByU,GAC9C,GAAIsvD,EAAc/jE,GAAY,OAE9B,MAAMkkE,EAAU9gE,OAAOa,OAAOg7D,IAAQh+D,KAAKkT,GAAUA,EAAMokD,qBAAqBv4D,EAAWyU,EAAS7E,MACpGm0D,EAAc/jE,GAAa,KACzB,IAAK,MAAMmkE,KAAaD,EACtBC,GACF,CAEJ,CAEA,SAASC,IACP,IAAK,MAAOpkE,EAAWqkE,KAAuBjhE,OAAOiQ,QAAQ0wD,GAC3DM,WACON,EAAc/jE,EAEzB,CAEA,MAAMskE,EAAuB3iC,EAAAA,GAG7B,MAAO,CACL4iC,iBAAkBD,GAzFpBx4E,eAAgCkU,GAA+B,IAAAwkE,EAC7D,GAAIxkE,IAAcgkE,EAChB,OAGF,QAAkB32E,IAAd2S,EAEF,YADAokE,IAIF,IAAKJ,GAAmBjkE,EAAeC,GAAWG,UAAYJ,EAAeikE,GAAiB7jE,QAE5F,kBA2CJrU,eAA6B24E,GAC3BL,IACAJ,EAAkBS,EAClB,MAAM,QAAEtkE,GAAYJ,EAAeikE,GAC7B7/C,QAAiBrP,KACjB4vD,EAAkBthE,OAAOL,KAAKohB,GAAU9gB,QAAQrD,GACpDA,IAAcgkE,GACXjkE,EAAeC,GAAWG,UAAYA,IAE3CukE,EAAgBzjE,KAAKjB,GAAcikE,EAAoBjkE,EAAWmkB,EAASnkB,KAC7E,CAtDU2kE,CAAc3kE,GAItB,MAAM4kE,EAA0BZ,EAChCA,EAAkBhkE,EAGY,QAA9BwkE,EAAAT,EAAcC,UAAgB,IAAAQ,GAA9BA,EAAAhzD,KAAAuyD,UACOA,EAAcC,GAGrB,MAAMa,QAA8BjwD,GAAwBgwD,GACxDC,GACFZ,EAAoBW,EAAyBC,EAEjD,IA+DEC,WAAYR,GA7Dd,SAAoBtkE,EAAmByU,GACrC,MAAMswD,EAAkB/kE,IAAcgkE,EAChCgB,EAAmBhB,GACpBjkE,EAAeC,GAAWG,UAAYJ,EAAeikE,GAAiB7jE,SAEtE4kE,GAAmBC,GACtBf,EAAoBjkE,EAAWyU,EAEnC,IAsDEwwD,cAAeX,GApDjB,SAAuBtkE,GAAmB,IAAAklE,EAChB,QAAxBA,EAAAnB,EAAc/jE,UAAU,IAAAklE,GAAxBA,EAAA1zD,KAAAuyD,UACOA,EAAc/jE,EACvB,IAkDEmlE,sBAAuBb,GAhDzB,SAA+BnkE,GACzB6jE,GAAmBjkE,EAAeikE,GAAiB7jE,UAAYA,GAEjEikE,GAEJ,IA4CEgB,kBAAmBd,GA1CrB,WACEF,GACF,IA0CF,CAvW4CiB,QAAyCh4E,EAC/Ei4E,GA4ON,WACE,MAAMC,EAAmB,IAAIzlE,IAE7B,MAAO,CAACE,EAAmBmU,EAAiB0J,EAAiC2nD,KAC3E,MAAMpmE,EAAM,GAAGY,KAAa6d,IAC5B,IAAI4nD,EAAqBF,EAAiBr0D,IAAI9R,GACzCqmE,IACHA,EAAqB,IAAIlU,IAAkBiU,IACzC51D,GAAS,CAAE/iB,KAAM,iBAAkBgxB,OAAM7d,YAAWwlE,cAAa,IAEnED,EAAiBl5D,IAAIjN,EAAKqmE,IAG5BA,EAAmB9T,OAAOx9C,EAAOqxD,EAAW,CAEhD,CA3P0BE,GAEnB,SAASC,GAAYvG,GAAwB,IAAAwG,EAClDh2D,GAAWwvD,E3EnCNtzE,iBACL,MAAMyzB,QAAeK,GAAgBC,YAC/Bc,GAAapB,GACnBc,GAAcxpB,SAChB,C2EiCOgvE,GAEAjvE,QAAQo+D,WAAW,CACtB/4C,KACA6pD,MACCzO,EAAAA,KAAuB0O,KACxBhF,OACC5jC,MAAK,IAAM4hC,OAETiH,KAEmB,QAAxBJ,EAAAjC,UAAwB,IAAAiC,GAAxBA,IACAjC,GAUF,WACE,MAAMO,EAAU,CACd7nC,GAAY,CACVzyB,OAAQ05D,GACR9mC,iBAAiB,EACjBE,KAAMopC,KACL1oC,KACHf,GAAY,CACVzyB,OAAQ25D,GACR/mC,iBAAiB,EACjB,UAAME,SACE9lC,QAAQipB,IAAI,CAChB5D,MACCo7C,EAAAA,KAAuB0J,KACxBiF,KACAD,MAEJ,IACC3oC,MAGL,MAAO,KACL,IAAK,MAAM6oC,KAAU/B,EACnB+B,GACF,CAEJ,CApC6BC,EAC7B,CAqCOp6E,eAAeg6E,KACpB,IACE,MAAMvlD,QAAqBm+C,KAErBn/C,QAAenE,GAAoC,UAAW,CAAEnW,KAAMsb,IAC5E,IAAK,MAAMW,KAAS3B,EAClB2B,EAAMI,eAAgB,QAGlBjB,GAAc1pB,QACpB,MAAM2pB,EAAcoB,KAEdykD,EAA2B/iE,OAAOa,OAAOqc,EAAYG,QAAQ5e,QAAO,CAACmB,EAAQke,MAC5EA,EAAMI,eAAiBJ,EAAMxY,cAChC1F,EAAO9H,KAAKgmB,EAAMxY,cAEb1F,IACN,IAGGojE,EAAyBD,EAAyB95E,aAC9C6tB,GAAmC,gBAAgBqG,IAAgB,CACzE8lD,OAAQF,EAAyBv7E,MAAM,EAAG84E,WACvCr2E,QAEDszB,GAAapB,EAAQ3P,GAAUw2D,EAAwB7lD,GAAc,EAC7E,CAAE,MAAOrzB,IACP8C,EAAAA,EAAAA,IAAc,kBAAmB9C,EACnC,CACF,CAEOpB,eAAei6E,KACpB,IACE,MAAMM,QAAexD,WAEfxiD,GAAc1pB,QACpB,MAAM2pB,EAAcoB,KAEdnC,EAAS8mD,EAAOxkE,QAAO,CAACqC,EAAmC8vB,KAAU,IAAAsyC,EAUzE,OATApiE,EAAI8vB,EAAMjW,MAAQ,IAEb9a,EAAK+wB,EAAc,CAAC,eACvB7f,MAAO,eAAgB6f,EAAQA,EAAMuyC,WAAuBvyC,EAAM7f,MAClEzL,aAAc,aAAcsrB,GAASA,EAAM7K,WAAa1qB,EAAAA,IAAQgnB,OAC5DuO,EAAM7K,SACN6K,EAAMtrB,aACV6Y,OAAqC,QAA9B+kD,EAAAhmD,EAAYG,OAAOuT,EAAMjW,aAAK,IAAAuoD,OAAA,EAA9BA,EAAgC/kD,QAAS,GAE3Crd,CAAG,GACT,CAAC,GAEJ0L,GAAS,CACP/iB,KAAM,mBACN0yB,UAEJ,CAAE,MAAOryB,IACP8C,EAAAA,EAAAA,IAAc,sBAAuB9C,EACvC,CACF,CAEOpB,eAAek6E,KACpB,IACE,MAAMpgB,QAAexqC,GAAiC,sBjCpInD,SAA+BwqC,GACpCY,GAAgBZ,EAChBa,GAAe5vD,SACjB,CiCkII2vE,CAAsB5gB,GAEtB,MAAM,UACJ6gB,EAAS,qBACTC,GAAuB,EAAK,qBAC5BC,EAAuB,EACvBr3D,IAAKs3D,EACLC,QAASC,EACTC,iBAAkBC,GAChBphB,EAEJh2C,GAAS,CACP/iB,KAAM,eACN45E,YACAC,uBACAC,uBACAG,cACAE,wBAGF,MAAMC,GAAY,IAAIxvE,MAAQ8/C,UAC1B76C,KAAKlD,IAAIotE,EAAYK,GAAYzD,IACnC5zD,GAAS,CACP/iB,KAAM,iBAGZ,CAAE,MAAOK,IACP8C,EAAAA,EAAAA,IAAc,kBAAmB9C,EACnC,CACF,CAGOpB,eAAeo7E,GACpBlnE,EACA6zD,GACA,IAAAsT,EAMA,GALwB,QAAxBA,EAAAvD,UAAwB,IAAAuD,GAAxBA,IACAvD,QAA2Bv2E,EAE3Bw2E,UAAAA,GAAwBU,iBAAiBvkE,GAErCA,EAAW,CACb,MAAMyU,QAAgBL,GAAmBpU,GAEnConE,EAAiB,EACpB3P,EAAAA,KAAkB4P,GAA0BrnE,EAAWyU,GAAS2oB,QAE7Dh6B,OAAOL,KAAKk8D,IAAoCh+D,KAAKkT,GACvD8qD,GAAO9qD,GAAOw/C,mBACZ3zD,EACAyU,EACA7E,GACA01D,GAAkB1yD,UAAKvlB,EAAW2S,EAAWmU,GA8LvD,SAA6BsM,EAA+BtM,GAC1D,MAAQ4J,KAAMupD,GAAel6B,GAAej5B,GAAOq5B,YACnD,OAAOpqC,OAAOiQ,QAAQoN,GAAQ5e,QAAO,CAAC0lE,EAAStlE,KAAwB,IAArB8b,EAAMV,GAAUpb,EAIhE,OAHI8b,IAASupD,GAAcvpD,EAAK1e,WAAW,GAAG8U,SAC5CozD,EAAUxpD,GAAQV,GAEbkqD,CAAS,GACf,CAAC,EACN,CArMUC,CAAoB3T,EAA0B1/C,OAKpDyvD,GAA2BA,KACzB,IAAK,MAAMqC,KAAUmB,EACfnB,GACFA,GAEJ,CAEJ,CACF,CAsBA,SAASoB,GAA0BrnE,EAAmByU,GACpD,IAAI2hD,EAEJ,MAAMqR,EAAiBxkE,EAAKwR,EAAmC,CAAC,sBAEhE,OAAO4nB,GAAY,CACjBzyB,OAAQ65D,GACR,UAAM/mC,GACJ,IACE,MAAMgrC,QAAsBxtD,GAAkC,kBAAmButD,GAE5Ej6C,GAAak6C,EAAetR,KAC/BA,EAAasR,EACb93D,GAAS,CACP/iB,KAAM,sBACNmT,YACA0nE,kBAGN,CAAE,MAAOx6E,IACP8C,EAAAA,EAAAA,IAAc,6BAA8B9C,EAC9C,CACF,GAEJ,CC5QA,IAAI0iB,GCOAA,GDLG,SAAS+3D,GAAavI,GAC3BxvD,GAAWwvD,CACb,CAEOtzE,eAAe87E,GAAgB5nE,GAAyE,IAAtD6zD,EAA+Cv8D,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,CAAC,QtEqGnGq3B,GsElGP,MACMk5C,SADsBryD,WAGtBjhB,GAAQ6d,QAAQ,mBAAoBpS,GAC1CgU,KAEIhqB,EAAAA,KACGw0E,GAAS,gBAGZqJ,GACFxmD,GAAiBzR,IAGds3D,GAAwBlnE,EAAW6zD,EAC1C,CAEO/nE,eAAeg8E,KACfZ,QAAwB75E,EAAW,CAAC,SACnCkH,GAAQ8d,WAAW,oBAErBroB,EAAAA,KACGw0E,GAAS,eAElB,CAEO,SAASuJ,GAAe/nE,GAC7B,OAAOqU,GAAqBrU,EAC9B,CAEO,SAASgoE,GAAmBhoE,GACjC,OAAOoU,GAAqCpU,EAC9C,CChCO,SAASioE,GAAU7I,GACxBxvD,GAAWwvD,CACb,CAaOtzE,eAAeo8E,GACpBloE,EACA0a,EACAytD,GAC8B,IAAAC,EAC9B,MAAMC,EACqC,QADhCD,QACHvzD,GAAgB7U,EAAW,gBAAQ,IAAAooE,OAAA,EAD7BA,EAEV1tD,GACJ,GAAK2tD,EAEL,OAAOA,EAAMF,EACf,CAEOr8E,eAAew8E,GAAQtoE,EAAmBuoE,EAAeJ,GAC9D,MAAMK,QAAcC,GAAczoE,GAE7BwoE,EAAMD,EAAK7tD,OACd8tD,EAAMD,EAAK7tD,KAAO,CAAC,GAGrB8tD,EAAMD,EAAK7tD,KAAKytD,GAAYI,QACtBtzD,GAAgBjV,EAAW,QAASwoE,EAC5C,CAEO18E,eAAe48E,GACpB1oE,EACA0a,EACAytD,EACAQ,GAEA,MAAMH,QAAcC,GAAczoE,GAClC,OAAM0a,KAAO8tD,WAINA,EAAM9tD,GAAKytD,GACd1pD,GAAc+pD,EAAM9tD,YACf8tD,EAAM9tD,SAGTzF,GAAgBjV,EAAW,QAASwoE,GAEtC54D,IAAYyf,GAAezf,KAC7BA,GAAS,CACP/iB,KAAM,iBACNmT,YACA0a,QAICiuD,SACGnK,GAAS,qBAAsBx+D,EAAW0a,SAG5C8jD,GAAS,mBAER,EACT,CAEO1yE,eAAe88E,GAAe5oE,GACnC,MAAM6oE,EAAOzlE,OAAOL,WAAW0lE,GAAczoE,UACvCiV,GAAgBjV,EAAW,QAAS,CAAC,GAE3C6oE,EAAKr6E,SAASksB,IACZ9K,GAAS,CACP/iB,KAAM,iBACNmT,YACA0a,QAEG8jD,GAAS,qBAAsBx+D,EAAW0a,EAAI,UAG/C8jD,GAAS,iBACjB,CAEO1yE,eAAeg9E,GAAS9oE,GAC7B,MAAMqoE,QAAcI,GAAczoE,GAClC,OAAOoD,OAAOa,OAAOokE,GAAOjjC,SAAS6L,GAAS7tC,OAAOa,OAAOgtC,IAC9D,CAEOnlD,eAAe28E,GAAczoE,GAClC,aAAc6U,GAAgB7U,EAAW,UAAa,CAAC,CACzD,CAwBO,SAAS+oE,KACd,OAAOx0E,GAAQ0d,QAAQ,QACzB,CAEOnmB,eAAek9E,GAAmBhpE,SACjCmV,GAAmBnV,EAAW,SAE/Bw+D,GAAS,iBAChB,CAEO1yE,eAAem9E,WACd10E,GAAQ8d,WAAW,eAEnBmsD,GAAS,iBACjB,CAEO,SAAS0K,GAAmB/oE,GACjC,OAAOmV,GAA2BnV,EAAS,QAC7C,CAUO,SAASgpE,GAAgB5+B,GAEgC,IAD9D,YAAE6+B,GAAuC7+B,EAEzC,OAAOnvB,GAAe,mBAAoB,CAAEguD,eAC9C,CCzHA,MAAQ70D,IAAG,GAAEG,KAAIA,IAAKuqD,GAEf,SAAS7zB,GAAiBi+B,GAC/B,OAAIA,E3FhCGrzD,EAAAA,GAAuB,KAAKznB,MAAM,K2FiClCgmB,GAAI62B,kBACb,CAEO,SAASk+B,GACdnpE,EACAE,EACA6V,EACAiJ,GAIA,OAFKA,IAASA,EAAU4qB,EAAAA,KAEjBw/B,GAAeppE,EAASE,EAAU6V,EAAUiJ,EACrD,CAEO,SAASmsB,GAAiBjrC,GAC/B,OAAQ0V,GAAsB1V,IAAampE,EAAAA,KAA8BvK,GAAO1qD,IAAI+2B,iBAAiBjrC,EACvG,CAEOvU,eAAey9E,GACpBppE,EACAE,EACA6V,EACAiJ,GAEA,MAAMsqD,EAAerpE,EAAqBC,GAC1C,IAAIqpE,EAAkB3zD,GAAsB1V,GAC5C,MAAMspE,QAAsBp1D,GAAI+2B,iBAAiBjrC,GAEjD,KAAKopE,GAAiBE,GAAmBD,GAAoBF,EAAAA,KAC3D,MAAM,IAAIv+E,MAAM,oBAGlB,MAAMqtB,QAA0BrC,GAAgB5V,EAAU6V,GAGpDqC,QAA0BrB,GAAgBoB,EAAmBpC,GAChEtF,OAAM,KAAe,IAExB,IAAKsF,IAAaqC,EAChB,MAAO,CAAEzoB,MAAO0oB,EAAAA,GAAeC,YAGjC,IAAIhE,EACA02B,EAEJ,IAQE,GAPIu+B,GAAmBC,IACrBx+B,QAAkB52B,GAAIg4B,sBAAsBlsC,EAAUF,EAASgf,GAC3DgsB,EAAUhoB,WACZumD,GAAkB,IAIlBA,EAAiB,CACnB,MAAME,EAAal1D,GAAK23B,2BAA2BlsC,EAASE,GAC5D8qC,QAAkB52B,GAAI83B,2BAA2BlsC,EAASE,GAE1DoU,EAAU,CACR5nB,KAAM,QACNyrB,oBACA5D,KAAMk1D,EACNr1D,IAAK42B,EAET,MACOA,IACHA,EAAYs+B,QACFl1D,GAAIi4B,wBAAwBnsC,EAAS,GAAIF,EAASgf,SAClD5K,GAAIg4B,sBAAsBlsC,EAAUF,EAASgf,IAEzD1K,EAAU,CACR5nB,KAAM,MACNyrB,oBACA/D,IAAK42B,GAIT,MAAMnrC,QAAkB8kE,GAAW3kE,EAASsU,GACtCo1D,EAAuBpS,EAAAA,UAAuBqS,GAA+B,CACjF9pE,YAAWG,UAASE,WAAUiY,oBAAmB6G,iBAC9C9xB,EAGL,OAFKu6E,GAAgB5nE,GAEd,CACLA,YACA0V,eAAgBD,GAAwBhB,GACxCo1D,uBAEJ,CAAE,MAAO38E,GACP,OAAO4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CAEOpB,eAAeg+E,GAA+B3vD,GAOnD,MAAM,SACJ9Z,EAAQ,QAAE8e,EAAO,kBAAE7G,GACjB6B,GACE,QAAEha,EAAO,UAAEH,GAAcma,EACzBgxB,QAAkB52B,GAAIg4B,sBAAsBlsC,EAAUF,EAASgf,GAE/D4qD,EAA4B,YAAZ5pE,EAAwB,UAAY,UAC1DgrC,EAAU5qC,QAAUuI,GAAgBqiC,EAAU5qC,SAAS,EAAOwpE,GAC9D,MAAMt1D,EAAyB,CAC7B5nB,KAAM,MACNyrB,oBACA/D,IAAK42B,GAIP,MAAO,CACLnrC,gBAH4B8kE,GAAWiF,EAAet1D,EAAS1U,EAAeC,GAAWE,IAIzFwV,eAAgB,CAAEnB,IAAK42B,EAAU5qC,SACjCJ,QAAS4pE,EAEb,CAEOj+E,eAAek+E,GAAmB7pE,EAAqB+sC,GAC5D,MAAM,UACJvE,EAAS,QAAEpoC,EAAO,MAAE2B,EAAK,OAAE+nE,EAAM,SAAEC,EAAQ,WAAEC,EAAU,QAAEhrD,GACvD+tB,EAgBJ,MAAO,CAAEltC,gBAde8kE,GAAW3kE,EAAS,CAC1CtT,KAAM,SACN0nB,IAAK,CACH1nB,KAAM,MACN0T,UACAooC,YACAxpB,UACAjd,SAEF+nE,SACAC,WACAC,eAGkB5pE,UAAS2sC,aAC/B,CAIA,MAAMk9B,IAAkB1W,EAAAA,EAAAA,IAAgB,GAExC5nE,eAAeg5E,GAAW3kE,EAAqBsU,EAAwB41D,GACrE,MAAMrqE,QAAkBoqE,GAAgBvsC,KAAI/xC,UAC1C,MAAMkU,Q5F1KHlU,eAA+BqU,EAAqBkqE,GACzD,MAAM9H,SAZDz2E,iBACL,OAAOsX,OAAOL,WAAWxO,GAAQ0d,QAAQ,aAAe,CAAC,EAC3D,CAUqBq4D,IAAiBrpE,KAAKjB,GAAcD,EAAeC,GAAWE,KAIjF,OnB5BK,SAAwBuU,GAC7B,MAAM,GAAEvU,EAAE,QAAEC,GAAYsU,EACxB,MAAO,GAAGvU,KAAMC,GAClB,CmByBSoqE,CAAe,CAAErqE,QAHG7S,IAAhBg9E,GAA8B9H,EAAIt4E,SAASogF,GAEnC,IAAf9H,EAAIl2E,OAAesnB,GAAqBjX,KAAKsuD,OAAOuX,GAAO,EAD3D8H,EAEwBlqE,WAC9B,C4FoK4BqqE,CAAgBrqE,EAASkqE,GAEjD,aADMp1D,GAAgBjV,EAAW,WAAYyU,GACtCzU,CAAS,IAKlB,OHwBK,SAA2BA,EAAmByU,GACnDovD,UAAAA,GAAwBiB,WAAW9kE,EAAWyU,EAChD,CG5BEg2D,CAAkBzqE,EAAWyU,GAEtBzU,CACT,CAEOlU,eAAeq5E,GAAsBhlE,IH+BrC,SAAsCA,GAC3C0jE,UAAAA,GAAwBsB,sBAAsBhlE,EAChD,CGhCEuqE,CAA6BvqE,SAEvBvJ,QAAQipB,IAAI,CAChBioD,KACAxyD,GAA2BnV,EAAS,YACpCyG,KAAiBb,iBAAmBmjE,GAAmB/oE,IAE3D,CAEOrU,eAAe6+E,KH2BpB9G,UAAAA,GAAwBuB,0BGxBlBxuE,QAAQipB,IAAI,CAChBioD,KACAvzE,GAAQ8d,WAAW,YACnBzL,KAAiBb,iBAAmBkjE,KACpCrpD,GAAgBtN,SAEpB,CAEOxmB,eAAem5E,GACpBjlE,EACA4qE,EACA/W,IHEK,SAA8B7zD,GACnC6jE,UAAAA,GAAwBoB,cAAcjlE,EACxC,CGFE6qE,CAAqB7qE,SAEfpJ,QAAQipB,IAAI,CAChB1K,GAAmBnV,EAAW,YAC9B4G,KAAiBb,iBAAmBijE,GAAmBhpE,WAGnD4nE,GAAgBgD,EAAe/W,EACvC,CAEO/nE,eAAeg/E,GAAeC,EAAqB70D,GACxD,IAAK,MAAOlW,EAAWyU,KAAYrR,OAAOiQ,cAAcyB,MAAwB,CAC9E,KAAM,sBAAuBL,GAAU,SAEvC,MAAMpU,QAAiB6W,GAAgBzC,EAAQ6D,kBAAmByyD,GAC5DC,QAA0B/0D,GAAgB5V,EAAU6V,SAEpDnB,GAA4C/U,EAAW,CAC3DsY,kBAAmB0yD,GAEvB,CACF,CAEOl/E,eAAem/E,GAAkB9qE,EAAqBuV,GAC3D,IACE,MAAMjB,EAA0B,CAC9B5nB,KAAM,QAER,IAAIsgD,EAEJ,GAAIz3B,EAAenB,IAAK,CACtB,MAAMlgB,QAAekgB,GAAIs4B,qBAAqB1sC,EAASuV,EAAenB,KACtE,GAAI,UAAWlgB,EAAQ,MAAO,IAAKA,EAAQ8f,MAAO,OAClDM,EAAQF,IAAMlgB,EAAOA,OACrB84C,EAAQ94C,EAAO84C,KACjB,CAEIz3B,EAAehB,OACjBD,EAAQC,KAAO,CACb7nB,KAAM,OACN0T,QAASmV,EAAehB,KACxBxS,MAAO,IAIX,MAAMlC,QAAkB8kE,GAAW3kE,EAASsU,GAG5C,OAFKmzD,GAAgB5nE,GAEd,CACLA,YACAmtC,QACA+9B,kBAAmBz1D,GAAwBhB,GAE/C,CAAE,MAAOvnB,GACP,OAAO4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CAEOpB,eAAeq/E,GAAuBnrE,EAAmBmf,GAS9D,MAAM,QAAEhf,GAAYJ,EAAeC,GAC7ByU,QAAgBH,GAAsBtU,GACtCorE,EAAa,IACd32D,EACHF,IAAKA,GAAIo4B,sBAAsBxsC,EAASsU,EAAQF,IAAK4K,IAGjDgF,QAAiBrP,KACjBu2D,EAAkBjoE,OAAOiQ,QAAQ8Q,GAAUpE,MAAK9d,IAAiB,IAAAqpE,EAAA,IAAf,CAAE72D,GAAQxS,EAChE,OAAkB,QAAXqpE,EAAA72D,EAAQF,WAAG,IAAA+2D,OAAA,EAAXA,EAAa/qE,WAAY6qE,EAAW72D,IAAIhU,SAAWkU,EAAQ5nB,OAASu+E,EAAWv+E,IAAI,IAG5F,GAAIw+E,EACF,MAAO,CACLE,OAAO,EACPvrE,UAAWqrE,EAAgB,IAI/B,MAAMG,EAA0B,WAAjB/2D,EAAQ5nB,KACnB,CAAEqV,MAAOuS,EAAQF,IAAIrS,MAAO+nE,OAAQx1D,EAAQw1D,aAC5C58E,EAIJ,MAAO,CACLk+E,OAAO,EACPvrE,gBAJyB8kE,GAAW3kE,EAASirE,GAK7C7qE,QAAS6qE,EAAW72D,IAAIhU,QACxBirE,SAEJ,CC/UA,MAAMC,GAAY,IAAI3rE,IAEtB,MAAMtJ,GAKJG,QAAU,IAAIC,SAAW,CAACC,EAASC,KACjCJ,KAAKG,QAAUA,EACfH,KAAKI,OAASA,CAAM,IAIjB,SAAS40E,KAAkD,IAAhCC,EAASr0E,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG+X,KAC5C,MAAMxlB,EAAW,IAAI2M,GAErBi1E,GAAUp/D,IAAIs/D,EAAW9hF,GAEzB,MAAM,QAAE8M,GAAY9M,EAEpB,MAAO,CAAE8hF,YAAWh1E,UACtB,CAEO,SAASi1E,GAAmBD,EAAmB7+E,GACpD,MAAMjD,EAAW4hF,GAAUv6D,IAAIy6D,GAC1B9hF,IAILA,EAASgN,QAAQ/J,GACjB2+E,GAAU36D,OAAO66D,GACnB,wBCfA,MAAMp3D,GAAM0qD,GAAO1qD,IAEZzoB,eAAe8/C,GAAgB5rC,EAAmBkW,GACvD,MAAMzB,QAAgBL,GAA2CpU,GAC3D8rC,QAAmB+/B,GAAmB7rE,EAAWkW,EAAUzB,GAEjE,OAAO1lB,GAAOC,KAAK88C,GAAazgD,SAAS,MAC3C,CAEOS,eAAeggF,GAAc9rE,EAAmBkW,GAErD,OAAOkC,GAAYpY,EAAWkW,QADR9B,GAA2CpU,GAEnE,CAEO,SAAS+rE,KACd,OAAO1gC,EAAAA,UAAyB2gC,OAClC,CAEOlgF,eAAemgF,KAMpB,IACE,MAAM9nD,QAAiBrP,KACvB,QAASqP,GAAgC,iBAAbA,GAAyB/gB,OAAOL,KAAKohB,GAAU93B,OAAS,CACtF,CAAE,MACA,OAAO,CACT,CACF,CAEOP,eAAeogF,GAAeh2D,GACnC,IACE,MAAOlW,EAAWyU,S9F1Bf3oB,iBACL,MAAMmlD,QAAan8B,KAEnB,OAAO1R,OAAOiQ,QAAQ49B,GACnBlxB,MAAK9d,IAAA,IAAE,EAAE,KAAEpV,IAAOoV,EAAA,MAAc,WAATpV,GAA8B,SAATA,CAAe,GAChE,C8FqBwCs/E,IAA6B,GACjE,IAAKnsE,IAAcyU,EACjB,OAAO,EAGT,MAAMpU,QAAiB+X,GAAYpY,EAAWkW,EAAUzB,GACxD,OAAO9Q,QAAQtD,EACjB,CAAE,MACA,OAAO,CACT,CACF,CAEO,SAAS+rE,GAAmBT,EAAmBrpE,GACpD+pE,GAAgCV,EAAWrpE,EAC7C,CAEO,SAASgqE,GAA0BX,EAAmBrpE,GAK3D+pE,GAAgCV,EAAWrpE,EAC7C,CAEO,SAASiqE,GAAkBZ,EAAmB57E,IDzC9C,SAA2B47E,GAAgE,IAA7C57E,EAAcuH,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,2BACpE,MAAMzN,EAAW4hF,GAAUv6D,IAAIy6D,GAC1B9hF,IAILA,EAASiN,OAAO,IAAI01E,GAAAA,GAAoBz8E,IACxC07E,GAAU36D,OAAO66D,GACnB,CCkCEU,CAA+BV,EAAW57E,EAC5C,CAEOjE,eAAe49C,GAAe1pC,EAAmBO,GACtD,MAAM,QAAEJ,GAAYJ,EAAeC,GAInC,OAHKO,KACAA,iBAAkB8T,GAAqBrU,IAErCuU,GAAIm1B,eAAevpC,EAASI,EACrC,CAEO,SAASksE,GAAazsE,EAAmBmU,GAC9C,OAAOD,GAAmBlU,EAAWmU,EACvC,CAEO,SAAS6mC,GAAoB76C,EAAqBI,GAGvD,OAFc0+D,GAAO1qD,IAER+zB,qBAAqBnoC,EAASI,EAC7C,CAEO,SAASkpC,GAAiBt1B,EAAiBhU,EAAqBI,GACrE,OAAO0+D,GAAO9qD,GAAOs1B,iBAAiBtpC,EAASI,EACjD,CAEO,SAAS0oC,GAAgB9oC,EAAqBI,GAGnD,OAFc0+D,GAAO1qD,IAER00B,gBAAgB9oC,EAASI,EACxC,CAEO,SAASioC,GAAcroC,EAAqBI,GAGjD,OAFc0+D,GAAO1qD,IAERi0B,cAAcroC,EAASI,EACtC,CAEOzU,eAAeo9C,GAAe/oC,EAAqB6K,GAQxD,IACE,aAAawvC,GAAer6C,EAAS6K,EACvC,CAAE,MAAO9d,GACP,OAAO4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CCxHA,MAAQqnB,IAAGA,IAAK0qD,GAETnzE,eAAe4gF,GAAU1sE,GAE9B,MAAO,cADeoU,GAAmBpU,GACfuU,GAAI0tC,eAAejiD,GAAa,EAC5D,CAEO,SAASqjD,GAAsBlpC,GAMpC,OAAO5F,GAAI8uC,sBAAsBlpC,EACnC,CAEOruB,eAAe63D,GACpB3jD,EACAkW,EACAmJ,EACArU,EACAiB,GAEA,IADAmpC,EAAY99C,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,GAEf,MAAQiJ,QAASwzB,SAAsB1f,GAAqBrU,GAEtDgD,QAAeuR,GAAIovC,mBAAmB,CAC1C3jD,YAAWkW,WAAUmJ,OAAMrU,YAAWiB,YAGxC,GAAI,UAAWjJ,EACb,OAAOA,EAGT,MAAM2pE,EAAgBptE,EAAqB61C,EAAchyC,OAAOL,KAAKC,EAAO65C,UAAUxwD,QAetF,OAbAuzE,GAAwB5/D,EAAW,MAAOgD,EAAO65C,SAAS57C,KAAI,CAAC3R,EAAS4S,KAAU,CAChFqb,KAAMva,EAAOutC,kBACb9pB,OAAQ,GACRsN,cACA/oB,YACAiB,UACAynB,IAAKi5C,EACL79C,kBAAmBx/B,EAAQ0b,UAC3B+S,KAAMtf,EAAAA,IAAQsf,KACdsa,oBAAqBr1B,EAAOutC,kBAC5BzyB,IAAKuB,aAAI,EAAJA,EAAOnd,QAGPc,CACT,CAEOlX,eAAew2D,GAAkBtiD,EAAmB6nB,GAEzD,MAAO,cADezT,GAAmBpU,IACduU,GAAI+tC,kBAAkBtiD,EAAW6nB,EAC9D,CCvDA,MAAQtT,IAAGA,IAAK0qD,GAET,SAASta,GAAqB3kD,EAAmBqf,GACtD,MAAMulC,EAAexgD,GAAWib,EAAM,WACtC,OAAO9K,GAAIowC,qBAAqB3kD,EAAW4kD,EAC7C,CAEO94D,eAAek5D,GAAiBhlD,EAAmBkW,EAAkBmJ,GAA8B,IAAd40B,EAAO38C,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,GACpG,MAAQiJ,QAASwzB,SAAsB1f,GAAqBrU,GAEtD4sE,EAAenqE,EAAqB4c,EAAM,WAC1CmjD,EAA6D,GAEnE,UAAW,MAAM,UAAEpgD,EAAS,OAAEpf,KAAYuR,GAAIywC,iBAAiBhlD,EAAWkW,EAAU9S,OAAOL,KAAK6pE,IAAgB,CAC9G,GAAI,UAAW5pE,EAAQ,CACrBw/D,EAAQtnE,KAAK8H,GACb,QACF,CAEA,MAAMy9D,EAAkBb,GAAwB5/D,EAAW,MAAOoiB,EAAUnhB,KAAKV,IAC/E,MAAMud,EAAM8uD,EAAarsE,GACzB,MAAO,CACLgd,KAAMva,EAAOutC,kBACb9pB,OAAQ,GACRsN,cACA/oB,UAAW8S,EAAIvd,QACfmzB,IAAKugB,EAAUz1C,OAAO6gB,EAAKhzB,QAC3ByiC,kBAAmBhR,EAAIvd,QACvBwd,KAAMtf,EAAAA,IAAQsf,KACdsa,oBAAqBr1B,EAAOutC,kBAC5BzyB,MACAjxB,KAAM,WACP,KAGH21E,EAAQtnE,KAAK,CACX2xE,YAAazoE,GAAWq8D,EAAiB,OAE7C,CAEA,OAAO+B,CACT,CAEO,SAASrd,GAA0BnlD,EAAmB8d,EAAavd,GACxE,OAAOgU,GAAI4wC,0BAA0BnlD,EAAW8d,EAAIvd,QAASA,EAC/D,CAEOzU,eAAeu5D,GACpBrlD,EACAkW,EACA4H,EACAvd,GAEA,IADA0zC,EAAO38C,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,GAEV,MAAQiJ,QAAS0J,SAAwBoK,GAAqBrU,GACxDgD,QAAeuR,GAAI8wC,sBAAsBrlD,EAAWkW,EAAU4H,EAAIvd,QAASA,GAEjF,GAAI,UAAWyC,EACb,OAAOA,EAGT,MAAO4a,GAAYgiD,GAAwB5/D,EAAW,MAAO,CAAC,CAC5Dud,KAAMva,EAAOutC,kBACb9pB,OAAQ,GACRsN,YAAa9pB,EACbe,UAAW8S,EAAIvd,QACfmzB,IAAKugB,EACLnlB,kBAAmBhR,EAAIvd,QACvBwd,KAAMtf,EAAAA,IAAQsf,KACdsa,oBAAqBr1B,EAAOutC,kBAC5BzyB,MACAjxB,KAAM,sBAGR,MAAO,CAAEw1E,WAAYzkD,EAAS1d,GAChC,CChEO,IAAK4sE,GAAyB,SAAzBA,GAAyB,OAAzBA,EAAAA,EAAyB,iCAAzBA,EAAAA,EAAyB,yCAAzBA,EAAAA,EAAyB,uDAAzBA,EAAAA,EAAyB,mDAAzBA,EAAAA,EAAyB,2CAAzBA,EAAAA,EAAyB,6CAAzBA,EAAAA,EAAyB,iDAAzBA,CAAyB,MAUzBC,GAA4B,SAA5BA,GAA4B,OAA5BA,EAAAA,EAA4B,iCAA5BA,EAAAA,EAA4B,yCAA5BA,EAAAA,EAA4B,2CAA5BA,EAAAA,EAA4B,6CAA5BA,EAAAA,EAA4B,iDAA5BA,CAA4B,MAiB5BC,GAAK,SAALA,GAAK,OAALA,EAAK,eAALA,EAAK,aAALA,CAAK,4BC7BV,SAASC,GAAwBx4D,GACtC,MAAMy4D,EAAsB,CAC1B,kBACA,CACEx4E,KAAM,kBACNmwD,YAAapwC,EAAU04D,GAAyB14D,GAAWrhB,GAAAA,KAW/D,OAPKqhB,GAA4B,WAAjBA,EAAQ5nB,MACtBqgF,EAAShyE,KAAK,CACZxG,KAAM,WACNkuC,MAAO,CAAC,OAAQ,SAAU,UAIvB,CACLwqC,SAAUC,KACVC,QAASC,EAAAA,IACTC,WAAYC,GAAAA,GACZC,mBAAoBC,EAAAA,IACpBT,WAEJ,CAGO,SAASC,GAAyB14D,GACvC,MAAM,KAAE5nB,GAAS4nB,EAEjB,MAAa,WAAT5nB,EACKqG,GAAAA,GAEAwxD,GAA4BjwC,EAEvC,CAEA,SAAS44D,KAA8B,IAAAO,EACrC,MAAM,UAAEC,GAAcC,UAChBV,EAAWU,UAAUV,WAAqB,QAAbQ,EAAIE,iBAAS,IAAAF,GAAe,QAAfA,EAATA,EAAWG,qBAAa,IAAAH,OAAA,EAAxBA,EAA0BR,WAAY,GAO7E,IAAIY,EAoBJ,OAjBEA,EADEhkF,EAAAA,KAAgBikF,EAAAA,IACD,UACR,UAAUpwE,KAAKgwE,GACP,WAC+B,IAT1B,CAAC,UASEjxE,QAAQwwE,GAChB,UAC6B,IAV1B,CAAC,OAAQ,QAUNxwE,QAAQwwE,GACd,QAC8B,IAf1B,CAAC,QAAS,YAAa,WAAY,SAAU,UAe1CxwE,QAAQwwE,GACf,OACgC,IAhB1B,CAAC,QAAS,QAAS,UAAW,SAgB3BxwE,QAAQwwE,GACjB,UACR,QAAQvvE,KAAKuvE,GACL,QAEA,UAGZY,CACT,CC5EO,MAAME,WAAwBC,GAAAA,GAGnC13E,WAAAA,CAAYnH,GAA6E,IAA5D2wC,EAAmB3oC,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,EAAGimD,EAAiCjmD,UAAAjL,OAAA,EAAAiL,UAAA,QAAAjK,EACrF6xB,MAAM5vB,GACNoH,KAAKupC,KAAOA,EACZvpC,KAAK6mD,aAAeA,CACtB,EAGK,MAAM6wB,WAA6BF,GACxCz3E,WAAAA,GACEyoB,MADiB5nB,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,yBACLw1E,GAA0BuB,uBAC3C,EAGK,MAAMC,WAAqBJ,GAChCz3E,WAAAA,GACEyoB,MADiB5nB,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,iBACLy1E,GAA6BwB,cAC9C,EAGK,MAAMC,WAAwBN,GACnCz3E,WAAAA,GAAwE,IAAnC8mD,EAAiCjmD,UAAAjL,OAAA,EAAAiL,UAAA,QAAAjK,EACpE6xB,MADiB5nB,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,cACLy1E,GAA6B0B,kBAAmBlxB,EACjE,EAGK,MAAMmxB,WAAwBR,GACnCz3E,WAAAA,GACEyoB,MADiB5nB,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,oBACLy1E,GAA6B4B,kBAC9C,EASK,MAAMC,WAAgCV,GAC3Cz3E,WAAAA,GACEyoB,MADiB5nB,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,8BACLy1E,GAA6B8B,qBAC9C,yBClCF,IAAIC,GAEJ,SAASC,KACP,IAAKD,GAAY,CACf,IAAI3gF,EACJ2gF,GAAa,IAAIE,YAAY,KAC7B,IAAK,IAAI9jF,EAAI,EAAGA,EAAI,IAAKA,IAAK,CAC5BiD,EAAIjD,EACJ,IAAK,IAAI4O,EAAI,EAAGA,EAAI,EAAGA,IACrB3L,EAAQ,EAAJA,EAAQ,WAAcA,IAAM,EAAKA,IAAM,EAE7C2gF,GAAW5jF,GAAKiD,CAClB,CACF,CAEA,OAAO2gF,EACT,wBCSOhjF,eAAemjF,GACpBhlE,EACAoT,EACAvvB,EACA0iB,EACAs7B,GAEA,MAAMvrC,EAAU0J,aAAyBze,GAAAA,QAAUye,EAAgBze,GAAAA,QAAQC,MAAMwe,GAE3EtV,QAA+B,SAAjB6b,EAAQ3jB,KAQ9B,SACEod,EACAoT,EACAvvB,EACA0iB,GAEA,MAAMlhB,GAAU0e,EAAAA,GAAAA,aACb1C,UAAU,WAAY,IACtBA,WDlEiBhJ,ECkEDkO,EAAQ0+D,OD9DtB,SAAwB/pE,GAE7B,MAAM2pE,EAAaC,KACnB,IAAII,GAAM,EAEV,IAAK,IAAInhF,EAAI,EAAGA,EAAImX,EAAM9Y,OAAQ2B,IAChCmhF,EAAOA,IAAQ,EAAKL,EAA8B,KAAlBK,EAAMhqE,EAAMnX,KAG9C,QAAe,EAAPmhF,KAAc,CACxB,CAbSC,CAAergF,GAAOC,KAAKsT,KCiEE,IACjCgJ,UAAU+R,EAAW,IACrB5R,aAAaxB,GACbolE,oBAAmBxhF,EAAAA,GAAAA,IAAaC,IAChCge,SAAS1B,GAAAA,KAAKksB,WAAW9lB,EAAQ/lB,OACjCshB,UAEGujE,EAAahgF,EAAQqF,ODzEtB,IAAe2N,EC0EpB,OAAO,IAAIrD,WAAWqwE,EAAWpjE,OAAQojE,EAAWviE,WAAYuiE,EAAWvR,WAC7E,CAxBMwR,CAAmBhvE,EAAS8c,EAAWvvB,EAAQ0iB,GA2BrD1kB,eACEme,EACAoT,EACAvvB,EACA0iB,GAEA,MAAMlhB,EAAUP,GAAOwT,OAAO,CAC5BxT,GAAOC,KAAK,CAAC,IAAM,MACnBD,GAAOC,KAAK,0BACZwgF,GAAkBvlE,GAClBwlE,GAA0B1gF,GAAOC,KAAKlB,IAAS,GAC/C4hF,GAAoBryD,GAAW,GAC/BtuB,GAAOC,KAAsB,SAAjBwhB,EAAQ3jB,KAAkB,MAAQ,OAC9C4iF,GACmB,SAAjBj/D,EAAQ3jB,KACJkC,GAAOC,KAAKwhB,EAAQqI,KAAM,QAC1B9pB,GAAOC,KAAKwhB,EAAQrL,MAAO,WAC/B,KAIJ,OAAO,IAAIlG,iBAAiBiG,GAAO5V,GACrC,CAhDMqgF,CAAmBpvE,EAAS8c,EAAWvvB,EAAQ0iB,IAEnD,OAAOi7B,IAAAA,KAAUW,SAASz3C,EAAMm3C,EAClC,CA+CA,SAAS0jC,GAAkBjvE,GACzB,MACMqvE,EAAgB7gF,GAAOqT,YADL,EACmC7B,EAAQ5L,KAAKtI,QAGxE,OAFAujF,EAAcC,aAAatvE,EAAQuvE,WACnCvvE,EAAQ5L,KAAKo7E,KAAKH,EAHM,GAIjBA,CACT,CAEA,SAASH,GAA0BtqE,EAAe6qE,GAChD,MACM9jE,EAASnd,GAAOqT,YADD,EAC4B+C,EAAM9Y,QAOvD,OANI2jF,EACF9jE,EAAO2jE,aAAa1qE,EAAM9Y,QAE1B6f,EAAO+jE,aAAa9qE,EAAM9Y,QAE5B8Y,EAAM4qE,KAAK7jE,EAPU,GAQdA,CACT,CAEA,SAASwjE,GAAoBQ,EAAqBF,GAChD,MAAMG,EAAkBphF,GAAOqT,YAAY,GACrCib,EAAY7e,OAAO0xE,GAMzB,OALIF,EACFG,EAAgBC,gBAAgB/yD,GAEhC8yD,EAAgBE,gBAAgBhzD,GAE3B8yD,CACT,CC9HA,MAAMG,GAAiB,IAEhB,SAASC,GAAczjF,GAA6B,IAAjB0jF,EAASl5E,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,IACpD,MAAwB,iBAAVxK,GAAsBA,EAAMT,QAAUmkF,CACtD,CAEO,SAASC,GAAW/1D,GAEzB,IADiB61D,GAAc71D,EAAK41D,IACrB,OAAO,EAEtB,IAEE,OADA,IAAI31D,IAAID,IACD,CACT,CAAE,MAAOxtB,GACP,OAAO,CACT,CACF,CAEO,SAASwjF,GAA2B1lE,EAAmBwF,GAE5D,OlDfK,SAA8BA,GACnC,MAAyB,kBAAlBA,aAAO,EAAPA,EAAS3jB,KAClB,CkDaM8jF,CAAqBngE,GAChBA,EAAQ+W,SAEbk9B,GAAuBj0C,GAClBA,EAAQmW,YAEV3b,CACT,CAEO,SAAS4lE,GAA2BpgE,GACzC,MAAyB,aAAlBA,aAAO,EAAPA,EAAS3jB,KAClB,wBC0CA,MAAMgkF,GAAqB,6EAErBt8D,GAAM0qD,GAAO1qD,IAEnB,IAAIu8D,GACJ,MAAMC,GAAc,IAAIn6E,SAASC,IAC/Bi6E,GAAcj6E,CAAO,IAGvB,IAAI+Y,GAEG,SAASohE,GAAe5R,GAC7BxvD,GAAWwvD,EACX0R,IACF,CAEOhlF,eAAemlF,GAAQ5gE,EAAyB/gB,EAAyB4Q,GAC9E,UACQgxE,IAAmB,GAEzBthE,GAAS,CACP/iB,KAAM,cACNskF,eAAgB,UAChBC,MAAO/gE,GAAW,eAAgBA,IAGpC,MAAMghE,QAAqBC,GAAkBhiF,EAAQiiF,aAC/C72D,EAAMrK,EAAQqK,KAAO22D,EAAa32D,IAClC82D,EAAcliF,EAAQ8jB,MAAM2M,MAAK9d,IAAA,IAAC,KAAEvN,GAAMuN,EAAA,MAAc,aAATvN,CAAmB,IAClE+8E,EAAYniF,EAAQ8jB,MAAM2M,MAAKwqB,IAAA,IAAC,KAAE71C,GAAM61C,EAAA,MAAc,cAAT71C,CAAoB,IACjEg9E,EAAQD,EAAY,CACxBp0D,UAAW3gB,KAAK/D,MAAMlB,KAAK6X,MAAQ,KACnCxhB,OAAQ,IAAI6sB,IAAID,GAAKsC,KACrBxM,QAASihE,EAAUjhE,cACjBnjB,EAEJ,IAAKmkF,EACH,MAAM,IAAIG,GAAuB,sBAGnC,GAAID,IAAUA,EAAM5jF,OAAO7D,SAAS,KAClC,MAAM,IAAI0nF,GAAuB,kBAGnC,IAAI3xE,QAspBRlU,iBACE,MAAMkU,QAAkBwV,KACxB,IAAKxV,EACH,MAAM,IAAI2xE,GAAuB,4CAEnC,OAAO3xE,CACT,CA5pB0B4xE,GAEtB,MAAM,UAAEjG,EAAS,QAAEh1E,GAAY+0E,KAEzBnD,EAAgB,IACjB8I,EACH32D,MACAm3D,YAAap6E,KAAK6X,SACde,EAAQyhE,cAAgB,CAAEA,cAAc,MACxC,eAAgBzhE,GAAW,CAC7Bqe,IAAKre,EAAQme,aAIX25C,EAAW95C,GAA0Bhe,GAE3CT,GAAS,CACP/iB,KAAM,cACNklF,WAAY,eAAgB1hE,EAAUA,EAAQ0hE,gBAAa1kF,EAC3Ds+E,YACA3rE,YACAuoE,OACAyJ,YAAa,CACXzxE,SAAS,EACTmxE,QAASA,GAEXA,UAGF,MAAMO,QAIgBt7E,EAEtBqJ,EAAYiyE,EAAejyE,UAC3BqQ,EAAQrQ,UAAYA,QACdsoE,GAAQtoE,EAAWuoE,EAAMJ,GAE/B,MAAM1zD,QAAgBH,GAAsBtU,IACtC,QAAEO,GAAYkU,EAAQF,IAEtB29D,EAAajF,GAAwBx4D,GACrCrB,EAA4B,OAC1B++D,GAAyBnyE,EAAWyU,EAAQF,MAGpD,GAAIm9D,EAAO,CACT,MAAM,SAAEx7D,EAAQ,UAAE63B,GAAckkC,EAEhC,IAAIG,EAEFA,EADEl8D,QAmfVpqB,eACEkU,EACAyU,EACAyB,EACAjM,EACAynE,GAEA,MAAMhmC,QAAgBK,GAAa/rC,EAAWkW,EAAUzB,GAClDs5B,QF9pBDjiD,eACLme,EACA6hC,EACA4lC,GAEA,MAAM,UAAEr0D,EAAS,OAAEvvB,EAAM,QAAE0iB,GAAYkhE,EACjCnxE,EAAU0J,aAAyBze,GAAAA,QAAUye,EAAgBze,GAAAA,QAAQC,MAAMwe,GAE3EooE,EAAgBtjF,GAAOwT,OAAO,CAClCxT,GAAOC,KAAK,sBACZwgF,GAAkBjvE,GAClBkvE,GAA0B1gF,GAAOC,KAAKlB,IAAS,GAC/C4hF,GAAoBryD,GAAW,GAC/BtuB,GAAOC,KAAKwhB,KAGR8hE,EAAevjF,GAAOwT,OAAO,CACjCxT,GAAOC,KAAK,CAAC,IAAM,MACnBD,GAAOC,KAAK,eACZD,GAAOC,WAAWkW,GAAOmtE,MAG3B,OAAO5mC,IAAAA,KAAUW,SACf,IAAIntC,iBAAiBiG,GAAOotE,IAC5BxmC,EAEJ,CEooB0BymC,CAA2BtoE,EAAeyhC,EAASG,UAAW6lC,GACtF,OAAOc,GAAuBd,EAAOlsE,GAAcuoC,GACrD,CA5f+B0kC,CAAazyE,EAAWyU,EAAmCyB,EAAU3V,EAASmxE,GAEpFc,GAAuBd,EAAO3jC,GAGjD36B,EAAMlY,KAAKk3E,EACb,CAKA,OAHAxiE,GAAS,CAAE/iB,KAAM,gBACjB+iB,GAAS,CAAE/iB,KAAM,wBAEV,CACLmzC,MAAO,UACP9/B,KACAsQ,QAAS,CACP4C,QACAs/D,OAAQR,GAGd,CAAE,MAAOhlF,GAUP,OATA8C,EAAAA,EAAAA,IAAc,qBAAsB9C,IAEpCmpC,EAAAA,GAAAA,IAAS,KACPzmB,GAAS,CACP/iB,KAAM,mBACNskF,eAAgB,WAChB,IAGGwB,GAAmBzyE,EAAIhT,EAChC,CACF,CAEOpB,eAAeozC,GAAU7uB,EAAyBnQ,GACvD,IACE,MAAM,IAAEwa,EAAG,UAAE1a,SAAoB4yE,GAAoBviE,GAE/C83D,EAAW95C,GAA0Bhe,GAE3C,UAD0B63D,GAAQloE,EAAW0a,EAAKytD,GAEhD,MAAM,IAAIuG,SZ/LT5iF,eACLkU,EACA0a,EACAytD,EACA3mE,GAEA,MAAM+mE,QAAaL,GAAQloE,EAAW0a,EAAKytD,GACtCI,SACCD,GAAQtoE,EAAW,IAAKuoE,KAAS/mE,GAAU2mE,EACnD,CYyLU0K,CAAW7yE,EAAW0a,EAAKytD,EAAU,CAAE0J,YAAap6E,KAAK6X,QAE/D,MAAMmF,QAAgBH,GAAsBtU,GAEtCkyE,EAAajF,GAAwBx4D,GAK3C,MAAO,CACLurB,MAAO,UACP9/B,KACAsQ,QAAS,CACP4C,MAR8B,OAC1B++D,GAAyBnyE,EAAWyU,EAAQF,MAQhDm+D,OAAQR,GAGd,CAAE,MAAOxiF,GAEP,OADAM,EAAAA,EAAAA,IAAc,uBAAwBN,GAC/BijF,GAAmBzyE,EAAIxQ,EAChC,CACF,CAEO5D,eAAegnF,GACpBziE,EACA/gB,GAEA,IACE,MAAM,IAAEorB,EAAG,UAAE1a,SAAoB4yE,GAAoBviE,GAE/C83D,EAAW95C,GAA0Bhe,SACrCq4D,GAAW1oE,EAAW0a,EAAKytD,GAAU,GAC3Cv4D,GAAS,CAAE/iB,KAAM,eACnB,CAAE,MAAOK,IACP8C,EAAAA,EAAAA,IAAc,wBAAyB9C,EACzC,CACA,MAAO,CACLgT,GAAI5Q,EAAQ4Q,GACZ8C,OAAQ,CAAC,EAEb,CAEOlX,eAAeuyE,GACpBhuD,EACA/gB,GAEA,IAAI,IAAAyjF,EACF,MAAM,IAAEr4D,EAAG,UAAE1a,SAAoB4yE,GAAoBviE,IAC/C,QAAElQ,GAAYJ,EAAeC,GAE7BgzE,EAAY5hE,KAAK3lB,MAAM6D,EAAQub,OAAO,KACtC,SAAEgyC,EAAU18C,QAAS8yE,GAAmBD,EAExCv+D,QAAgBH,GAAsBtU,IACtC,KACJnT,EAAM0nB,KAAK,QACThU,EACAooC,UAAWuqC,IAEXz+D,EAEEowC,EAAcsoB,GAAyB14D,GAE7C,GAAIooC,EAASxwD,OAASw4D,EACpB,MAAM,IAAI8sB,GAAuB,8BAA8B9sB,mCAGjE,MAAMsuB,EAAcF,EACfA,IAAmBjG,GAAMoG,QAAU,UAAY,eAChD/lF,EACJ,IAAIgmF,EAAaL,EAAUM,YACvBD,GAAcA,EAAa,IAAM,KAEnCA,EAAa32E,KAAK/D,MAAM06E,EAAa,MAGvC,MAAME,EAAoB,WAAT1mF,EAEjB,IAAI2mF,EAEJ,GAAIR,EAAUhkF,MAAQ8Z,GAAgBkqE,EAAUhkF,QAAU8Z,GAAgBvI,GAAU,CAClF,MAAMooC,EAAYrjC,GAAW4tE,GAC7B,IAAIK,UAkLVznF,eAAuCqU,EAAqBszE,EAA4BlzE,GAAiB,IAAAmzE,EACvG,MAAOrqC,EAAMV,SAAmB/xC,QAAQipB,IAAI,CAC1CopB,GAAgB9oC,EAASI,GACzB8I,GAAmBlJ,EAASI,KAG9B,MAAmC,aAAX,QAAjBmzE,EAAArqC,EAAKD,oBAAY,IAAAsqC,OAAA,EAAjBA,EAAmBh/E,OAAsB84B,GAAaimD,EAAgB9qC,EAC/E,CAzL4BgrC,CAAwBxzE,EAASwoC,EAAWqqC,EAAUhkF,MAG1E,MAAM,IAAI2iF,QAAuBtkF,EAAWkvD,EAAAA,GAAoBq3B,cAFhEJ,EAAiBR,EAAUhkF,IAI/B,CAEA,GAAImkF,GAAehzE,IAAYgzE,EAC7B,MAAM,IAAIxB,QAAuBtkF,EAAWkvD,EAAAA,GAAoBs3B,oBAG5D3C,IAAmB,GAEzBthE,GAAS,CACP/iB,KAAM,cACNskF,eAAgB,kBAChBnxE,YACAoxE,MAAOztE,QAAQ,eAAgB0M,GAAWA,EAAQme,cAGpD,MAAM,iBACJkxB,EAAgB,YAChB8D,SAkON13D,eACEkU,EACA68C,EACA18C,GAEA,MAAMu/C,EAAwC7C,EAAS57C,KAAKomC,IAC1D,MACE9mC,QAASyK,EAAS,OAClByb,EAAM,QACNjW,EAAO,UACPylC,GACE5O,EAEJ,MAAO,CACLr8B,UAAW4C,GAAgB5C,GACvBlC,GAAgBkC,GAAW,EAAM7K,GACjC6K,EACJyb,OAAQjoB,OAAOioB,GACfjW,QAASA,EAAUpG,GAAAA,KAAKksB,WAAW9lB,QAAWnjB,EAC9C4oD,UAAWA,EAAY7rC,GAAAA,KAAKksB,WAAW2f,QAAa5oD,EACrD,IAGGm2D,QAAoBjvC,GAAI+pC,2BAA2Bt+C,EAAW0/C,GAGpE,MAAI,UAAW8D,GACVA,EAAY1zD,QAAU2qD,EAAAA,GAAyBoB,qBAC/C2H,EAAY3O,UAQR,CACL6K,mBACA8D,YAT+D,CAC/D3O,UAAW,CACTgL,YAAY,EACZ5nB,WAAYurB,EAAY3O,UAAU5c,YAEpC0mB,eAAgB6E,EAAY7E,iBAQzB,CACLe,mBACA8D,cAEJ,CA/QcswB,CAAyB9zE,EAAW68C,EAAU18C,GAExD,GAAI,UAAWqjD,EACb,MAAM,IAAImuB,GAAuBnuB,EAAY1zD,MAAO0zD,EAAY1zD,OAGlE,MAAMq4E,EAAW95C,GAA0Bhe,GACrCk4D,QAAcL,GAAQloE,EAAW0a,EAAKytD,GACtC4L,QAyQV,SACE5zE,EACA08C,EACAhI,EACA8J,GAEA,OAAO/nD,QAAQipB,IAAIg9B,EAAS57C,KAC1BnV,MAAA2+C,EAKGvoC,KAAoC,IALhC,QACL3B,EACAkmB,OAAQutD,EACRxjE,QAASyjE,EAAU,UACnBh+B,GACDxL,EACC,MAAMhkB,EAASjoB,OAAOw1E,GAChBhpE,EAAY4C,GAAgBrN,GAAWuI,GAAgBvI,GAAS,EAAMJ,GAAWI,EAEjFuuB,EAAoBhmB,GAAgBvI,OAASlT,EAAW8S,GACxDqQ,GAAUmuC,aAAc,EAAdA,EAAiBz8C,MAC3B+xE,QAAmBpuD,GAAmB1lB,EAAS6K,EAAWipE,QAAc5mF,IACxE,OAAE++B,GAAW3P,GAAoBqS,IAAsB,CAAC,EACxDolD,EAAoBr/B,EAAUgL,gBAAaxyD,EAAYwnD,EAAU1C,mBAAmBjwC,GAE1F,MAAO,CACL8I,YACAyb,SACAwtD,aACAzjE,UACAylC,YACAnnB,oBACA1C,SACA+nD,YAAavD,GAA2BpgE,GACxC4jE,mBAAoB1D,GAA2B1lE,EAAWwF,GAC1DynB,YAAYi8C,aAAiB,EAAjBA,EAAmBj8C,aAAc14B,EAAqBs1C,EAAU5c,WAAY4kB,EAASxwD,QAClG,IAGP,CA7SyCgoF,CACnCl0E,EACA08C,EACA2G,EAAY3O,UACZ2O,EAAY7E,iBAGR,UAAEgtB,EAAS,QAAEh1E,GAAY+0E,KAE/B97D,GAAS,CACP/iB,KAAM,uBACN8+E,YACA3rE,YACAuoE,OACAhiC,aAAcwtC,EACdl/B,UAAW2O,EAAY3O,UAAUgL,gBAAaxyD,EAAYwV,EAAK2gD,EAAY3O,UAAW,CAAC,aAAc,YACrG2+B,mBAGF,MAAMliE,QAA+C3a,EAErD,GAAI08E,GAAcA,EAAc57E,KAAK6X,MAAQ,IAC3C,MAAM,IAAIqiE,GAAuB,wCAGnC,IAAIhhC,EACA7gD,EACAygD,EAEJ,GAAIgjC,EAAU,CACZ,MAAMe,EAAkBhjE,EAClBijE,QAAqBhgE,GAAIksC,mBAAmBzgD,EAAWs0E,GAC7D3jC,EAAM4jC,EAAa5zB,SACnBpQ,EAAoBgkC,EAAa3zB,oBAAoB,GAEjD2zB,EAAazzB,cAAgB,EAC3ByzB,EAAazzB,cAAgBjE,EAASxwD,QACxCujB,GAAS,CACP/iB,KAAM,YACNiD,MAAOysD,EAAAA,GAAoBi4B,4BAI/B1kF,EAAQ,kBAEZ,KAAO,CACL,MAAMomB,EAAW5E,EACXijE,QAAqBhgE,GAAIwoC,oBAAoB,CACjD/8C,YAAWkW,WAAU2mC,SAAU6C,EAAkBjC,SAAU41B,IAEzD,UAAWkB,EACbzkF,EAAQykF,EAAazkF,QAElB6gD,MAAKJ,qBAAsBgkC,EAElC,CAEA,GAAIzkF,EACF,MAAM,IAAI6hF,GAAoB7hF,GAmChC,OAhCK0zD,EAAY3O,UAAUgL,aAA8C,QAAhCkzB,EAAAvvB,EAAY3O,UAAU5jB,kBAAU,IAAA8hD,OAAA,EAAhCA,EAAkC1mF,QAAS,EAElFk0E,GACEvgE,EACA,MACAuwC,EACAiT,EAAY3O,UAAU5jB,YAIxB2uC,GAAwB5/D,EAAW,MAAO+zE,EAAuB9yE,KAAKyzC,IACpE,MAAM,OAAEjuB,EAAM,kBAAEqI,EAAiB,QAAEte,EAAO,WAAEynB,GAAeyc,EACrDzoC,EAA4B,aAAlBuE,aAAO,EAAPA,EAAS3jB,MAAqB2jB,EAAQvE,aAAU5e,EAChE,MAAO,CACLkwB,KAAMgzB,EACN9pB,SACAsN,YAAaxzB,EACbyK,UAAW8jB,EACX7iB,UACAynB,IAAKuE,EACLla,KAAMtf,EAAAA,IAAQsf,KACdsa,oBAAqBkY,EACtB,KAKL3gC,GAAS,CACP/iB,KAAM,uBACNmT,cAGK,CACLgD,OAAQ2tC,EACRzwC,GAAI5Q,EAAQ4Q,GAEhB,CAAE,MAAOhT,GAEP,OADA8C,EAAAA,EAAAA,IAAc,6BAA8B9C,GACrCunF,GAAkBvnF,EAAKoC,EAAQ4Q,GAAI,kBAC5C,CACF,CAEA,SAASu0E,GACPvnF,EACAqjB,EACA4gE,IAEA96C,EAAAA,GAAAA,IAAS,KACPzmB,GAAS,CACP/iB,KAAM,mBACNskF,kBACA,IAGJ,IAEI5zB,EAFAtd,EAAO8sC,GAA6BwB,cACpCmG,EAAe,kBAsBnB,OAnBIxnF,aAAeynF,GAAAA,IACjB10C,EAAO8sC,GAA6B6H,mBACpCF,EAAexnF,EAAIoC,SACVpC,aAAeykF,IACxB1xC,EAAO/yC,EAAI+yC,KACXy0C,EAAexnF,EAAIoC,QACnBiuD,EAAerwD,EAAIqwD,cAEnBA,EADSrwD,aAAekwD,GAAAA,GACTlwD,EAAIqwD,aAEJ/kC,EAAAA,GAAeq8D,WAG5BjlE,IAAYyf,GAAezf,KAAa2tC,GAC1C3tC,GAAS,CACP/iB,KAAM,YACNiD,MAAOytD,IAGJ,CACLztD,MAAO,CACLmwC,OACA3wC,QAASolF,GAEXx0E,GAAIqQ,EAER,CAcOzkB,eAAegpF,GACpBzkE,EACA/gB,GAEA,IACE,MAAM,IAAEorB,EAAG,UAAE1a,SAAoB4yE,GAAoBviE,GAC/CoE,QAAgBH,GAAsBtU,GAE5C,GAAqB,SAAjByU,EAAQ5nB,KAAiB,MAAM,IAAI8kF,GAA+B,uCACtE,GAAqB,WAAjBl9D,EAAQ5nB,KAAmB,MAAM,IAAI8kF,GAA+B,iCAElET,IAAmB,GAEzBthE,GAAS,CACP/iB,KAAM,cACNskF,eAAgB,WAChBnxE,YACAoxE,MAAOztE,QAAQ,eAAgB0M,GAAWA,EAAQme,cAGpD,MAAM,UAAEm9C,EAAS,QAAEh1E,GAAY+0E,KACzBvD,EAAW95C,GAA0Bhe,GACrCk4D,QAAcL,GAAQloE,EAAW0a,EAAKytD,GACtC4M,EAAgB3jE,KAAK3lB,MAAM6D,EAAQub,OAAO,IAEhD+E,GAAS,CACP/iB,KAAM,eACN8+E,YACA3rE,YACAuoE,OACAwM,kBAGF,MAAM7+D,QAAyBvf,EAEzBqM,QAkLVlX,eACEkU,EACAyU,EACA8zD,EACAwM,EACA7+D,GAEA,MAAM,QAAE3V,GAAYkU,EAAQF,IACtB8I,EAAY3gB,KAAK8hB,MAAM/mB,KAAK6X,MAAQ,KACpCxhB,EAAS,IAAI6sB,IAAI4tD,EAAK7tD,KAAKsC,KAC3B0uB,QAAiBK,GAAa/rC,EAAWkW,EAAUzB,GASzD,MAAO,CACLs5B,UAAWvoC,SATWypE,GACtB1uE,EACA8c,EACAvvB,EACAinF,EACArpC,EAAQG,YAKRtrC,UACA8c,YACAvvB,SACA0iB,QAASukE,EAEb,CA5MyBC,CACnBh1E,EACAyU,EACA8zD,EACAwM,EACA7+D,GAQF,OALAtG,GAAS,CACP/iB,KAAM,uBACNmT,cAGK,CACLgD,SACA9C,GAAI5Q,EAAQ4Q,GAEhB,CAAE,MAAOhT,GAEP,OADA8C,EAAAA,EAAAA,IAAc,sBAAuB9C,GAC9BunF,GAAkBvnF,EAAKoC,EAAQ4Q,GAAI,WAC5C,CACF,CAwFA,SAASyyE,GAAmBzyE,EAAYpQ,GACtC,IAAImwC,EAAO6sC,GAA0ByB,cACjCj/E,EAAU,kBAUd,OARIQ,aAAiB6kF,GAAAA,IACnB10C,EAAO6sC,GAA0B8H,mBACjCtlF,EAAUQ,EAAMR,SACPQ,aAAiB6hF,KAC1B1xC,EAAOnwC,EAAMmwC,KACb3wC,EAAUQ,EAAMR,SAGX,CACL4Q,KACA8/B,MAAO,gBACPxvB,QAAS,CACPyvB,OACA3wC,WAGN,CAEAxD,eAAeqmF,GAAyBnyE,EAAmB3L,GACzD,MAAM,QAAE8L,GAAYJ,EAAeC,IAC7B,UAAE2oC,EAAS,QAAEpoC,GAAYlM,EAEzB4hD,QAAkB1hC,GAAIq2B,mBAAmB5qC,EAAW3L,GAE1D,MAAO,CACLK,KAAM,WACN6L,QAASmK,GAAanK,GACtBJ,QAAqB,YAAZA,EAAwB6sE,GAAMoG,QAAUpG,GAAMiI,QACvDtsC,UAAWA,EACXusC,gBAAiBj/B,EACd7uB,MAAM,CAAE+tD,KAAK,EAAMC,OAAO,IAC1B/pF,SAAS,UAEhB,CAcA,SAASmnF,GAAuBd,EAA2B3jC,GACzD,MAAM,UAAE1wB,EAAS,OAAEvvB,EAAM,QAAE0iB,GAAYkhE,EACjC2D,EAAetmF,GAAOC,KAAKlB,GAEjC,MAAO,CACL4G,KAAM,YACNg9E,MAAO,CACLr0D,YACAvvB,OAAQ,CACNwnF,YAAaD,EAAatX,WAC1BjxE,MAAOuoF,EAAahqF,SAAS,SAE/B0iD,YACAv9B,WAGN,CA8BO1kB,eAAewlF,GAAkBC,GACtC,IACE,MAAM,IAAE72D,EAAG,KAAEhmB,EAAI,QAAE6gF,SAAkB3vD,EAAAA,GAAAA,IAAmB2rD,GAClDiE,EAAeD,EAAQl2E,WAAW,UAAwB,KAAZk2E,EAAkB1E,GAAqB0E,EAC3F,IAAK9E,GAAW/1D,KAAS61D,GAAc77E,KAAU+7E,GAAW+E,GAC1D,MAAM,IAAIvqF,MAAM,gBAGlB,MAAO,CACLyvB,MACAhmB,OACA6gF,QAASC,EACTjE,cAEJ,CAAE,MAAOrkF,GAEP,MADA8C,EAAAA,EAAAA,IAAc,YAAa9C,GACrB,IAAIykF,EACZ,CACF,CAEA7lF,eAAe8mF,GACbviE,GAEA,IAAKA,EAAQqK,IACX,MAAM,IAAIi3D,GAAuB,4BAGnC,GAAIthE,EAAQrQ,UACV,OAAOqQ,EAGT,MAAM,QAAElQ,GAAYJ,QvGhnBfjU,iBACL,MAAMkU,QAAkBwV,KACxB,IAAKxV,EACH,MAAM,IAAI/U,MAAM,4CAElB,OAAO+U,CACT,CuG0mB2Cy1E,IACnCC,QZpoBD5pF,eAAwCqU,EAAqBua,GAClE,MAAM8tD,QAAcO,MAAmB,CAAC,EAExC,IACI4M,EADA9D,EAAc,EAgBlB,OAbAzuE,OAAOiQ,QAAQm1D,GAAOh6E,SAAQyT,IAAwB,IAAtBjC,EAAWqoE,GAAMpmE,EAC/C,MAAM2zE,EAAcvN,EAAM3tD,GACrBk7D,GACD71E,EAAeC,GAAWG,UAAYA,GAE1CiD,OAAOa,OAAO2xE,GAAapnF,SAASqnF,IAC9BA,EAAKhE,YAAcA,IACrBA,EAAcgE,EAAKhE,YACnB8D,EAAyB31E,EAC3B,GACA,IAGG21E,CACT,CYgnB8BG,CAAyB31E,EAASkQ,EAAQqK,KACtE,IAAKg7D,EACH,MAAM,IAAI/D,GAAuB,2CAGnC,MAAO,IACFthE,EACHrQ,UAAW01E,EAEf,CAEA5pF,eAAeolF,GAAmBh/D,GAChC,SAAKloB,EAAAA,MAAkBkoB,GAAStC,IAAYyf,GAAezf,YAIrD4uD,GAAS,wBACTuS,GAEC,GACT,wBCjvBA,MAAMgF,GAAU,IACVC,GAAa,GACbC,GAAuB,IAE7B,IAAIC,GAEAC,GAMAvmE,GAPAwmE,GAAsB,GAanBtqF,eAAeuqF,GAAkBp0E,GAMA,IANC,IACvCyY,EAAG,mBAAE47D,EAAkB,WAAEvE,GAK1B9vE,EACC,MAAQwZ,aAAc5Q,EAAQxE,OAAQkwE,GAAqB,IAAI57D,IAAID,GAE7D87D,EAAsB3rE,EAAOqG,IAAI,QAAU,OAC3CiO,EAAU7hB,OAAOuN,EAAOqG,IAAI,MAC5Bud,EAAc5jB,EAAOqG,IAAI,MAEzBulE,EAAwB,SAARD,GAA0B,SAARA,EAClC57E,EAAIiQ,EAAOqG,IAAI,KAErB,IAAKtW,EAQH,YAPI67E,IACFN,GAAsB,CACpB9C,WAAY57E,KAAK6X,MAAQ2mE,GACzBv7D,IAAK87D,EACLF,wBAMN,MAAMI,GAAwCrgD,EAAAA,GAAAA,IAAS,IAAMjlB,KAAK3lB,MAAMmP,MAAOwW,KAAK3lB,MAAMkrF,mBAAmB/7E,KAE7GmlC,EAAAA,EAAAA,IAAS,wBAAyB,CAChC5gB,UAASsP,cAAaioD,iBAAgBF,MAAKD,mBAAkBxE,eAG/D,MAAQlmC,UAAW+qC,EAAgBjuC,UAAWkuC,GAAmBprC,IAAAA,IAASC,UACpEG,EAAYxmC,GAAWuxE,GACvB9vB,EAAWzhD,GAAWwxE,GAGtBxmE,EAA0B,CAC9BqK,SAAKrtB,EACL0kF,aACAvjD,WAAY,CACVs4B,WACAr4B,cACAod,YACAirC,aARiB,IAcrB,SxGoDO7iE,IwGpDFyiE,EAMH,YALA9mE,GAAS,CACP/iB,KAAM,YACNiD,MAAO,6BAMX,MAAMkT,QAAe+zE,GAAmB1mE,EAASqmE,EAvB5B,GAyBrB,GAAqB,kBAAjB1zE,EAAOg9B,MAA2B,CACpC,MAAM,KAAEC,GAASj9B,EAAOwN,QAEpB,CACFs8D,GAA0BuB,uBAC1BvB,GAA0BkK,yBAC1BlK,GAA0B2B,kBAC1B3B,GAA0B6B,kBAC1B7B,GAA0B+B,sBAC1B5kF,SAASg2C,IACTrwB,GAAS,CACP/iB,KAAM,YACNiD,MAAOkT,EAAOwN,QAAQlhB,SAG5B,CAQA,aANM2nF,GAAYj0E,EAAQ6oC,EAAWib,EAAUr4B,GAE1B,kBAAjBzrB,EAAOg9B,aACHk3C,KAGHT,EAIED,OAJP,CAKF,CAEO1qF,eAAeorF,KACpB,MAAOC,EAAaC,EAAYj3E,SAAiBvJ,QAAQipB,IAAI,CbqBtDtrB,GAAQ0d,QAAQ,kBanBrB82D,KACAxzD,OAGF,IAAK6hE,IAAej3E,EAClB,OAGFi2E,GAAWhzE,OAAOiQ,QAAQ+jE,GAAYv1E,QAAO,CAACmB,EAAMunC,KAA8B,IAA3BvqC,EAAWq3E,GAAW9sC,EAC3E,GAAIxqC,EAAeC,GAAWG,UAAYA,EACxC,OAAO6C,EAGT,IAAK,MAAMs0E,KAAcl0E,OAAOa,OAAOozE,GACrC,IAAK,MAAM9O,KAAQnlE,OAAOa,OAAOqzE,GAAa,KAAAC,EAChC,QAAZA,EAAIhP,EAAK75C,WAAG,IAAA6oD,GAARA,EAAUzwB,UACZ9jD,EAAO9H,KAAK,IACPqtE,EAAK75C,IACR1uB,YACA0a,IAAK6tD,EAAK7tD,KAGhB,CAGF,OAAO1X,CAAM,GACZ,IAEH,MAAMw0E,EAAYpzE,GAAWgyE,GAAU,YAAY/yE,OAAOM,SACrD6zE,EAAUnrF,SA4FV6pF,MAEL7/C,EAAAA,GAAAA,IAAS,KACP6/C,GAAgB/2C,OAAO,IAEzB+2C,QAAiB7oF,GA5FjB6oF,GA+FF,SAAyBsB,EAAqBL,GAC5C,MAAMz8D,EAAM,IAAIC,IAAI,GAAG88D,EAAAA,aAKvB,OAJA/8D,EAAIe,aAAapP,IAAI,YAAamrE,EAAU7oF,KAAK,MAC7CwoF,GACFz8D,EAAIe,aAAapP,IAAI,gBAAiB8qE,GAEjC,IAAIO,YAAYh9D,EACzB,CAtGmBi9D,CAAgBH,EAAWL,GAE5CjB,GAAez2C,OAAS,MACtBM,EAAAA,EAAAA,IAAS,qBAAqB,EAGhCm2C,GAAe12C,QAAW9vC,KACxBM,EAAAA,EAAAA,IAAc,cAAeN,EAAE7C,KAAK,EAGtCqpF,GAAev2C,UAAY7zC,UACzB,MAAM,KAAEkD,EAAMM,QAASsoF,GAAqBxmE,KAAK3lB,MAAMu0C,EAAM19B,MAEvDu1E,EAAUzB,GAASr2D,MAAK0qB,IAAA,IAAC,YAAEhc,GAAagc,EAAA,OAAKhc,IAAgBz/B,CAAI,IACvE,IAAK6oF,EAEH,YADA93C,EAAAA,EAAAA,IAAS,sBAAsB/wC,eAIjC,MAAM,UACJgR,EAAS,SAAE8mD,EAAQ,YAAEr4B,EAAW,UAAEod,EAAS,IAAEnxB,EAAG,aAAEo8D,GAChDe,EACEvoF,EA0FV,SAAwBA,EAAiBq5C,EAAmBkD,GAC1D,MAAMisC,EAAa/oF,GAAOC,KAAKM,EAAS,UAClCyoF,EAAQD,EAAW3qE,SAAS,EAAG6oE,IAC/B7+D,EAAY2gE,EAAW3qE,SAAS6oE,IAChCgC,EAAYvsC,IAAAA,IAAS7iC,KACzBuO,EACA4gE,EACAhpF,GAAOC,KAAK25C,EAAW,OACvB55C,GAAOC,KAAK68C,EAAW,QAEnBosC,EAAW,IAAIlgE,YAAY,SAASC,OAAOggE,GACjD,OAAO5mE,KAAK3lB,MAAMwsF,EACpB,CAtGoBC,CAAeN,EAAkBnpD,EAAaod,IAE9D9L,EAAAA,EAAAA,IAAS,aAAczwC,SbpCpB,SAA2B6nF,GAChC,OAAO5iF,GAAQ6d,QAAQ,iBAAkB+kE,EAC3C,CaoCUgB,CAAkBn4C,EAAMm3C,aAC9B,MAAM3oD,EAAa,CACjBs4B,WACAr4B,cACAod,YACAirC,gBAII9zE,QAAe+zE,EAAWznF,EAAQgrB,QAAQ,CAAEI,MAAK1a,YAAWwuB,cAAcl/B,GAIhF,SAFM2nF,GAAYj0E,EAAQ6oC,EAAWib,EAAUr4B,GAE3C0nD,GAAqB,CACvB,MAAM,WAAE9C,EAAU,IAAE34D,EAAG,mBAAE47D,GAAuBH,GAC5C9C,EAAa57E,KAAK6X,OACpBM,GAAS,CAAE/iB,KAAM,UAAW6tB,MAAKmlD,YAAayW,IAEhDH,QAAsB9oF,CACxB,GAEJ,CAkBA,SAAS4pF,GACP3nF,EAAqBu8C,EAAmBib,EAAkBsxB,EAAcC,GAExE,MACMT,EAmCR,SAAwBtoF,EAAqBq5C,EAAmBkD,GAC9D,MAAMksC,GAAQl5E,EAAAA,EAAAA,aAAYm3E,IACpB7+D,EAAYs0B,IAAAA,IAChBn8C,EAASyoF,EAAOhpF,GAAOC,KAAK25C,EAAW,OAAQ55C,GAAOC,KAAK68C,EAAW,QAExE,OAAO98C,GAAOwT,OAAO,CAACw1E,EAAO5gE,IAAY9rB,SAAS,SACpD,CAzC2BitF,CADVvpF,GAAOC,KAAKoiB,KAAKhY,UAAU9J,IACM8oF,EAAMvsC,GACtD,OAGF//C,eAA8BgvB,EAAcgsC,EAAkBsxB,EAAcC,GAC1E,MAAM39D,EAAM,IAAIC,IAAI,GAAG88D,EAAAA,cACvB/8D,EAAIe,aAAapP,IAAI,YAAay6C,GAClCpsC,EAAIe,aAAapP,IAAI,KAAM+rE,GAC3B19D,EAAIe,aAAapP,IAAI,MAAO0pE,GAAQ1qF,YAChCgtF,GACF39D,EAAIe,aAAapP,IAAI,QAASgsE,GAGhC,MAAM/mE,QAAiB2J,MAAMP,EAAK,CAAEJ,OAAQ,OAAQQ,eAC9CI,EAAAA,GAAAA,IAAkB5J,EAC1B,CAdSinE,CAAeX,EAAkB9wB,EAAUsxB,EAAMC,EAC1D,CC9OOvsF,eAAe0sF,GACpBz6D,EACAnU,GAEqC,IADrC2W,EAA6BjpB,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGkpB,EAAAA,UAE1BH,GAAc1pB,QACpB,MAAMuqB,EAAQS,GAAe5D,GAE7B,OAAKmD,EAME9F,GAAe,iBAFN8F,EAAM/M,QAAU1V,EAAAA,IAAQ0V,OAAS+M,EAAMxY,aAAewY,EAAMxY,aAAewY,EAAMuE,SAE/C,CAChDxgB,KAAMsb,EACN3W,WAPO,EASX,CCnBO9d,eAAe2sF,GAAuBC,GAC3C,IACE,aAAax+D,GACX,2BAA4Bw+D,EAAO,CAAEn+D,aAAa,GAEtD,CAAE,MAAOrtB,GAEP,OADA8C,EAAAA,EAAAA,IAAc,yBAA0B9C,IACjC4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CAEOpB,eAAe6sF,GAAyBD,GAC7C,IACE,aAAax+D,GACX,6BAA8Bw+D,EAAO,CAAEn+D,aAAa,GAExD,CAAE,MAAOrtB,GAEP,OADA8C,EAAAA,EAAAA,IAAc,2BAA4B9C,IACnC4uD,EAAAA,GAAAA,IAAkB5uD,EAC3B,CACF,CCTepB,eAAemkB,GAAKL,EAAuB/J,IvFyEnD,SAAwB+J,GAC7Bgf,GAAkBhf,CACpB,CuF1EEgpE,CAAehpE,GACf,MAAMjK,EAAcC,GAAeC,GnHV9BsJ,KAMDA,GE0MC,SACL0pE,EACAjpE,EACAC,GAGA,MAAMV,EAAY,IAAIK,GAAkBqpE,OFhN4BxrF,EEgNVwiB,OAASxiB,OFhNnDyrF,GEkNhB,SAASC,EAAa92E,GAA8C,IAA7C,KAAEK,GAAyCL,EAChEkN,EAAUgC,UAAU7O,EACtB,CAQA,OANAu2E,EAAO1oF,iBAAiB,UAAW4oF,GAEnC5pE,EAAUa,QAAU,KAClB6oE,EAAOG,oBAAoB,UAAWD,EAAqB,EAGtD5pE,CACT,CF7NkB2pE,CAAgB5uF,KAAoCmD,EAAW4rF,EAAAA,KAC3E9pE,GAAUc,QmHOdipE,GAAqBtpE,GACrBspE,GAAoBtpE,GACpBspE,GAAyBtpE,GAEzBspE,GAAiBtpE,GAEbjK,EAAYI,kBACdmzE,GAAkBtpE,GAClBmnE,GAA0BnnE,IAGxBjK,EAAYK,iBHQhB4J,GGPwBA,SvFmEnB,SAA+BA,EAAuB2E,EAAwB4kE,GASnF,OARAxqD,GAeK7iC,eAA8B8jB,EAAuB2E,EAAwB4kE,GAClF,IAAIh6D,EAAU7hB,aAAa/I,GAAQ0d,QAAQ,gBAAgB,IAE3D,GAvFyB,KAuFrBkN,EACF,OAOF,GAJIs4C,EAAAA,MAAmBt4C,SA+UzBrzB,eAAiC8jB,GAC/B,MAAMwpE,EAAiBpvF,EAAAA,IAAeuK,GAAUif,IAK9Co1B,EAAgB,OAChBkvB,EACAv3D,EACA84E,EACA1wC,EACA2wC,EACAC,SACQ3iF,QAAQipB,IAAI,CACpBu5D,EAAennE,QAAQ,iBACvBmnE,EAAennE,QAAQ,aACvBmnE,EAAennE,QAAQ,WACvBmnE,EAAennE,QAAQ,SACvBmnE,EAAennE,QAAQ,aACvBmnE,EAAennE,QAAQ,SACvBmnE,EAAennE,QAAQ,WAGrB6lD,GACFloD,EAAS,CACP/iB,KAAM,iBACN2sF,SAAU,CACR1hB,WAAW,KAKjB,MAAM33D,EAAU23D,EAAY,UAAY,UAClC93D,EAAY,SAASG,IAE3B,GAAII,GAAW84E,GAAS1wC,EAAW,CACjC,MAAMohC,EAA4B,YAAZ5pE,EAAwB,UAAY,UACpDs5E,EAAkB,SAAS1P,IAC3B2P,EAAgB5wE,GAAgBvI,GAAS,EAAOwpE,GAEhD4P,EAAgD,CAAC,EACvDA,EAAe35E,GAAa,CAC1BnT,KAAM,MACNyrB,kBAAmB+gE,EACnB9kE,IAAK,CACH1nB,KAAM,MACN0T,UACA4e,QAASypB,EACTD,YACAzmC,MAAO,IAIXy3E,EAAeF,GAAmB,CAChC5sF,KAAM,MACNyrB,kBAAmB+gE,EACnB9kE,IAAK,CACH1nB,KAAM,MACN0T,QAASm5E,EACTv6D,QAASypB,EACTD,YACAzmC,MAAO,UAIL3N,GAAQ6d,QAAQ,WAAYunE,GAElC/pE,EAAS,CACP/iB,KAAM,yBACNirE,YACA93D,YACAO,UACAk5E,kBACAC,gBACAJ,oBACAC,sBAIF,CACE,gBAAiB,YAAa,QAAS,UAAW,YAAa,QAAS,QAAS,WACjF,sBAAuB,SAAU,WACjC/qF,SAAS4Q,IACJg6E,EAAe/mE,WAAWjT,EAAkB,GAErD,CACF,CApaUw6E,CAAkBhqE,GAGtB1J,EAAAA,MAAiBiZ,EACnB,SAAU5qB,GAAQ0d,QAAQ,YAA0B,GAElDkN,EAAU,OACL,CAEL,MAAM06D,QAAmBC,GAAW7nE,QAAQ,gBACxC4nE,IACF16D,EAAU7hB,OAAOu8E,GAErB,CAIF,GAAI7vF,EAAAA,MAAiBm1B,UAAmB5qB,GAAQ0d,QAAQ,eACtDkN,QAAgB26D,GAAW7nE,QAAQ,gBAE/BkN,GAAS,CAEX,MAAM46D,QAAgBD,GAAWjnE,eAC3Bte,GAAQue,QAASinE,EACzB,CAGF,IAAK56D,EAEH,kBADM5qB,GAAQ6d,QAAQ,eAxHC,IA6HzB,IAAK+M,EAAS,CAEZ,MAAM7G,QAA0B/jB,GAAQ0d,QAAQ,qBAShD,GARIqG,UACI/jB,GAAQ6d,QAAQ,qBAAoChB,KAAKhY,UAAU,CACvE,CAAC4gF,EAAAA,KAAkB1hE,WAEf/jB,GAAQ8d,WAAW,uBAItBiG,EACH,IAAK,MAAM2hE,IAAS,CAAC,qBAAsB,YAAa,cAA0C,CAChG,MAAMC,QAAY3lF,GAAQ0d,QAAQgoE,GAClC,IAAKC,EAAK,SAEV,MAAMC,EAAU/oE,KAAK3lB,MAAMyuF,GAErBE,EAAUh3E,OAAOiQ,QAAQ8mE,GAASt4E,QAAO,CAACw4E,EAASp4E,KAAwB,IAArBjC,EAAWsC,GAAKL,EAC1E,MAAO/B,EAAIiU,EAAQ,OAASnU,EAAUzR,MAAM,KAG5C,OADA8rF,EAD0B,CAACn6E,EAAIiU,GAAOxlB,KAAK,MACZ2T,EACxB+3E,CAAS,GACf,CAAC,SAEE9lF,GAAQ6d,QAAQ6nE,EAAO7oE,KAAKhY,UAAUghF,GAC9C,CAGFj7D,EAAU,QACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,GAAgB,IAAZA,EAAe,CACjB,MAAMiD,QAAkB7tB,GAAQ0d,QAAQ,aACxC,GAAImQ,GAAaA,EAAUn4B,SAAS,cAClC,IAAK,MAAMgwF,IAAS,CAAC,qBAAsB,YAAa,cAA0C,CAChG,MAAMK,SAAkB/lF,GAAQ0d,QAAQgoE,IAAkBn8E,QAAQ,aAAc,cAC1EvJ,GAAQ6d,QAAQ6nE,EAAOK,EAC/B,CAGFn7D,EAAU,QACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,GAAIA,GAAW,GAAKA,GAAW,EAAG,CAChC,IAAK,MAAM/f,IAAO,CAAC,YAAa,qBAAsB,aAAc,SAA0B,CAC5F,MAAMwS,QAAgBrd,GAAQ0d,QAAQ7S,GACf,iBAAZwS,SACHrd,GAAQ6d,QAAQhT,EAAKgS,KAAK3lB,MAAMmmB,GAE1C,CAEAuN,EAAU,QACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,GAAgB,IAAZA,EAAe,CACjB,MAAMqpD,QAAcj0E,GAAQ0d,QAAQ,SACpC,GAAIu2D,EAAO,CACT,IAAK,MAAM+R,KAAgBn3E,OAAOa,OAAOukE,GACvC,IAAK,MAAMD,KAAQnlE,OAAOa,OAAOs2E,GAC/BhS,EAAKsJ,YAAc,QAGjBt9E,GAAQ6d,QAAQ,QAASo2D,EACjC,CAEArpD,EAAU,QACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,GAAgB,IAAZA,EAAe,CACjB,IAAK,MAAM/f,IAAO,CAAC,YAAa,qBAAsB,aAAc,WAAY,SAA0B,CACxG,IAAIkD,QAAa/N,GAAQ0d,QAAQ7S,GAC5BkD,IAELA,EAAOc,OAAOiQ,QAAQ/Q,GAAMT,QAAO,CAAC24E,EAAWjwC,KAAuC,IAApCkwC,EAAmBC,GAAYnwC,EAC/E,MAAMowC,EAAS56E,EAAe06E,GACxBG,EAAmBtrD,GAAkB,IAAKqrD,EAAQx6E,QAAS,YAC3D06E,EAAmBvrD,GAAkB,IAAKqrD,EAAQx6E,QAAS,YACjE,MAAO,IACFq6E,EACH,CAACI,GAAmBF,EACpB,CAACG,GAAmBH,EACrB,GACA,CAAC,SAEEnmF,GAAQ6d,QAAQhT,EAAKkD,GAC7B,CAEA6c,EAAU,QACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,GAAgB,IAAZA,EAAe,CACjB,MAAMiD,QAAmB7tB,GAAQ0d,QAAQ,aAEzC,GAAImQ,EAAW,CACb,MAAM04D,QAAoBvmF,GAAQ0d,QAAQ,cACpCkS,QAAkB5vB,GAAQ0d,QAAQ,aAAe,CAAC,EAExD,IAAK,MAAOjS,EAAW+6E,KAAe33E,OAAOiQ,QAAQ+O,GAAY,CAC/D,MAAM44D,EAAalyE,GAAgBiyE,GAAY,GAE/C52D,EAASnkB,GAAa,IACjBmkB,EAASnkB,GACZO,QAASy6E,EACTryC,UAAWmyC,EAAW96E,IAGxB4P,EAAS,CACP/iB,KAAM,gBACNmT,YACAmU,MAAO,MACP5T,QAASy6E,GAEb,OAEMzmF,GAAQ6d,QAAQ,WAAY+R,SAE5B5vB,GAAQ8d,WAAW,mBACnB9d,GAAQ8d,WAAW,aAC3B,CAEA8M,EAAU,QACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,GAAgB,IAAZA,EAAe,CACjB,GAAIvY,KAAiBZ,eAAgB,CACnC,MAAMwiE,QAAcj0E,GAAQ0d,QAAQ,SAEpC,GAAIu2D,EAAO,CACT,MAAMp1D,EAA8B,GAEpC,IAAK,MAAMmnE,KAAgBn3E,OAAOa,OAAOukE,GACvC,IAAK,MAAMD,KAAQnlE,OAAOa,OAAOs2E,GAAsC,KAAAhD,EAC1C0D,EAAf,QAAZ1D,EAAIhP,EAAK75C,WAAG,IAAA6oD,GAARA,EAAU9oD,aACZrb,EAAMlY,KAAK,CAAE4rD,SAAkB,QAAVm0B,EAAE1S,EAAK75C,WAAG,IAAAusD,OAAA,EAARA,EAAUxsD,aAErC,CAEJ,CACF,CAEAtP,EAAU,QACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,GAAgB,IAAZA,EAAe,CACjB,GAAIjZ,EAAAA,IAAc,CAChB,MAAM5D,QAAaw3E,GAAWjnE,SAE9B,IAAK,MAAOzT,EAAKtS,KAAUsW,OAAOiQ,QAAQ/Q,GAIxC,SAHMoR,GAAiBtB,QAAQhT,EAAmBtS,IAG7C0gC,GAAa1gC,QAFK4mB,GAAiBzB,QAAQ7S,GAAmB,IAGjE,MAAM,IAAInU,MAAM,0BAGd6uF,GAAWxnE,OACnB,CAEA6M,EAAU,SACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,IAAI+7D,GAA4B,EAMhC,GALIt0E,KAAiBu0E,UAAYh8D,GAAW,IAAMA,GAAW,WACrDoQ,KACN2rD,GAA4B,GAGd,KAAZ/7D,GAA8B,KAAZA,GAA8B,KAAZA,EAAgB,CACtD,MAAMgF,QAIiB5vB,GAAQ0d,QAAQ,YAAY,GAEnD,GAAIkS,EAAU,CACZ,IAAK,MAAM1P,KAAWrR,OAAOa,OAAOkgB,GAAW,CAC7C,MAAM,UAAEwkB,EAAS,QAAEpoC,EAAS4e,QAASypB,GAAkBn0B,EAEvD,GAAIm0B,IAAkBD,EAAW,SAEjC,MAAM6tB,EAAiBlxD,GAAWqjC,GAC5BuE,EAAa34B,EAAI02B,oBAAoB,UAAWurB,EAAgBj2D,GAEtEkU,EAAQ0K,QAAU+tB,EAAW/tB,OAC/B,OAEM5qB,GAAQ6d,QAAQ,WAAY+R,EACpC,CAEAhF,EAAU,SACJ5qB,GAAQ6d,QAAQ,eAAgB+M,EACxC,CAEA,GAAgB,KAAZA,EAAgB,CAClB,MAAMgF,QAIiB5vB,GAAQ0d,QAAQ,YAAY,GAEnD,GAAIkS,EAAU,CACZ,IAAK,MAAOnkB,EAAWyU,KAAYrR,OAAOiQ,QAAQ8Q,GAAW,CAC3D,MAAM,QAAEhkB,GAAYJ,EAAeC,GACnB,YAAZG,IACFsU,EAAQlU,QAAUuI,GAAgB2L,EAAQlU,SAAS,EAAOJ,GAE1DyP,EAAS,CACP/iB,KAAM,gBACNmT,YACAmU,MAAO,MACP5T,QAASkU,EAAQlU,UAGvB,CAEA4e,EAAU,SACJ5qB,GAAQ6d,QAAQ,WAAY+R,EACpC,CACF,CAEgB,KAAZhF,GAA8B,KAAZA,IAChBvY,KAAiBu0E,WAAaD,SAC1B3rD,KAGRpQ,EAAU,SACJ5qB,GAAQ6d,QAAQ,eAAgB+M,IAGxB,KAAZA,UwF7XCrzB,iBACL,MAAMsvF,QAA+D7mF,GAAQ0d,QAAQ,YAErF,IAAKmpE,EAAgB,OAErB,MAAMC,QAA6C9mF,GAAQ0d,QAAQ,sBAC7D0nE,EAAsC,CAAC,EAE7C,IAAK,MAAO35E,EAAWs7E,KAAel4E,OAAOiQ,QAAQ+nE,GAAiB,CACpE,MAAM,QACJ76E,EAAO,QAAE4e,EAAO,UAAEwpB,EAAS,UAAEvuB,EAAS,OAAEoxD,EAAM,cAAEzoD,GAC9Cu4D,EAEEnwC,EAAY,CAChBt+C,KAAM,MACN0T,UACA4e,UACAwpB,YACAvuB,YACA2I,gBACA7gB,OAAOspE,aAAM,EAANA,EAAQtpE,QAAS,GAG1By3E,EAAe35E,GAAawrE,EAAS,CACnC3+E,KAAM,SACN0nB,IAAK42B,EACL8+B,OAAQuB,EAAOvB,OACfC,SAAUsB,EAAOtB,SACjBC,WAAYqB,EAAOrB,YACjB,CACFt9E,KAAM,MACNyrB,kBAAmB+iE,EAAar7E,GAChCuU,IAAK42B,EAET,OAEM52C,GAAQ6d,QAAQ,WAAYunE,EACpC,CxFyVU4B,GAENp8D,EAAU,SACJ5qB,GAAQ6d,QAAQ,eAAgB+M,IAGxB,KAAZA,UyFjZCrzB,iBAGL,MAAM0vF,QAAsEjnF,GAAQ0d,QAAQ,SAE5F,IAAKupE,EAAU,OAEf,MAAMC,EAAoE,CAAC,EAE3E,IAAK,MAAOz7E,EAAWqoE,KAAUjlE,OAAOiQ,QAAQmoE,GAAW,CACzDC,EAASz7E,GAAa,CAAC,EAEvB,IAAK,MAAO0a,EAAK6tD,KAASnlE,OAAOiQ,QAAQg1D,GAAQ,CAC/C,MAAMF,EAAW95C,GAA0Bk6C,GAC3CkT,EAASz7E,GAAW0a,GAAO,CAAE,CAACytD,GAAWI,EAC3C,CACF,OAEMh0E,GAAQ6d,QAAQ,QAASqpE,EACjC,CzF+XUF,GAENp8D,EAAU,SACJ5qB,GAAQ6d,QAAQ,eAAgB+M,IAGxB,KAAZA,U0F1ZCrzB,eAAqB4vF,GAC1B,IAAKA,GAAgD,IAA5BA,EAAiBrvF,OACxC,OAGF,MAAM83B,QAAkD5vB,GAAQ0d,QAAQ,YAEnEkS,SAIC5vB,GAAQ6d,QAAQ,WAAYvP,EAAKshB,EAAUu3D,GACnD,C1F+YUH,CAA6BpC,GAEnCh6D,EAAU,SACJ5qB,GAAQ6d,QAAQ,eAAgB+M,GAE1C,CA1T2Bw8D,CAAe/rE,EAAU2E,EAAK4kE,GACpDvoE,OAAO1jB,IAAQ,IAAA0uF,GACd5rF,EAAAA,EAAAA,IAAc,kBAAmB9C,GAClB,QAAf0uF,EAAAhtD,UAAe,IAAAgtD,GAAfA,EAAkB,CAChB/uF,KAAM,YACNiD,MAAO,mBACP,IAEC6+B,EACT,CuF1EQktD,CAAsBjsE,EAAUqvD,GAAO1qD,IAAK1O,EAAKszE,YAEnDxzE,EAAYK,gBACT81E,KAWThwF,eAA4B+Z,GAC1B,IAAImhD,QAAiBzyD,GAAQ0d,QAAQ,iBAEpB5kB,IAAb25D,IAEAnhD,EAAKmhD,SACPA,EAAWnhD,EAAKmhD,WAEbA,kBAAmB5rC,GAAsC,wBAIxD7mB,GAAQ6d,QAAQ,WAAY40C,GAAY,IAChD,CArBO+0B,CAAal2E,EACpB,E1BhCO,SAAkBmP,GACvB,IAAK,MAAOtgB,EAAM+pE,KAASr7D,OAAOiQ,QAAQ2B,GACxCupD,GAAM7pE,IAAS6pE,GAAM7pE,IAAS,IAAI6N,OAAO,CAACk8D,GAE9C,C0BLAud,CAAS,CACPC,mBHkNKnwF,eAAiCkU,EAAmB0a,GACzD,MAAMm9D,EAAUzB,GAASr2D,MAAMm8D,GAAMA,EAAExhE,MAAQA,GAAOwhE,EAAEl8E,YAAcA,IACtE,IAAK63E,EAAS,OAEd,MAAM,UAAEhsC,EAAS,SAAEib,EAAQ,YAAEr4B,GAAgBopD,EAGvCvmE,EAA4B,CAChC0uB,MAAO,aACP9/B,GAJmB23E,EAAQf,aAAe,EAK1CtmE,QAAS,CAAC,SAGNymE,GAAY3lE,EAAUu6B,EAAWib,EAAUr4B,EACnD,EG/NE0tD,eAAgBL,KhIUX,SACLM,EACAvsE,GAGA,IAFAF,EAA4ErY,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGpN,KAG/E,SAASmyF,EAAa/5E,EAAyBg6E,GAC7Ch6E,EAAKuN,QAAUA,EAEXysE,EACF3sE,EAAOS,YAAY9N,EAAMg6E,GAEzB3sE,EAAOS,YAAY9N,EAEvB,EAV4BhL,UAAAjL,OAAA,EAAAiL,UAAA,QAAAjK,IAmP9B,SAAsBgvF,GACpBnyF,KAAKs1C,QAAW9vC,IAAM,IAAA6sF,EAAAC,EACpB,MAAMltF,GAAiB,QAAPitF,EAAA7sF,EAAEI,aAAK,IAAAysF,OAAA,EAAPA,EAASjtF,UAAW,gCACpCU,EAAAA,EAAAA,IAAcV,EAASI,EAAEI,OAEzBusF,EAAa,CACXxvF,KAAM,iBACNiD,MAAO,CACLR,UACA3C,MAAc,QAAT6vF,EAAE9sF,EAAEI,aAAK,IAAA0sF,OAAA,EAAPA,EAAS7vF,QAElB,EAGJzC,KAAKiG,iBAAiB,sBAAuBT,IAAM,IAAA+sF,EAAAC,EACjD,MAAMptF,GAAkB,QAARmtF,EAAA/sF,EAAEK,cAAM,IAAA0sF,OAAA,EAARA,EAAUntF,UAAW,iCACrCU,EAAAA,EAAAA,IAAcV,EAASI,EAAEK,QAEzBssF,EAAa,CACXxvF,KAAM,iBACNiD,MAAO,CACLR,UACA3C,MAAe,QAAV+vF,EAAEhtF,EAAEK,cAAM,IAAA2sF,OAAA,EAARA,EAAU/vF,QAEnB,GAEN,CAhQIgwF,CAAaN,GAUd1sE,EAAsCxf,iBAAiB,WAPxD,SAAuBT,GAAuB,IAAAktF,GAClC,QAANA,EAAAltF,EAAE4S,YAAI,IAAAs6E,OAAA,EAANA,EAAQ/sE,WAAYA,GAgI5B/jB,eACEswF,EACA95E,EACA+5E,EACAzsE,EACAvJ,GAWA,OATKuJ,IACHA,EAAYpO,IACV66E,EAAa,CACXxvF,KAAM,SACN2U,UACA,GAIEc,EAAKzV,MACX,IAAK,OAAQ,KAAAgwF,EACX,MAAM,KAAEh3E,GAASvD,EACX3L,EAAyB,mBAARylF,EACnBA,EAAI,OAAQ/1E,EAAQuJ,KAAa/J,GACzB,QAD8Bg3E,EACtCT,EAAInsE,YAAI,IAAA4sE,OAAA,EAARA,EAAArrE,KAAA4qE,EAAWxsE,KAAa/J,SACtBlP,EAEN,KACF,CACA,IAAK,aAAc,CACjB,MAAM,UACJ4Z,EAAS,KAAE7b,EAAI,KAAEmR,EAAI,aAAE8K,GACrBrO,EACJ,IAEE,GAAmB,mBAAR85E,IAAuBA,EAAI1nF,GAAO,OAE7C,GAAI6b,GAAaI,EAAc,CAC7B,MAAM3B,EAAW,WAA4B,QAAAkB,EAAA5Y,UAAAjL,OAAxBolB,EAAY,IAAA3U,MAAAoT,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAZsB,EAAYtB,GAAA7Y,UAAA6Y,GAC/B,MAAM2sE,EAAUrrE,EAAaA,EAAaplB,OAAS,GA0D/D,IAAwByiB,EAxDZutE,EAAa,CACXxvF,KAAM,iBACN0jB,YACAkB,iBAqDU3C,EApDMguE,aAqDN18C,aAAetxB,aAAeiuE,YArDb,CAACD,QAAWzvF,EAC3C,EAEAwS,EAAcwM,IAAIkE,EAAWvB,GAE7BnJ,EAAK3K,KAAK8T,EACZ,CAEA,MAAMsC,EAA0B,mBAAR8qE,QACdA,EAAI1nF,EAAM2R,KAAWR,SACrBu2E,EAAI1nF,MAASmR,IACjB,YAAEm3E,GAAqC,iBAAb1rE,GAAyBA,GAAY,gBAAiBA,GAAa,CAAC,EAEhGf,GACF8rE,EACE,CACExvF,KAAM,iBACN0jB,YACAe,YAEF0rE,EAAc,CAACA,QAAe3vF,EAGpC,CAAE,MAAOH,IACP8C,EAAAA,EAAAA,IAAc0E,EAAMxH,GAEhBqjB,GACF8rE,EAAa,CACXxvF,KAAM,iBACN0jB,YACAzgB,MAAO,CAAER,QAASpC,EAAIoC,UAG5B,CAEIihB,GACF1Q,EAAciR,OAAOP,GAGvB,KACF,CACA,IAAK,iBAAkB,CACrB,MAAMvB,EAAWnP,EAAcqR,IAAI5O,EAAKiO,WACpCvB,IACFA,EAASiC,YAAa,GAGxB,KACF,EAEJ,CA3NWE,CAAUirE,EAAK1sF,EAAE4S,KAAM+5E,EAEhC,GAQF,CoI7CAY,EAA2B,SAACvoF,EAAc2R,GAAoC,QAAA6J,EAAA5Y,UAAAjL,OAAhBwZ,EAAI,IAAA/I,MAAAoT,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJtK,EAAIsK,EAAA,GAAA7Y,UAAA6Y,GAChE,MAAa,SAATzb,EACKub,GAAKpK,EAAK,GAAmBA,EAAK,IAErCnR,EAAK2K,WAAW,gBAClB3K,EAAOA,EAAKoJ,QAAQ,cAAe,KAG5Bwc,EAFQ4iE,EAAcxoF,OAEZmR,KAMZyU,EAHQ4+D,EAAQxkF,OAGNmR,EAErB,gEC7BA,MAAMmM,EAAQ,IAAImrE,QAEH,SAASlmF,EAAiCsc,GACvD,OAAO,WACL,IAAI6pE,EAAUprE,EAAMd,IAAIqC,GAAI,QAAArD,EAAA5Y,UAAAjL,OADnBwZ,EAAI,IAAA/I,MAAAoT,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJtK,EAAIsK,GAAA7Y,UAAA6Y,GAEb,MAAMktE,EAAWx3E,EAAK5E,IAAI7S,QAAQO,KAAK,KAEvC,GAAIyuF,EAAS,CACX,MAAME,EAASF,EAAQlsE,IAAImsE,GAC3B,GAAIC,EACF,OAAOA,CAEX,MACEF,EAAU,IAAIt9E,IACdkS,EAAM3F,IAAIkH,EAAI6pE,GAGhB,MAAM9C,EAAW/mE,KAAM1N,GAIvB,OAFAu3E,EAAQ/wE,IAAIgxE,EAAU/C,GAEfA,CACT,CACF,k7BCXO,MAAMprF,EAAUquF,aAEV9lB,GAAiB8lB,EACjBhQ,EAAoC9V,EAAiB,aAAe,cACpEn8C,EAAciiE,QASdhzD,EAAoB,eAAZr7B,GAAwC,SAAZA,GAAkC,SAAZA,EAC1DsuF,GAAa,EAObxzF,GAAeuzF,EAIfr3E,GAFqBq3E,EAAQE,IAAIC,oBAElBH,GAEfzZ,GAAayZ,EACbtP,GAAkBsP,EAYlBxvB,EAAmD,mDACnDjR,EAA+C,mDAI/C5sD,EAAkB,mFAMlBs5E,GAA6B/R,EAI7Bn3D,EAAyB,GAkCzB05E,EAAkB,gBAElB/xE,EAA6D,oCAC7DzB,EAAwB+2E,GACxBh3E,EAAiCg3E,GACjCz5D,EAA2D,mCAE3Dvb,EAA6D,4CAC7D5B,EAAwB42E,GACxB72E,EAAiC62E,GACjCt5D,EAA2D,2CAE3DrJ,EAA+D,8BAC/D+iE,EAAuD,oCACvDC,EAAwB,wBACxBnG,EAAiB,mDAwGjBpgB,EAAsBI,EACtBvM,EAAuB,QACvB76D,EAAU,YACVixD,EAAc,UACdiK,EAA2B,KAE3B0B,EAAmF,GACnFp2B,EAAyC,mDACzCzO,EAA6C,mDAG7CuiC,EAA6B,WAE7BgjB,EAA8B,EAI9BvgD,EAA2B,CACtC,qEACA,sEAEWP,EAAuC,4DACvCU,EAAkC,uBAGlCZ,EAAuB,mDAKvBluB,EAAU,CACrB/J,KAAM,UACN+wB,OAAQ,MACR1H,KAAM,UACNxf,SAAU,EACV4V,MAAO,MACP0pE,QAAS,WAGEvkB,EAAM,CACjB5kE,KAAM,OACN+wB,OAAQ,MACR1H,KAAM,MACNxf,SAAU,EACV4V,MAAO,OACP0pE,QAAS,QAGEC,EAAS,CACpBppF,KAAM,mBACN+wB,OAAQ,KACR1H,KAAM,iBACNxf,SAAU,EACV4V,MAAO,MACP4pE,cAAe,oDASJ1wC,EAAe,CAC1B94B,IAAK,CACHypE,iBAAiB,EACjBC,gBAAgB,EAChBC,aAAc,gCACdC,mBAAoB,oCACpB3wC,YAAa/uC,GAEfiW,KAAM,CACJspE,iBAAiB,EACjBC,gBAAgB,EAChBC,aAAc,8BACdC,mBAAoB,gCACpB3wC,YAAa8rB,EACbxxD,QAAS,CACPgxD,OApLkE,kCAqLlE0D,YAAa,sCAEfl0D,QAAS,CACPwwD,OAvLkE,iCAwLlE0D,YAAa,wCAKN4hB,EAA0B,kBAC1BC,EAA0B,kBAC1B5lC,EAAgB,iBAIhBvkB,EAAsB,mDAEtBE,GAAuB,mDAOvBy7B,GAAwB,IAAI1sD,IAAI,CAC3C1E,EAAQsf,KACR06B,EACA6gB,EAAIv7C,KACJqgE,IAGWpmD,GAAoB,mDAGpBsB,GAAoB,2CAE3BglD,GAAa,CACjB5pF,KAAM,aACN+wB,OAAQ,OACRlnB,SAAU,EACV4V,MAAO,QAGHoqE,GAAW,CACf7pF,KAAM,aACN+wB,OAAQ,OACRtR,MAAO,MACP4J,KAAM06B,EACNl6C,SAAU,EACVmK,aAAc,oDAGHyrB,GAAW,CACtBz/B,KAAM,cACN+wB,OAAQ,OACRtR,MAAO,MACPzL,aAAc,mDACdqV,KAAM,iBACNxf,SAAU,EAEVinB,MAAO,2JAGIgP,GAAa,CACxB9/B,KAAM,gBACN+wB,OAAQ,SACRtR,MAAO,MACPzL,aAAc,mDACdqV,KAAM,iBACNxf,SAAU,EAEVinB,MAAO,mLAqBHg5D,IAdJhqD,GAAW9rB,aAIXjK,EAAQsf,KAAqBu7C,EAAIv7C,KAOjCtf,EAAQsf,KAAqBu7C,EAAIv7C,KAGd,CACnBuD,eAAe,EACfC,MAAO,EACPC,SAAU,EACVC,iBAAkB,IAGPf,GAAgD,CAC3D+9D,QAAS,IACJhgF,EACH6iB,eAAe,EACfC,MAAO,IACPC,SAAU,IACVC,iBAAkB,GAEpBw3C,IAAK,IACAK,KACAklB,IAEL,CAACJ,GAA0B,IACtBE,GACHvgE,KAAMqgE,EACN11E,aAAc,wCACX81E,IAEL,CAACH,GAA0B,IACtBC,GACHvgE,KAAMsgE,EACN31E,aAAc,wCACX81E,IAEL,CAAC/lC,GAAgB,IACZ8lC,GAEH/4D,MAAO,gKACPzH,KAAM06B,KACH+lC,IAEL,CAACV,EAAO//D,MAAO,IACV+/D,EAEHt4D,MAAO,qKACJg5D,IAEL,CAACrqD,GAASpW,MAAO,IACZoW,MACAqqD,IAEL,CAAChqD,GAAWzW,MAAO,IACdyW,MACAgqD,KAiDMtrE,IApCDzU,EAAQgnB,OACThnB,EAAQ0V,MACT1V,EAAQsf,KACJtf,EAAQF,SAoB2BE,EAAQsf,KACZtf,EAAQsf,KAEVtf,EAAQsf,KAUpB,gBAClB5K,GAAwB,SAExB8lE,GAA0B,iBAO1Bz4D,GAAyB,MAUzByT,IAHVx1B,EAAQgnB,OAGiB,oDAEfskB,GAA8C,KAC9C2sB,GAAiD,CAAC,OAAQ,OAAQ,OAAQ,MAC1ED,GAAgD,CAAC,OAAQ,QAEzDtuD,GAAkB,IAClBu2E,GAAkB,EAClBC,GAAsB,IAMtBr7B,GAAiB,EACjBM,GAA2B,mDAE3BM,GAA6B,UAC7BL,GAAqB,CAChC,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,mDACA,oDAYW/mC,GAAmB,kIAEnBsS,GAAoB,gGAmFpBggC,IAhDyB,IAAIjsD,IAAI,CAC5C,mEACA,mEACA,mEACA,mEACA,mEACA,mEACA,mEACA,mEACA,qEAGgC,IAAIA,IAAI,CAtSX,iBACG,iBAwShCqxB,GAAWzW,OAQAtf,EAAQsf,KAeRtf,EAAQsf,KAUW,GACnBuF,GAA4B,KAcnCs7D,GAAoB,CACxB,CACE95E,SAAU,CAAC,OACXC,WAAY,uCACZwkB,SAAU,mDACV2D,eAAgB,mBAElB,CACEpoB,SAAU,CAAC,QACXC,WAAY,uCACZwkB,SAAU,mDACVC,YAAY,EACZ0D,eAAgB,sBAElB,CACEpoB,SAAU,CAAC,MAAO,UAAW,WAC7BC,WAAY,sCACZwkB,SAAU,mDACV2D,eAAgB,kBAChB2xD,cAAc,GAEhB,CACE/5E,SAAU,CAAC,QACXC,WAAY,sCACZwkB,SAAU,mDACV2D,eAAgB,mBAChB2xD,cAAc,IAILh6E,GAAgB4yD,EACzBmnB,GAAkBv7E,QAAOpB,IAAA,IAAC,aAAE48E,GAAc58E,EAAA,OAAM48E,CAAY,IAC5DD,qGC5qBG,MAAMrrC,EAASh1B,GAAe,IAAI3nB,SAAeC,IACtDioF,YAAW,IAAMjoF,KAAW0nB,EAAG,IAiC1B,SAASlvB,EACdkkB,EACAgL,GAEA,IACI1Y,EAFJk5E,IAAcznF,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,KAAAA,UAAA,GAGV0nF,GAAY,EAEhBlzF,eAAemzF,UACQ,mBAAP1gE,EAAoBA,IAAOg1B,EAAMh1B,IAC1C2gE,GACP,CAEApzF,eAAeozF,IACb,GAAKr5E,EAKL,IACE,MAAMs5E,EAAYt5E,EAClBA,OAAOxY,QACDkmB,KAAM4rE,EACd,CAAE,QAEKF,GACP,MAXED,GAAY,CAYhB,CAEA,OAAO,WAA6B,QAAAI,EAAA9nF,UAAAjL,OAAzBgzF,EAAK,IAAAviF,MAAAsiF,GAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAALD,EAAKC,GAAAhoF,UAAAgoF,GACdz5E,EAAOw5E,EAEFL,IACHA,GAAY,EAERD,EACGG,IAEAD,IAGX,CACF,CAgLO,SAASjkD,EAAsBzc,EAAYQ,GAChD,MAAMwgE,EAAYT,WAAW//D,EAAIR,GACjC,MAAO,IAAMihE,aAAaD,EAC5B,CAOO,SAAS7rB,IAAoC,IAApB+rB,EAAcnoF,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,EAC/C,MAAMooF,EAA4B,GAClC,IAAIC,EAAc,EAElB,MAUM9hD,EAAU+hD,IACd,MAAM/1F,EAAW,IAAI2M,EAAAA,EAarB,OAZAkpF,EAAMxkF,MAAKpP,UACT,IACEjC,EAASgN,cAAc+oF,IACzB,CAAE,MAAO1yF,GACPrD,EAASiN,OAAO5J,EAClB,KAGEyyF,EAAcF,GApBH3zF,WAEf,IADA6zF,IACOD,EAAMrzF,QAAQ,CACnB,MAAMuzF,EAAOF,EAAMvkF,cACbykF,GACR,CACAD,GAAa,EAeNE,GAGAh2F,EAAS8M,OAAO,EAUzB,MAAO,CAAEknC,MAAKk3B,KALZ6qB,GAEO,mBAAAE,EAAAxoF,UAAAjL,OAAIwZ,EAAI,IAAA/I,MAAAgjF,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJl6E,EAAIk6E,GAAAzoF,UAAAyoF,GAAA,OAAWliD,GAAI,IAAM+hD,KAAQ/5E,IAAM,EAItD,CAMO,SAAS87B,EACdzQ,GAEA,OAAOwiC,EAAgB,GAAGqB,KAAK7jC,EACjC,4FCxTO,MAAMi9C,UAAqBljF,MAChCwL,WAAAA,CAAYnH,EAAyBiuD,GACnCr+B,MAAM5vB,GAAS,KADoBiuD,aAAAA,EAEnC7mD,KAAKhC,KAAOgC,KAAKD,YAAY/B,IAC/B,EAGK,MAAM83E,UAA4B2B,EACvC13E,WAAAA,GACEyoB,MADyB5nB,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,uBAE9B,EAGK,MAAM8lD,UAAuB+wB,EAClC13E,WAAAA,CAAYnH,EAAwBguD,GAClCp+B,MAAM5vB,EAASkpB,EAAAA,GAAewnE,aAAa,KADT1iC,WAAAA,CAEpC,EAqCK,SAASxB,EAAkB5uD,GAChC,GAAIA,aAAekwD,EACjB,MAAO,CAAEttD,MAAO5C,EAAIqwD,cAEtB,MAAMrwD,CACR,+IChDA,MAAM+yF,EAAc,IAEb,SAASr6D,EAAmBlL,EAAmBpY,EAAoB2N,GACxE,OAAOoL,EA6GF,SAA2BX,GAChC,MAAO,GAAGijE,EAAAA,yBAAwCuC,mBAAmBxlE,IACvE,CA/GmBylE,CAAkBzlE,EAAIrvB,YAAaiX,EAAM2N,EAC5D,CAEOnkB,eAAeuvB,EAAUX,EAAmBpY,EAAoB2N,GACrE,MAAMmwE,EAAY,IAAIzlE,IAAID,GAmB1B,OAlBIpY,GACFc,OAAOiQ,QAAQ/Q,GAAM9T,SAAQyT,IAAkB,IAAhB7C,EAAKtS,GAAMmV,OAC1B5U,IAAVP,IAIAgQ,MAAMqH,QAAQrX,GAChBA,EAAM0B,SAAS0xB,IACbkgE,EAAU3kE,aAAaC,OAAOtc,EAAK8gB,EAAK70B,WAAW,IAGrD+0F,EAAU3kE,aAAapP,IAAIjN,EAAKtS,EAAMzB,YACxC,WAImB0vB,EAAeqlE,EAAWnwE,IAEjCkL,MAClB,CAEOrvB,eAAeivB,EAAeL,EAAmBzK,EAAoBkK,GAK1E,MAAM,QACJK,EAAUkkE,EAAAA,IAAe,SACzBjkE,EAAWtS,EAAAA,IAAe,kBAC1B6S,EAAoBqlE,GAClBlmE,GAAW,CAAC,EAEhB,IACImjC,EADAhuD,EAAU,iBAGd,IAAK,IAAItB,EAAI,EAAGA,GAAKwsB,EAASxsB,IAC5B,IACMA,EAAI,IACN+xC,EAAAA,EAAAA,IAAS,kBAAkB/xC,KAAM0sB,EAAIrvB,WAAYiyD,GAGnD,MAAMp1C,EAAUpL,MAAMqH,QAAQsW,GAC1BA,EAASzsB,EAAI,IAAMysB,EAASA,EAASpuB,OAAS,GAC9CqQ,KAAKmQ,IAAI4N,EAAWzsB,EAAGiyF,GACrB3uE,QAAiBgvE,EAAiB5lE,EAAKzK,EAAM/H,GAGnD,GAFAo1C,EAAahsC,EAAS4M,OAElBo/B,GAAc,IAAK,CACrB,MAAM,MAAExtD,SAAgBwhB,EAAS6J,OAAOvK,OAAM,SAC9C,MAAM,IAAI3lB,MAAM6E,GAAS,cAAcwtD,IACzC,CAEA,OAAOhsC,CACT,CAAE,MAAOpkB,GAKP,GAJAoC,EAAyB,iBAARpC,EAAmBA,EAAMA,EAAIoC,SAAWA,EAEjC0rB,EAAkB1rB,EAASguD,GAGjD,MAAM,IAAIF,EAAAA,GAAe9tD,EAASguD,GAGhCtvD,EAAIwsB,SACA+4B,EAAAA,EAAAA,IAAMorC,EAAAA,IAAsB3wF,EAEtC,CAGF,MAAM,IAAIovD,EAAAA,GAAe9tD,EAC3B,CAEOxD,eAAew0F,EAAiB5lE,EAAmBzK,GAA+C,IAA3B/H,EAAO5Q,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG6Q,EAAAA,IACtF,MAAMo4E,EAAa,IAAIC,gBACjBtgF,EAAK4+E,YAAW,KACpByB,EAAWE,OAAO,GACjBv4E,GAEH,IACE,aAAa+S,MAAMP,EAAK,IACnBzK,EACHywE,OAAQH,EAAWG,QAEvB,CAAE,QACAlB,aAAat/E,EACf,CACF,CAEOpU,eAAeovB,EAAkB5J,EAAoBqvE,GAC1D,KAAKrvE,EAASsvE,IAAQD,SAAAA,EAAiB12F,SAASqnB,EAAS4M,SAAU,CAEjE,IAAI,MAAEpuB,EAAK,OAAE6hF,SAAiBrgE,EAAS6J,OAAOvK,OAAM,KAAe,IAC5B,IAAAiwE,EAIvC,MAJK/wF,GAAS6hF,GAAUA,EAAOtlF,SAC7ByD,EAAiB,QAAZ+wF,EAAGlP,EAAO,UAAE,IAAAkP,OAAA,EAATA,EAAWx5C,KAGf,IAAI+V,EAAAA,GAAettD,GAAS,cAAcwhB,EAAS4M,SAAU5M,EAAS4M,OAC9E,CACA,OAAO5M,CACT,CAEA,SAAS+uE,EAAoB/wF,EAAkBguD,GAC7C,OAAOA,GAAc,CAAC,IAAK,KAAKrzD,SAASqzD,EAC3C,CAMO,SAAS5wB,EAAoBhS,GAClC,MAAO,GAAGijE,EAAAA,2BAA0CuC,mBAAmBxlE,IACzE,CAEO,SAASqS,EAAWrS,GACzB,OAAOA,EAAI5c,QAAQ,UAAW8/E,EAAAA,IAChC,0ECpIA,MAAMkD,GAAqBtD,EAAAA,IA+BZ,SAASnnD,EAAgCtX,EAAO5E,GAC7D,IAAK2mE,EACH,OAAO/hE,IAGT,MAAM,OAAEgiE,EAAM,OAAEC,EAAM,kBAAEC,GAAsB9mE,GAAW,CAAC,EAE1D,IACE,OAAO4E,GACT,CAAE,MAAO7xB,GAKP,OAJA6zF,SAAAA,EAAS7zF,QACJ+zF,IACHpxF,EAAAA,EAAAA,GAAY3C,GAGhB,CAAE,QACA8zF,SAAAA,GACF,CACF,wBC/CU,SAAUE,GAAW,aAE7B,MAEMC,EAA0B/9E,OAAOg+E,OAAO,CAC5CC,UAAW,KACX,QAJyB,CAAC,IAQtBC,EAAM9iF,OAAO,GACb+iF,EAAM/iF,OAAO,GACbgjF,EAAMhjF,OAAO,GACbijF,EAAMjjF,OAAO,GACbkjF,EAAOljF,OAAO,gFACdmjF,EAAQv+E,OAAOg+E,OAAO,CAC1BlnF,EAAGsE,QAAQ,GACX09E,EAAG19E,OAAO,iFACVhG,EAAGgG,OAAO,iFACVzE,EAAG2nF,EACHx2F,EAAGw2F,EACHE,EAAGpjF,OAAO,GACVqjF,GAAIrjF,OAAO,iFACXsjF,GAAItjF,OAAO,mFAEPujF,EAAYvjF,OAAO,uEACnBwjF,EAAUxjF,OAAO,iFACvBA,OAAO,gFACP,MAAMyjF,EAAoBzjF,OAAO,iFAC3B0jF,EAAoB1jF,OAAO,iFAC3B2jF,EAAiB3jF,OAAO,gFACxB4jF,EAAiB5jF,OAAO,iFAC9B,MAAM6jF,EACJ5rF,WAAAA,CAAYmC,EAAGc,EAAG4oF,EAAG3mF,GACnBjF,KAAKkC,EAAIA,EACTlC,KAAKgD,EAAIA,EACThD,KAAK4rF,EAAIA,EACT5rF,KAAKiF,EAAIA,CACX,CACA,iBAAO4mF,CAAWtnF,GAChB,KAAMA,aAAaunF,GACjB,MAAM,IAAI7kF,UAAU,4CAEtB,OAAI1C,EAAEmoD,OAAOo/B,EAAMC,MACVJ,EAAcI,KAChB,IAAIJ,EAAcpnF,EAAErC,EAAGqC,EAAEvB,EAAG6nF,EAAKvlF,EAAIf,EAAErC,EAAIqC,EAAEvB,GACtD,CACA,oBAAOgpF,CAAcC,GACnB,MAAMC,EA2eV,SAAqBC,GAAmB,IAAb5nF,EAAC3D,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGqqF,EAAMnpF,EACnC,MAAMsqF,EAAM,IAAIhmF,MAAM+lF,EAAKx2F,QAOrB02F,EAAWC,EANMH,EAAKhhF,QAAO,CAACqC,EAAK1E,EAAKxR,IACxCwR,IAAQ8hF,EACHp9E,GACT4+E,EAAI90F,GAAKkW,EACFlI,EAAIkI,EAAM1E,EAAKvE,KACrBsmF,GACqCtmF,GAOxC,OANA4nF,EAAKI,aAAY,CAAC/+E,EAAK1E,EAAKxR,IACtBwR,IAAQ8hF,EACHp9E,GACT4+E,EAAI90F,GAAKgO,EAAIkI,EAAM4+E,EAAI90F,GAAIiN,GACpBe,EAAIkI,EAAM1E,EAAKvE,KACrB8nF,GACID,CACT,CA3fkBI,CAAYP,EAAO1hF,KAAKhG,GAAMA,EAAEqnF,KAC9C,OAAOK,EAAO1hF,KAAI,CAAChG,EAAGjN,IAAMiN,EAAEkoF,SAASP,EAAM50F,KAC/C,CACA,iBAAOo1F,CAAWT,GAChB,OAAOjsF,KAAKgsF,cAAcC,GAAQ1hF,IAAIvK,KAAK6rF,WAC7C,CACAn/B,MAAAA,CAAOigC,GACLC,EAAeD,GACf,MAAQzqF,EAAG2qF,EAAI7pF,EAAG8pF,EAAIlB,EAAGmB,GAAO/sF,MACxBkC,EAAG8qF,EAAIhqF,EAAGiqF,EAAIrB,EAAGsB,GAAOP,EAC1BQ,EAAO7nF,EAAIunF,EAAKK,GAChBE,EAAO9nF,EAAI0nF,EAAKD,GAChBM,EAAO/nF,EAAIwnF,EAAKI,GAChBI,EAAOhoF,EAAI2nF,EAAKF,GACtB,OAAOI,IAASC,GAAQC,IAASC,CACnC,CACAC,MAAAA,GACE,OAAO,IAAI5B,EAAcrmF,GAAKtF,KAAKkC,GAAIlC,KAAKgD,EAAGhD,KAAK4rF,EAAGtmF,GAAKtF,KAAKiF,GACnE,CACAuoF,MAAAA,GACE,MAAQtrF,EAAG2qF,EAAI7pF,EAAG8pF,EAAIlB,EAAGmB,GAAO/sF,MAC1B,EAAEwD,GAAMynF,EACRwC,EAAInoF,EAAIunF,EAAKA,GACba,EAAIpoF,EAAIwnF,EAAKA,GACba,EAAIroF,EAAIwlF,EAAMxlF,EAAIynF,EAAKA,IACvBa,EAAItoF,EAAI9B,EAAIiqF,GACZI,EAAOhB,EAAKC,EACZgB,EAAIxoF,EAAIA,EAAIuoF,EAAOA,GAAQJ,EAAIC,GAC/BK,EAAIH,EAAIF,EACRM,EAAID,EAAIJ,EACRM,EAAIL,EAAIF,EACRQ,EAAK5oF,EAAIwoF,EAAIE,GACbG,EAAK7oF,EAAIyoF,EAAIE,GACbG,EAAK9oF,EAAIwoF,EAAIG,GACbI,EAAK/oF,EAAI0oF,EAAID,GACnB,OAAO,IAAIpC,EAAcuC,EAAIC,EAAIE,EAAID,EACvC,CACA1oF,GAAAA,CAAIinF,GACFC,EAAeD,GACf,MAAQzqF,EAAG2qF,EAAI7pF,EAAG8pF,EAAIlB,EAAGmB,EAAI9nF,EAAGqpF,GAAOtuF,MAC/BkC,EAAG8qF,EAAIhqF,EAAGiqF,EAAIrB,EAAGsB,EAAIjoF,EAAGspF,GAAO5B,EACjCc,EAAInoF,GAAKwnF,EAAKD,IAAOI,EAAKD,IAC1BU,EAAIpoF,GAAKwnF,EAAKD,IAAOI,EAAKD,IAC1BgB,EAAI1oF,EAAIooF,EAAID,GAClB,GAAIO,IAAMpD,EACR,OAAO5qF,KAAKwtF,SACd,MAAMG,EAAIroF,EAAIynF,EAAKjC,EAAMyD,GACnBX,EAAItoF,EAAIgpF,EAAKxD,EAAMoC,GACnBY,EAAIF,EAAID,EACRI,EAAIL,EAAID,EACRQ,EAAIL,EAAID,EACRO,EAAK5oF,EAAIwoF,EAAIE,GACbG,EAAK7oF,EAAIyoF,EAAIE,GACbG,EAAK9oF,EAAIwoF,EAAIG,GACbI,EAAK/oF,EAAI0oF,EAAID,GACnB,OAAO,IAAIpC,EAAcuC,EAAIC,EAAIE,EAAID,EACvC,CACAI,QAAAA,CAAS7B,GACP,OAAO3sF,KAAK0F,IAAIinF,EAAMY,SACxB,CACAkB,gBAAAA,CAAiBC,GACf,MAAMC,EAAU,EAAI,IAAMD,EACpBzC,EAAS,GACf,IAAI1nF,EAAIvE,KACJuO,EAAOhK,EACX,IAAK,IAAI9L,EAAS,EAAGA,EAASk2F,EAASl2F,IAAU,CAC/C8V,EAAOhK,EACP0nF,EAAOznF,KAAK+J,GACZ,IAAK,IAAIjX,EAAI,EAAGA,EAAI,IAAMo3F,EAAI,GAAIp3F,IAChCiX,EAAOA,EAAK7I,IAAInB,GAChB0nF,EAAOznF,KAAK+J,GAEdhK,EAAIgK,EAAKi/E,QACX,CACA,OAAOvB,CACT,CACA2C,IAAAA,CAAKp6F,EAAGq6F,IACDA,GAAe7uF,KAAK0sD,OAAOi/B,EAAcmD,QAC5CD,EAAc/C,EAAMgD,MACtB,MAAMJ,EAAKG,GAAeA,EAAYE,cAAiB,EACvD,GAAI,IAAML,EACR,MAAM,IAAIn6F,MAAM,iEAElB,IAAIy6F,EAAcH,GAAeI,EAAiBz0E,IAAIq0E,GACjDG,IACHA,EAAchvF,KAAKyuF,iBAAiBC,GAChCG,GAAqB,IAANH,IACjBM,EAAcrD,EAAce,WAAWsC,GACvCC,EAAiBt5E,IAAIk5E,EAAaG,KAGtC,IAAIzqF,EAAIonF,EAAcI,KAClBmD,EAAIvD,EAAcmD,KACtB,MAAMH,EAAU,EAAI,IAAMD,EACpBS,EAAa,IAAMT,EAAI,GACvBU,EAAOtnF,OAAO,GAAK4mF,EAAI,GACvBW,EAAY,GAAKX,EACjBY,EAAUxnF,OAAO4mF,GACvB,IAAK,IAAIj2F,EAAS,EAAGA,EAASk2F,EAASl2F,IAAU,CAC/C,MAAM6R,EAAS7R,EAAS02F,EACxB,IAAII,EAAQ3oF,OAAOpS,EAAI46F,GACvB56F,IAAM86F,EACFC,EAAQJ,IACVI,GAASF,EACT76F,GAAKq2F,GAEP,MAAM2E,EAAUllF,EACVmlF,EAAUnlF,EAAStE,KAAKlD,IAAIysF,GAAS,EACrCG,EAAQj3F,EAAS,GAAM,EACvBk3F,EAAQJ,EAAQ,EACR,IAAVA,EACFL,EAAIA,EAAExpF,IAAIkqF,EAAgBF,EAAOV,EAAYQ,KAG7CjrF,EAAIA,EAAEmB,IAAIkqF,EAAgBD,EAAOX,EAAYS,IAEjD,CACA,OAAO9D,EAAce,WAAW,CAACnoF,EAAG2qF,IAAI,EAC1C,CACAW,QAAAA,CAASC,EAAQjB,GACf,OAAO7uF,KAAK4uF,KAAKmB,EAAgBD,EAAQ7E,EAAM5nF,GAAIwrF,EACrD,CACAmB,cAAAA,CAAeF,GACb,IAAIt7F,EAAIu7F,EAAgBD,EAAQ7E,EAAM5nF,GAAG,GACzC,MAAM0qF,EAAIpC,EAAcmD,KAClBmB,EAAKtE,EAAcI,KACzB,GAAIv3F,IAAMo2F,EACR,OAAOqF,EACT,GAAIjwF,KAAK0sD,OAAOujC,IAAOz7F,IAAMq2F,EAC3B,OAAO7qF,KACT,GAAIA,KAAK0sD,OAAOqhC,GACd,OAAO/tF,KAAK4uF,KAAKp6F,GACnB,IAAI+P,EAAI0rF,EACJzK,EAAIxlF,KACR,KAAOxL,EAAIo2F,GACLp2F,EAAIq2F,IACNtmF,EAAIA,EAAEmB,IAAI8/E,IACZA,EAAIA,EAAEgI,SACNh5F,IAAMq2F,EAER,OAAOtmF,CACT,CACA2rF,YAAAA,GACE,OAAOlwF,KAAKgwF,eAAe/E,EAAMC,GAAGx+B,OAAOi/B,EAAcI,KAC3D,CACAoE,aAAAA,GACE,IAAI5rF,EAAIvE,KAAKgwF,eAAe/E,EAAM5nF,EAAIynF,GAAK0C,SAG3C,OAFIvC,EAAM5nF,EAAIynF,IACZvmF,EAAIA,EAAEmB,IAAI1F,OACLuE,EAAEmoD,OAAOi/B,EAAcI,KAChC,CACAU,QAAAA,CAAS2D,GACP,MAAM,EAAEluF,EAAC,EAAEc,EAAC,EAAE4oF,GAAM5rF,KACdqwF,EAAMrwF,KAAK0sD,OAAOi/B,EAAcI,MAC1B,MAARqE,IACFA,EAAOC,EAAMtF,EAAMuB,EAAOV,IAC5B,MAAM0E,EAAKhrF,EAAIpD,EAAIkuF,GACbG,EAAKjrF,EAAItC,EAAIotF,GACbI,EAAKlrF,EAAIsmF,EAAIwE,GACnB,GAAIC,EACF,OAAOvE,EAAMC,KACf,GAAIyE,IAAO3F,EACT,MAAM,IAAIt2F,MAAM,oBAClB,OAAO,IAAIu3F,EAAMwE,EAAIC,EACvB,CACAE,kBAAAA,GACEC,GACF,CACAC,gBAAAA,GACED,GACF,CACAE,iBAAAA,GACEF,GACF,EAIF,SAASd,EAAgBn4B,EAAWjuC,GAClC,MAAM/jB,EAAM+jB,EAAK+jE,SACjB,OAAO91B,EAAYhyD,EAAM+jB,CAC3B,CACA,SAASojE,EAAeD,GACtB,KAAMA,aAAiBhB,GACrB,MAAM,IAAI1kF,UAAU,yBACxB,CACA,SAAS4pF,EAAelE,GACtB,KAAMA,aAAiBmE,GACrB,MAAM,IAAI7pF,UAAU,0BACxB,CACA,SAASypF,IACP,MAAM,IAAIn8F,MAAM,0CAClB,CAhBAo3F,EAAcmD,KAAO,IAAInD,EAAcV,EAAME,GAAIF,EAAMG,GAAIP,EAAKvlF,EAAI2lF,EAAME,GAAKF,EAAMG,KACrFO,EAAcI,KAAO,IAAIJ,EAAcf,EAAKC,EAAKA,EAAKD,GAgBtD,MAAMkG,EACJ/wF,WAAAA,CAAYgxF,GACV/wF,KAAK+wF,GAAKA,CACZ,CACA,gCAAOC,CAA0BC,GAC/B,MAAM,EAAEzL,GAAMyF,EACR/mF,EAAIoB,EAAIgmF,EAAU2F,EAAKA,GACvBC,EAAK5rF,GAAKpB,EAAI2mF,GAAOY,GAC3B,IAAIh0F,EAAIqQ,QAAQ,GAChB,MAAM8lF,EAAItoF,GAAK7N,EAAI+tF,EAAIthF,GAAKoB,EAAIpB,EAAIshF,IACpC,IAAM1uE,QAASq6E,EAAY/6F,MAAOxB,GAAMw8F,EAAQF,EAAItD,GAChDyD,EAAK/rF,EAAI1Q,EAAIq8F,GACZK,EAAaD,KAChBA,EAAK/rF,GAAK+rF,IACPF,IACHv8F,EAAIy8F,GACDF,IACH15F,EAAIyM,GACN,MAAMqtF,EAAKjsF,EAAI7N,GAAKyM,EAAI2mF,GAAOa,EAAiBkC,GAC1C4D,EAAK58F,EAAIA,EACT68F,EAAKnsF,GAAK1Q,EAAIA,GAAKg5F,GACnB8D,EAAKpsF,EAAIisF,EAAKhG,GACdoG,EAAKrsF,EAAIulF,EAAM2G,GACfI,EAAKtsF,EAAIulF,EAAM2G,GACrB,OAAO,IAAI7F,EAAcrmF,EAAImsF,EAAKG,GAAKtsF,EAAIqsF,EAAKD,GAAKpsF,EAAIosF,EAAKE,GAAKtsF,EAAImsF,EAAKE,GAC9E,CACA,kBAAOE,CAAYhjF,GAEjB,MAAMijF,EAAKC,GADXljF,EAAMmjF,EAAYnjF,EAAK,KACW3a,MAAM,EAAG,KACrC+9F,EAAKjyF,KAAKgxF,0BAA0Bc,GACpCI,EAAKH,EAAmBljF,EAAI3a,MAAM,GAAI,KACtCi+F,EAAKnyF,KAAKgxF,0BAA0BkB,GAC1C,OAAO,IAAIpB,EAAemB,EAAGvsF,IAAIysF,GACnC,CACA,cAAOxuB,CAAQ90D,GACbA,EAAMmjF,EAAYnjF,EAAK,IACvB,MAAM,EAAErL,EAAC,EAAEgiF,GAAMyF,EACXmH,EAAO,0EACPx9F,EAAIm9F,EAAmBljF,GAC7B,IA4UJ,SAAoBwjF,EAAIC,GACtB,GAAID,EAAG18F,SAAW28F,EAAG38F,OACnB,OAAO,EAET,IAAK,IAAI2B,EAAI,EAAGA,EAAI+6F,EAAG18F,OAAQ2B,IAC7B,GAAI+6F,EAAG/6F,KAAOg7F,EAAGh7F,GACf,OAAO,EAGX,OAAO,CACT,CAtVSi7F,CAAWC,EAAkB59F,GAAIia,IAAQyiF,EAAa18F,GACzD,MAAM,IAAIL,MAAM69F,GAClB,MAAMZ,EAAKlsF,EAAI1Q,EAAIA,GACb69F,EAAKntF,EAAIulF,EAAMrnF,EAAIguF,GACnBkB,EAAKptF,EAAIulF,EAAMrnF,EAAIguF,GACnBmB,EAAOrtF,EAAImtF,EAAKA,GAChBG,EAAOttF,EAAIotF,EAAKA,GAChBtkE,EAAI9oB,EAAI9B,EAAIgiF,EAAImN,EAAOC,IACvB,QAAE97E,EAAS1gB,MAAOwU,GAAMioF,EAAWvtF,EAAI8oB,EAAIwkE,IAC3CE,EAAKxtF,EAAIsF,EAAI8nF,GACbK,EAAKztF,EAAIsF,EAAIkoF,EAAK1kE,GACxB,IAAIlsB,EAAIoD,GAAK1Q,EAAIA,GAAKk+F,GAClBxB,EAAapvF,KACfA,EAAIoD,GAAKpD,IACX,MAAMc,EAAIsC,EAAImtF,EAAKM,GACb9tF,EAAIK,EAAIpD,EAAIc,GAClB,IAAK8T,GAAWw6E,EAAarsF,IAAMjC,IAAM4nF,EACvC,MAAM,IAAIr2F,MAAM69F,GAClB,OAAO,IAAItB,EAAe,IAAInF,EAAczpF,EAAGc,EAAG6nF,EAAK5lF,GACzD,CACA+tF,UAAAA,GACE,IAAI,EAAE9wF,EAAC,EAAEc,EAAC,EAAE4oF,EAAC,EAAE3mF,GAAMjF,KAAK+wF,GAC1B,MAAM0B,EAAKntF,EAAIA,EAAIsmF,EAAI5oF,GAAKsC,EAAIsmF,EAAI5oF,IAC9B0vF,EAAKptF,EAAIpD,EAAIc,GACbiwF,EAAO3tF,EAAIotF,EAAKA,IACdt8F,MAAO88F,GAAYL,EAAWvtF,EAAImtF,EAAKQ,IACzCE,EAAK7tF,EAAI4tF,EAAUT,GACnBW,EAAK9tF,EAAI4tF,EAAUR,GACnBW,EAAO/tF,EAAI6tF,EAAKC,EAAKnuF,GAC3B,IAAI2oF,EACJ,GAAI0D,EAAarsF,EAAIouF,GAAO,CAC1B,IAAIC,EAAKhuF,EAAItC,EAAIsoF,GACbiI,EAAKjuF,EAAIpD,EAAIopF,GACjBppF,EAAIoxF,EACJtwF,EAAIuwF,EACJ3F,EAAItoF,EAAI6tF,EAAK3H,EACf,MAEEoC,EAAIwF,EAEF9B,EAAapvF,EAAImxF,KACnBrwF,EAAIsC,GAAKtC,IACX,IAAIpO,EAAI0Q,GAAKsmF,EAAI5oF,GAAK4qF,GAGtB,OAFI0D,EAAa18F,KACfA,EAAI0Q,GAAK1Q,IACJ49F,EAAkB59F,EAC3B,CACA4+F,KAAAA,GACE,OAAO7kF,EAAW3O,KAAKgzF,aACzB,CACAr+F,QAAAA,GACE,OAAOqL,KAAKwzF,OACd,CACA9mC,MAAAA,CAAOigC,GACLkE,EAAelE,GACf,MAAMnpF,EAAIxD,KAAK+wF,GACTttF,EAAIkpF,EAAMoE,GACVnrF,EAAMN,EAAI9B,EAAEtB,EAAIuB,EAAET,KAAOsC,EAAI9B,EAAER,EAAIS,EAAEvB,GACrCuxF,EAAMnuF,EAAI9B,EAAER,EAAIS,EAAET,KAAOsC,EAAI9B,EAAEtB,EAAIuB,EAAEvB,GAC3C,OAAO0D,GAAO6tF,CAChB,CACA/tF,GAAAA,CAAIinF,GAEF,OADAkE,EAAelE,GACR,IAAImE,EAAe9wF,KAAK+wF,GAAGrrF,IAAIinF,EAAMoE,IAC9C,CACAvC,QAAAA,CAAS7B,GAEP,OADAkE,EAAelE,GACR,IAAImE,EAAe9wF,KAAK+wF,GAAGvC,SAAS7B,EAAMoE,IACnD,CACAlB,QAAAA,CAASC,GACP,OAAO,IAAIgB,EAAe9wF,KAAK+wF,GAAGlB,SAASC,GAC7C,CACAE,cAAAA,CAAeF,GACb,OAAO,IAAIgB,EAAe9wF,KAAK+wF,GAAGf,eAAeF,GACnD,EAEFgB,EAAehC,KAAO,IAAIgC,EAAenF,EAAcmD,MACvDgC,EAAe/E,KAAO,IAAI+E,EAAenF,EAAcI,MACvD,MAAMkD,EAAmB,IAAIxI,QAC7B,MAAMqF,EACJ/rF,WAAAA,CAAYmC,EAAGc,GACbhD,KAAKkC,EAAIA,EACTlC,KAAKgD,EAAIA,CACX,CACA0wF,cAAAA,CAAevE,GACbnvF,KAAK+uF,aAAeI,EACpBF,EAAiB70E,OAAOpa,KAC1B,CACA,cAAO2jE,CAAQ90D,GAAoB,IAAfhI,IAAMjG,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,KAAAA,UAAA,GACxB,MAAM,EAAE4kF,EAAC,EAAE1jF,GAAMmpF,EAEX0I,GADN9kF,EAAMmjF,EAAYnjF,EAAK,KACJ3a,QACnBy/F,EAAO,KAAgB,IAAV9kF,EAAI,IACjB,MAAM7L,EAAI4wF,EAAgBD,GAC1B,GAAI9sF,GAAU7D,GAAKlB,EACjB,MAAM,IAAIvN,MAAM,wBAClB,IAAKsS,GAAU7D,GAAKqoF,EAClB,MAAM,IAAI92F,MAAM,6BAClB,MAAMs/F,EAAKvuF,EAAItC,EAAIA,GACb8wF,EAAIxuF,EAAIuuF,EAAKhJ,GACbz8D,EAAI9oB,EAAIkgF,EAAIqO,EAAKhJ,GACvB,IAAI,QAAE/zE,EAAS1gB,MAAO8L,GAAMkvF,EAAQ0C,EAAG1lE,GACvC,IAAKtX,EACH,MAAM,IAAIviB,MAAM,uCAClB,MAAMw/F,GAAU7xF,EAAI2oF,KAASA,EAK7B,SAJiC,IAAVh8E,EAAI,OACLklF,IACpB7xF,EAAIoD,GAAKpD,IAEJ,IAAI4pF,EAAM5pF,EAAGc,EACtB,CACA,2BAAagxF,CAAe5+C,GAC1B,aAAc6+C,EAAqB7+C,IAAa8+C,KAClD,CACAlB,UAAAA,GACE,MAAMvkF,EAAQ+jF,EAAkBxyF,KAAKgD,GAErC,OADAyL,EAAM,KAAOzO,KAAKkC,EAAI2oF,EAAM,IAAO,EAC5Bp8E,CACT,CACA+kF,KAAAA,GACE,OAAO7kF,EAAW3O,KAAKgzF,aACzB,CACAmB,QAAAA,GACE,MAAM,EAAEnxF,GAAMhD,KAEd,OAAOwyF,EADGltF,GAAKulF,EAAM7nF,GAAKspF,EAAOzB,EAAM7nF,IAEzC,CACAmtF,aAAAA,GACE,OAAOxE,EAAcE,WAAW7rF,MAAMmwF,eACxC,CACAzjC,MAAAA,CAAOigC,GACL,OAAO3sF,KAAKkC,IAAMyqF,EAAMzqF,GAAKlC,KAAKgD,IAAM2pF,EAAM3pF,CAChD,CACAuqF,MAAAA,GACE,OAAO,IAAIzB,EAAMxmF,GAAKtF,KAAKkC,GAAIlC,KAAKgD,EACtC,CACA0C,GAAAA,CAAIinF,GACF,OAAOhB,EAAcE,WAAW7rF,MAAM0F,IAAIimF,EAAcE,WAAWc,IAAQF,UAC7E,CACA+B,QAAAA,CAAS7B,GACP,OAAO3sF,KAAK0F,IAAIinF,EAAMY,SACxB,CACAsC,QAAAA,CAASC,GACP,OAAOnE,EAAcE,WAAW7rF,MAAM6vF,SAASC,EAAQ9vF,MAAMysF,UAC/D,EAEFX,EAAMgD,KAAO,IAAIhD,EAAMb,EAAME,GAAIF,EAAMG,IACvCU,EAAMC,KAAO,IAAID,EAAMlB,EAAKC,GAC5B,MAAMuJ,EACJr0F,WAAAA,CAAYmE,EAAGtP,GACboL,KAAKkE,EAAIA,EACTlE,KAAKpL,EAAIA,EACToL,KAAKq0F,gBACP,CACA,cAAO1wB,CAAQ90D,GACb,MAAMJ,EAAQujF,EAAYnjF,EAAK,IACzB3K,EAAI4nF,EAAMnoB,QAAQl1D,EAAMva,MAAM,EAAG,KAAK,GACtCU,EAAIg/F,EAAgBnlF,EAAMva,MAAM,GAAI,KAC1C,OAAO,IAAIkgG,EAAUlwF,EAAGtP,EAC1B,CACAy/F,cAAAA,GACE,MAAM,EAAEnwF,EAAC,EAAEtP,GAAMoL,KACjB,KAAMkE,aAAa4nF,GACjB,MAAM,IAAIv3F,MAAM,2BAElB,OADAw7F,EAAgBn7F,EAAGq2F,EAAM5nF,GAAG,GACrBrD,IACT,CACAgzF,UAAAA,GACE,MAAMsB,EAAK,IAAI/rF,WAAW,IAG1B,OAFA+rF,EAAG3+E,IAAI3V,KAAKkE,EAAE8uF,cACdsB,EAAG3+E,IAAI68E,EAAkBxyF,KAAKpL,GAAI,IAC3B0/F,CACT,CACAd,KAAAA,GACE,OAAO7kF,EAAW3O,KAAKgzF,aACzB,EAEF,SAASuB,IAAuB,QAAA/6E,EAAA5Y,UAAAjL,OAAR6+F,EAAM,IAAApuF,MAAAoT,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAN+6E,EAAM/6E,GAAA7Y,UAAA6Y,GAC5B,IAAK+6E,EAAOr9D,OAAO3zB,GAAMA,aAAa+E,aACpC,MAAM,IAAIhU,MAAM,4BAClB,GAAsB,IAAlBigG,EAAO7+F,OACT,OAAO6+F,EAAO,GAChB,MAAM7+F,EAAS6+F,EAAOrpF,QAAO,CAAC3H,EAAG5L,IAAQ4L,EAAI5L,EAAIjC,QAAQ,GACnD2W,EAAS,IAAI/D,WAAW5S,GAC9B,IAAK,IAAI2B,EAAI,EAAGm9F,EAAM,EAAGn9F,EAAIk9F,EAAO7+F,OAAQ2B,IAAK,CAC/C,MAAMM,EAAM48F,EAAOl9F,GACnBgV,EAAOqJ,IAAI/d,EAAK68F,GAChBA,GAAO78F,EAAIjC,MACb,CACA,OAAO2W,CACT,CACA,MAAMooF,EAAQtuF,MAAM9N,KAAK,CAAE3C,OAAQ,MAAO,CAACy4B,EAAG92B,IAAMA,EAAE3C,SAAS,IAAIE,SAAS,EAAG,OAC/E,SAAS8Z,EAAWgmF,GAClB,KAAMA,aAAkBpsF,YACtB,MAAM,IAAIhU,MAAM,uBAClB,IAAIsa,EAAM,GACV,IAAK,IAAIvX,EAAI,EAAGA,EAAIq9F,EAAOh/F,OAAQ2B,IACjCuX,GAAO6lF,EAAMC,EAAOr9F,IAEtB,OAAOuX,CACT,CACA,SAASD,EAAWC,GAClB,GAAmB,iBAARA,EACT,MAAM,IAAI5H,UAAU,2CAA6C4H,GAEnE,GAAIA,EAAIlZ,OAAS,EACf,MAAM,IAAIpB,MAAM,6CAClB,MAAMyY,EAAQ,IAAIzE,WAAWsG,EAAIlZ,OAAS,GAC1C,IAAK,IAAI2B,EAAI,EAAGA,EAAI0V,EAAMrX,OAAQ2B,IAAK,CACrC,MAAM6L,EAAQ,EAAJ7L,EACJs9F,EAAU/lF,EAAI3a,MAAMiP,EAAGA,EAAI,GAC3B0d,EAAOja,OAAOsE,SAAS0pF,EAAS,IACtC,GAAIhuF,OAAO6D,MAAMoW,IAASA,EAAO,EAC/B,MAAM,IAAItsB,MAAM,yBAClByY,EAAM1V,GAAKupB,CACb,CACA,OAAO7T,CACT,CACA,SAAS6nF,EAAkB/rF,GAGzB,OAAO8F,EADK9F,EAAInU,SAAS,IAAIE,SAASc,GAAY,KAEpD,CACA,SAAS68F,EAAkB1pF,GACzB,OAAO+rF,EAAkB/rF,GAAK9Q,SAChC,CACA,SAASs5F,EAAaxoF,GACpB,OAAQxD,EAAIwD,GAAO+hF,KAASA,CAC9B,CACA,SAAS+I,EAAgBe,GACvB,KAAMA,aAAkBpsF,YACtB,MAAM,IAAIhU,MAAM,uBAClB,OAAOuT,OAAO,KAAO6G,EAAWpG,WAAWjQ,KAAKq8F,GAAQ38F,WAC1D,CACA,MAAM88F,EAAWhtF,OAAO,sEACxB,SAASiqF,EAAmBtjF,GAC1B,OAAOnJ,EAAIsuF,EAAgBnlF,GAASqmF,EACtC,CACA,SAASxvF,EAAI9B,GAAgB,IAAbC,EAAC7C,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGqqF,EAAMnpF,EACxB,MAAM8Q,EAAMpP,EAAIC,EAChB,OAAOmP,GAAOg4E,EAAMh4E,EAAMnP,EAAImP,CAChC,CACA,SAAS05E,EAAOyI,GAA0B,IAAlBC,EAAMp0F,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGqqF,EAAMnpF,EACrC,GAAIizF,IAAWnK,GAAOoK,GAAUpK,EAC9B,MAAM,IAAIr2F,MAAM,6CAA6CwgG,SAAcC,KAE7E,IAAIxxF,EAAI8B,EAAIyvF,EAAQC,GAChBvxF,EAAIuxF,EACJ9yF,EAAI0oF,EAAKkJ,EAAIjJ,EACjB,KAAOrnF,IAAMonF,GAAK,CAChB,MACM1mF,EAAIT,EAAID,EACRyxF,EAAI/yF,EAAI4xF,GAFJrwF,EAAID,GAGdC,EAAID,EAAGA,EAAIU,EAAGhC,EAAI4xF,EAAGA,EAAImB,CAC3B,CAEA,GADYxxF,IACAonF,EACV,MAAM,IAAIt2F,MAAM,0BAClB,OAAO+Q,EAAIpD,EAAG8yF,EAChB,CAkBA,SAASE,EAAKhzF,EAAGizF,GACf,MAAM,EAAErzF,GAAMmpF,EACd,IAAIr4E,EAAM1Q,EACV,KAAOizF,KAAUvK,GACfh4E,GAAOA,EACPA,GAAO9Q,EAET,OAAO8Q,CACT,CACA,SAASwiF,EAAYlzF,GACnB,MAAM,EAAEJ,GAAMmpF,EACRoK,EAAMvtF,OAAO,GACbwtF,EAAOxtF,OAAO,IACdytF,EAAOztF,OAAO,IACd0tF,EAAO1tF,OAAO,IACd2tF,EAAO3tF,OAAO,IAEdwqF,EADMpwF,EAAIA,EAAKJ,EACJI,EAAKJ,EAChB4zF,EAAMR,EAAK5C,EAAIxH,GAAOwH,EAAMxwF,EAC5B6zF,EAAMT,EAAKQ,EAAI7K,GAAO3oF,EAAKJ,EAC3B8zF,EAAOV,EAAKS,EAAIN,GAAOM,EAAM7zF,EAC7B+zF,EAAOX,EAAKU,EAAKN,GAAQM,EAAO9zF,EAChCg0F,EAAOZ,EAAKW,EAAKN,GAAQM,EAAO/zF,EAChCi0F,EAAOb,EAAKY,EAAKN,GAAQM,EAAOh0F,EAChCk0F,EAAQd,EAAKa,EAAKN,GAAQM,EAAOj0F,EACjCm0F,EAAQf,EAAKc,EAAMP,GAAQM,EAAOj0F,EAClCo0F,EAAQhB,EAAKe,EAAMX,GAAQM,EAAO9zF,EAExC,MAAO,CAAEq0F,UADUjB,EAAKgB,EAAMpL,GAAO5oF,EAAKJ,EACtBwwF,KACtB,CACA,SAASlB,EAAQ0C,EAAG1lE,GAClB,MAAMgoE,EAAK9wF,EAAI8oB,EAAIA,EAAIA,GACjBioE,EAAK/wF,EAAI8wF,EAAKA,EAAKhoE,GAEzB,IAAIlsB,EAAIoD,EAAIwuF,EAAIsC,EADJhB,EAAYtB,EAAIuC,GAAIF,WAEhC,MAAMG,EAAMhxF,EAAI8oB,EAAIlsB,EAAIA,GAClBq0F,EAAQr0F,EACRs0F,EAAQlxF,EAAIpD,EAAIopF,GAChBmL,EAAWH,IAAQxC,EACnB4C,EAAWJ,IAAQhxF,GAAKwuF,GACxB6C,EAASL,IAAQhxF,GAAKwuF,EAAIxI,GAOhC,OANImL,IACFv0F,EAAIq0F,IACFG,GAAYC,KACdz0F,EAAIs0F,GACFlF,EAAapvF,KACfA,EAAIoD,GAAKpD,IACJ,CAAE4U,QAAS2/E,GAAYC,EAAUtgG,MAAO8L,EACjD,CACA,SAAS2wF,EAAWkC,GAClB,OAAO3D,EAAQvG,EAAKkK,EACtB,CACA,SAAS6B,EAAO34F,GACd,OAAOqH,EAAIsuF,EAAgB31F,GAAOgtF,EAAM5nF,EAC1C,CAYA,SAAS2uF,EAAYnjF,EAAKgoF,GACxB,MAAMpoF,EAAQI,aAAetG,WAAaA,WAAWjQ,KAAKuW,GAAOD,EAAWC,GAC5E,GAA8B,iBAAnBgoF,GAA+BpoF,EAAM9Y,SAAWkhG,EACzD,MAAM,IAAItiG,MAAM,YAAYsiG,WAC9B,OAAOpoF,CACT,CACA,SAASshF,EAAgBjnF,EAAKwrD,GAAoB,IAAfztD,IAAMjG,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,KAAAA,UAAA,GACvC,IAAK0zD,EACH,MAAM,IAAIrtD,UAAU,qBAGtB,GAFmB,iBAAR6B,GAAoBlC,OAAOkwF,cAAchuF,KAClDA,EAAMhB,OAAOgB,IACI,iBAARA,GAAoBA,EAAMwrD,EACnC,GAAIztD,GACF,GAAI+jF,EAAM9hF,EACR,OAAOA,OAGT,GAAI8hF,GAAO9hF,EACT,OAAOA,EAGb,MAAM,IAAI7B,UAAU,0CACtB,CACA,SAAS8vF,EAAiBtoF,GAIxB,OAHAA,EAAM,IAAM,IACZA,EAAM,KAAO,IACbA,EAAM,KAAO,GACNA,CACT,CAIA,SAASuoF,EAAgBtuF,GAKvB,GAAmB,MAJnBA,EACiB,iBAARA,GAAmC,iBAARA,EAC9BmsF,EAAkB9E,EAAgBrnF,EAAK2iF,IACvC2G,EAAYtpF,IACV/S,OACN,MAAM,IAAIpB,MAAM,qBAClB,OAAOmU,CACT,CACA,SAASuuF,EAAeC,GACtB,MAAMC,EAAOJ,EAAiBG,EAAOhjG,MAAM,EAAG,KACxC+jD,EAASi/C,EAAOhjG,MAAM,GAAI,IAC1B47F,EAAS8G,EAAOO,GAChBjD,EAAQpI,EAAMgD,KAAKe,SAASC,GAC5BsH,EAAalD,EAAMlB,aACzB,MAAO,CAAEmE,OAAMl/C,SAAQ63C,SAAQoE,QAAOkD,aACxC,CACA,IAAIC,EACJ,SAASC,IACP,GAA2B,mBAAhBD,EACT,MAAM,IAAI9iG,MAAM,oDAClB,OAAO8iG,KAAYz2F,UACrB,CACAxL,eAAe6+F,EAAqBvrF,GAClC,OAAOuuF,QAAqBM,GAAMC,OAAOR,EAAgBtuF,IAC3D,CACA,SAAS+uF,EAAyB/uF,GAChC,OAAOuuF,EAAeK,EAAQN,EAAgBtuF,IAChD,CAyBA,SAASgvF,EAAoBC,EAAK/+F,EAASq5C,GACzCr5C,EAAUo5F,EAAYp5F,GAChBq5C,aAAqB65C,IACzB75C,EAAY65C,EAAMnoB,QAAQ1xB,GAAW,IACvC,MAAM,EAAE/tC,EAAC,EAAEtP,GAAM+iG,aAAevD,EAAYuD,EAAItD,iBAAmBD,EAAUzwB,QAAQg0B,GAErF,MAAO,CAAEzzF,IAAGtP,IAAGgjG,GADJjM,EAAcmD,KAAKkB,eAAep7F,GAC1BijG,IAAK5lD,EAAWtB,IAAK/3C,EAC1C,CACA,SAASk/F,EAAmB7lD,EAAW/tC,EAAG0zF,EAAIV,GAC5C,MAAM9zF,EAAIwzF,EAAOM,GACXa,EAAKpM,EAAcE,WAAW55C,GAAW+9C,eAAe5sF,GAE9D,OADYuoF,EAAcE,WAAW3nF,GAAGwB,IAAIqyF,GACjCvJ,SAASoJ,GAAI5H,eAAe/E,EAAMC,GAAGx+B,OAAOi/B,EAAcI,KACvE,CAWA,MAAMiM,EAAO,CACX/D,qBAAsBwD,EACtBQ,aA/CF,SAA0B7iD,GACxB,OAAOqiD,EAAyBriD,GAAYgiD,UAC9C,EA8CE9/C,KApCF,SAAkB1+C,EAASw8C,GACzBx8C,EAAUo5F,EAAYp5F,GACtB,MAAM,OAAEq/C,EAAM,OAAE63C,EAAM,WAAEsH,GAAeK,EAAyBriD,GAC1DlxC,EAAI0yF,EAAOU,EAAQr/C,EAAQr/C,IAC3Bs/F,EAAIpM,EAAMgD,KAAKe,SAAS3rF,GAExBtP,EAAI0Q,EAAIpB,EADJ0yF,EAAOU,EAAQY,EAAElF,aAAcoE,EAAYx+F,IAC/Bk3F,EAAQ7E,EAAM5nF,GACpC,OAAO,IAAI+wF,EAAU8D,EAAGtjG,GAAGo+F,YAC7B,EA6BEmF,OATF,SAAoBR,EAAK/+F,EAASq5C,GAChC,MAAM,EAAE/tC,EAAC,GAAE0zF,EAAE,IAAEjnD,EAAG,IAAEknD,GAAQH,EAAoBC,EAAK/+F,EAASq5C,GACxDilD,EAASI,EAAQpzF,EAAE8uF,aAAc6E,EAAI7E,aAAcriD,GACzD,OAAOmnD,EAAmBD,EAAK3zF,EAAG0zF,EAAIV,EACxC,GAaA,SAASkB,EAAMhgC,EAAMigC,EAAKC,GACxB,MAAMC,EAAQjzF,EAAI8yD,GAAQigC,EAAMC,IAGhC,MAAO,CAFPD,EAAM/yF,EAAI+yF,EAAME,GAChBD,EAAMhzF,EAAIgzF,EAAMC,GAElB,CANAzM,EAAMgD,KAAK4E,eAAe,GA+D1B,MAAM8E,EAAa,CACjBC,aAAc,mEACdC,UAAAA,CAAWtjD,EAAYnD,GACrB,MAEM0mD,EA7DV,SAA0BC,EAAQ9I,GAChC,MAAM,EAAEhuF,GAAMmpF,EACR6I,EAAI/D,EAAgB6I,EAAQ92F,GAC5BsB,EAAI2sF,EAAgBD,EAAQhuF,GAC5B+2F,EAAM/wF,OAAO,QACbgxF,EAAMhF,EACZ,IAKIiF,EALAV,EAAMxN,EACNmO,EAAMpO,EACN0N,EAAMxE,EACNmF,EAAMpO,EACNzyB,EAAOwyB,EAEX,IAAK,IAAI3lF,EAAI6C,OAAO,KAAU7C,GAAK2lF,EAAK3lF,IAAK,CAC3C,MAAMi0F,EAAO91F,GAAK6B,EAAK4lF,EACvBzyB,GAAQ8gC,EACRH,EAAKX,EAAMhgC,EAAMigC,EAAKC,GACtBD,EAAMU,EAAG,GACTT,EAAMS,EAAG,GACTA,EAAKX,EAAMhgC,EAAM4gC,EAAKC,GACtBD,EAAMD,EAAG,GACTE,EAAMF,EAAG,GACT3gC,EAAO8gC,EACP,MAAMzL,EAAI4K,EAAMW,EACVG,EAAK7zF,EAAImoF,EAAIA,GACbC,EAAI2K,EAAMW,EACVI,EAAK9zF,EAAIooF,EAAIA,GACbI,EAAIqL,EAAKC,EACTzL,EAAI2K,EAAMW,EAEVI,EAAK/zF,GADDgzF,EAAMW,GACGxL,GACb6L,EAAKh0F,EAAIqoF,EAAID,GACb6L,EAAOF,EAAKC,EACZE,EAAQH,EAAKC,EACnBhB,EAAMhzF,EAAIi0F,EAAOA,GACjBN,EAAM3zF,EAAIwzF,EAAMxzF,EAAIk0F,EAAQA,IAC5BnB,EAAM/yF,EAAI6zF,EAAKC,GACfJ,EAAM1zF,EAAIwoF,GAAKqL,EAAK7zF,EAAIuzF,EAAM/K,IAChC,CACAiL,EAAKX,EAAMhgC,EAAMigC,EAAKC,GACtBD,EAAMU,EAAG,GACTT,EAAMS,EAAG,GACTA,EAAKX,EAAMhgC,EAAM4gC,EAAKC,GACtBD,EAAMD,EAAG,GACTE,EAAMF,EAAG,GACT,MAAM,UAAE5C,EAAS,GAAE7D,GAAO8C,EAAY4D,GAChCS,EAAMn0F,EAAI4vF,EAAKiB,EAAWruF,OAAO,IAAMwqF,GAC7C,OAAOhtF,EAAI+yF,EAAMoB,EACnB,CAceC,CAVf,SAA2BC,GACzB,MAAM7F,EAAI9B,EAAY2H,EAAM,IAE5B,OADA7F,EAAE,KAAO,IACFF,EAAgBE,EACzB,CAIc8F,CAAkB3nD,GA5JvB2hD,EAAgBmD,EAAiB/E,EA6JV58C,EA7JyB,OA+JrD,GAAIujD,IAAO/N,EACT,MAAM,IAAIr2F,MAAM,0CAClB,OAfKi+F,EAAkBltF,EAeEqzF,EAfK1N,EAAMnpF,GAgBtC,EACA+3F,eAAezkD,GACNojD,EAAWE,WAAWtjD,EAAYojD,EAAWC,eAGlDpwF,GAAS,CACbyxF,KAAMrP,EACNsP,IAAqB,iBAATvmG,MAAqB,WAAYA,KAAOA,KAAK6U,YAAS1R,GAE9D4gG,GAAQ,CACZ5oF,aACAC,aACA2lF,cACAN,uBACA3uF,MACAgnF,SACA0N,iBAAkB,CAChB,mEACA,mEACA,mEACA,mEACA,mEACA,mEACA,mEACA,oEAEFC,oBAAsBh8F,IAEpB,IADAA,EAAO+zF,EAAY/zF,IACVtI,OAAS,IAAMsI,EAAKtI,OAAS,KACpC,MAAM,IAAIpB,MAAM,yDAClB,OAAO+Q,EAAIsuF,EAAgB31F,GAAOgtF,EAAM5nF,EAAIwnF,GAAOA,CAAG,EAExD1iF,YAAa,WAAsB,IAArB+xF,EAAWt5F,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,GAC1B,GAAIyH,GAAO0xF,IACT,OAAO1xF,GAAO0xF,IAAIzxF,gBAAgB,IAAIC,WAAW2xF,IAE9C,GAAI7xF,GAAOyxF,KAAM,CACpB,MAAM,YAAE3xF,GAAgBE,GAAOyxF,KAC/B,OAAO,IAAIvxF,WAAWJ,EAAY+xF,GAAa1kF,OACjD,CAEE,MAAM,IAAIjhB,MAAM,oDAEpB,EACA4lG,iBAAkBA,IACT5C,GAAMpvF,YAAY,IAE3BqvF,OAAQpiG,iBACN,MAAMwD,EAAU27F,KAAY3zF,WAC5B,GAAIyH,GAAO0xF,IAAK,CACd,MAAMvkF,QAAenN,GAAO0xF,IAAIrrF,OAAO3D,OAAO,UAAWnS,EAAQ4c,QACjE,OAAO,IAAIjN,WAAWiN,EACxB,CACK,GAAInN,GAAOyxF,KACd,OAAOvxF,WAAWjQ,KAAK+P,GAAOyxF,KAAKM,WAAW,UAAUtvF,OAAOlS,GAASmS,UAGxE,MAAM,IAAIxW,MAAM,+CAEpB,EACA8lG,UAAAA,GAA+C,IAApClL,EAAUvuF,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAG,EAAGszF,EAAKtzF,UAAAjL,OAAA,QAAAgB,IAAAiK,UAAA,GAAAA,UAAA,GAAGkrF,EAAMgD,KACvC,MAAMlI,EAASsN,EAAMxnC,OAAOo/B,EAAMgD,MAAQoF,EAAQ,IAAIpI,EAAMoI,EAAMhyF,EAAGgyF,EAAMlxF,GAG3E,OAFA4jF,EAAO8M,eAAevE,GACtBvI,EAAOiJ,SAAS/E,GACTlE,CACT,EACA0T,gBAAY3jG,GAEd+V,OAAO6tF,iBAAiBhD,GAAO,CAC7B+C,WAAY,CACVE,cAAc,EACdhgF,IAAGA,IACM68E,EAET1hF,GAAAA,CAAIzL,GACGmtF,IACHA,EAAcntF,EAClB,KAIJsgF,EAAQS,MAAQA,EAChBT,EAAQmB,cAAgBA,EACxBnB,EAAQsB,MAAQA,EAChBtB,EAAQsG,eAAiBA,EACzBtG,EAAQ4J,UAAYA,EACpB5J,EAAQgO,WAAaA,EACrBhO,EAAQyN,aA1NR7iG,eAA4BggD,GAC1B,aAAc6+C,EAAqB7+C,IAAagiD,UAClD,EAyNA5M,EAAQxyC,gBArKR5iD,eAA+BggD,EAAYnD,GACzC,MAAM,KAAEklD,SAAelD,EAAqB7+C,GACtC0+C,EAAIhI,EAAMnoB,QAAQ1xB,GAAWkiD,WACnC,OAAOqE,EAAWE,WAAWvB,EAAMrD,EACrC,EAkKAtJ,EAAQlzC,KAtNRliD,eAAoBwD,EAASw8C,GAC3Bx8C,EAAUo5F,EAAYp5F,GACtB,MAAM,OAAEq/C,EAAM,OAAE63C,EAAM,WAAEsH,SAAqBnD,EAAqB7+C,GAC5DlxC,EAAI0yF,QAAaW,GAAMC,OAAOv/C,EAAQr/C,IACtCs/F,EAAIpM,EAAMgD,KAAKe,SAAS3rF,GAExBtP,EAAI0Q,EAAIpB,EADJ0yF,QAAaW,GAAMC,OAAOU,EAAElF,aAAcoE,EAAYx+F,IAC1Ck3F,EAAQ7E,EAAM5nF,GACpC,OAAO,IAAI+wF,EAAU8D,EAAGtjG,GAAGo+F,YAC7B,EA+MAxI,EAAQwN,KAAOA,EACfxN,EAAQ+M,MAAQA,GAChB/M,EAAQ2N,OAzLR/iG,eAAsBuiG,EAAK/+F,EAASq5C,GAClC,MAAM,EAAE/tC,EAAC,GAAE0zF,EAAE,IAAEjnD,EAAG,IAAEknD,GAAQH,EAAoBC,EAAK/+F,EAASq5C,GACxDilD,QAAeK,GAAMC,OAAOtzF,EAAE8uF,aAAc6E,EAAI7E,aAAcriD,GACpE,OAAOmnD,EAAmBD,EAAK3zF,EAAG0zF,EAAIV,EACxC,EAuLAxqF,OAAO+tF,eAAejQ,EAAS,aAAc,CAAEp0F,OAAO,GAExD,CAj5BiEskG,CAAQlQ,+FCQzE,MAAMmQ,EAAiB,IACjBC,EAAc,GAEb,SAASC,EAAcC,EAAW1kG,GACvC,OAAIA,aAAiB7B,MACZ,CACLyJ,KAAM5H,EAAM4H,KACZpF,QAASxC,EAAMwC,QACf3C,MAAOG,EAAMH,MACbk+B,SAAU/9B,aAAiB2kG,EAAAA,EAAiB3kG,EAAM+9B,cAAWx9B,GAG1DP,CACT,CAEO,SAAS4kG,EAAOC,GACjBL,EAAKjlG,OAASglG,GAChBC,EAAKn2F,QAGPm2F,EAAKp2F,KAAK,IACLy2F,EACH9rF,KAAM8rF,EAAI9rF,KAAK5E,KAAK2wF,GAAQxgF,KAAKhY,UAAUw4F,EAAKL,KAChDM,KAAMp6F,KAAK6X,OAEf,CAEO,SAASwiF,IACd,OAAOR,CACT,CAEO,SAASthG,EAAcV,GAAiC,QAAA4gB,EAAA5Y,UAAAjL,OAAbwZ,EAAI,IAAA/I,MAAAoT,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJtK,EAAIsK,EAAA,GAAA7Y,UAAA6Y,GACpDuhF,EAAO,CAAEpiG,UAASyiG,MAAO,aAAclsF,SACnC0kB,EAAAA,KAEFyhB,QAAQl8C,MAAM,WAAWR,QAAeuW,EAE5C,CAEO,SAASk6B,EAASzwC,GAA8B,QAAA8vF,EAAA9nF,UAAAjL,OAAbwZ,EAAI,IAAA/I,MAAAsiF,EAAA,EAAAA,EAAA,KAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAJz5E,EAAIy5E,EAAA,GAAAhoF,UAAAgoF,GAC5CoS,EAAO,CAAEpiG,UAASyiG,MAAO,QAASlsF,SAC9B0kB,EAAAA,KAEFyhB,QAAQ2lD,IAAI,WAAWriG,OAAcuW,EAEzC,6ECvDO,IAAK2S,EAAc,SAAdA,GAAc,OAAdA,EAAc,wBAAdA,EAAc,0BAAdA,EAAc,wBAAdA,EAAc,wCAAdA,CAAc,MAOdu0B,EAAY,SAAZA,GAAY,OAAZA,EAAY,kCAAZA,EAAY,gCAAZA,EAAY,sCAAZA,CAAY,MAMZ0N,EAAwB,SAAxBA,GAAwB,OAAxBA,EAAwB,8BAAxBA,EAAwB,oCAAxBA,EAAwB,0CAAxBA,EAAwB,oCAAxBA,EAAwB,0CAAxBA,EAAwB,sCAAxBA,EAAwB,4CAAxBA,EAAwB,4CAAxBA,EAAwB,oCAAxBA,CAAwB,MAYxB8B,EAAmB,SAAnBA,GAAmB,OAAnBA,EAAmB,sDAAnBA,EAAmB,0CAAnBA,EAAmB,0CAAnBA,EAAmB,0CAAnBA,EAAmB,8DAAnBA,EAAmB,gEAAnBA,EAAmB,4BAAnBA,EAAmB,4BAAnBA,CAAmB,6DCzBxB,MAAMk1C,UAAuBxmG,MAClCwL,WAAAA,CACEnH,EAEOu7B,GAEP3L,MAAM5vB,GAAS,KAFRu7B,SAAAA,CAGT,EAGK,SAAS4E,EAAO0+B,EAAoB7+D,EAAiBu7B,GAC1D,IAAKsjC,EACH,MAAM,IAAIsjC,EAAeniG,EAASu7B,EAEtC,oECVO,MAAM5c,EAAuB,CAClC+jF,gBAAiB,UACjBC,mBAAoB,WACpBC,iBAAkB,WAClBC,oBAAqB,WACrBC,SAAU,WAGVC,gBAAiB,UACjBC,kBAAmB,UACnBC,sBAAuB,WACvBC,uBAAwB,UACxBC,oBAAqB,WACrBC,YAAa,WAGblhG,cAAe,WACfmhG,YAAa,WACbC,qBAAsB,WACtBC,sBAAuB,WACvBC,cAAe,WACfC,aAAc,WACdC,mBAAoB,UACpBC,kBAAmB,WACnBC,uBAAwB,WAGxBvkF,cAAe,WACfwkF,gBAAiB,WACjBxhG,gBAAiB,WACjByhG,gBAAiB,SACjBC,uBAAwB,WACxBC,eAAgB,WAChBC,iBAAkB,WAGlBC,gBAAiB,WACjBC,iBAAkB,WAClBC,SAAU,WACVC,oBAAqB,WACrBC,eAAgB,UAChBC,aAAc,YAGHtiG,EAAmB,CAC9BuiG,YAAa,UACbC,YAAa,WACbC,aAAc,WACdniG,gBAAiB,UACjBoiG,aAAc,WACdziG,cAAe,WACfG,gBAAiB,WACjBuiG,eAAgB,WAChBT,iBAAkB,WAClB3hG,sBAAuB,WACvB6gG,YAAa,WACbwB,iBAAkB,WAClBC,qBAAsB,WACtBC,WAAY,UACZC,oBAAqB,YAGVC,EAAW,CACtBC,mBAAoB,OACpBC,gBAAiB,IACjBC,2BAA4Bl2F,OAAO,OACnCm2F,4BAA6B,2ECpE/B,WACE,aAEA,SAASC,EAAS9nG,GAChB,OAAQ8U,SAAS9U,KAAWA,CAC9B,CAEA,SAAS+nG,EAAUC,GACjB,IAAKF,EAASE,EAASzoG,QAAW,OAAO,EAEzC,IAAK,IAAI2B,EAAI,EAAGA,EAAI8mG,EAASzoG,OAAQ2B,IACnC,IAAK4mG,EAASE,EAAS9mG,KAAO8mG,EAAS9mG,GAAK,GAAK8mG,EAAS9mG,GAAK,IAC7D,OAAO,EAIX,OAAO,CACT,CAEA,SAAS+mG,EAAYnD,EAAK7hB,GAGxB,GAAI6hB,EAAI1lF,QAAuB,eAAb0lF,EAAIl9F,KAUpB,OARIq7E,IAEA6hB,EADEA,EAAIhnG,MACAgnG,EAAIhnG,QAEJkS,MAAMkB,UAAUpT,MAAM4mB,KAAKogF,IAI9BA,EAIT,GAAI90F,MAAMqH,QAAQytF,GAAM,CACtB,IAAKiD,EAAUjD,GACb,MAAM,IAAI3mG,MAAM,iCAAmC2mG,GAGrD,OAAO,IAAI3yF,WAAW2yF,EACxB,CAGA,GAAIgD,EAAShD,EAAIvlG,SAAWwoG,EAAUjD,GACpC,OAAO,IAAI3yF,WAAW2yF,GAGxB,MAAM,IAAI3mG,MAAM,gCAClB,CAEA,SAAS+pG,EAAY3oG,GACnB,OAAO,IAAI4S,WAAW5S,EACxB,CAEA,SAAS4oG,EAAUC,EAAaC,EAAaC,EAAaC,EAAaC,GAClD,MAAfD,GAAoC,MAAbC,IAEvBJ,EADEA,EAAYtqG,MACAsqG,EAAYtqG,MAAMyqG,EAAaC,GAE/Bx4F,MAAMkB,UAAUpT,MAAM4mB,KAAK0jF,EAAaG,EAAaC,IAGvEH,EAAY9oF,IAAI6oF,EAAaE,EAC/B,CAIA,IA2DMG,EA3DFC,EA0CK,CACLC,QA1CF,SAAiB58E,GACf,IAAI7V,EAAS,GAAIhV,EAAI,EAErB,IADA6qB,EAAO68E,UAAU78E,GACV7qB,EAAI6qB,EAAKxsB,QAAQ,CACtB,IAAI8B,EAAI0qB,EAAK5qB,WAAWD,KAGd,KAANG,GACF6U,EAAO9H,KAAK0G,SAASiX,EAAK88E,OAAO3nG,EAAG,GAAI,KACxCA,GAAK,GAILgV,EAAO9H,KAAK/M,EAEhB,CAEA,OAAO4mG,EAAY/xF,EACrB,EAyBE4yF,UAvBF,SAAmBzwF,GAGjB,IAFA,IAAInC,EAAS,GAAIhV,EAAI,EAEdA,EAAImX,EAAM9Y,QAAQ,CACvB,IAAI8B,EAAIgX,EAAMnX,GAEVG,EAAI,KACN6U,EAAO9H,KAAK9M,OAAOC,aAAaF,IAChCH,KACSG,EAAI,KAAOA,EAAI,KACxB6U,EAAO9H,KAAK9M,OAAOC,cAAmB,GAAJF,IAAa,EAAqB,GAAfgX,EAAMnX,EAAI,KAC/DA,GAAK,IAELgV,EAAO9H,KAAK9M,OAAOC,cAAmB,GAAJF,IAAa,IAAuB,GAAfgX,EAAMnX,EAAI,KAAc,EAAqB,GAAfmX,EAAMnX,EAAI,KAC/FA,GAAK,EAET,CAEA,OAAOgV,EAAOrU,KAAK,GACrB,GAQEknG,GAWEN,EAAM,mBAWH,CACLE,QAtBF,SAAiB58E,GAEf,IADA,IAAI7V,EAAS,GACJhV,EAAI,EAAGA,EAAI6qB,EAAKxsB,OAAQ2B,GAAK,EACpCgV,EAAO9H,KAAK0G,SAASiX,EAAK88E,OAAO3nG,EAAG,GAAI,KAG1C,OAAOgV,CACT,EAgBE4yF,UAXF,SAAmBzwF,GAEjB,IADA,IAAInC,EAAS,GACJhV,EAAI,EAAGA,EAAImX,EAAM9Y,OAAQ2B,IAAK,CACrC,IAAI82B,EAAI3f,EAAMnX,GACdgV,EAAO9H,KAAKq6F,GAAS,IAAJzwE,IAAa,GAAKywE,EAAQ,GAAJzwE,GACzC,CACA,OAAO9hB,EAAOrU,KAAK,GACrB,IAUEmnG,EAAiB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,IAGtCC,EAAO,CAAC,EAAM,EAAM,EAAM,EAAM,GAAM,GAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,KAGtLC,EAAI,CAAC,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,EAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,EAAM,IAAM,GAAM,IAAM,GAAM,IAAM,EAAM,IAAM,EAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,EAAM,IAAM,GAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,EAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,GAAM,IAAM,EAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,EAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,EAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,IAC//CC,EAAI,CAAC,GAAM,EAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,EAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,EAAM,IAAM,IAAM,GAAM,EAAM,IAAM,GAAM,GAAM,IAAM,IAAM,GAAM,GAAM,EAAM,IAAM,IAAM,IAAM,EAAM,EAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,IAAM,GAAM,IAAM,EAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,GAAM,IAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,GAAM,IAAM,GAAM,IAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,GAAM,IAAM,GAAM,GAAM,GAAM,EAAM,IAAM,IAAM,IAAM,IAAM,GAAM,IAAM,IAAM,GAAM,GAAM,GAAM,GAAM,GAAM,KAG//CjR,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,EAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FH,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAC1/FoR,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAG1/FC,EAAK,CAAC,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,EAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,SAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,EAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,WAAY,SAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,SAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,EAAY,WAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,UAAY,WAAY,YAG1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,SAAY,UAAY,UAAY,WAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,YAC1/FC,EAAK,CAAC,EAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,UAAY,UAAY,UAAY,UAAY,UAAY,UAAY,SAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,WAAY,SAAY,UAAY,UAAY,UAAY,UAAY,SAAY,UAAY,UAAY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","sources":["webpack://mytonwallet/webpack/runtime/chunk loaded","webpack://mytonwallet/webpack/runtime/startup chunk dependencies","webpack://mytonwallet/./src/util/environment.ts","webpack://mytonwallet/./src/api/chains/ton/util/dns.ts","webpack://mytonwallet/./src/util/handleError.ts","webpack://mytonwallet/./src/api/chains/ton/constants.ts","webpack://mytonwallet/./src/util/Deferred.ts","webpack://mytonwallet/./src/util/dateFormat.ts","webpack://mytonwallet/./src/api/types/misc.ts","webpack://mytonwallet/./src/lib/big.js/index.js","webpack://mytonwallet/./src/util/decimals.ts","webpack://mytonwallet/./src/util/random.ts","webpack://mytonwallet/./src/util/bigint.ts","webpack://mytonwallet/./src/util/extensionMessageSerializer.ts","webpack://mytonwallet/./src/util/createPostMessageInterface.ts","webpack://mytonwallet/./src/util/bigintPatch.ts","webpack://mytonwallet/./src/util/account.ts","webpack://mytonwallet/./src/util/isMnemonicPrivateKey.ts","webpack://mytonwallet/./src/util/shortenAddress.ts","webpack://mytonwallet/./src/lib/ed25519-hd-key/index.ts","webpack://mytonwallet/./src/util/iteratees.ts","webpack://mytonwallet/./src/util/dns.ts","webpack://mytonwallet/./src/api/common/utils.ts","webpack://mytonwallet/./src/api/environment.ts","webpack://mytonwallet/./src/api/chains/ton/util/index.ts","webpack://mytonwallet/./src/api/chains/ton/util/tonCore.ts","webpack://mytonwallet/./src/api/storages/types.ts","webpack://mytonwallet/./src/util/windowProvider/connector.ts","webpack://mytonwallet/./src/util/generateUniqueId.ts","webpack://mytonwallet/./src/util/PostMessageConnector.ts","webpack://mytonwallet/./src/api/storages/capacitorStorage.ts","webpack://mytonwallet/./src/api/storages/extension.ts","webpack://mytonwallet/./src/api/storages/idb.ts","webpack://mytonwallet/./src/api/storages/localStorage.ts","webpack://mytonwallet/./src/api/storages/index.ts","webpack://mytonwallet/./src/api/common/accounts.ts","webpack://mytonwallet/./src/api/common/mnemonic.ts","webpack://mytonwallet/./src/lib/confusables/util.ts","webpack://mytonwallet/./src/lib/confusables/characters.ts","webpack://mytonwallet/./src/lib/confusables/index.ts","webpack://mytonwallet/./src/api/common/backend.ts","webpack://mytonwallet/./src/api/common/addresses.ts","webpack://mytonwallet/./src/util/compareActivities.ts","webpack://mytonwallet/./src/util/activities/index.ts","webpack://mytonwallet/./src/util/datetime.ts","webpack://mytonwallet/./src/util/poisoningHash.ts","webpack://mytonwallet/./src/util/isEmptyObject.ts","webpack://mytonwallet/./src/api/db/repository.ts","webpack://mytonwallet/./src/api/db/index.ts","webpack://mytonwallet/./src/api/common/tokens.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/other.ts","webpack://mytonwallet/./src/api/chains/ton/util/tonapiio.ts","webpack://mytonwallet/./src/api/chains/ton/util/metadata.ts","webpack://mytonwallet/./src/util/areDeepEqual.ts","webpack://mytonwallet/./src/util/getDappConnectionUniqueId.ts","webpack://mytonwallet/./src/api/common/helpers.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/actions.ts","webpack://mytonwallet/./src/util/callbacks.ts","webpack://mytonwallet/./src/util/focusAwareDelay.ts","webpack://mytonwallet/./src/api/constants.ts","webpack://mytonwallet/./src/api/common/polling/utils.ts","webpack://mytonwallet/./src/api/common/polling/fallbackPollingScheduler.ts","webpack://mytonwallet/./src/util/reconnectingWebsocket.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/socket.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/throttleSocketActions.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/activityStream.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/transactions.ts","webpack://mytonwallet/./src/api/chains/ton/address.ts","webpack://mytonwallet/./src/api/chains/ton/wallet.ts","webpack://mytonwallet/./src/api/chains/ton/auth.ts","webpack://mytonwallet/./src/util/chain.ts","webpack://mytonwallet/./src/util/fee/transferFee.ts","webpack://mytonwallet/./src/util/tokens.ts","webpack://mytonwallet/./src/api/chains/ton/util/encryption.ts","webpack://mytonwallet/./src/api/chains/ton/util/diesel.ts","webpack://mytonwallet/./src/api/chains/ton/util/w5diesel.ts","webpack://mytonwallet/./src/api/chains/ton/util/sendExternal.ts","webpack://mytonwallet/./src/api/common/pendingTransfers.ts","webpack://mytonwallet/./src/api/chains/ton/traces.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/traces.ts","webpack://mytonwallet/./src/api/chains/ton/activities.ts","webpack://mytonwallet/./src/api/chains/ton/emulation.ts","webpack://mytonwallet/./src/api/chains/ton/toncenter/emulation.ts","webpack://mytonwallet/./src/api/chains/ton/tokens.ts","webpack://mytonwallet/./src/api/chains/ton/priceless.ts","webpack://mytonwallet/./src/api/chains/ton/transfer.ts","webpack://mytonwallet/./src/api/chains/ton/nfts.ts","webpack://mytonwallet/./src/util/ton/transfer.ts","webpack://mytonwallet/./src/api/chains/ton/domains.ts","webpack://mytonwallet/./src/util/devSettings.ts","webpack://mytonwallet/./src/api/chains/ton/contracts/NominatorPool.ts","webpack://mytonwallet/./src/api/common/cache.ts","webpack://mytonwallet/./src/api/common/other.ts","webpack://mytonwallet/./src/api/chains/ton/staking.ts","webpack://mytonwallet/./src/util/staking/index.ts","webpack://mytonwallet/./src/util/ton/calcJettonStakingApr.ts","webpack://mytonwallet/./src/api/chains/ton/other.ts","webpack://mytonwallet/./src/api/chains/ton/swap.ts","webpack://mytonwallet/./src/api/common/swap.ts","webpack://mytonwallet/./src/api/common/activities.ts","webpack://mytonwallet/./src/api/common/backendSocket.ts","webpack://mytonwallet/./src/api/common/polling/walletPolling.ts","webpack://mytonwallet/./src/api/common/txCallbacks.ts","webpack://mytonwallet/./src/util/orGate.ts","webpack://mytonwallet/./src/api/chains/ton/richActivityStream.ts","webpack://mytonwallet/./src/api/chains/ton/polling.ts","webpack://mytonwallet/./src/api/chains/ton/vesting.ts","webpack://mytonwallet/./src/api/chains/tron/util/tronweb.ts","webpack://mytonwallet/./src/api/chains/tron/transactions.ts","webpack://mytonwallet/./src/api/chains/tron/wallet.ts","webpack://mytonwallet/./src/api/chains/tron/polling.ts","webpack://mytonwallet/./src/api/chains/tron/constants.ts","webpack://mytonwallet/./src/api/chains/tron/transfer.ts","webpack://mytonwallet/./src/util/stringFormat.ts","webpack://mytonwallet/./src/api/chains/tron/index.ts","webpack://mytonwallet/./src/api/chains/index.ts","webpack://mytonwallet/./src/api/hooks.ts","webpack://mytonwallet/./src/api/common/prices.ts","webpack://mytonwallet/./src/api/methods/preload.ts","webpack://mytonwallet/./src/api/methods/tokens.ts","webpack://mytonwallet/./src/api/methods/transactions.ts","webpack://mytonwallet/./src/api/methods/staking.ts","webpack://mytonwallet/./src/api/methods/other.ts","webpack://mytonwallet/./src/api/methods/swap.ts","webpack://mytonwallet/./src/api/methods/polling.ts","webpack://mytonwallet/./src/api/methods/accounts.ts","webpack://mytonwallet/./src/api/methods/dapps.ts","webpack://mytonwallet/./src/api/methods/auth.ts","webpack://mytonwallet/./src/api/common/dappPromises.ts","webpack://mytonwallet/./src/api/methods/wallet.ts","webpack://mytonwallet/./src/api/methods/nfts.ts","webpack://mytonwallet/./src/api/methods/domains.ts","webpack://mytonwallet/./src/api/tonConnect/types/index.ts","webpack://mytonwallet/./src/util/tonConnectEnvironment.ts","webpack://mytonwallet/./src/api/tonConnect/errors.ts","webpack://mytonwallet/./src/util/crcHash.ts","webpack://mytonwallet/./src/api/tonConnect/signing.ts","webpack://mytonwallet/./src/api/tonConnect/utils.ts","webpack://mytonwallet/./src/api/tonConnect/index.ts","webpack://mytonwallet/./src/api/tonConnect/sse.ts","webpack://mytonwallet/./src/api/methods/prices.ts","webpack://mytonwallet/./src/api/methods/notifications.ts","webpack://mytonwallet/./src/api/methods/init.ts","webpack://mytonwallet/./src/api/migrations/00016.ts","webpack://mytonwallet/./src/api/migrations/00017.ts","webpack://mytonwallet/./src/api/migrations/00018.ts","webpack://mytonwallet/./src/api/providers/worker/provider.ts","webpack://mytonwallet/./src/util/withCache.ts","webpack://mytonwallet/./src/config.ts","webpack://mytonwallet/./src/util/schedulers.ts","webpack://mytonwallet/./src/api/errors.ts","webpack://mytonwallet/./src/util/fetch.ts","webpack://mytonwallet/./src/util/safeExec.ts","webpack://mytonwallet/./src/lib/noble-ed25519/index.js","webpack://mytonwallet/./src/util/logs.ts","webpack://mytonwallet/./src/api/types/errors.ts","webpack://mytonwallet/./src/util/assert.ts","webpack://mytonwallet/./src/api/chains/ton/contracts/JettonStaking/imports/constants.ts","webpack://mytonwallet/./src/lib/aes-js/index.js","webpack://mytonwallet/webpack/bootstrap","webpack://mytonwallet/webpack/runtime/compat get default export","webpack://mytonwallet/webpack/runtime/define property getters","webpack://mytonwallet/webpack/runtime/ensure chunk","webpack://mytonwallet/webpack/runtime/get javascript chunk filename","webpack://mytonwallet/webpack/runtime/get mini-css chunk filename","webpack://mytonwallet/webpack/runtime/global","webpack://mytonwallet/webpack/runtime/hasOwnProperty shorthand","webpack://mytonwallet/webpack/runtime/make namespace object","webpack://mytonwallet/webpack/runtime/publicPath","webpack://mytonwallet/webpack/runtime/importScripts chunk loading","webpack://mytonwallet/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([973,508,115].map(__webpack_require__.e, __webpack_require__)).then(next);\n};","import { IS_EXTENSION } from '../config';\n\nexport const IS_EXTENSION_PAGE_SCRIPT = IS_EXTENSION\n  && !['chrome-extension:', 'moz-extension:'].includes(self.location.protocol);\n","/* Source https://github.com/toncenter/tonweb/blob/master/src/contract/dns/DnsUtils.js */\nimport type { Cell, Slice } from '@ton/core';\nimport { Address, Builder } from '@ton/core';\n\nimport type { TonClient } from './TonClient';\n\nimport { DnsCategory } from '../constants';\nimport { sha256BigInt } from './other';\n\nexport type DnsResult = Cell | Address | string | undefined;\n\nexport function dnsCategoryToBigInt(category?: string) {\n  if (!category) return 0n; // all categories\n  return sha256BigInt(category);\n}\n\nfunction parseSmartContractAddressImpl(cell: Cell, prefix0: number, prefix1: number): Address | undefined {\n  const slice = cell.asSlice();\n\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== prefix0 || byte1 !== prefix1) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  return parseAddress(slice);\n}\n\nfunction parseSmartContractAddressRecord(cell: Cell): Address | undefined {\n  return parseSmartContractAddressImpl(cell, 0x9f, 0xd3);\n}\n\nfunction parseNextResolverRecord(cell: Cell): Address | undefined {\n  return parseSmartContractAddressImpl(cell, 0xba, 0x93);\n}\n\nfunction parseStorageBagIdRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== 0x74 || byte1 !== 0x73) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  const buffer = slice.loadBuffer(4);\n  return buffer.toString('hex');\n}\n\nfunction parseSiteRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 === 0xad || byte1 === 0x01) {\n    return parseAdnlAddressRecord(cell);\n  } else {\n    return parseStorageBagIdRecord(cell);\n  }\n}\n\nfunction parseAdnlAddressRecord(cell: Cell): string {\n  const slice = cell.asSlice();\n  const byte0 = slice.loadUint(8);\n  const byte1 = slice.loadUint(8);\n\n  if (byte0 !== 0xad || byte1 !== 0x01) {\n    throw new Error('Invalid dns record value prefix');\n  }\n\n  const buffer = slice.loadBuffer(4);\n  return buffer.toString('hex');\n}\n\nasync function dnsResolveImpl(\n  client: TonClient,\n  dnsAddress: string,\n  rawDomainBytes: Buffer,\n  category?: DnsCategory,\n  oneStep?: boolean,\n): Promise<DnsResult> {\n  const len = rawDomainBytes.length * 8;\n\n  const domainCell = new Builder()\n    .storeBuffer(rawDomainBytes)\n    .asCell();\n\n  const categoryBigInt = dnsCategoryToBigInt(category);\n  const { stack } = await client.callGetMethod(Address.parse(dnsAddress), 'dnsresolve', [\n    { type: 'slice', cell: domainCell },\n    { type: 'int', value: categoryBigInt },\n  ]);\n\n  const resultLen = stack.readNumber();\n\n  let cell: Cell | undefined;\n\n  try {\n    cell = stack.readCell();\n  } catch (err) {\n    // Do nothing\n  }\n\n  if (resultLen === 0) {\n    return undefined; // domain cannot be resolved\n  }\n\n  if (resultLen % 8 !== 0) {\n    throw new Error('domain split not at a component boundary');\n  }\n  // if (rawDomainBytes[resultLen] !== 0) {\n  //     throw new Error('domain split not at a component boundary');\n  // }\n  if (resultLen > len) {\n    throw new Error(`invalid response ${resultLen}/${len}`);\n  } else if (resultLen === len) {\n    if (category === DnsCategory.DnsNextResolver) {\n      return cell ? parseNextResolverRecord(cell) : undefined;\n    } else if (category === DnsCategory.Wallet) {\n      return cell ? parseSmartContractAddressRecord(cell) : undefined;\n    } else if (category === DnsCategory.Site) {\n      return cell ? parseSiteRecord(cell) : undefined;\n    } else if (category === DnsCategory.BagId) {\n      return cell ? parseStorageBagIdRecord(cell) : undefined;\n    } else {\n      return cell;\n    }\n  } else if (!cell) {\n    return undefined; // domain cannot be resolved\n  } else {\n    const nextAddress = parseNextResolverRecord(cell)!;\n    if (oneStep) {\n      if (category === DnsCategory.DnsNextResolver) {\n        return nextAddress;\n      } else {\n        return undefined;\n      }\n    } else {\n      return dnsResolveImpl(client, nextAddress.toString(), rawDomainBytes.slice(resultLen / 8), category, false);\n    }\n  }\n}\n\n/** Encodes the domain in accordance with the TEP-81 standard */\nexport function encodeDomain(domain: string): string {\n  if (!domain || !domain.length) {\n    throw new Error('empty domain');\n  }\n  if (domain === '.') {\n    return '';\n  }\n\n  domain = domain.toLowerCase();\n\n  for (let i = 0; i < domain.length; i++) {\n    if (domain.charCodeAt(i) <= 32) {\n      throw new Error('bytes in range 0..32 are not allowed in domain names');\n    }\n  }\n\n  for (let i = 0; i < domain.length; i++) {\n    const s = domain.substring(i, i + 1);\n    for (let c = 127; c <= 159; c++) { // another control codes range\n      if (s === String.fromCharCode(c)) {\n        throw new Error('bytes in range 127..159 are not allowed in domain names');\n      }\n    }\n  }\n\n  const arr = domain.split('.');\n\n  arr.forEach((part) => {\n    if (!part.length) {\n      throw new Error('domain name cannot have an empty component');\n    }\n  });\n\n  return `${arr.reverse().join('\\0')}\\0`;\n}\n\nexport function dnsResolve(\n  client: TonClient,\n  rootDnsAddress: string,\n  domain: string,\n  category?: DnsCategory,\n  oneStep?: boolean,\n): Promise<DnsResult> {\n  let rawDomain = encodeDomain(domain);\n  if (rawDomain.length < 126) {\n    rawDomain = `\\0${rawDomain}`;\n  }\n\n  return dnsResolveImpl(client, rootDnsAddress, Buffer.from(rawDomain), category, oneStep);\n}\n\nfunction parseAddress(slice: Slice): Address | undefined {\n  slice.loadUint(3);\n  let n = slice.loadUintBig(8);\n  if (n > 127n) { // Maybe it's not necessary?\n    n -= 256n;\n  }\n\n  const hashPart = slice.loadUintBig(256);\n  if (`${n.toString(10)}:${hashPart.toString(16)}` === '0:0') {\n    return undefined;\n  }\n  const s = `${n.toString(10)}:${hashPart.toString(16).padStart(64, '0')}`;\n  return Address.parse(s);\n}\n","import { APP_ENV, DEBUG_ALERT_MSG } from '../config';\nimport { SECOND } from './dateFormat';\nimport { IS_EXTENSION_PAGE_SCRIPT } from './environment';\nimport { logDebugError } from './logs';\nimport { throttle } from './schedulers';\n\nconst shouldShowAlert = (APP_ENV === 'development' || APP_ENV === 'staging')\n  && typeof window === 'object'\n  && !IS_EXTENSION_PAGE_SCRIPT;\n\nconst throttledAlert = throttle((message) => window.alert(message), 10 * SECOND);\n\nself.addEventListener('error', handleErrorEvent);\nself.addEventListener('unhandledrejection', handleErrorEvent);\n\nfunction handleErrorEvent(e: ErrorEvent | PromiseRejectionEvent) {\n  // https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n  if (e instanceof ErrorEvent && e.message === 'ResizeObserver loop limit exceeded') {\n    return;\n  }\n\n  e.preventDefault();\n\n  handleError(e instanceof ErrorEvent ? (e.error || e.message) : e.reason);\n}\n\nexport function handleError(err: Error | string) {\n  logDebugError('handleError', err);\n\n  const message = typeof err === 'string' ? err : err.message;\n  const stack = typeof err === 'object' ? err.stack : undefined;\n\n  if (message.endsWith('Failed to import rlottie-wasm.js')) {\n    return;\n  }\n\n  if (shouldShowAlert) {\n    throttledAlert(`${DEBUG_ALERT_MSG}\\n\\n${(message) || err}\\n${stack}`);\n  }\n}\n","import type { ApiTonWalletVersion, ContractInfo, ContractName } from './types';\n\nimport { JettonStakingGas } from './contracts/JettonStaking/imports/constants';\n\nexport const TON_BIP39_PATH = 'm/44\\'/607\\'/0\\'';\n\nexport const ONE_TON = 1_000_000_000n;\nexport const TOKEN_TRANSFER_AMOUNT = 50000000n; // 0.05 TON\nexport const TINY_TOKEN_TRANSFER_AMOUNT = 18000000n; // 0.018 TON\nexport const TOKEN_TRANSFER_REAL_AMOUNT = 32100000n; // 0.0321 TON\nexport const TINY_TOKEN_TRANSFER_REAL_AMOUNT = 8000000n; // 0.008 TON\nexport const TINIEST_TOKEN_TRANSFER_REAL_AMOUNT = 3000000n; // 0.003 TON\nexport const TOKEN_TRANSFER_FORWARD_AMOUNT = 1n; // 0.000000001 TON\nexport const CLAIM_MINTLESS_AMOUNT = 20000000n; // 0.02 TON\n\n/** The amount that MyTonWallet attaches to NFT transfers */\nexport const NFT_TRANSFER_AMOUNT = 100000000n; // 0.1 TON\nexport const NFT_TRANSFER_REAL_AMOUNT = 5000000n; // 0.005 TON\nexport const NFT_TRANSFER_FORWARD_AMOUNT = 1n; // 0.000000001 TON\n/**\n * When the NFT contract handles the payload we send, it simply adds its data to the payload. If the resulting payload\n * size becomes greater than the cell capacity, the contract fails to send the NFT. To avoid that, we keep some free\n * space in the payload cell we send. This constant is the size of the free space in bits.\n */\nexport const NFT_PAYLOAD_SAFE_MARGIN = 14 * 8;\n\nexport const TON_GAS = {\n  stakeNominators: ONE_TON,\n  unstakeNominators: ONE_TON,\n  stakeLiquid: ONE_TON,\n  unstakeLiquid: ONE_TON,\n  stakeJettonsForward: JettonStakingGas.STAKE_JETTONS,\n  stakeJettons: JettonStakingGas.STAKE_JETTONS + TOKEN_TRANSFER_AMOUNT,\n  unstakeJettons: JettonStakingGas.UNSTAKE_JETTONS,\n  claimJettons: JettonStakingGas.JETTON_TRANSFER + JettonStakingGas.SIMPLE_UPDATE_REQUEST,\n  changeDns: 15_000_000n, // 0.015 TON\n  stakeEthena: TOKEN_TRANSFER_AMOUNT + 100_000_000n, // 0.15 TON\n  stakeEthenaForward: 100_000_000n, // 0.1 TON\n  unstakeEthena: TOKEN_TRANSFER_AMOUNT + 100_000_000n, // 0.15 TON\n  unstakeEthenaForward: 100_000_000n, // 0.1 TON\n  unstakeEthenaLocked: 150_000_000n, // 0.15 TON\n  unstakeEthenaLockedForward: 70_000_000n, // 0.07 TON\n} as const;\n\nexport const TON_GAS_REAL = {\n  stakeNominators: 1_000_052_853n,\n  unstakeNominators: 148_337_433n,\n  stakeLiquid: 20_251_387n,\n  unstakeLiquid: 18_625_604n,\n  stakeJettons: 74_879_996n,\n  unstakeJettons: 59_971_662n,\n  claimJettons: 57_053_859n,\n  stakeEthena: 116_690_790n,\n  unstakeEthena: 113_210_330n,\n  unstakeEthenaLocked: 37_612_000n,\n};\n\nexport const STAKE_COMMENT = 'd';\nexport const UNSTAKE_COMMENT = 'w';\n\nexport const ATTEMPTS = 5;\n\nexport const DEFAULT_DECIMALS = 9;\nexport const DEFAULT_IS_BOUNCEABLE = true;\nexport const WALLET_IS_BOUNCEABLE = false;\n\n// Fee may change, so we add 5% for more reliability. This is only safe for low-fee blockchains such as TON.\nexport const FEE_FACTOR = 1.05;\n\nexport const ALL_WALLET_VERSIONS: ApiTonWalletVersion[] = [\n  'simpleR1', 'simpleR2', 'simpleR3', 'v2R1', 'v2R2', 'v3R1', 'v3R2', 'v4R2', 'W5',\n];\n\nexport const OUR_FEE_PAYLOAD_BOC = 'te6cckEBAQEABgAACE0jhUPUcYAL';\n\nexport const RAW_ADDRESS_LENGTH = 66;\n\nexport enum Workchain {\n  MasterChain = -1,\n  BaseChain = 0,\n}\n\nexport const WORKCHAIN = Workchain.BaseChain;\nexport const TRANSFER_TIMEOUT_SEC = 600; // 10 min.\n\nexport const DEFAULT_MAX_MESSAGES = 4;\nexport const LEDGER_MAX_MESSAGES = 1;\nexport const W5_MAX_MESSAGES = 255;\n\nexport enum OpCode {\n  Comment = 0,\n  Encrypted = 0x2167da4b,\n  OurFee = 0x4d238543,\n  Bounced = 0xffffffff,\n}\n\nexport enum JettonOpCode {\n  Transfer = 0xf8a7ea5,\n  TransferNotification = 0x7362d09c,\n  InternalTransfer = 0x178d4519,\n  Excesses = 0xd53276db,\n  Burn = 0x595f07bc,\n  BurnNotification = 0x7bdd97de,\n}\n\nexport enum NftOpCode {\n  TransferOwnership = 0x5fcc3d14,\n  OwnershipAssigned = 0x05138d91,\n  Excesses = 0xd53276db,\n}\n\nexport enum LiquidStakingOpCode {\n  // Pool\n  RequestLoan = 0xe642c965,\n  LoanRepayment = 0xdfdca27b,\n  Deposit = 0x47d54391,\n  Withdraw = 0x319B0CDC,\n  Withdrawal = 0x0a77535c,\n  DeployController = 0xb27edcad,\n  Touch = 0x4bc7c2df,\n  Donate = 0x73affe21,\n  // NFT\n  DistributedAsset = 0xdb3b8abd,\n  // Jetton\n  Vote = 0x69fb306c,\n}\n\nexport enum JettonStakingOpCode {\n  UnstakeRequest = 0x499a9262,\n  ClaimRewards = 0x78d9f109,\n}\n\nexport enum VestingV1OpCode {\n  AddWhitelist = 0x7258a69b,\n}\n\nexport enum SingleNominatorOpCode {\n  Withdraw = 0x1000,\n  ChangeValidator = 0x1001,\n}\n\nexport enum DnsOpCode {\n  ChangeRecord = 0x4eb1f0f9,\n}\n\nexport enum TeleitemOpCode {\n  Ok = 0xa37a0983,\n}\n\nexport enum OtherOpCode {\n  TokenBridgePaySwap = 0x8,\n}\n\nexport enum ContractType {\n  Wallet = 'wallet',\n  Staking = 'staking',\n}\n\nexport enum DnsCategory {\n  DnsNextResolver = 'dns_next_resolver',\n  Wallet = 'wallet',\n  Site = 'site',\n  BagId = 'storage',\n  Unknown = 'unknown',\n}\n\nexport const EXCESS_OP_CODES = [\n  JettonOpCode.Excesses,\n  TeleitemOpCode.Ok,\n];\n\nexport const DNS_CATEGORY_HASH_MAP = {\n  dns_next_resolver: '19f02441ee588fdb26ee24b2568dd035c3c9206e11ab979be62e55558a1d17ff',\n  wallet: 'e8d44050873dba865aa7c170ab4cce64d90839a34dcfd6cf71d14e0205443b1b',\n  site: 'fbae041b02c41ed0fd8a4efb039bc780dd6af4a1f0c420f42561ae705dda43fe',\n  storage: '49a25f9feefaffecad0fcd30c50dc9331cff8b55ece53def6285c09e17e6f5d7',\n} as const;\n\nexport const KnownContracts: Record<ContractName, ContractInfo> = {\n  simpleR1: {\n    name: 'simpleR1',\n    hash: '3232dc55b02b3d2a9485adc151cf29c50b94c374d3571cb59390d761b87af8bd',\n    type: ContractType.Wallet,\n  },\n  simpleR2: {\n    name: 'simpleR2',\n    hash: '672ce2b01d2fd487a5e0528611e7e4fc11867148cc13ff772bd773b72fb368df',\n    type: ContractType.Wallet,\n  },\n  simpleR3: {\n    name: 'simpleR3',\n    hash: 'd95417233f66ae218317f533630cbbddc677d6d893d5722be6947c8fad8e9d52',\n    type: ContractType.Wallet,\n  },\n  v2R1: {\n    name: 'v2R1',\n    hash: 'fb3bd539b7e50166f1cfdc0bbd298b1c88f6b261fe5ee61343ea47ab4b256029',\n    type: ContractType.Wallet,\n  },\n  v2R2: {\n    name: 'v2R2',\n    hash: 'b584b6106753b7f34709df505be603e463a44ff6a85adf7fec4e26453c325983',\n    type: ContractType.Wallet,\n  },\n  v3R1: {\n    name: 'v3R1',\n    hash: '11d123ed5c2055128e75a9ef4cf1e837e6d14a9c079c39939885c78dc13626e6',\n    type: ContractType.Wallet,\n  },\n  v3R2: {\n    name: 'v3R2',\n    hash: 'df7bf014ee7ac0c38da19ef1b7fa054e2cc7a4513df1f1aa295109cf3606ac14',\n    type: ContractType.Wallet,\n  },\n  v4R1: {\n    name: 'v4R1',\n    hash: '1bc0dfa40956c911616f8a5db09ecc217601bae48d7d3f9311562c5afcb66dcf',\n    type: ContractType.Wallet,\n  },\n  v4R2: {\n    name: 'v4R2',\n    hash: '5659ce2300f4a09a37b0bdee41246ded52474f032c1d6ffce0d7d31b18b7b2b1',\n    type: ContractType.Wallet,\n  },\n  W5: {\n    name: 'W5',\n    hash: '7e94eaaeaaa423b9396e79747038c42edc4fe98dce65094071f0e0ad2df22fd5',\n    type: ContractType.Wallet,\n  },\n  highloadV2: {\n    name: 'highloadV2',\n    hash: 'fcd7d1f3b3847f0b9bd44bc64a2256c03450979dd1646a24fbc874b075392d6e',\n    type: ContractType.Wallet,\n  },\n  nominatorPool: {\n    name: 'nominatorPool',\n    hash: '26faa2d0fd2a8197ea36ded8dc50ad081cce5244207e9b05c08c1bb655527bff',\n    type: ContractType.Staking,\n  },\n  multisig: {\n    name: 'multisig',\n    hash: '45d890485cdd6b152bcbbe3fb2e16d2df82f6da840440a5b9f34ea13cb0b92d2',\n    type: ContractType.Wallet,\n  },\n  multisigV2: {\n    name: 'multisigV2',\n    hash: 'eb1323c5544d5bf26248dc427d108d722d5c2922dd97dd0bdf903c4cea73ca97',\n    type: ContractType.Wallet,\n  },\n  vesting: {\n    name: 'vesting',\n    hash: '69dc931958f7aa203c4a7bfcf263d25d2d828d573184b542a65dd55c8398ad83',\n    type: ContractType.Wallet,\n  },\n  multisigNew: {\n    name: 'multisigNew',\n    hash: '7cb3678880388acff45d74b2e7e7544caa8039d20b49f57c75b53c051b6fa30f',\n    type: ContractType.Wallet,\n  },\n  dedustPool: {\n    name: 'dedustPool',\n    hash: 'f216ded2b43d32e2d487db6fa6e4d2387f0ef1d7b53ec1ad85f0b4feb8e4ed62',\n    isSwapAllowed: true,\n  },\n  dedustVaultNative: {\n    name: 'dedustVaultNative',\n    hash: '64a42ad66688097422901ae6188670f0d6292ad3bdb4139289666f24187e86cb',\n    isSwapAllowed: true,\n  },\n  // Example: https://tonscan.org/address/EQAYqo4u7VF0fa4DPAebk4g9lBytj2VFny7pzXR0trjtXQaO\n  dedustVaultJetton: {\n    name: 'dedustVaultJetton',\n    hash: '5bc82f0c5972ccc6732e98cbe31ea4795da818f9e06c991331568182a8362307',\n    isSwapAllowed: true,\n  },\n  stonPtonWallet: {\n    name: 'stonPtonWallet',\n    hash: '6ccbf71a3ed9c7355f84a698a44a7406574bfb8aa34d4bbd86ab75ee9c994880',\n    isSwapAllowed: true,\n  },\n  stonRouter: {\n    name: 'stonRouter',\n    hash: '14ce618a0e9a94adc99fa6e975219ddd675425b30dfa9728f98714c8dc55f9da',\n    isSwapAllowed: true,\n  },\n  stonRouterV2_1: {\n    name: 'stonRouterV2_1',\n    hash: 'd61cb7fb7bee0cc414286a482fccdec53c3f8717e4aae4fc362d98ab6254e6cd',\n    isSwapAllowed: true,\n  },\n  stonPoolV2_1: {\n    name: 'stonPoolV2_1',\n    hash: '16cc513c380e329f45d54f294787e2030e289799eca138961c1cd7e26e882c7c',\n    isSwapAllowed: true,\n  },\n  // Example: https://tonscan.org/address/EQCS4UEa5UaJLzOyyKieqQOQ2P9M-7kXpkO5HnP3Bv250cN3\n  stonRouterV2_2: {\n    name: 'stonRouterV2_2',\n    hash: '094b5084111addda1b6fac7007c8a8f85ff4ccc63475815ab3dfa3b5b4c6b102',\n    isSwapAllowed: true,\n  },\n  // Example: https://tonscan.org/address/EQBSNX_5mSikBVttWhIaIb0f8jJU7fL6kvyyFVppd7dWRO6M\n  stonRouterV2_2_alt: {\n    name: 'stonRouterV2_2_alt',\n    hash: 'd41e7563afa05ee008655e190920d3f53de9cab4c2d4e10ee1d0f158e95e52e5',\n    isSwapAllowed: true,\n  },\n  stonPoolV2_2: {\n    name: 'stonPoolV2_2',\n    hash: '11eaf6db706e63adf9327897aaa845c77a631856abfc14375837f19b617cacb4',\n    isSwapAllowed: true,\n  },\n  // Example: https://tonscan.org/address/EQBiLHuQjDj4fNyCD7Ch5HwpNGldlb5g-LMwQ1kStQ4NM5kv\n  stonPtonWalletV2: {\n    name: 'stonPtonWalletV2',\n    hash: '2761042202032258de9eb1b672e1ec2e4f13b2af00700195801ada33f7ced1b6',\n    isSwapAllowed: true,\n  },\n};\n","export default class Deferred<T = void> {\n  promise: Promise<T>;\n\n  reject!: (reason?: any) => void;\n\n  resolve!: (value: T | PromiseLike<T>) => void;\n\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n\n  static resolved(): Deferred<void>;\n  static resolved<T>(value: T): Deferred<T>;\n  static resolved<T>(value?: T): Deferred<T | void> {\n    const deferred = new Deferred<T | void>();\n    deferred.resolve(value);\n    return deferred;\n  }\n}\n","import type { LangCode } from '../global/types';\nimport type { LangFn } from './langProvider';\n\nimport withCache from './withCache';\n\nexport const SECOND = 1000;\nexport const MINUTE = SECOND * 60;\nexport const HOUR = MINUTE * 60;\nexport const DAY = HOUR * 24;\nexport const YEAR = 365 * DAY;\n\nconst formatDayToStringWithCache = withCache((\n  langCode: LangCode,\n  dayStartAt: number,\n  noYear?: boolean,\n  monthFormat: 'short' | 'long' | 'numeric' | false = 'short',\n  noDay?: boolean,\n  withTime = false,\n) => {\n  return new Date(dayStartAt).toLocaleString(\n    langCode,\n    {\n      year: noYear ? undefined : 'numeric',\n      month: monthFormat || undefined,\n      day: noDay ? undefined : 'numeric',\n      hour: withTime ? 'numeric' : undefined,\n      minute: withTime ? 'numeric' : undefined,\n      hourCycle: 'h23',\n    },\n  );\n});\n\nexport function formatRelativeHumanDateTime(\n  langCode: LangCode = 'en',\n  time: number,\n) {\n  const total = time - Date.now();\n  const minutes = Math.floor((total / 1000 / 60) % 60);\n  const hours = Math.floor((total / (1000 * 3600)) % 24);\n  const days = Math.floor(total / 1000 / 3600 / 24);\n\n  const rtf = new Intl.RelativeTimeFormat(langCode, {\n    localeMatcher: 'best fit',\n    numeric: 'always',\n    style: 'long',\n  });\n\n  const result: string[] = [];\n\n  if (days > 0) {\n    const [daysPlural, daysValue] = rtf.formatToParts(days, 'day').reverse();\n    result.push(`${daysValue.value}${daysPlural.value}`.replace(' ', '\\u00A0'));\n  }\n  if (hours > 0) {\n    const [hoursPlural, hoursValue] = rtf.formatToParts(hours, 'hour').reverse();\n    result.push(`${hoursValue.value}${hoursPlural.value}`.replace(' ', '\\u00A0'));\n  }\n  if (minutes > 0) {\n    const [minutesPlural, minutesValue] = rtf.formatToParts(minutes, 'minute').reverse();\n    result.push(`${minutesValue.value}${minutesPlural.value}`.replace(' ', '\\u00A0'));\n  }\n\n  return result.join(' ');\n}\n\nexport function formatHumanDay(lang: LangFn, datetime: string | number) {\n  if (isToday(datetime)) {\n    return lang('Today');\n  }\n\n  if (isYesterday(datetime)) {\n    return lang('Yesterday');\n  }\n\n  return formatFullDay(lang.code!, datetime);\n}\n\nexport function formatFullDay(langCode: LangCode, datetime: string | number | Date) {\n  const date = new Date(datetime);\n  const dayStartAt = getDayStartAt(date);\n  const today = getDayStart(new Date());\n  const noYear = date.getFullYear() === today.getFullYear();\n\n  return formatDayToStringWithCache(langCode, dayStartAt, noYear, 'long');\n}\n\nexport function formatShortDay(langCode: LangCode, datetime: string | number | Date, withTime = false, noYear = false) {\n  const date = new Date(datetime);\n  const dayStartAt = getDayStartAt(date);\n  const today = getDayStart(new Date());\n  const todayStartAt = getDayStartAt(today);\n  const noDate = withTime && dayStartAt === todayStartAt;\n  const targetAt = withTime ? getMinuteStart(date).getTime() : dayStartAt;\n\n  noYear ||= date.getFullYear() === today.getFullYear();\n\n  return formatDayToStringWithCache(langCode, targetAt, noYear, !noDate && 'short', noDate, withTime);\n}\n\nexport function formatTime(datetime: string | number) {\n  const date = new Date(datetime);\n\n  return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;\n}\n\nexport function getCountDaysToDate(datetime: string | number | Date) {\n  const today = new Date();\n  const date = datetime instanceof Date ? datetime\n    : new Date(datetime);\n\n  return Math.ceil((date.getTime() - today.getTime()) / DAY);\n}\n\nexport function getDayStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\nexport function getDayStartAt(datetime: number | Date) {\n  return getDayStart(datetime).getTime();\n}\n\nexport function getMinuteStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setSeconds(0, 0);\n  return date;\n}\n\nfunction isToday(datetime: string | number) {\n  return getDayStartAt(new Date()) === getDayStartAt(new Date(datetime));\n}\n\nfunction isYesterday(datetime: string | number) {\n  const yesterday = new Date();\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  return getDayStartAt(yesterday) === getDayStartAt(new Date(datetime));\n}\n","import type { NftItem } from 'tonapi-sdk-js';\n\nimport type { ApiTonWalletVersion } from '../chains/ton/types';\nimport type { ApiTransactionActivity } from './activity';\nimport type { ApiParsedPayload } from './payload';\nimport type { ApiSseOptions } from './storage';\n\nexport type ApiChain = 'ton' | 'tron';\nexport type ApiNetwork = 'mainnet' | 'testnet';\nexport type ApiLedgerDriver = 'HID' | 'USB';\nexport type ApiTokenType = 'lp_token';\nexport type ApiDappConnectionType = 'connect' | 'sendTransaction' | 'signData';\n\nexport interface AccountIdParsed {\n  id: number;\n  network: ApiNetwork;\n}\n\nexport interface ApiInitArgs {\n  isElectron?: boolean;\n  isNativeBottomSheet?: boolean;\n  isIosApp?: boolean;\n  isAndroidApp?: boolean;\n  referrer?: string;\n  accountIds?: string[];\n}\n\nexport interface ApiToken {\n  name: string;\n  symbol: string;\n  slug: string;\n  decimals: number;\n  chain: ApiChain;\n  type?: ApiTokenType;\n  tokenAddress?: string;\n  image?: string;\n  isPopular?: boolean;\n  keywords?: string[];\n  cmcSlug?: string;\n  color?: string;\n  isGaslessEnabled?: boolean;\n  isStarsEnabled?: boolean;\n  isTiny?: boolean;\n  customPayloadApiUrl?: string;\n  codeHash?: string;\n  /* Means the token is fetched from the backend by default and already includes price\n  and other details (`ApiTokenDetails`), so no separate requests are needed. */\n  isFromBackend?: boolean;\n}\n\nexport type ApiTokenWithPrice = ApiToken & {\n  price: number;\n  priceUsd: number;\n  percentChange24h: number;\n};\n\nexport type ApiKnownAddresses = Record<string, ApiAddressInfo>;\n\nexport interface ApiAddressInfo {\n  name?: string;\n  isScam?: boolean;\n  isMemoRequired?: boolean;\n}\n\nexport interface ApiNftSuperCollection {\n  id: string;\n  name: string;\n  icon?: 'gift';\n}\n\nexport type ApiActivityTimestamps = Record<string, number | undefined>;\nexport type ApiTransactionType = 'stake' | 'unstake' | 'unstakeRequest'\n  | 'callContract' | 'excess' | 'contractDeploy' | 'bounced'\n  | 'mint' | 'burn' | 'auctionBid' | 'nftTrade'\n  | 'dnsChangeAddress' | 'dnsChangeSite' | 'dnsChangeSubdomains' | 'dnsChangeStorage' | 'dnsDelete' | 'dnsRenew'\n  | 'liquidityDeposit' | 'liquidityWithdraw'\n  | undefined;\n\nexport interface ApiTransaction {\n  txId: string;\n  timestamp: number;\n  /** The amount to show in the UI (may mismatch the actual attached TON amount) */\n  amount: bigint;\n  fromAddress: string;\n  toAddress: string;\n  comment?: string;\n  encryptedComment?: string;\n  /**\n   * The fee to show in the UI (not the same as the network fee). When not 0, should be shown even for incoming\n   * transactions. It means that there was a hidden outgoing transaction with the given fee.\n   */\n  fee: bigint;\n  slug: string;\n  isIncoming: boolean;\n  normalizedAddress: string; // Only for TON now\n  /** Trace external message hash normalized. Only for TON. */\n  externalMsgHashNorm?: string;\n  shouldHide?: boolean;\n  type?: ApiTransactionType;\n  metadata?: ApiTransactionMetadata;\n  nft?: ApiNft;\n  /** True if awaiting confirmation by the blockchain */\n  isPending?: true;\n}\n\nexport type ApiTransactionMetadata = ApiAddressInfo;\n\nexport type ApiMtwCardType = 'black' | 'platinum' | 'gold' | 'silver' | 'standard';\nexport type ApiMtwCardTextType = 'light' | 'dark';\nexport type ApiMtwCardBorderShineType = 'up' | 'down' | 'left' | 'right' | 'radioactive';\n\nexport interface ApiNftAttribute {\n  trait_type: string;\n  value: string;\n}\n\nexport interface ApiNftMetadata {\n  attributes?: ApiNftAttribute[];\n  lottie?: string;\n  imageUrl?: string;\n  fragmentUrl?: string;\n  mtwCardId?: number;\n  mtwCardType?: ApiMtwCardType;\n  mtwCardTextType?: ApiMtwCardTextType;\n  mtwCardBorderShineType?: ApiMtwCardBorderShineType;\n}\n\nexport interface ApiNft {\n  index: number;\n  ownerAddress?: string;\n  name?: string;\n  address: string;\n  thumbnail: string;\n  image: string;\n  description?: string;\n  collectionName?: string;\n  collectionAddress?: string;\n  isOnSale: boolean;\n  isHidden?: boolean;\n  isOnFragment?: boolean;\n  isTelegramGift?: boolean;\n  isScam?: boolean;\n  metadata: ApiNftMetadata;\n}\n\nexport interface ApiDomainData {\n  domain: string;\n  linkedAddress?: string;\n  lastFillUpTime: string;\n  nft: NftItem;\n}\n\nexport type ApiHistoryList = Array<[number, number]>;\n\nexport type ApiStakingType = ApiStakingState['type'];\nexport type ApiBackendStakingType = 'nominators' | 'liquid';\n\ntype BaseStakingState = {\n  id: string;\n  tokenSlug: string;\n  annualYield: number;\n  yieldType: ApiYieldType;\n  balance: bigint;\n  pool: string;\n  unstakeRequestAmount?: bigint;\n};\n\nexport type ApiNominatorsStakingState = BaseStakingState & {\n  type: 'nominators';\n  start: number;\n  end: number;\n  pendingDepositAmount: bigint;\n};\n\nexport type ApiLiquidStakingState = BaseStakingState & {\n  type: 'liquid';\n  tokenBalance: bigint;\n  instantAvailable: bigint;\n  start: number;\n  end: number;\n};\n\nexport type ApiJettonStakingState = BaseStakingState & {\n  type: 'jetton';\n  tokenAddress: string;\n  unclaimedRewards: bigint;\n  stakeWalletAddress: string;\n  tokenAmount: bigint;\n  period: number;\n  tvl: bigint;\n  dailyReward: bigint;\n  poolWallets?: string[];\n};\n\nexport type ApiEthenaStakingState = BaseStakingState & {\n  type: 'ethena';\n  tokenBalance: bigint;\n  tsUsdeWalletAddress: string;\n  lockedBalance: bigint;\n  unstakeRequestAmount: bigint;\n  unlockTime?: number;\n  annualYieldStandard?: number;\n  annualYieldVerified?: number;\n};\n\nexport type ApiYieldType = 'APY' | 'APR';\nexport type ApiStakingState = ApiNominatorsStakingState\n  | ApiLiquidStakingState\n  | ApiJettonStakingState\n  | ApiEthenaStakingState;\nexport type ApiToncoinStakingState = ApiNominatorsStakingState | ApiLiquidStakingState;\n\nexport interface ApiNominatorsPool {\n  address: string;\n  apy: number;\n  start: number;\n  end: number;\n}\n\nexport interface ApiBackendStakingState {\n  balance: bigint;\n  totalProfit: bigint;\n  type?: ApiBackendStakingType;\n  nominatorsPool: ApiNominatorsPool;\n  loyaltyType?: ApiLoyaltyType;\n  shouldUseNominators?: boolean;\n  stakedAt?: number;\n  ethena: {\n    /**\n     * - undefined — never passed the verification;\n     * - true — passed the verification and eligible for the boosted APY;\n     * - false — passed the verification and not eligible for the boosted APY;\n     */\n    isVerified?: boolean;\n  };\n  liquid?: {\n    unstakeRequestAmount?: string;\n  };\n}\n\nexport type ApiStakingHistory = {\n  timestamp: number;\n  profit: string;\n}[];\n\nexport interface ApiDappPermissions {\n  isAddressRequired?: boolean;\n  isPasswordRequired?: boolean;\n}\n\nexport type ApiDappRequest = {\n  url: string | undefined; // `undefined` is a special case for SSE connect request\n  isUrlEnsured?: boolean;\n  accountId?: string;\n  identifier?: string;\n  sseOptions?: ApiSseOptions;\n};\n\nexport interface ApiTransferToSign {\n  toAddress: string;\n  amount: bigint;\n  rawPayload?: string;\n  payload?: ApiParsedPayload;\n  stateInit?: string;\n}\n\nexport interface ApiDappTransfer extends ApiTransferToSign {\n  isScam?: boolean;\n  /** Whether the transfer should be treated with cautiousness, because its payload is unclear */\n  isDangerous: boolean;\n  normalizedAddress: string;\n  /** The transfer address to show in the UI */\n  displayedToAddress: string;\n  networkFee: bigint;\n}\n\nexport interface ApiSignedTransfer {\n  base64: string;\n  seqno: number;\n  /** Will be used to create a local activity in the global state after the transfer is sent */\n  localActivity: Omit<ApiLocalTransactionParams, 'externalMsgHashNorm' | 'txId'>;\n}\n\n/**\n * The `fee` field should contain the final (real) fee, because we want to show the real fee in local transactions\n */\nexport type ApiLocalTransactionParams = Omit<\n  ApiTransactionActivity, 'id' | 'timestamp' | 'isIncoming' | 'normalizedAddress' | 'kind' | 'shouldLoadDetails'\n> & {\n  normalizedAddress?: string;\n  isIncoming?: boolean;\n};\n\nexport type ApiBaseCurrency = 'USD' | 'EUR' | 'RUB' | 'CNY' | 'BTC' | 'TON';\n\nexport enum ApiLiquidUnstakeMode {\n  Default,\n  Instant,\n  BestRate,\n}\n\nexport type ApiLoyaltyType = 'black' | 'platinum' | 'gold' | 'silver' | 'standard';\n\nexport type ApiBalanceBySlug = Record<string, bigint>;\n\nexport type ApiWalletInfo = {\n  /** The user-friendly address of this wallet (may differ from the requested address) */\n  address: string;\n  /** Undefined when the address is not initialized or not a wallet */\n  version?: ApiTonWalletVersion;\n  balance: bigint;\n  isInitialized: boolean;\n  seqno: number;\n  lastTxId?: string;\n  domain?: string;\n};\n\nexport type ApiWalletWithVersionInfo = ApiWalletInfo & Required<Pick<ApiWalletInfo, 'version'>>;\n\n// Country codes from ISO-3166-1 spec\nexport type ApiCountryCode = 'AF' | 'AX' | 'AL' | 'DZ' | 'AS' | 'AD' | 'AO' | 'AI' | 'AQ' | 'AG' | 'AR'\n  | 'AM' | 'AW' | 'AU' | 'AT' | 'AZ' | 'BS' | 'BH' | 'BD' | 'BB' | 'BY' | 'BE' | 'BZ' | 'BJ' | 'BM'\n  | 'BT' | 'BO' | 'BQ' | 'BA' | 'BW' | 'BV' | 'BR' | 'IO' | 'BN' | 'BG' | 'BF' | 'BI' | 'CV' | 'KH'\n  | 'CM' | 'CA' | 'KY' | 'CF' | 'TD' | 'CL' | 'CN' | 'CX' | 'CC' | 'CO' | 'KM' | 'CG' | 'CD' | 'CK'\n  | 'CR' | 'CI' | 'HR' | 'CU' | 'CW' | 'CY' | 'CZ' | 'DK' | 'DJ' | 'DM' | 'DO' | 'EC' | 'EG' | 'SV'\n  | 'GQ' | 'ER' | 'EE' | 'SZ' | 'ET' | 'FK' | 'FO' | 'FJ' | 'FI' | 'FR' | 'GF' | 'PF' | 'TF' | 'GA'\n  | 'GM' | 'GE' | 'DE' | 'GH' | 'GI' | 'GR' | 'GL' | 'GD' | 'GP' | 'GU' | 'GT' | 'GG' | 'GN' | 'GW'\n  | 'GY' | 'HT' | 'HM' | 'VA' | 'HN' | 'HK' | 'HU' | 'IS' | 'IN' | 'ID' | 'IR' | 'IQ' | 'IE' | 'IM'\n  | 'IL' | 'IT' | 'JM' | 'JP' | 'JE' | 'JO' | 'KZ' | 'KE' | 'KI' | 'KP' | 'KR' | 'KW' | 'KG' | 'LA'\n  | 'LV' | 'LB' | 'LS' | 'LR' | 'LY' | 'LI' | 'LT' | 'LU' | 'MO' | 'MG' | 'MW' | 'MY' | 'MV' | 'ML'\n  | 'MT' | 'MH' | 'MQ' | 'MR' | 'MU' | 'YT' | 'MX' | 'FM' | 'MD' | 'MC' | 'MN' | 'ME' | 'MS' | 'MA'\n  | 'MZ' | 'MM' | 'NA' | 'NR' | 'NP' | 'NL' | 'NC' | 'NZ' | 'NI' | 'NE' | 'NG' | 'NU' | 'NF' | 'MP'\n  | 'NO' | 'OM' | 'PK' | 'PW' | 'PS' | 'PA' | 'PG' | 'PY' | 'PE' | 'PH' | 'PN' | 'PL' | 'PT' | 'PR'\n  | 'QA' | 'MK' | 'RO' | 'RU' | 'RW' | 'RE' | 'BL' | 'SH' | 'KN' | 'LC' | 'MF' | 'PM' | 'VC' | 'WS'\n  | 'SM' | 'ST' | 'SA' | 'SN' | 'RS' | 'SC' | 'SL' | 'SG' | 'SX' | 'SK' | 'SI' | 'SB' | 'SO' | 'ZA'\n  | 'GS' | 'SS' | 'ES' | 'LK' | 'SD' | 'SR' | 'SJ' | 'SE' | 'CH' | 'SY' | 'TW' | 'TJ' | 'TZ' | 'TH'\n  | 'TL' | 'TG' | 'TK' | 'TO' | 'TT' | 'TN' | 'TR' | 'TM' | 'TC' | 'TV' | 'UG' | 'UA' | 'AE' | 'GB'\n  | 'US' | 'UM' | 'UY' | 'UZ' | 'VU' | 'VE' | 'VN' | 'VG' | 'VI' | 'WF' | 'EH' | 'YE' | 'ZM' | 'ZW';\n\n/** Each string value can be either an address or a domain name */\nexport type ApiImportAddressByChain = Partial<Record<ApiChain, string>>;\n\nexport type ApiNftMarketplace = 'fragment' | 'getgems';\n","/*\n *  big.js v6.2.1\n *  A small, fast, easy-to-use library for arbitrary-precision decimal arithmetic.\n *  Copyright (c) 2022 Michael Mclaughlin\n *  https://github.com/MikeMcl/big.js/LICENCE.md\n */\n\n\n/************************************** EDITABLE DEFAULTS *****************************************/\n\n\n  // The default values below must be integers within the stated ranges.\n\n  /*\n   * The maximum number of decimal places (DP) of the results of operations involving division:\n   * div and sqrt, and pow with negative exponents.\n   */\nvar DP = 20,          // 0 to MAX_DP\n\n  /*\n   * The rounding mode (RM) used when rounding to the above decimal places.\n   *\n   *  0  Towards zero (i.e. truncate, no rounding).       (ROUND_DOWN)\n   *  1  To nearest neighbour. If equidistant, round up.  (ROUND_HALF_UP)\n   *  2  To nearest neighbour. If equidistant, to even.   (ROUND_HALF_EVEN)\n   *  3  Away from zero.                                  (ROUND_UP)\n   */\n  RM = 1,             // 0, 1, 2 or 3\n\n  // The maximum value of DP and Big.DP.\n  MAX_DP = 1E6,       // 0 to 1000000\n\n  // The maximum magnitude of the exponent argument to the pow method.\n  MAX_POWER = 1E6,    // 1 to 1000000\n\n  /*\n   * The negative exponent (NE) at and beneath which toString returns exponential notation.\n   * (JavaScript numbers: -7)\n   * -1000000 is the minimum recommended exponent value of a Big.\n   */\n  NE = -7,            // 0 to -1000000\n\n  /*\n   * The positive exponent (PE) at and above which toString returns exponential notation.\n   * (JavaScript numbers: 21)\n   * 1000000 is the maximum recommended exponent value of a Big, but this limit is not enforced.\n   */\n  PE = 21,            // 0 to 1000000\n\n  /*\n   * When true, an error will be thrown if a primitive number is passed to the Big constructor,\n   * or if valueOf is called, or if toNumber is called on a Big which cannot be converted to a\n   * primitive number without a loss of precision.\n   */\n  STRICT = false,     // true or false\n\n\n/**************************************************************************************************/\n\n\n  // Error messages.\n  NAME = '[big.js] ',\n  INVALID = NAME + 'Invalid ',\n  INVALID_DP = INVALID + 'decimal places',\n  INVALID_RM = INVALID + 'rounding mode',\n  DIV_BY_ZERO = NAME + 'Division by zero',\n\n  // The shared prototype object.\n  P = {},\n  UNDEFINED = void 0,\n  NUMERIC = /^-?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i;\n\n\n/*\n * Create and return a Big constructor.\n */\nfunction _Big_() {\n\n  /*\n   * The Big constructor and exported function.\n   * Create and return a new instance of a Big number object.\n   *\n   * n {number|string|Big} A numeric value.\n   */\n  function Big(n) {\n    var x = this;\n\n    // Enable constructor usage without new.\n    if (!(x instanceof Big)) return n === UNDEFINED ? _Big_() : new Big(n);\n\n    // Duplicate.\n    if (n instanceof Big) {\n      x.s = n.s;\n      x.e = n.e;\n      x.c = n.c.slice();\n    } else {\n      if (typeof n !== 'string') {\n        if (Big.strict === true && typeof n !== 'bigint') {\n          throw TypeError(INVALID + 'value');\n        }\n\n        // Minus zero?\n        n = n === 0 && 1 / n < 0 ? '-0' : String(n);\n      }\n\n      parse(x, n);\n    }\n\n    // Retain a reference to this Big constructor.\n    // Shadow Big.prototype.constructor which points to Object.\n    x.constructor = Big;\n  }\n\n  Big.prototype = P;\n  Big.DP = DP;\n  Big.RM = RM;\n  Big.NE = NE;\n  Big.PE = PE;\n  Big.strict = STRICT;\n  Big.roundDown = 0;\n  Big.roundHalfUp = 1;\n  Big.roundHalfEven = 2;\n  Big.roundUp = 3;\n\n  return Big;\n}\n\n\n/*\n * Parse the number or string value passed to a Big constructor.\n *\n * x {Big} A Big number instance.\n * n {number|string} A numeric value.\n */\nfunction parse(x, n) {\n  var e, i, nl;\n\n  if (!NUMERIC.test(n)) {\n    throw Error(INVALID + 'number');\n  }\n\n  // Determine sign.\n  x.s = n.charAt(0) == '-' ? (n = n.slice(1), -1) : 1;\n\n  // Decimal point?\n  if ((e = n.indexOf('.')) > -1) n = n.replace('.', '');\n\n  // Exponential form?\n  if ((i = n.search(/e/i)) > 0) {\n\n    // Determine exponent.\n    if (e < 0) e = i;\n    e += +n.slice(i + 1);\n    n = n.substring(0, i);\n  } else if (e < 0) {\n\n    // Integer.\n    e = n.length;\n  }\n\n  nl = n.length;\n\n  // Determine leading zeros.\n  for (i = 0; i < nl && n.charAt(i) == '0';) ++i;\n\n  if (i == nl) {\n\n    // Zero.\n    x.c = [x.e = 0];\n  } else {\n\n    // Determine trailing zeros.\n    for (; nl > 0 && n.charAt(--nl) == '0';);\n    x.e = e - i - 1;\n    x.c = [];\n\n    // Convert string to array of digits without leading/trailing zeros.\n    for (e = 0; i <= nl;) x.c[e++] = +n.charAt(i++);\n  }\n\n  return x;\n}\n\n\n/*\n * Round Big x to a maximum of sd significant digits using rounding mode rm.\n *\n * x {Big} The Big to round.\n * sd {number} Significant digits: integer, 0 to MAX_DP inclusive.\n * rm {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n * [more] {boolean} Whether the result of division was truncated.\n */\nfunction round(x, sd, rm, more) {\n  var xc = x.c;\n\n  if (rm === UNDEFINED) rm = x.constructor.RM;\n  if (rm !== 0 && rm !== 1 && rm !== 2 && rm !== 3) {\n    throw Error(INVALID_RM);\n  }\n\n  if (sd < 1) {\n    more =\n      rm === 3 && (more || !!xc[0]) || sd === 0 && (\n      rm === 1 && xc[0] >= 5 ||\n      rm === 2 && (xc[0] > 5 || xc[0] === 5 && (more || xc[1] !== UNDEFINED))\n    );\n\n    xc.length = 1;\n\n    if (more) {\n\n      // 1, 0.1, 0.01, 0.001, 0.0001 etc.\n      x.e = x.e - sd + 1;\n      xc[0] = 1;\n    } else {\n\n      // Zero.\n      xc[0] = x.e = 0;\n    }\n  } else if (sd < xc.length) {\n\n    // xc[sd] is the digit after the digit that may be rounded up.\n    more =\n      rm === 1 && xc[sd] >= 5 ||\n      rm === 2 && (xc[sd] > 5 || xc[sd] === 5 &&\n        (more || xc[sd + 1] !== UNDEFINED || xc[sd - 1] & 1)) ||\n      rm === 3 && (more || !!xc[0]);\n\n    // Remove any digits after the required precision.\n    xc.length = sd;\n\n    // Round up?\n    if (more) {\n\n      // Rounding up may mean the previous digit has to be rounded up.\n      for (; ++xc[--sd] > 9;) {\n        xc[sd] = 0;\n        if (sd === 0) {\n          ++x.e;\n          xc.unshift(1);\n          break;\n        }\n      }\n    }\n\n    // Remove trailing zeros.\n    for (sd = xc.length; !xc[--sd];) xc.pop();\n  }\n\n  return x;\n}\n\n\n/*\n * Return a string representing the value of Big x in normal or exponential notation.\n * Handles P.toExponential, P.toFixed, P.toJSON, P.toPrecision, P.toString and P.valueOf.\n */\nfunction stringify(x, doExponential, isNonzero) {\n  var e = x.e,\n    s = x.c.join(''),\n    n = s.length;\n\n  // Exponential notation?\n  if (doExponential) {\n    s = s.charAt(0) + (n > 1 ? '.' + s.slice(1) : '') + (e < 0 ? 'e' : 'e+') + e;\n\n  // Normal notation.\n  } else if (e < 0) {\n    for (; ++e;) s = '0' + s;\n    s = '0.' + s;\n  } else if (e > 0) {\n    if (++e > n) {\n      for (e -= n; e--;) s += '0';\n    } else if (e < n) {\n      s = s.slice(0, e) + '.' + s.slice(e);\n    }\n  } else if (n > 1) {\n    s = s.charAt(0) + '.' + s.slice(1);\n  }\n\n  return x.s < 0 && isNonzero ? '-' + s : s;\n}\n\n\n// Prototype/instance methods\n\n\n/*\n * Return a new Big whose value is the absolute value of this Big.\n */\nP.abs = function () {\n  var x = new this.constructor(this);\n  x.s = 1;\n  return x;\n};\n\n\n/*\n * Return 1 if the value of this Big is greater than the value of Big y,\n *       -1 if the value of this Big is less than the value of Big y, or\n *        0 if they have the same value.\n */\nP.cmp = function (y) {\n  var isneg,\n    x = this,\n    xc = x.c,\n    yc = (y = new x.constructor(y)).c,\n    i = x.s,\n    j = y.s,\n    k = x.e,\n    l = y.e;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) return !xc[0] ? !yc[0] ? 0 : -j : i;\n\n  // Signs differ?\n  if (i != j) return i;\n\n  isneg = i < 0;\n\n  // Compare exponents.\n  if (k != l) return k > l ^ isneg ? 1 : -1;\n\n  j = (k = xc.length) < (l = yc.length) ? k : l;\n\n  // Compare digit by digit.\n  for (i = -1; ++i < j;) {\n    if (xc[i] != yc[i]) return xc[i] > yc[i] ^ isneg ? 1 : -1;\n  }\n\n  // Compare lengths.\n  return k == l ? 0 : k > l ^ isneg ? 1 : -1;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big divided by the value of Big y, rounded,\n * if necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM.\n */\nP.div = function (y) {\n  var x = this,\n    Big = x.constructor,\n    a = x.c,                  // dividend\n    b = (y = new Big(y)).c,   // divisor\n    k = x.s == y.s ? 1 : -1,\n    dp = Big.DP;\n\n  if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n    throw Error(INVALID_DP);\n  }\n\n  // Divisor is zero?\n  if (!b[0]) {\n    throw Error(DIV_BY_ZERO);\n  }\n\n  // Dividend is 0? Return +-0.\n  if (!a[0]) {\n    y.s = k;\n    y.c = [y.e = 0];\n    return y;\n  }\n\n  var bl, bt, n, cmp, ri,\n    bz = b.slice(),\n    ai = bl = b.length,\n    al = a.length,\n    r = a.slice(0, bl),   // remainder\n    rl = r.length,\n    q = y,                // quotient\n    qc = q.c = [],\n    qi = 0,\n    p = dp + (q.e = x.e - y.e) + 1;    // precision of the result\n\n  q.s = k;\n  k = p < 0 ? 0 : p;\n\n  // Create version of divisor with leading zero.\n  bz.unshift(0);\n\n  // Add zeros to make remainder as long as divisor.\n  for (; rl++ < bl;) r.push(0);\n\n  do {\n\n    // n is how many times the divisor goes into current remainder.\n    for (n = 0; n < 10; n++) {\n\n      // Compare divisor and remainder.\n      if (bl != (rl = r.length)) {\n        cmp = bl > rl ? 1 : -1;\n      } else {\n        for (ri = -1, cmp = 0; ++ri < bl;) {\n          if (b[ri] != r[ri]) {\n            cmp = b[ri] > r[ri] ? 1 : -1;\n            break;\n          }\n        }\n      }\n\n      // If divisor < remainder, subtract divisor from remainder.\n      if (cmp < 0) {\n\n        // Remainder can't be more than 1 digit longer than divisor.\n        // Equalise lengths using divisor with extra leading zero?\n        for (bt = rl == bl ? b : bz; rl;) {\n          if (r[--rl] < bt[rl]) {\n            ri = rl;\n            for (; ri && !r[--ri];) r[ri] = 9;\n            --r[ri];\n            r[rl] += 10;\n          }\n          r[rl] -= bt[rl];\n        }\n\n        for (; !r[0];) r.shift();\n      } else {\n        break;\n      }\n    }\n\n    // Add the digit n to the result array.\n    qc[qi++] = cmp ? n : ++n;\n\n    // Update the remainder.\n    if (r[0] && cmp) r[rl] = a[ai] || 0;\n    else r = [a[ai]];\n\n  } while ((ai++ < al || r[0] !== UNDEFINED) && k--);\n\n  // Leading zero? Do not remove if result is simply zero (qi == 1).\n  if (!qc[0] && qi != 1) {\n\n    // There can't be more than one zero.\n    qc.shift();\n    q.e--;\n    p--;\n  }\n\n  // Round?\n  if (qi > p) round(q, p, Big.RM, r[0] !== UNDEFINED);\n\n  return q;\n};\n\n\n/*\n * Return true if the value of this Big is equal to the value of Big y, otherwise return false.\n */\nP.eq = function (y) {\n  return this.cmp(y) === 0;\n};\n\n\n/*\n * Return true if the value of this Big is greater than the value of Big y, otherwise return\n * false.\n */\nP.gt = function (y) {\n  return this.cmp(y) > 0;\n};\n\n\n/*\n * Return true if the value of this Big is greater than or equal to the value of Big y, otherwise\n * return false.\n */\nP.gte = function (y) {\n  return this.cmp(y) > -1;\n};\n\n\n/*\n * Return true if the value of this Big is less than the value of Big y, otherwise return false.\n */\nP.lt = function (y) {\n  return this.cmp(y) < 0;\n};\n\n\n/*\n * Return true if the value of this Big is less than or equal to the value of Big y, otherwise\n * return false.\n */\nP.lte = function (y) {\n  return this.cmp(y) < 1;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big minus the value of Big y.\n */\nP.minus = P.sub = function (y) {\n  var i, j, t, xlty,\n    x = this,\n    Big = x.constructor,\n    a = x.s,\n    b = (y = new Big(y)).s;\n\n  // Signs differ?\n  if (a != b) {\n    y.s = -b;\n    return x.plus(y);\n  }\n\n  var xc = x.c.slice(),\n    xe = x.e,\n    yc = y.c,\n    ye = y.e;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) {\n    if (yc[0]) {\n      y.s = -b;\n    } else if (xc[0]) {\n      y = new Big(x);\n    } else {\n      y.s = 1;\n    }\n    return y;\n  }\n\n  // Determine which is the bigger number. Prepend zeros to equalise exponents.\n  if (a = xe - ye) {\n\n    if (xlty = a < 0) {\n      a = -a;\n      t = xc;\n    } else {\n      ye = xe;\n      t = yc;\n    }\n\n    t.reverse();\n    for (b = a; b--;) t.push(0);\n    t.reverse();\n  } else {\n\n    // Exponents equal. Check digit by digit.\n    j = ((xlty = xc.length < yc.length) ? xc : yc).length;\n\n    for (a = b = 0; b < j; b++) {\n      if (xc[b] != yc[b]) {\n        xlty = xc[b] < yc[b];\n        break;\n      }\n    }\n  }\n\n  // x < y? Point xc to the array of the bigger number.\n  if (xlty) {\n    t = xc;\n    xc = yc;\n    yc = t;\n    y.s = -y.s;\n  }\n\n  /*\n   * Append zeros to xc if shorter. No need to add zeros to yc if shorter as subtraction only\n   * needs to start at yc.length.\n   */\n  if ((b = (j = yc.length) - (i = xc.length)) > 0) for (; b--;) xc[i++] = 0;\n\n  // Subtract yc from xc.\n  for (b = i; j > a;) {\n    if (xc[--j] < yc[j]) {\n      for (i = j; i && !xc[--i];) xc[i] = 9;\n      --xc[i];\n      xc[j] += 10;\n    }\n\n    xc[j] -= yc[j];\n  }\n\n  // Remove trailing zeros.\n  for (; xc[--b] === 0;) xc.pop();\n\n  // Remove leading zeros and adjust exponent accordingly.\n  for (; xc[0] === 0;) {\n    xc.shift();\n    --ye;\n  }\n\n  if (!xc[0]) {\n\n    // n - n = +0\n    y.s = 1;\n\n    // Result must be zero.\n    xc = [ye = 0];\n  }\n\n  y.c = xc;\n  y.e = ye;\n\n  return y;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big modulo the value of Big y.\n */\nP.mod = function (y) {\n  var ygtx,\n    x = this,\n    Big = x.constructor,\n    a = x.s,\n    b = (y = new Big(y)).s;\n\n  if (!y.c[0]) {\n    throw Error(DIV_BY_ZERO);\n  }\n\n  x.s = y.s = 1;\n  ygtx = y.cmp(x) == 1;\n  x.s = a;\n  y.s = b;\n\n  if (ygtx) return new Big(x);\n\n  a = Big.DP;\n  b = Big.RM;\n  Big.DP = Big.RM = 0;\n  x = x.div(y);\n  Big.DP = a;\n  Big.RM = b;\n\n  return this.minus(x.times(y));\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big negated.\n */\nP.neg = function () {\n  var x = new this.constructor(this);\n  x.s = -x.s;\n  return x;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big plus the value of Big y.\n */\nP.plus = P.add = function (y) {\n  var e, k, t,\n    x = this,\n    Big = x.constructor;\n\n  y = new Big(y);\n\n  // Signs differ?\n  if (x.s != y.s) {\n    y.s = -y.s;\n    return x.minus(y);\n  }\n\n  var xe = x.e,\n    xc = x.c,\n    ye = y.e,\n    yc = y.c;\n\n  // Either zero?\n  if (!xc[0] || !yc[0]) {\n    if (!yc[0]) {\n      if (xc[0]) {\n        y = new Big(x);\n      } else {\n        y.s = x.s;\n      }\n    }\n    return y;\n  }\n\n  xc = xc.slice();\n\n  // Prepend zeros to equalise exponents.\n  // Note: reverse faster than unshifts.\n  if (e = xe - ye) {\n    if (e > 0) {\n      ye = xe;\n      t = yc;\n    } else {\n      e = -e;\n      t = xc;\n    }\n\n    t.reverse();\n    for (; e--;) t.push(0);\n    t.reverse();\n  }\n\n  // Point xc to the longer array.\n  if (xc.length - yc.length < 0) {\n    t = yc;\n    yc = xc;\n    xc = t;\n  }\n\n  e = yc.length;\n\n  // Only start adding at yc.length - 1 as the further digits of xc can be left as they are.\n  for (k = 0; e; xc[e] %= 10) k = (xc[--e] = xc[e] + yc[e] + k) / 10 | 0;\n\n  // No need to check for zero, as +x + +y != 0 && -x + -y != 0\n\n  if (k) {\n    xc.unshift(k);\n    ++ye;\n  }\n\n  // Remove trailing zeros.\n  for (e = xc.length; xc[--e] === 0;) xc.pop();\n\n  y.c = xc;\n  y.e = ye;\n\n  return y;\n};\n\n\n/*\n * Return a Big whose value is the value of this Big raised to the power n.\n * If n is negative, round to a maximum of Big.DP decimal places using rounding\n * mode Big.RM.\n *\n * n {number} Integer, -MAX_POWER to MAX_POWER inclusive.\n */\nP.pow = function (n) {\n  var x = this,\n    one = new x.constructor('1'),\n    y = one,\n    isneg = n < 0;\n\n  if (n !== ~~n || n < -MAX_POWER || n > MAX_POWER) {\n    throw Error(INVALID + 'exponent');\n  }\n\n  if (isneg) n = -n;\n\n  for (;;) {\n    if (n & 1) y = y.times(x);\n    n >>= 1;\n    if (!n) break;\n    x = x.times(x);\n  }\n\n  return isneg ? one.div(y) : y;\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big rounded to a maximum precision of sd\n * significant digits using rounding mode rm, or Big.RM if rm is not specified.\n *\n * sd {number} Significant digits: integer, 1 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.prec = function (sd, rm) {\n  if (sd !== ~~sd || sd < 1 || sd > MAX_DP) {\n    throw Error(INVALID + 'precision');\n  }\n  return round(new this.constructor(this), sd, rm);\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big rounded to a maximum of dp decimal places\n * using rounding mode rm, or Big.RM if rm is not specified.\n * If dp is negative, round to an integer which is a multiple of 10**-dp.\n * If dp is not specified, round to 0 decimal places.\n *\n * dp? {number} Integer, -MAX_DP to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.round = function (dp, rm) {\n  if (dp === UNDEFINED) dp = 0;\n  else if (dp !== ~~dp || dp < -MAX_DP || dp > MAX_DP) {\n    throw Error(INVALID_DP);\n  }\n  return round(new this.constructor(this), dp + this.e + 1, rm);\n};\n\n\n/*\n * Return a new Big whose value is the square root of the value of this Big, rounded, if\n * necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM.\n */\nP.sqrt = function () {\n  var r, c, t,\n    x = this,\n    Big = x.constructor,\n    s = x.s,\n    e = x.e,\n    half = new Big('0.5');\n\n  // Zero?\n  if (!x.c[0]) return new Big(x);\n\n  // Negative?\n  if (s < 0) {\n    throw Error(NAME + 'No square root');\n  }\n\n  // Estimate.\n  s = Math.sqrt(x + '');\n\n  // Math.sqrt underflow/overflow?\n  // Re-estimate: pass x coefficient to Math.sqrt as integer, then adjust the result exponent.\n  if (s === 0 || s === 1 / 0) {\n    c = x.c.join('');\n    if (!(c.length + e & 1)) c += '0';\n    s = Math.sqrt(c);\n    e = ((e + 1) / 2 | 0) - (e < 0 || e & 1);\n    r = new Big((s == 1 / 0 ? '5e' : (s = s.toExponential()).slice(0, s.indexOf('e') + 1)) + e);\n  } else {\n    r = new Big(s + '');\n  }\n\n  e = r.e + (Big.DP += 4);\n\n  // Newton-Raphson iteration.\n  do {\n    t = r;\n    r = half.times(t.plus(x.div(t)));\n  } while (t.c.slice(0, e).join('') !== r.c.slice(0, e).join(''));\n\n  return round(r, (Big.DP -= 4) + r.e + 1, Big.RM);\n};\n\n\n/*\n * Return a new Big whose value is the value of this Big times the value of Big y.\n */\nP.times = P.mul = function (y) {\n  var c,\n    x = this,\n    Big = x.constructor,\n    xc = x.c,\n    yc = (y = new Big(y)).c,\n    a = xc.length,\n    b = yc.length,\n    i = x.e,\n    j = y.e;\n\n  // Determine sign of result.\n  y.s = x.s == y.s ? 1 : -1;\n\n  // Return signed 0 if either 0.\n  if (!xc[0] || !yc[0]) {\n    y.c = [y.e = 0];\n    return y;\n  }\n\n  // Initialise exponent of result as x.e + y.e.\n  y.e = i + j;\n\n  // If array xc has fewer digits than yc, swap xc and yc, and lengths.\n  if (a < b) {\n    c = xc;\n    xc = yc;\n    yc = c;\n    j = a;\n    a = b;\n    b = j;\n  }\n\n  // Initialise coefficient array of result with zeros.\n  for (c = new Array(j = a + b); j--;) c[j] = 0;\n\n  // Multiply.\n\n  // i is initially xc.length.\n  for (i = b; i--;) {\n    b = 0;\n\n    // a is yc.length.\n    for (j = a + i; j > i;) {\n\n      // Current sum of products at this digit position, plus carry.\n      b = c[j] + yc[i] * xc[j - i - 1] + b;\n      c[j--] = b % 10;\n\n      // carry\n      b = b / 10 | 0;\n    }\n\n    c[j] = b;\n  }\n\n  // Increment result exponent if there is a final carry, otherwise remove leading zero.\n  if (b) ++y.e;\n  else c.shift();\n\n  // Remove trailing zeros.\n  for (i = c.length; !c[--i];) c.pop();\n  y.c = c;\n\n  return y;\n};\n\n\n/*\n * Return a string representing the value of this Big in exponential notation rounded to dp fixed\n * decimal places using rounding mode rm, or Big.RM if rm is not specified.\n *\n * dp? {number} Decimal places: integer, 0 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.toExponential = function (dp, rm) {\n  var x = this,\n    n = x.c[0];\n\n  if (dp !== UNDEFINED) {\n    if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n      throw Error(INVALID_DP);\n    }\n    x = round(new x.constructor(x), ++dp, rm);\n    for (; x.c.length < dp;) x.c.push(0);\n  }\n\n  return stringify(x, true, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big in normal notation rounded to dp fixed\n * decimal places using rounding mode rm, or Big.RM if rm is not specified.\n *\n * dp? {number} Decimal places: integer, 0 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n *\n * (-0).toFixed(0) is '0', but (-0.1).toFixed(0) is '-0'.\n * (-0).toFixed(1) is '0.0', but (-0.01).toFixed(1) is '-0.0'.\n */\nP.toFixed = function (dp, rm) {\n  var x = this,\n    n = x.c[0];\n\n  if (dp !== UNDEFINED) {\n    if (dp !== ~~dp || dp < 0 || dp > MAX_DP) {\n      throw Error(INVALID_DP);\n    }\n    x = round(new x.constructor(x), dp + x.e + 1, rm);\n\n    // x.e may have changed if the value is rounded up.\n    for (dp = dp + x.e + 1; x.c.length < dp;) x.c.push(0);\n  }\n\n  return stringify(x, false, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big.\n * Return exponential notation if this Big has a positive exponent equal to or greater than\n * Big.PE, or a negative exponent equal to or less than Big.NE.\n * Omit the sign for negative zero.\n */\nP[Symbol.for('nodejs.util.inspect.custom')] = P.toJSON = P.toString = function () {\n  var x = this,\n    Big = x.constructor;\n  return stringify(x, x.e <= Big.NE || x.e >= Big.PE, !!x.c[0]);\n};\n\n\n/*\n * Return the value of this Big as a primitve number.\n */\nP.toNumber = function () {\n  var n = Number(stringify(this, true, true));\n  if (this.constructor.strict === true && !this.eq(n.toString())) {\n    throw Error(NAME + 'Imprecise conversion');\n  }\n  return n;\n};\n\n\n/*\n * Return a string representing the value of this Big rounded to sd significant digits using\n * rounding mode rm, or Big.RM if rm is not specified.\n * Use exponential notation if sd is less than the number of digits necessary to represent\n * the integer part of the value in normal notation.\n *\n * sd {number} Significant digits: integer, 1 to MAX_DP inclusive.\n * rm? {number} Rounding mode: 0 (down), 1 (half-up), 2 (half-even) or 3 (up).\n */\nP.toPrecision = function (sd, rm) {\n  var x = this,\n    Big = x.constructor,\n    n = x.c[0];\n\n  if (sd !== UNDEFINED) {\n    if (sd !== ~~sd || sd < 1 || sd > MAX_DP) {\n      throw Error(INVALID + 'precision');\n    }\n    x = round(new Big(x), sd, rm);\n    for (; x.c.length < sd;) x.c.push(0);\n  }\n\n  return stringify(x, sd <= x.e || x.e <= Big.NE || x.e >= Big.PE, !!n);\n};\n\n\n/*\n * Return a string representing the value of this Big.\n * Return exponential notation if this Big has a positive exponent equal to or greater than\n * Big.PE, or a negative exponent equal to or less than Big.NE.\n * Include the sign for negative zero.\n */\nP.valueOf = function () {\n  var x = this,\n    Big = x.constructor;\n  if (Big.strict === true) {\n    throw Error(NAME + 'valueOf disallowed');\n  }\n  return stringify(x, x.e <= Big.NE || x.e >= Big.PE, true);\n};\n\n\n// Export\n\n\nexport var Big = _Big_();\n\n/// <reference types=\"https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/big.js/index.d.ts\" />\nexport default Big;\n","import { TONCOIN } from '../config';\nimport { Big } from '../lib/big.js';\n\nBig.RM = 0; // RoundDown\nBig.NE = -100000; // Disable exponential form\nBig.PE = 100000; // Disable exponential form\n\nconst ten = Big(10);\n\nexport function fromDecimal(value: string | number, decimals?: number) {\n  return BigInt(Big(value).mul(ten.pow(decimals ?? TONCOIN.decimals)).round().toString());\n}\n\nexport function toDecimal(value: bigint | number, decimals?: number, noFloor = false) {\n  return toBig(value, decimals ?? TONCOIN.decimals, noFloor).toString();\n}\n\nexport function toBig(value: bigint | number, decimals: number = TONCOIN.decimals, noFloor = false) {\n  return Big(value.toString()).div(ten.pow(decimals)).round(decimals, noFloor ? Big.roundHalfUp : undefined);\n}\n\nexport function roundDecimal(value: string, decimals: number) {\n  return Big(value).round(decimals).toString();\n}\n","export function random(min: number, max: number) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n}\n\nexport function sample<T>(arr: T[]) {\n  return arr[random(0, arr.length - 1)];\n}\n\nexport function randomBytes(size: number) {\n  return self.crypto.getRandomValues(new Uint8Array(size));\n}\n\nexport function randomBase64(byteSize: number) {\n  return Buffer.from(randomBytes(byteSize)).toString('base64');\n}\n","import { ONE_TON } from '../config';\nimport { fromDecimal } from './decimals';\nimport { randomBytes } from './random';\n\nexport const BIGINT_PREFIX = 'bigint:';\n\nexport function bigintReviver(this: any, key: string, value: any) {\n  if (typeof value === 'string' && value.startsWith(BIGINT_PREFIX)) {\n    return BigInt(value.slice(7));\n  }\n  return value;\n}\n\nexport function bigintAbs(value: bigint) {\n  return value === -0n || value < 0n ? -value : value;\n}\n\nexport function bigintSum(values: bigint[]) {\n  let result = 0n;\n  for (const value of values) result += value;\n  return result;\n}\n\nexport function bigintDivideToNumber(value: bigint, num: number) {\n  return (value * ONE_TON) / fromDecimal(num);\n}\n\nexport function bigintMultiplyToNumber(value: bigint, num: number) {\n  return (value * fromDecimal(num)) / ONE_TON;\n}\n\nexport function bigintRandom(bytes: number) {\n  let value = BigInt(0);\n  for (const randomNumber of randomBytes(bytes)) {\n    const randomBigInt = BigInt(randomNumber);\n    value = (value << BigInt(8)) + randomBigInt;\n  }\n  return value;\n}\n\nexport function bigintCountBits(value: bigint) {\n  const binaryString = value.toString(2);\n  return binaryString.length;\n}\n\nexport function bigintMax(value0: bigint, value1: bigint) {\n  return value0 > value1 ? value0 : value1;\n}\n\nexport function bigintMin(value0: bigint, value1: bigint) {\n  return value0 < value1 ? value0 : value1;\n}\n\nexport function bigintMultiplePercent(value: bigint, percent: number) {\n  return (value * fromDecimal(percent / 100)) / ONE_TON;\n}\n","import type { OriginMessageData, WorkerMessageData } from './PostMessageConnector';\n\nimport { BIGINT_PREFIX } from './bigint';\n\nexport const UNDEFINED_PREFIX = 'undefined:';\n\nfunction extensionMessageReplacer(this: any, key: string, value: any) {\n  if (value === undefined) {\n    return `${UNDEFINED_PREFIX}marker`;\n  }\n\n  // Bigint is replaced by patching `toJSON` method\n\n  return value;\n}\n\nfunction extensionMessageReviver(this: any, key: string, value: any) {\n  // Handle bigint values\n  if (typeof value === 'string' && value.startsWith(BIGINT_PREFIX)) {\n    return BigInt(value.slice(BIGINT_PREFIX.length));\n  }\n\n  // Handle undefined values\n  if (typeof value === 'string' && value.startsWith(UNDEFINED_PREFIX)) {\n    return undefined;\n  }\n\n  return value;\n}\n\nexport function encodeExtensionMessage(data: OriginMessageData | WorkerMessageData) {\n  return JSON.stringify(data, extensionMessageReplacer);\n}\n\nexport function decodeExtensionMessage<T extends OriginMessageData | WorkerMessageData>(data: string | T): T {\n  if (typeof data === 'string') {\n    return JSON.parse(data, extensionMessageReviver);\n  }\n  return data;\n}\n","import type InAppBrowserPostMessageAdapter from './embeddedDappBridge/provider/InAppBrowserPostMessageAdapter';\nimport type {\n  ApiUpdate,\n  CancellableCallback,\n  OriginMessageData,\n  OriginMessageEvent,\n  WorkerMessageData,\n} from './PostMessageConnector';\n\nimport { decodeExtensionMessage, encodeExtensionMessage } from './extensionMessageSerializer';\nimport { logDebugError } from './logs';\n\ndeclare const self: WorkerGlobalScope;\n\nconst callbackState = new Map<string, CancellableCallback>();\n\ntype ApiConfig =\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\n  ((name: string, ...args: any[]) => any | [any, ArrayBuffer[]])\n  | Record<string, AnyFunction>;\ntype SendToOrigin = (data: WorkerMessageData, transferables?: Transferable[]) => void;\n\n/**\n * Provides functions, defined in this messenger (a window, a worker), to another messenger.\n * The other messenger can call the functions using `createConnector`.\n */\nexport function createPostMessageInterface(\n  api: ApiConfig,\n  channel?: string,\n  target: DedicatedWorkerGlobalScope | Worker | InAppBrowserPostMessageAdapter = self as DedicatedWorkerGlobalScope,\n  shouldIgnoreErrors?: boolean,\n) {\n  function sendToOrigin(data: WorkerMessageData, transferables?: Transferable[]) {\n    data.channel = channel;\n\n    if (transferables) {\n      target.postMessage(data, transferables);\n    } else {\n      target.postMessage(data);\n    }\n  }\n\n  if (!shouldIgnoreErrors) {\n    handleErrors(sendToOrigin);\n  }\n\n  function handleMessage(e: OriginMessageEvent) {\n    if (e.data?.channel === channel) {\n      void onMessage(api, e.data, sendToOrigin);\n    }\n  }\n\n  // Correct for any target, but TypeScript weirdly complains\n  (target as DedicatedWorkerGlobalScope).addEventListener('message', handleMessage);\n\n  return () => {\n    (target as DedicatedWorkerGlobalScope).removeEventListener('message', handleMessage);\n  };\n}\n\n/**\n * Provides functions, defined in the main window, to an IFrame.\n */\nexport function createReverseIFrameInterface(\n  api: ApiConfig,\n  targetOrigin: string,\n  target: Window,\n  channel?: string,\n) {\n  function sendToOrigin(data: WorkerMessageData, transferables?: Transferable[]) {\n    data.channel = channel;\n\n    if (transferables) {\n      throw new Error('Cannot send `Transferable` to `Window`');\n    } else {\n      target.postMessage(data, targetOrigin);\n    }\n  }\n\n  function handleMessage(e: OriginMessageEvent) {\n    if (targetOrigin && e.origin !== targetOrigin) return;\n\n    if (e.data?.channel === channel) {\n      void onMessage(api, e.data, sendToOrigin);\n    }\n  }\n\n  window.addEventListener('message', handleMessage);\n\n  return () => {\n    window.removeEventListener('message', handleMessage);\n  };\n}\n\n/**\n * Provides functions, defined in this extension service worker, to a window.\n * The window can call the functions using `createExtensionConnector`.\n */\nexport function createExtensionInterface(\n  portName: string,\n  api: ApiConfig,\n  channel?: string,\n  cleanUpdater?: (onUpdate: (update: ApiUpdate) => void) => void,\n  withAutoInit = false,\n) {\n  chrome.runtime.onConnect.addListener((port) => {\n    if (port.name !== portName) {\n      return;\n    }\n\n    const url = port.sender?.url;\n    const origin = url ? new URL(url).origin : undefined;\n\n    const dAppUpdater = (update: ApiUpdate) => {\n      sendToOrigin({\n        type: 'update',\n        update,\n      });\n    };\n\n    function sendToOrigin(data: WorkerMessageData) {\n      data.channel = channel;\n      port.postMessage(encodeExtensionMessage(data));\n    }\n\n    handleErrors(sendToOrigin);\n\n    port.onMessage.addListener((data: OriginMessageData | string) => {\n      data = decodeExtensionMessage(data);\n      if (data.channel === channel) {\n        void onMessage(api, data, sendToOrigin, dAppUpdater, origin);\n      }\n    });\n\n    port.onDisconnect.addListener(() => {\n      cleanUpdater?.(dAppUpdater);\n    });\n\n    if (withAutoInit) {\n      void onMessage(api, { type: 'init', args: [] }, sendToOrigin, dAppUpdater);\n    }\n  });\n}\n\n/**\n * Provides functions, defined in this window, to the extension service worker.\n * The service worker can call the functions using `createReverseExtensionConnector`.\n */\nexport function createReverseExtensionInterface(\n  portName: string,\n  api: ApiConfig,\n) {\n  let port: chrome.runtime.Port;\n\n  function sendToServiceWorker(data: WorkerMessageData) {\n    port.postMessage(encodeExtensionMessage(data));\n  }\n\n  function connect() {\n    port = chrome.runtime.connect({ name: portName });\n\n    port.onMessage.addListener((data: OriginMessageData | string) => {\n      data = decodeExtensionMessage(data);\n      void onMessage(api, data, sendToServiceWorker);\n    });\n\n    // For some reason port can suddenly get disconnected\n    port.onDisconnect.addListener(() => {\n      connect();\n    });\n  }\n\n  connect();\n}\n\nasync function onMessage(\n  api: ApiConfig,\n  data: OriginMessageData,\n  sendToOrigin: SendToOrigin,\n  onUpdate?: (update: ApiUpdate) => void,\n  origin?: string,\n) {\n  if (!onUpdate) {\n    onUpdate = (update: ApiUpdate) => {\n      sendToOrigin({\n        type: 'update',\n        update,\n      });\n    };\n  }\n\n  switch (data.type) {\n    case 'init': {\n      const { args } = data;\n      const promise = typeof api === 'function'\n        ? api('init', origin, onUpdate, ...args)\n        : api.init?.(onUpdate, ...args);\n      await promise;\n\n      break;\n    }\n    case 'callMethod': {\n      const {\n        messageId, name, args, withCallback,\n      } = data;\n      try {\n        // This method is probably from another worker\n        if (typeof api !== 'function' && !api[name]) return;\n\n        if (messageId && withCallback) {\n          const callback = (...callbackArgs: any[]) => {\n            const lastArg = callbackArgs[callbackArgs.length - 1];\n\n            sendToOrigin({\n              type: 'methodCallback',\n              messageId,\n              callbackArgs,\n            }, isTransferable(lastArg) ? [lastArg] : undefined);\n          };\n\n          callbackState.set(messageId, callback);\n\n          args.push(callback as never);\n        }\n\n        const response = typeof api === 'function'\n          ? await api(name, origin, ...args)\n          : await api[name](...args);\n        const { arrayBuffer } = (typeof response === 'object' && response && 'arrayBuffer' in response) || {};\n\n        if (messageId) {\n          sendToOrigin(\n            {\n              type: 'methodResponse',\n              messageId,\n              response,\n            },\n            arrayBuffer ? [arrayBuffer] : undefined,\n          );\n        }\n      } catch (err: any) {\n        logDebugError(name, err);\n\n        if (messageId) {\n          sendToOrigin({\n            type: 'methodResponse',\n            messageId,\n            error: { message: err.message },\n          });\n        }\n      }\n\n      if (messageId) {\n        callbackState.delete(messageId);\n      }\n\n      break;\n    }\n    case 'cancelProgress': {\n      const callback = callbackState.get(data.messageId);\n      if (callback) {\n        callback.isCanceled = true;\n      }\n\n      break;\n    }\n  }\n}\n\nfunction isTransferable(obj: any) {\n  return obj instanceof ArrayBuffer || obj instanceof ImageBitmap;\n}\n\nfunction handleErrors(sendToOrigin: SendToOrigin) {\n  self.onerror = (e) => {\n    const message = e.error?.message || 'Uncaught exception in worker';\n    logDebugError(message, e.error);\n\n    sendToOrigin({\n      type: 'unhandledError',\n      error: {\n        message,\n        stack: e.error?.stack,\n      },\n    });\n  };\n\n  self.addEventListener('unhandledrejection', (e) => {\n    const message = e.reason?.message || 'Unhandled rejection in worker';\n    logDebugError(message, e.reason);\n\n    sendToOrigin({\n      type: 'unhandledError',\n      error: {\n        message,\n        stack: e.reason?.stack,\n      },\n    });\n  });\n}\n","import { BIGINT_PREFIX } from './bigint';\n\n// Fixes serialization of objects containing `bigint` values.\n// Extracted to a separate file to avoid leaking into Extension Page Script.\n// @ts-ignore\nBigInt.prototype.toJSON = function toJSON() {\n  return `${BIGINT_PREFIX}${this.toString()}`;\n};\n","import type { AccountIdParsed, ApiNetwork } from '../api/types';\nimport type { Account } from '../global/types';\n\nimport { shortenAddress } from './shortenAddress';\n\nexport function parseAccountId(accountId: string): AccountIdParsed {\n  const parts = accountId.split('-');\n  const [id, network = 'mainnet'] = (parts.length === 3 ? [parts[0], parts[2]] : parts) as [string, ApiNetwork];\n  return { id: Number(id), network };\n}\n\nexport function buildAccountId(account: AccountIdParsed) {\n  const { id, network } = account;\n  return `${id}-${network}`;\n}\n\nexport function getMainAccountAddress(addressByChain: Account['addressByChain']) {\n  return addressByChain.ton ?? Object.values(addressByChain).find(Boolean);\n}\n\nexport function getAccountTitle(account: Account) {\n  return account.title || shortenAddress(getMainAccountAddress(account.addressByChain) ?? '');\n}\n","import { PRIVATE_KEY_HEX_LENGTH } from '../config';\n\nexport default function isMnemonicPrivateKey(mnemonic: string[]) {\n  return mnemonic.length === 1 && mnemonic[0].length === PRIVATE_KEY_HEX_LENGTH;\n}\n","import withCache from './withCache';\n\nexport const MEANINGFUL_CHAR_LENGTH = 6;\nconst FILLER = '···';\nconst FILLER_LENGTH = FILLER.length;\n\nexport const shortenAddress = withCache((address: string, shift = MEANINGFUL_CHAR_LENGTH, fromRight = shift) => {\n  if (!address) return undefined;\n\n  if (address.length <= shift + fromRight + FILLER_LENGTH) return address;\n\n  return `${address.slice(0, shift)}${FILLER}${address.slice(-fromRight)}`;\n});\n","import createHmac from 'create-hmac';\nimport * as nacl from 'tweetnacl';\n\ntype Hex = string;\ntype Path = string;\n\ntype Keys = {\n  key: Buffer;\n  chainCode: Buffer;\n};\n\nconst ED25519_CURVE = 'ed25519 seed';\nconst HARDENED_OFFSET = 0x80000000;\n\nconst pathRegex = /^m(\\/[0-9]+')+$/;\nfunction replaceDerive(val: string) {\n  return val.replace('\\'', '');\n}\n\nexport const getMasterKeyFromSeed = (seed: Hex): Keys => {\n  const hmac = createHmac('sha512', ED25519_CURVE);\n  const I = hmac.update(Buffer.from(seed, 'hex')).digest();\n  const IL = I.slice(0, 32);\n  const IR = I.slice(32);\n  return {\n    key: IL,\n    chainCode: IR,\n  };\n};\n\nexport const CKDPriv = ({ key, chainCode }: Keys, index: number): Keys => {\n  const indexBuffer = Buffer.allocUnsafe(4);\n  indexBuffer.writeUInt32BE(index, 0);\n\n  const data = Buffer.concat([Buffer.alloc(1, 0), key, indexBuffer]);\n\n  const I = createHmac('sha512', chainCode)\n    .update(data)\n    .digest();\n  const IL = I.slice(0, 32);\n  const IR = I.slice(32);\n  return {\n    key: IL,\n    chainCode: IR,\n  };\n};\n\nexport const getPublicKey = (privateKey: Buffer, withZeroByte = true): Buffer => {\n  const keyPair = nacl.sign.keyPair.fromSeed(privateKey);\n  const signPk = keyPair.secretKey.subarray(32);\n  const zero = Buffer.alloc(1, 0);\n  return withZeroByte\n    ? Buffer.concat([zero, Buffer.from(signPk)])\n    : Buffer.from(signPk);\n};\n\nexport const isValidPath = (path: string): boolean => {\n  if (!pathRegex.test(path)) {\n    return false;\n  }\n  return !path\n    .split('/')\n    .slice(1)\n    .map(replaceDerive)\n\n    .some(isNaN as any);\n};\n\nexport const derivePath = (path: Path, seed: Hex, offset = HARDENED_OFFSET): Keys => {\n  if (!isValidPath(path)) {\n    throw new Error('Invalid derivation path');\n  }\n\n  const { key, chainCode } = getMasterKeyFromSeed(seed);\n  const segments = path\n    .split('/')\n    .slice(1)\n    .map(replaceDerive)\n    .map((el) => parseInt(el, 10));\n\n  return segments.reduce(\n    (parentKeys, segment) => CKDPriv(parentKeys, segment + offset),\n    { key, chainCode },\n  );\n};\n","type CollectionByKey<Member> = Record<number | string, Member>;\ntype GroupedByKey<Member> = Record<number | string, Member[]>;\n\ntype OrderDirection =\n  'asc'\n  | 'desc';\n\ntype OrderCallback<T> = (member: T) => unknown;\n\nexport function buildCollectionByKey<T extends AnyLiteral>(collection: readonly T[], key: keyof T): CollectionByKey<T> {\n  return collection.reduce((byKey: CollectionByKey<T>, member: T) => {\n    byKey[member[key]] = member;\n\n    return byKey;\n  }, {});\n}\n\nexport function groupBy<T extends AnyLiteral>(collection: readonly T[], key: keyof T): GroupedByKey<T> {\n  return collection.reduce((byKey: GroupedByKey<T>, member: T) => {\n    const groupKey = member[key];\n\n    if (!byKey[groupKey]) {\n      byKey[groupKey] = [member];\n    } else {\n      byKey[groupKey].push(member);\n    }\n\n    return byKey;\n  }, {});\n}\n\nexport function mapValues<R, M>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => R,\n): CollectionByKey<R> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<R>, key, index) => {\n    newByKey[key] = callback(byKey[key], key, index, byKey);\n    return newByKey;\n  }, {});\n}\n\nexport function pick<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    result[key] = object[key];\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function pickTruthy<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    if (object[key]) {\n      result[key] = object[key];\n    }\n\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function omit<T extends object, K extends keyof T>(object: T, keys: K[]): Omit<T, K> {\n  const stringKeys = new Set(keys.map(String));\n  const savedKeys = Object.keys(object)\n    .filter((key) => !stringKeys.has(key)) as Array<Exclude<keyof T, K>>;\n\n  return pick(object, savedKeys);\n}\n\nexport function omitUndefined<T extends object>(object: T): T {\n  return Object.keys(object).reduce((result, stringKey) => {\n    const key = stringKey as keyof T;\n    if (object[key] !== undefined) {\n      result[key] = object[key];\n    }\n    return result;\n  }, {} as T);\n}\n\nexport function orderBy<T>(\n  collection: T[],\n  orderRule: (keyof T) | OrderCallback<T> | ((keyof T) | OrderCallback<T>)[],\n  mode: OrderDirection | [OrderDirection, OrderDirection] = 'asc',\n): T[] {\n  function compareValues(a: T, b: T, currentOrderRule: (keyof T) | OrderCallback<T>, isAsc: boolean) {\n    const aValue = (typeof currentOrderRule === 'function' ? currentOrderRule(a) : a[currentOrderRule]) || 0;\n    const bValue = (typeof currentOrderRule === 'function' ? currentOrderRule(b) : b[currentOrderRule]) || 0;\n\n    if (aValue === bValue) return 0;\n\n    const condition = isAsc ? aValue > bValue : aValue < bValue;\n    return condition ? 1 : -1;\n  }\n\n  if (Array.isArray(orderRule)) {\n    const [mode1, mode2] = Array.isArray(mode) ? mode : [mode, mode];\n    const [orderRule1, orderRule2] = orderRule;\n    const isAsc1 = mode1 === 'asc';\n    const isAsc2 = mode2 === 'asc';\n\n    return collection.sort((a, b) => {\n      return compareValues(a, b, orderRule1, isAsc1) || compareValues(a, b, orderRule2, isAsc2);\n    });\n  }\n\n  const isAsc = mode === 'asc';\n  return collection.sort((a, b) => {\n    return compareValues(a, b, orderRule, isAsc);\n  });\n}\n\nexport function unique<T>(array: T[]): T[] {\n  return Array.from(new Set(array));\n}\n\nexport function compact<T>(array: T[]) {\n  return array.filter(Boolean);\n}\n\nexport function areSortedArraysEqual<T>(array1: readonly T[], array2: readonly T[]) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => item === array2[i]);\n}\n\nexport function split<T>(array: T[], chunkSize: number) {\n  const result: T[][] = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    result.push(array.slice(i, i + chunkSize));\n  }\n\n  return result;\n}\n\nexport function cloneDeep<T>(value: T): T {\n  if (!isObject(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(cloneDeep) as typeof value;\n  }\n\n  return Object.keys(value).reduce((acc, key) => {\n    acc[key as keyof T] = cloneDeep(value[key as keyof T]);\n    return acc;\n  }, {} as T);\n}\n\nexport function isLiteralObject(value: any): value is AnyLiteral {\n  return isObject(value) && !Array.isArray(value);\n}\n\nfunction isObject(value: any): value is object {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null;\n}\n\nexport function findLast<T>(array: Array<T>, predicate: (value: T, index: number, obj: T[]) => boolean): T | undefined {\n  let cursor = array.length;\n\n  while (cursor--) {\n    if (predicate(array[cursor], cursor, array)) {\n      return array[cursor];\n    }\n  }\n\n  return undefined;\n}\n\nexport function range(start: number, end: number) {\n  const arr: number[] = [];\n  for (let i = start; i < end;) {\n    arr.push(i++);\n  }\n  return arr;\n}\n\nexport function fromKeyValueArrays<T>(keys: string[], values: T[] | T) {\n  return keys.reduce((acc, key, index) => {\n    acc[key] = Array.isArray(values) ? values[index] : values;\n    return acc;\n  }, {} as Record<string, T>);\n}\n\nexport function extractKey<T, K extends keyof T>(array: readonly T[], key: K): T[K][] {\n  return array.map((value) => value[key]);\n}\n\nexport function findDifference<T>(array1: Iterable<T>, array2: Iterable<T>): T[] {\n  const set2 = new Set(array2);\n  const diff: T[] = [];\n\n  for (const element of array1) {\n    if (!set2.has(element)) {\n      diff.push(element);\n    }\n  }\n\n  return diff;\n}\n\nexport function filterValues<M>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => boolean,\n): CollectionByKey<M> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<M>, key, index) => {\n    if (callback(byKey[key], key, index, byKey)) {\n      newByKey[key] = byKey[key];\n    }\n\n    return newByKey;\n  }, {});\n}\n\nexport function uniqueByKey<T>(array: T[], key: keyof T, shouldKeepFirst?: boolean) {\n  if (shouldKeepFirst) {\n    array = Array.from(array);\n    array.reverse();\n  }\n\n  const result = [...new Map(array.map((item) => [item[key], item])).values()];\n\n  if (shouldKeepFirst) {\n    result.reverse();\n  }\n\n  return result;\n}\n\nexport function intersection<T>(x: Set<T>, y: Set<T>): Set<T> {\n  const result = new Set<T>();\n  for (const elem of y) {\n    if (x.has(elem)) {\n      result.add(elem);\n    }\n  }\n  return result;\n}\n\nexport function swapKeysAndValues<\n  K extends string | number,\n  V extends keyof any,\n>(object: Record<K, V>): Record<V, `${K}`> {\n  const result = {} as any;\n  for (const [key, value] of Object.entries(object)) {\n    result[value as any] = key;\n  }\n  return result;\n}\n","import type { ApiNft } from '../api/types';\n\nimport { TON_DNS_COLLECTION, TON_DNS_RENEWAL_WARNING_DAYS, TON_DNS_ZONES } from '../config';\nimport { getCountDaysToDate } from './dateFormat';\n\nexport function isDnsDomain(value: string) {\n  return getDnsDomainZone(value) !== undefined;\n}\n\nexport function getDnsDomainZone(domain: string) {\n  for (const zone of TON_DNS_ZONES) {\n    const { suffixes, baseFormat } = zone;\n\n    // Iterating the zones in reverse to prioritize longer zones when multiple zones match (assuming the zones go from\n    // the shortest to the longest). For example, `test.ton.vip` matches both `vip` and `ton.vip`, and `ton.vip` must be\n    // used.\n    for (let i = suffixes.length - 1; i >= 0; i--) {\n      const suffix = suffixes[i];\n      if (!domain.endsWith(`.${suffix}`)) {\n        continue;\n      }\n\n      const base = domain.slice(0, -suffix.length - 1);\n      if (!baseFormat.test(base)) {\n        continue;\n      }\n\n      return { base, zone };\n    }\n  }\n\n  return undefined;\n}\n\nexport function getDnsZoneByCollection(collectionAddress: string) {\n  return TON_DNS_ZONES.find((zone) => zone.resolver === collectionAddress);\n}\n\nexport function isTonDnsNft(nft: ApiNft | undefined): nft is ApiNft {\n  return nft?.collectionAddress === TON_DNS_COLLECTION;\n}\n\nexport function getTonDnsExpirationDate(nft: ApiNft | undefined, dnsExpiration: Record<string, number> | undefined) {\n  return isTonDnsNft(nft) ? dnsExpiration?.[nft.address] : undefined;\n}\n\nexport function filterExpiringDomains(\n  nftAddresses: string[],\n  nftByAddress?: Record<string, ApiNft>,\n  dnsExpiration?: Record<string, number>,\n) {\n  const expiringDomains: ApiNft[] = [];\n\n  if (nftByAddress && dnsExpiration) {\n    for (const address of nftAddresses) {\n      const nft = nftByAddress[address];\n      if (getCountDaysToDate(getTonDnsExpirationDate(nft, dnsExpiration) ?? Infinity) <= TON_DNS_RENEWAL_WARNING_DAYS) {\n        expiringDomains.push(nft);\n      }\n    }\n  }\n\n  return expiringDomains;\n}\n\nexport function getDomainsExpirationDate(\n  nfts: (string | ApiNft)[],\n  nftByAddress?: Record<string, ApiNft>,\n  dnsExpiration?: Record<string, number>,\n) {\n  if (!dnsExpiration) {\n    return undefined;\n  }\n\n  return nfts.reduce<number | undefined>(\n    (minDate, nftOrAddress) => {\n      const nft = typeof nftOrAddress === 'string' ? nftByAddress?.[nftOrAddress] : nftOrAddress;\n      const expirationDate = getTonDnsExpirationDate(nft, dnsExpiration);\n      return expirationDate\n        ? Math.min(expirationDate, minDate ?? Infinity)\n        : minDate;\n    },\n    undefined,\n  );\n}\n","import { STAKING_POOLS } from '../../config';\n\nexport function sha256(bytes: Uint8Array) {\n  return crypto.subtle.digest('SHA-256', bytes);\n}\n\nexport function bytesToHex(bytes: Uint8Array) {\n  return Buffer.from(bytes).toString('hex');\n}\n\nexport function hexToBytes(hex: string) {\n  return Uint8Array.from(Buffer.from(hex, 'hex'));\n}\n\nexport function bytesToBase64(bytes: Uint8Array) {\n  return Buffer.from(bytes).toString('base64');\n}\n\nexport function base64ToBytes(base64: string) {\n  return Uint8Array.from(Buffer.from(base64, 'base64'));\n}\n\nexport function base64ToString(base64: string) {\n  return Buffer.from(base64, 'base64').toString('utf-8');\n}\n\nexport function isKnownStakingPool(address: string) {\n  return STAKING_POOLS.some((poolPart) => address.endsWith(poolPart));\n}\n","/*\n * This module is to be used instead of /src/util/environment.ts\n * when `window` is not available (e.g. in a web worker).\n */\nimport type { ApiInitArgs } from './types';\n\nimport {\n  ELECTRON_TONCENTER_MAINNET_KEY,\n  ELECTRON_TONCENTER_TESTNET_KEY,\n  IS_CAPACITOR,\n  TONCENTER_MAINNET_KEY,\n  TONCENTER_TESTNET_KEY,\n} from '../config';\n\nconst ELECTRON_ORIGIN = 'file://';\n\nlet environment: ApiInitArgs & {\n  isDappSupported?: boolean;\n  isSseSupported?: boolean;\n  apiHeaders?: AnyLiteral;\n  toncenterMainnetKey?: string;\n  toncenterTestnetKey?: string;\n};\n\nexport function setEnvironment(args: ApiInitArgs) {\n  environment = {\n    ...args,\n    isDappSupported: true,\n    isSseSupported: args.isElectron || (IS_CAPACITOR && !args.isNativeBottomSheet),\n\n    apiHeaders: { 'X-App-Origin': args.isElectron ? ELECTRON_ORIGIN : self?.origin },\n    toncenterMainnetKey: args.isElectron ? ELECTRON_TONCENTER_MAINNET_KEY : TONCENTER_MAINNET_KEY,\n    toncenterTestnetKey: args.isElectron ? ELECTRON_TONCENTER_TESTNET_KEY : TONCENTER_TESTNET_KEY,\n  };\n  return environment;\n}\n\nexport function getEnvironment() {\n  return environment;\n}\n","import { bigintRandom, bigintReviver } from '../../../../util/bigint';\n\nexport function cloneDeep<T>(value: T): T {\n  return JSON.parse(JSON.stringify(value), bigintReviver);\n}\n\nexport function generateQueryId() {\n  return bigintRandom(8);\n}\n","import type { OpenedContract } from '@ton/core';\nimport {\n  Address, beginCell, Builder, Cell, Dictionary,\n} from '@ton/core';\nimport { WalletContractV1R1 } from '@ton/ton/dist/wallets/WalletContractV1R1';\nimport { WalletContractV1R2 } from '@ton/ton/dist/wallets/WalletContractV1R2';\nimport { WalletContractV1R3 } from '@ton/ton/dist/wallets/WalletContractV1R3';\nimport { WalletContractV2R1 } from '@ton/ton/dist/wallets/WalletContractV2R1';\nimport { WalletContractV2R2 } from '@ton/ton/dist/wallets/WalletContractV2R2';\nimport { WalletContractV3R1 } from '@ton/ton/dist/wallets/WalletContractV3R1';\nimport { WalletContractV3R2 } from '@ton/ton/dist/wallets/WalletContractV3R2';\nimport { WalletContractV4 } from '@ton/ton/dist/wallets/WalletContractV4';\nimport { WalletContractV5R1 } from '@ton/ton/dist/wallets/WalletContractV5R1';\n\nimport type { ApiNetwork } from '../../../types';\nimport type { ApiTonWalletVersion, TokenTransferBodyParams } from '../types';\n\nimport { DEFAULT_TIMEOUT, TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL } from '../../../../config';\nimport { getDnsZoneByCollection } from '../../../../util/dns';\nimport { fromKeyValueArrays, mapValues } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport withCacheAsync from '../../../../util/withCacheAsync';\nimport { DnsItem } from '../contracts/DnsItem';\nimport { JettonMinter } from '../contracts/JettonMaster';\nimport { JettonStakingOpCodes } from '../contracts/JettonStaking/imports/constants';\nimport { StakeWallet } from '../contracts/JettonStaking/StakeWallet';\nimport { StakingPool } from '../contracts/JettonStaking/StakingPool';\nimport { JettonWallet } from '../contracts/JettonWallet';\nimport { hexToBytes } from '../../../common/utils';\nimport { getEnvironment } from '../../../environment';\nimport { DEFAULT_IS_BOUNCEABLE, JettonOpCode, LiquidStakingOpCode, OpCode } from '../constants';\nimport { generateQueryId } from './index';\n\nimport { TonClient } from './TonClient';\n\ntype TonWalletType = typeof WalletContractV1R1\n  | typeof WalletContractV1R2\n  | typeof WalletContractV1R3\n  | typeof WalletContractV2R1\n  | typeof WalletContractV2R2\n  | typeof WalletContractV3R1\n  | typeof WalletContractV3R2\n  | typeof WalletContractV4\n  | typeof WalletContractV5R1;\n\nexport type TonWallet = WalletContractV1R1\n  | WalletContractV1R2\n  | WalletContractV1R3\n  | WalletContractV2R1\n  | WalletContractV2R2\n  | WalletContractV3R1\n  | WalletContractV3R2\n  | WalletContractV4\n  | WalletContractV5R1;\n\nconst TON_MAX_COMMENT_BYTES = 127;\n\nlet clientByNetwork: Record<ApiNetwork, TonClient> | undefined;\n\nexport const walletClassMap: Record<ApiTonWalletVersion, TonWalletType> = {\n  simpleR1: WalletContractV1R1,\n  simpleR2: WalletContractV1R2,\n  simpleR3: WalletContractV1R3,\n  v2R1: WalletContractV2R1,\n  v2R2: WalletContractV2R2,\n  v3R1: WalletContractV3R1,\n  v3R2: WalletContractV3R2,\n  v4R2: WalletContractV4,\n  W5: WalletContractV5R1,\n};\n\nexport function getTonClient(network: ApiNetwork = 'mainnet') {\n  if (!clientByNetwork) {\n    const { apiHeaders, toncenterMainnetKey, toncenterTestnetKey } = getEnvironment();\n\n    clientByNetwork = {\n      mainnet: new TonClient({\n        endpoint: `${TONCENTER_MAINNET_URL}/api/v2/jsonRPC`,\n        timeout: DEFAULT_TIMEOUT,\n        apiKey: toncenterMainnetKey,\n        headers: apiHeaders,\n      }),\n      testnet: new TonClient({\n        endpoint: `${TONCENTER_TESTNET_URL}/api/v2/jsonRPC`,\n        timeout: DEFAULT_TIMEOUT,\n        apiKey: toncenterTestnetKey,\n        headers: apiHeaders,\n      }),\n    };\n  }\n\n  return clientByNetwork[network];\n}\n\nexport const resolveTokenWalletAddress = withCacheAsync(\n  async (network: ApiNetwork, address: string, tokenAddress: string) => {\n    const minter = getTonClient(network).open(new JettonMinter(Address.parse(tokenAddress)));\n    const walletAddress = await minter.getWalletAddress(Address.parse(address));\n    return toBase64Address(walletAddress, true, network);\n  },\n);\n\nexport const resolveTokenAddress = withCacheAsync(async (network: ApiNetwork, tokenWalletAddress: string) => {\n  const tokenWallet = getTonClient(network).open(new JettonWallet(Address.parse(tokenWalletAddress)));\n  const data = await tokenWallet.getWalletData();\n  return toBase64Address(data.minter, true, network);\n});\n\nexport const getWalletPublicKey = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  const res = await getTonClient(network).runMethodWithError(Address.parse(address), 'get_public_key');\n  if (res.exit_code !== 0) {\n    return undefined;\n  }\n\n  const bigintKey = res.stack.readBigNumber();\n  const hex = bigintKey.toString(16).padStart(64, '0');\n  return hexToBytes(hex);\n});\n\nexport const getJettonPoolStakeWallet = withCacheAsync(async (\n  network: ApiNetwork,\n  poolAddress: string,\n  period: number,\n  address: string,\n): Promise<OpenedContract<StakeWallet>> => {\n  const tonClient = getTonClient(network);\n  const pool = tonClient.open(StakingPool.createFromAddress(Address.parse(poolAddress)));\n  const walletAddress = (await pool.getWalletAddress(Address.parse(address), period))!;\n  return tonClient.open(StakeWallet.createFromAddress(walletAddress));\n});\n\nexport function getJettonMinterData(network: ApiNetwork, address: string) {\n  const contract = getTonClient(network).open(new JettonMinter(Address.parse(address)));\n  return contract.getJettonData();\n}\n\nexport function oneCellFromBoc(bytes: Uint8Array) {\n  return Cell.fromBoc(Buffer.from(bytes));\n}\n\nexport function toBase64Address(address: Address | string, isBounceable = DEFAULT_IS_BOUNCEABLE, network?: ApiNetwork) {\n  if (typeof address === 'string') {\n    address = Address.parse(address);\n  }\n  return address.toString({\n    urlSafe: true,\n    bounceable: isBounceable,\n    testOnly: network === 'testnet',\n  });\n}\n\nexport function toRawAddress(address: Address | string) {\n  if (typeof address === 'string') {\n    address = Address.parse(address);\n  }\n  return address.toRawString();\n}\n\nexport function buildTokenTransferBody(params: TokenTransferBodyParams) {\n  const {\n    queryId,\n    tokenAmount,\n    toAddress,\n    responseAddress,\n    forwardAmount,\n    customPayload,\n  } = params;\n  let forwardPayload = params.forwardPayload;\n\n  let builder = new Builder()\n    .storeUint(JettonOpCode.Transfer, 32)\n    .storeUint(queryId || generateQueryId(), 64)\n    .storeCoins(tokenAmount)\n    .storeAddress(Address.parse(toAddress))\n    .storeAddress(Address.parse(responseAddress))\n    .storeMaybeRef(customPayload)\n    .storeCoins(forwardAmount ?? 0n);\n\n  if (forwardPayload instanceof Uint8Array) {\n    const freeBytes = Math.round(builder.availableBits / 8);\n    forwardPayload = packBytesAsSnake(forwardPayload, freeBytes);\n  }\n\n  if (!forwardPayload) {\n    builder.storeBit(false);\n  } else if (typeof forwardPayload === 'string') {\n    builder = builder.storeBit(false)\n      .storeUint(0, 32)\n      .storeBuffer(Buffer.from(forwardPayload));\n  } else if (forwardPayload instanceof Uint8Array) {\n    builder = builder.storeBit(false)\n      .storeBuffer(Buffer.from(forwardPayload));\n  } else {\n    builder = builder.storeBit(true)\n      .storeRef(forwardPayload);\n  }\n\n  return builder.endCell();\n}\n\nexport function parseBase64(base64: string) {\n  try {\n    return Cell.fromBase64(base64);\n  } catch (err) {\n    logDebugError('parseBase64', err);\n    return Uint8Array.from(Buffer.from(base64, 'base64'));\n  }\n}\n\nexport function commentToBytes(comment: string): Uint8Array {\n  const buffer = Buffer.from(comment);\n  const bytes = new Uint8Array(buffer.length + 4);\n\n  const startBuffer = Buffer.alloc(4);\n  startBuffer.writeUInt32BE(OpCode.Comment);\n  bytes.set(startBuffer, 0);\n  bytes.set(buffer, 4);\n\n  return bytes;\n}\n\nexport function packBytesAsSnake(bytes: Uint8Array, maxBytes = TON_MAX_COMMENT_BYTES): Uint8Array | Cell {\n  const buffer = Buffer.from(bytes);\n  if (buffer.length <= maxBytes) {\n    return bytes;\n  }\n\n  return packBytesAsSnakeCell(bytes);\n}\n\nexport function packBytesAsSnakeCell(bytes: Uint8Array): Cell {\n  const bytesPerCell = TON_MAX_COMMENT_BYTES;\n  const cellCount = Math.ceil(bytes.length / bytesPerCell);\n  let headCell: Cell | undefined;\n\n  for (let i = cellCount - 1; i >= 0; i--) {\n    const cellOffset = i * bytesPerCell;\n    const cellLength = Math.min(bytesPerCell, bytes.length - cellOffset);\n    const cellBuffer = Buffer.from(bytes.buffer, bytes.byteOffset + cellOffset, cellLength); // This creates a buffer that references the input bytes instead of copying them\n\n    const nextHeadCell = new Builder().storeBuffer(cellBuffer);\n    if (headCell) {\n      nextHeadCell.storeRef(headCell);\n    }\n    headCell = nextHeadCell.endCell();\n  }\n\n  return headCell ?? Cell.EMPTY;\n}\n\nexport function packBytesAsSnakeForEncryptedData(data: Uint8Array): Uint8Array | Cell {\n  const ROOT_BUILDER_BYTES = 39;\n  const MAX_CELLS_AMOUNT = 16;\n\n  if (data.length > ROOT_BUILDER_BYTES + MAX_CELLS_AMOUNT * TON_MAX_COMMENT_BYTES) {\n    throw new Error('Input text is too long');\n  }\n\n  return new Builder()\n    .storeBuffer(Buffer.from(data.subarray(0, ROOT_BUILDER_BYTES)))\n    .storeRef(packBytesAsSnakeCell(data.subarray(ROOT_BUILDER_BYTES)))\n    .endCell();\n}\n\nexport function buildLiquidStakingDepositBody(queryId?: number) {\n  return new Builder()\n    .storeUint(LiquidStakingOpCode.Deposit, 32)\n    .storeUint(queryId || 0, 64)\n    .asCell();\n}\n\nexport function buildLiquidStakingWithdrawBody(options: {\n  queryId?: number;\n  amount: bigint;\n  responseAddress: string;\n  waitTillRoundEnd?: boolean; // opposite of request_immediate_withdrawal\n  fillOrKill?: boolean;\n}) {\n  const {\n    queryId, amount, responseAddress, waitTillRoundEnd, fillOrKill,\n  } = options;\n\n  const customPayload = buildLiquidStakingWithdrawCustomPayload(waitTillRoundEnd, fillOrKill);\n\n  return new Builder()\n    .storeUint(JettonOpCode.Burn, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeCoins(amount)\n    .storeAddress(Address.parse(responseAddress))\n    .storeBit(1)\n    .storeRef(customPayload)\n    .asCell();\n}\n\nexport function buildLiquidStakingWithdrawCustomPayload(waitTillRoundEnd?: boolean, fillOrKill?: boolean) {\n  return new Builder()\n    .storeUint(Number(waitTillRoundEnd), 1)\n    .storeUint(Number(fillOrKill), 1)\n    .asCell();\n}\n\nexport function getTokenBalance(network: ApiNetwork, walletAddress: string) {\n  const tokenWallet = getTonClient(network).open(new JettonWallet(Address.parse(walletAddress)));\n  return tokenWallet.getJettonBalance();\n}\n\nexport function parseAddress(address: string): {\n  isValid: boolean;\n  isRaw?: boolean;\n  isUserFriendly?: boolean;\n  isBounceable?: boolean;\n  isTestOnly?: boolean;\n  address?: Address;\n} {\n  try {\n    if (Address.isRaw(address)) {\n      return {\n        address: Address.parseRaw(address),\n        isRaw: true,\n        isValid: true,\n      };\n    } else if (Address.isFriendly(address)) {\n      return {\n        ...Address.parseFriendly(address),\n        isUserFriendly: true,\n        isValid: true,\n      };\n    }\n  } catch (err) {\n    // Do nothing\n  }\n\n  return { isValid: false };\n}\n\nexport function getIsRawAddress(address: string) {\n  return Boolean(parseAddress(address).isRaw);\n}\n\nexport async function getDnsItemDomain(network: ApiNetwork, address: Address | string) {\n  if (typeof address === 'string') address = Address.parse(address);\n\n  const contract = getTonClient(network)\n    .open(new DnsItem(address));\n  const nftData = await contract.getNftData();\n  const collectionAddress = toBase64Address(nftData.collectionAddress, true);\n\n  const zone = getDnsZoneByCollection(collectionAddress);\n\n  const base = zone?.isTelemint\n    ? await contract.getTelemintDomain()\n    : await contract.getDomain();\n\n  return `${base}.${zone?.suffixes[0]}`;\n}\n\nexport function buildJettonUnstakePayload(jettonsToUnstake: bigint, forceUnstake?: boolean, queryId?: bigint) {\n  return beginCell()\n    .storeUint(JettonStakingOpCodes.UNSTAKE_JETTONS, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeCoins(jettonsToUnstake)\n    .storeBit(forceUnstake ?? false)\n    .endCell();\n}\n\nexport function buildJettonClaimPayload(poolWallets: string[], queryId?: bigint) {\n  const rewardsToClaim = Dictionary.empty(Dictionary.Keys.Address(), Dictionary.Values.Bool());\n\n  for (const poolWallet of poolWallets) {\n    rewardsToClaim.set(Address.parse(poolWallet), true);\n  }\n\n  return beginCell()\n    .storeUint(JettonStakingOpCodes.CLAIM_REWARDS, 32)\n    .storeUint(queryId ?? 0, 64)\n    .storeDict(rewardsToClaim, Dictionary.Keys.Address(), Dictionary.Values.Bool())\n    .endCell();\n}\n\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport function unpackDicts(obj: Record<string, any | Dictionary<any, any>>): AnyLiteral {\n  if (!isSimpleObject(obj)) {\n    return obj;\n  }\n\n  return mapValues(obj, (value) => {\n    if (value instanceof Dictionary) {\n      return unpackDicts(fromKeyValueArrays(value.keys(), value.values()));\n    }\n    if (isSimpleObject(value)) {\n      return unpackDicts(value);\n    }\n    return value;\n  });\n}\n\nfunction isSimpleObject(obj: any) {\n  // eslint-disable-next-line no-null/no-null\n  return obj !== null\n    && typeof obj === 'object'\n    && Object.getPrototypeOf(obj) === Object.prototype;\n}\n\nexport function getOurFeePayload() {\n  return new Builder()\n    .storeUint(OpCode.OurFee, 32)\n    .endCell();\n}\n","export enum StorageType {\n  IndexedDb,\n  LocalStorage,\n  ExtensionLocal,\n  CapacitorStorage,\n}\n\nexport interface Storage {\n  getItem(name: StorageKey, force?: boolean): Promise<any>;\n\n  setItem(name: StorageKey, value: any): Promise<void>;\n\n  removeItem(name: StorageKey): Promise<void>;\n\n  clear(): Promise<void>;\n\n  getAll?(): Promise<AnyLiteral>;\n\n  setMany?(items: AnyLiteral): Promise<void>;\n\n  getMany?(keys: string[]): Promise<AnyLiteral>;\n}\n\nexport type StorageKey = 'accounts'\n  | 'stateVersion'\n  | 'currentAccountId'\n  | 'clientId'\n  | 'baseCurrency'\n  | 'referrer'\n  // For extension\n  | 'dapps'\n  | 'dappMethods:lastAccountId'\n  | 'windowId'\n  | 'windowState'\n  | 'isTonMagicEnabled'\n  | 'isTonProxyEnabled'\n  | 'isDeeplinkHookEnabled'\n  // For TonConnect SSE\n  | 'sseLastEventId';\n","import type { Connector } from '../PostMessageConnector';\nimport type { WindowMethodArgs, WindowMethodResponse, WindowMethods } from './types';\n\nimport { WINDOW_PROVIDER_CHANNEL, WINDOW_PROVIDER_PORT } from '../../config';\n\nimport { createReverseExtensionConnector } from '../PostMessageConnector';\nimport { createConnector } from '../PostMessageConnector';\n\nlet connector: Connector;\n\nexport function initWindowConnector() {\n  if (!connector) {\n    // We use process.env.IS_EXTENSION instead of IS_EXTENSION in order to remove the irrelevant code during bundling\n    if (process.env.IS_EXTENSION) {\n      connector = createReverseExtensionConnector(WINDOW_PROVIDER_PORT);\n      // connector.init() is not called here because the extension connector is available only when the popup is open\n    } else {\n      connector = createConnector(self as DedicatedWorkerGlobalScope, undefined, WINDOW_PROVIDER_CHANNEL);\n      connector.init();\n    }\n  }\n}\n\nexport function callWindow<T extends keyof WindowMethods>(methodName: T, ...args: WindowMethodArgs<T>) {\n  if (!connector) {\n    throw new Error('API is not initialized');\n  }\n\n  return connector.request({ name: methodName, args }) as EnsurePromise<WindowMethodResponse<T>>;\n}\n","export default function generateUniqueId() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2);\n}\n","import { decodeExtensionMessage, encodeExtensionMessage } from './extensionMessageSerializer';\nimport generateUniqueId from './generateUniqueId';\nimport { logDebugError } from './logs';\n\nexport interface CancellableCallback {\n  (\n    ...args: any[]\n  ): void;\n\n  isCanceled?: boolean;\n  acceptsBuffer?: boolean;\n}\n\ntype InitData = {\n  channel?: string;\n  type: 'init';\n  args: any[];\n};\n\ntype CallMethodData = {\n  channel?: string;\n  type: 'callMethod';\n  messageId?: string;\n  name: string;\n  args: any;\n  withCallback?: boolean;\n};\n\nexport type OriginMessageData = InitData | CallMethodData | {\n  channel?: string;\n  type: 'cancelProgress';\n  messageId: string;\n};\n\nexport interface OriginMessageEvent extends MessageEvent {\n  data: OriginMessageData;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport type ApiUpdate = { type: string } & any;\n\nexport type WorkerMessageData = {\n  channel?: string;\n  type: 'update';\n  update: ApiUpdate;\n} | {\n  channel?: string;\n  type: 'methodResponse';\n  messageId: string;\n  response?: any;\n  error?: { message: string };\n} | {\n  channel?: string;\n  type: 'methodCallback';\n  messageId: string;\n  callbackArgs: any[];\n} | {\n  channel?: string;\n  type: 'unhandledError';\n  error?: { message: string; stack?: string };\n};\n\nexport interface WorkerMessageEvent {\n  data: WorkerMessageData;\n}\n\ninterface RequestStates {\n  messageId: string;\n  resolve: AnyToVoidFunction;\n  reject: AnyToVoidFunction;\n  callback: AnyToVoidFunction;\n}\n\ntype InputRequestTypes = Record<string, AnyFunction>;\n\ntype Values<T> = T[keyof T];\nexport type RequestTypes<T extends InputRequestTypes> = Values<{\n  [Name in keyof (T)]: {\n    name: Name & string;\n    args: Parameters<T[Name]>;\n  }\n}>;\n\nclass ConnectorClass<T extends InputRequestTypes> {\n  private requestStates = new Map<string, RequestStates>();\n\n  private requestStatesByCallback = new Map<AnyToVoidFunction, RequestStates>();\n\n  constructor(\n    public target: Worker | Window | chrome.runtime.Port | DedicatedWorkerGlobalScope,\n    private onUpdate?: (update: ApiUpdate) => void,\n    private channel?: string,\n    private shouldUseJson?: boolean,\n    private targetOrigin = '*',\n  ) {\n  }\n\n  public destroy() {\n  }\n\n  init(...args: any[]) {\n    this.postMessage({\n      type: 'init',\n      args,\n    });\n  }\n\n  request(messageData: RequestTypes<T>) {\n    const { requestStates, requestStatesByCallback } = this;\n\n    const messageId = generateUniqueId();\n    const payload: CallMethodData = {\n      type: 'callMethod',\n      messageId,\n      ...messageData,\n    };\n\n    const requestState = { messageId } as RequestStates;\n\n    // Re-wrap type because of `postMessage`\n    const promise = new Promise<any>((resolve, reject) => {\n      Object.assign(requestState, { resolve, reject });\n    });\n\n    if (typeof payload.args[payload.args.length - 1] === 'function') {\n      payload.withCallback = true;\n\n      const callback = payload.args.pop() as AnyToVoidFunction;\n      requestState.callback = callback;\n      requestStatesByCallback.set(callback, requestState);\n    }\n\n    requestStates.set(messageId, requestState);\n    promise\n      .catch(() => undefined)\n      .finally(() => {\n        requestStates.delete(messageId);\n\n        if (requestState.callback) {\n          requestStatesByCallback.delete(requestState.callback);\n        }\n      });\n\n    this.postMessage(payload);\n\n    return promise;\n  }\n\n  cancelCallback(progressCallback: CancellableCallback) {\n    progressCallback.isCanceled = true;\n\n    const { messageId } = this.requestStatesByCallback.get(progressCallback) || {};\n    if (!messageId) {\n      return;\n    }\n\n    this.postMessage({\n      type: 'cancelProgress',\n      messageId,\n    });\n  }\n\n  onMessage(data: WorkerMessageData | string) {\n    try {\n      data = decodeExtensionMessage(data);\n    } catch (err: any) {\n      logDebugError('PostMessageConnector: Failed to parse message', err);\n      return;\n    }\n\n    const { requestStates, channel } = this;\n    if (data.channel !== channel) {\n      return;\n    }\n\n    if (data.type === 'update' && this.onUpdate) {\n      this.onUpdate(data.update);\n    }\n    if (data.type === 'methodResponse') {\n      const requestState = requestStates.get(data.messageId);\n      if (requestState) {\n        if (data.error) {\n          requestState.reject(data.error);\n        } else {\n          requestState.resolve(data.response);\n        }\n      }\n    } else if (data.type === 'methodCallback') {\n      const requestState = requestStates.get(data.messageId);\n      requestState?.callback?.(...data.callbackArgs);\n    } else if (data.type === 'unhandledError') {\n      const error = new Error(data.error?.message);\n      if (data.error?.stack) {\n        error.stack = data.error.stack;\n      }\n      throw error;\n    }\n  }\n\n  private postMessage(data: OriginMessageData) {\n    data.channel = this.channel;\n\n    let rawData: OriginMessageData | string = data;\n    if (this.shouldUseJson) {\n      rawData = encodeExtensionMessage(data);\n    }\n\n    if ('open' in this.target) { // Is Window\n      this.target.postMessage(rawData, this.targetOrigin);\n    } else {\n      this.target.postMessage(rawData);\n    }\n  }\n}\n\n/**\n * Allows to call functions, provided by another messenger (a window, a worker), in this messenger.\n * The other messenger must provide the functions using `createPostMessageInterface`.\n */\nexport function createConnector<T extends InputRequestTypes>(\n  worker: Worker | Window | DedicatedWorkerGlobalScope,\n  onUpdate?: (update: ApiUpdate) => void,\n  channel?: string,\n  targetOrigin?: string,\n) {\n  const connector = new ConnectorClass<T>(worker, onUpdate, channel, undefined, targetOrigin);\n\n  function handleMessage({ data }: WorkerMessageEvent | MessageEvent) {\n    connector.onMessage(data);\n  }\n\n  worker.addEventListener('message', handleMessage as any); // TS weirdly complains here\n\n  connector.destroy = () => {\n    worker.removeEventListener('message', handleMessage as any);\n  };\n\n  return connector;\n}\n\n/**\n * Allows to call functions, provided by the extension service worker, in this window.\n * The service worker must provide the functions using `createExtensionInterface`.\n */\nexport function createExtensionConnector(\n  name: string,\n  onUpdate?: (update: ApiUpdate) => void,\n  getInitArgs?: () => any,\n  channel?: string,\n) {\n  const connector = new ConnectorClass(connect(), onUpdate, channel, true);\n\n  function connect() {\n    const port = self.chrome.runtime.connect({ name });\n\n    port.onMessage.addListener((data: string | WorkerMessageData) => {\n      connector.onMessage(data);\n    });\n\n    // For some reason port can suddenly get disconnected\n    port.onDisconnect.addListener(() => {\n      connector.target = connect();\n      connector.init(getInitArgs?.());\n    });\n\n    return port;\n  }\n\n  connector.init(getInitArgs?.());\n\n  return connector;\n}\n\n/**\n * Allows to call functions, provided by a window, in this service worker.\n * The window must provide the functions using `createReverseExtensionInterface`.\n *\n * Warning: the connector is able to send messages only when the popup window is open.\n */\nexport function createReverseExtensionConnector(portName: string) {\n  const nullWorker = {\n    postMessage() {\n      throw new Error('The popup window is not connected');\n    },\n  } as Pick<Worker, 'postMessage'> as Worker;\n\n  const connector = new ConnectorClass(nullWorker, undefined, undefined, true);\n\n  chrome.runtime.onConnect.addListener((port) => {\n    if (port.name !== portName) {\n      return;\n    }\n\n    connector.target = port;\n\n    port.onMessage.addListener((data: string | WorkerMessageData) => {\n      connector.onMessage(data);\n    });\n\n    port.onDisconnect.addListener(() => {\n      connector.target = nullWorker;\n    });\n  });\n\n  return connector;\n}\n\nexport type Connector<T extends InputRequestTypes = InputRequestTypes> = ReturnType<typeof createConnector<T>>;\n","import type { Storage, StorageKey } from './types';\n\nimport { bigintReviver } from '../../util/bigint';\nimport { callWindow } from '../../util/windowProvider/connector';\nimport { getEnvironment } from '../environment';\n\nlet cache: AnyLiteral = {};\n\nconst storage: Storage & {\n  getKeys: () => Promise<string[] | undefined>;\n} = {\n  async getItem(key: StorageKey, force?: boolean) {\n    if (getEnvironment().isAndroidApp && key in cache && !force) {\n      return cache[key];\n    }\n\n    const result = await callWindow('capacitorStorageGetItem', key);\n    const value = result ? JSON.parse(result, bigintReviver) : undefined;\n\n    if (getEnvironment().isAndroidApp) {\n      if (value === undefined) {\n        delete cache[key];\n      } else {\n        cache[key] = value;\n      }\n    }\n\n    return value;\n  },\n\n  async setItem(key: StorageKey, value: any) {\n    await callWindow('capacitorStorageSetItem', key, JSON.stringify(value));\n\n    if (getEnvironment().isAndroidApp) {\n      cache[key] = value;\n    }\n  },\n\n  async removeItem(key: StorageKey) {\n    await callWindow('capacitorStorageRemoveItem', key);\n\n    if (getEnvironment().isAndroidApp) {\n      delete cache[key];\n    }\n  },\n\n  async clear() {\n    await callWindow('capacitorStorageClear');\n\n    if (getEnvironment().isAndroidApp) {\n      cache = {};\n    }\n  },\n\n  async getKeys() {\n    const result = await callWindow('capacitorStorageKeys');\n\n    return result?.value;\n  },\n};\n\nexport default storage;\n","import type { Storage } from './types';\n\nimport { IS_EXTENSION } from '../../config';\n\nconst storage = IS_EXTENSION ? self.chrome.storage.local : undefined;\n\nexport default ((storage && {\n  getItem: async (key) => (await storage.get(key))?.[key],\n  setItem: (key, value) => storage.set({ [key]: value }),\n  removeItem: storage.remove.bind(storage),\n  clear: storage.clear.bind(storage),\n  getAll: storage.get.bind(storage),\n  setMany: storage.set.bind(storage),\n  getMany: storage.get.bind(storage),\n}) || {}) as Storage;\n","import * as idb from 'idb-keyval';\n\nimport type { Storage, StorageKey } from './types';\n\nimport { INDEXED_DB_NAME, INDEXED_DB_STORE_NAME } from '../../config';\nimport { fromKeyValueArrays } from '../../util/iteratees';\n\nconst store = idb.createStore(INDEXED_DB_NAME, INDEXED_DB_STORE_NAME);\n\nexport default {\n  getItem: (name: StorageKey) => idb.get(name, store),\n  setItem: (name: StorageKey, value: any) => idb.set(name, value, store),\n  removeItem: (name: StorageKey) => idb.del(name, store),\n  clear: () => idb.clear(store),\n  getAll: async () => {\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n    const keys = (await idb.keys(store)) as string[];\n    const values = await idb.getMany(keys, store);\n    return fromKeyValueArrays(keys, values);\n  },\n  getMany: async (keys) => {\n    const values = await idb.getMany(keys, store);\n    return fromKeyValueArrays(keys, values);\n  },\n  setMany: (items) => {\n    return idb.setMany(Object.entries(items), store);\n  },\n} as Storage;\n","import type { Storage, StorageKey } from './types';\n\nimport { pick } from '../../util/iteratees';\nimport { callWindow } from '../../util/windowProvider/connector';\n\nfunction withPromise(fn: AnyFunction) {\n  return (...args: any) => Promise.resolve(fn(...args));\n}\n\nconst storage: Storage = (typeof localStorage === 'object' ? {\n  getItem: withPromise(localStorage.getItem),\n  setItem: withPromise(localStorage.setItem),\n  removeItem: withPromise(localStorage.removeItem),\n  clear: withPromise(localStorage.clear),\n  getAll: withPromise(() => ({ ...localStorage })),\n  getMany: withPromise((keys: string[]) => pick(localStorage, keys)),\n  setMany: withPromise((items: AnyLiteral) => {\n    Object.assign(localStorage, items);\n  }),\n} : {\n  getItem(key: StorageKey) {\n    return callWindow('localStorageGetItem', key);\n  },\n  setItem(key: StorageKey, value: any) {\n    return callWindow('localStorageSetItem', key, value);\n  },\n  removeItem(key: StorageKey) {\n    return callWindow('localStorageRemoveItem', key);\n  },\n  clear() {\n    return callWindow('localStorageClear');\n  },\n  getAll() {\n    return callWindow('localStorageGetAll');\n  },\n  getMany(keys: StorageKey[]) {\n    return callWindow('localStorageGetMany', keys);\n  },\n  setMany(items: AnyLiteral) {\n    return callWindow('localStorageSetMany', items);\n  },\n});\n\nexport default storage;\n","import { StorageType } from './types';\n\nimport { IS_CAPACITOR, IS_EXTENSION } from '../../config';\nimport capacitorStorage from './capacitorStorage';\nimport extensionStorage from './extension';\nimport idb from './idb';\nimport localStorage from './localStorage';\n\nexport const storage = IS_EXTENSION ? extensionStorage : IS_CAPACITOR ? capacitorStorage : idb;\n\nexport default {\n  [StorageType.IndexedDb]: idb,\n  [StorageType.LocalStorage]: localStorage,\n  [StorageType.ExtensionLocal]: extensionStorage,\n  [StorageType.CapacitorStorage]: capacitorStorage,\n};\n","import type { StorageKey } from '../storages/types';\nimport type {\n  ApiAccountAny,\n  ApiAccountWithMnemonic,\n  ApiAccountWithTon,\n  ApiAccountWithTron,\n  ApiBip39Account,\n  ApiChain,\n  ApiNetwork,\n  ApiTonWallet,\n  ApiTronWallet,\n} from '../types';\n\nimport { buildAccountId, parseAccountId } from '../../util/account';\nimport { storage } from '../storages';\n\nconst MIN_ACCOUNT_NUMBER = 0;\n\nexport let loginResolve: AnyFunction;\nconst loginPromise = new Promise<void>((resolve) => {\n  loginResolve = resolve;\n});\n\nexport async function getAccountIds(): Promise<string[]> {\n  return Object.keys(await storage.getItem('accounts') || {});\n}\n\nexport async function getAccountWithMnemonic() {\n  const byId = await fetchStoredAccounts();\n\n  return Object.entries(byId)\n    .find(([, { type }]) => type !== 'ledger' && type !== 'view') as [string, ApiAccountWithMnemonic] | undefined;\n}\n\nexport async function getNewAccountId(network: ApiNetwork, preferredId?: number) {\n  const ids = (await getAccountIds()).map((accountId) => parseAccountId(accountId).id);\n  const id = preferredId !== undefined && !ids.includes(preferredId)\n    ? preferredId\n    : ids.length === 0 ? MIN_ACCOUNT_NUMBER : Math.max(...ids) + 1;\n  return buildAccountId({ id, network });\n}\n\nexport async function fetchStoredAddress(accountId: string, chain: ApiChain): Promise<string> {\n  return (await fetchStoredAccount<ApiBip39Account>(accountId))[chain].address;\n}\n\nexport async function fetchStoredTonWallet(accountId: string): Promise<ApiTonWallet> {\n  return (await fetchStoredTonAccount(accountId)).ton;\n}\n\nexport async function fetchStoredTronWallet(accountId: string): Promise<ApiTronWallet> {\n  return (await fetchStoredTronAccount(accountId)).tron;\n}\n\nexport function fetchMaybeStoredAccount<T extends ApiAccountAny>(accountId: string): Promise<T | undefined> {\n  return getAccountValue(accountId, 'accounts');\n}\n\nexport async function fetchStoredAccount<T extends ApiAccountAny>(accountId: string): Promise<T> {\n  const account = await fetchMaybeStoredAccount<T>(accountId);\n  if (account) return account;\n  throw new Error(`Account ${accountId} doesn't exist`);\n}\n\nexport async function fetchStoredTonAccount<T extends ApiAccountWithTon>(accountId: string): Promise<T> {\n  const account = await fetchStoredAccount(accountId);\n  if (account.ton) return account as T;\n  throw new Error('TON wallet missing');\n}\n\nexport async function fetchStoredTronAccount<T extends ApiAccountWithTron>(accountId: string): Promise<T> {\n  const account = await fetchStoredAccount(accountId);\n  if ((account as ApiAccountWithTron).tron) return account as T;\n  throw new Error('TRON wallet missing');\n}\n\nexport function fetchStoredAccounts(): Promise<Record<string, ApiAccountAny>> {\n  return storage.getItem('accounts');\n}\n\nexport async function updateStoredAccount<T extends ApiAccountAny>(\n  accountId: string,\n  partial: Partial<T>,\n): Promise<void> {\n  const account = await fetchStoredAccount<T>(accountId);\n  return setAccountValue(accountId, 'accounts', {\n    ...account,\n    ...partial,\n  });\n}\n\nexport async function updateStoredTonWallet(accountId: string, partial: Partial<ApiTonWallet>): Promise<void> {\n  const tonWallet = await fetchStoredTonWallet(accountId);\n  return updateStoredAccount(accountId, {\n    ton: {\n      ...tonWallet,\n      ...partial,\n    },\n  });\n}\n\nexport async function getAccountValue(accountId: string, key: StorageKey) {\n  return (await storage.getItem(key))?.[accountId];\n}\n\nexport async function removeAccountValue(accountId: string, key: StorageKey) {\n  const data = await storage.getItem(key);\n  if (!data) return;\n\n  const { [accountId]: removedValue, ...restData } = data;\n  await storage.setItem(key, restData);\n}\n\nexport async function setAccountValue(accountId: string, key: StorageKey, value: any) {\n  const data = await storage.getItem(key);\n  await storage.setItem(key, { ...data, [accountId]: value });\n}\n\nexport async function removeNetworkAccountsValue(network: string, key: StorageKey) {\n  const data = await storage.getItem(key);\n  if (!data) return;\n\n  for (const accountId of Object.keys(data)) {\n    if (parseAccountId(accountId).network === network) {\n      delete data[accountId];\n    }\n  }\n\n  await storage.setItem(key, data);\n}\n\nexport async function getCurrentNetwork() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) return undefined;\n  return parseAccountId(accountId).network;\n}\n\nexport async function getCurrentAccountIdOrFail() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) {\n    throw new Error('The user is not authorized in the wallet');\n  }\n  return accountId;\n}\n\nexport function getCurrentAccountId(): Promise<string | undefined> {\n  return storage.getItem('currentAccountId');\n}\n\nexport function waitLogin() {\n  return loginPromise;\n}\n\nexport function getAddressesFromAccount(account: ApiAccountAny) {\n  const addressByChain: Partial<Record<ApiChain, string>> = {};\n\n  if ('ton' in account && account.ton) addressByChain.ton = account.ton.address;\n  if ('tron' in account && account.tron) addressByChain.tron = account.tron.address;\n\n  return addressByChain;\n}\n","import * as bip39 from 'bip39';\n\nimport { type ApiAccountWithMnemonic, ApiCommonError } from '../types';\n\nimport { logDebugError } from '../../util/logs';\nimport { updateStoredAccount } from './accounts';\n\nconst PBKDF2_IMPORT_KEY_ARGS = [\n  { name: 'PBKDF2' },\n  false,\n  ['deriveBits', 'deriveKey'],\n] as const;\n\nconst PBKDF2_DERIVE_KEY_ARGS = {\n  name: 'PBKDF2',\n  iterations: 100000, // Higher is more secure but slower\n  hash: 'SHA-256',\n};\n\nconst PBKDF2_DERIVE_KEY_TYPE = { name: 'AES-GCM', length: 256 };\n\nexport function generateBip39Mnemonic() {\n  return bip39.generateMnemonic(256).split(' ');\n}\n\nexport function validateBip39Mnemonic(mnemonic: string[]) {\n  return bip39.validateMnemonic(mnemonic.join(' '));\n}\n\nexport async function tryMigratingMnemonicEncryption(accountId: string, mnemonic: string[], password: string) {\n  const sensitiveData = [password, ...mnemonic];\n\n  try {\n    const mnemonicEncrypted = await encryptMnemonic(mnemonic, password);\n    sensitiveData.push(mnemonicEncrypted);\n\n    // This is a defensive approach against potential corrupted encryption reported by some users\n    const decryptedMnemonic = await decryptMnemonic(mnemonicEncrypted, password)\n      .catch(() => undefined);\n\n    if (!password || !decryptedMnemonic) {\n      return { error: ApiCommonError.DebugError };\n    }\n\n    await updateStoredAccount<ApiAccountWithMnemonic>(accountId, { mnemonicEncrypted });\n  } catch (err) {\n    logDebugError('tryMigratingMnemonicEncryption', removeSensitiveDataFromError(err, sensitiveData));\n  }\n\n  return undefined;\n}\n\nexport async function encryptMnemonic(mnemonic: string[], password: string) {\n  const plaintext = mnemonic.join(',');\n  const salt = crypto.getRandomValues(new Uint8Array(16)); // generate a 128-bit salt\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(password),\n    ...PBKDF2_IMPORT_KEY_ARGS,\n  );\n  const key = await crypto.subtle.deriveKey(\n    {\n      salt,\n      ...PBKDF2_DERIVE_KEY_ARGS,\n    },\n    keyMaterial,\n    PBKDF2_DERIVE_KEY_TYPE,\n    false,\n    ['encrypt'],\n  );\n  const iv = crypto.getRandomValues(new Uint8Array(12)); // get 96-bit random iv\n  const ptUint8 = new TextEncoder().encode(plaintext); // encode plaintext as UTF-8\n  const ctBuffer = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, ptUint8); // encrypt plaintext using key\n  const ctArray = Array.from(new Uint8Array(ctBuffer)); // ciphertext as byte array\n  const ctBase64 = btoa(String.fromCharCode(...ctArray)); // encode ciphertext as base64\n  const ivHex = Array.from(iv).map((b) => (`00${b.toString(16)}`).slice(-2)).join(''); // iv as hex string\n  const saltHex = Array.from(salt).map((b) => (`00${b.toString(16)}`).slice(-2)).join(''); // salt as hex string\n\n  return `${saltHex}:${ivHex}:${ctBase64}`;\n}\n\nexport async function decryptMnemonic(encrypted: string, password: string) {\n  if (!encrypted.includes(':')) {\n    return decryptMnemonicLegacy(encrypted, password);\n  }\n\n  const [saltHex, ivHex, encryptedData] = encrypted.split(':');\n  const salt = new Uint8Array(saltHex.match(/.{2}/g)!.map((b) => parseInt(b, 16)));\n  const iv = new Uint8Array(ivHex.match(/.{2}/g)!.map((b) => parseInt(b, 16)));\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(password),\n    ...PBKDF2_IMPORT_KEY_ARGS,\n  );\n  const key = await crypto.subtle.deriveKey(\n    { salt, ...PBKDF2_DERIVE_KEY_ARGS },\n    keyMaterial,\n    PBKDF2_DERIVE_KEY_TYPE,\n    false,\n    ['decrypt'],\n  );\n  const ctStr = atob(encryptedData); // decode base64 ciphertext\n  const ctUint8 = new Uint8Array(ctStr.match(/[\\s\\S]/g)!.map((ch) => ch.charCodeAt(0))); // ciphertext as Uint8Array\n  const plainBuffer = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ctUint8); // decrypt ciphertext using key\n  const plaintext = new TextDecoder().decode(plainBuffer); // decode password from UTF-8\n\n  return plaintext.split(',');\n}\n\nasync function decryptMnemonicLegacy(encrypted: string, password: string) {\n  const pwUtf8 = new TextEncoder().encode(password); // encode password as UTF-8\n  const pwHash = await crypto.subtle.digest('SHA-256', pwUtf8); // hash the password\n  const iv = encrypted.slice(0, 24).match(/.{2}/g)!.map((byte) => parseInt(byte, 16)); // get iv from ciphertext\n  const alg = { name: 'AES-GCM', iv: new Uint8Array(iv) }; // specify algorithm to use\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']); // use pw to generate key\n  const ctStr = atob(encrypted.slice(24)); // decode base64 ciphertext\n  const ctUint8 = new Uint8Array(ctStr.match(/[\\s\\S]/g)!.map((ch) => ch.charCodeAt(0))); // ciphertext as Uint8Array\n  const plainBuffer = await crypto.subtle.decrypt(alg, key, ctUint8); // decrypt ciphertext using key\n  const plaintext = new TextDecoder().decode(plainBuffer); // decode password from UTF-8\n\n  return plaintext.split(',');\n}\n\nexport async function getMnemonic(accountId: string, password: string, account: ApiAccountWithMnemonic) {\n  const sensitiveData = [password];\n\n  try {\n    const { mnemonicEncrypted } = account;\n    sensitiveData.push(mnemonicEncrypted);\n\n    const mnemonic = await decryptMnemonic(mnemonicEncrypted, password);\n    sensitiveData.push(...mnemonic);\n\n    if (!mnemonicEncrypted.includes(':')) {\n      await tryMigratingMnemonicEncryption(accountId, mnemonic, password);\n    }\n\n    return mnemonic;\n  } catch (err) {\n    logDebugError('getMnemonic', removeSensitiveDataFromError(err, sensitiveData));\n\n    return undefined;\n  }\n}\n\nfunction removeSensitiveDataFromError(error: unknown, sensitiveData: string[]) {\n  const removeFromString = (text: string) => {\n    for (const toRemove of sensitiveData) {\n      text = text.replaceAll(toRemove, '(hidden)');\n    }\n    return text;\n  };\n\n  if (typeof error === 'string') {\n    return removeFromString(error);\n  }\n\n  if (error instanceof Error) {\n    const message = removeFromString(error.message);\n    return {\n      name: error.name,\n      message,\n      stack: error.stack?.replaceAll(error.message, message),\n    };\n  }\n\n  return error;\n}\n","/* eslint-disable @stylistic/max-len, no-misleading-character-class, no-control-regex, @stylistic/operator-linebreak */\n/** @copyright Mathias Bynens <https://mathiasbynens.be/>. MIT license. */\nconst RE_SYMBOL_WITH_COMBINING_MARKS =\n  /([\\0-\\u02FF\\u0370-\\u1AAF\\u1B00-\\u1DBF\\u1E00-\\u20CF\\u2100-\\uD7FF\\uE000-\\uFE1F\\uFE30-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF])([\\u0300-\\u036F\\u1AB0-\\u1AFF\\u1DC0-\\u1DFF\\u20D0-\\u20FF\\uFE20-\\uFE2F]+)/g;\n/** @copyright Mathias Bynens <https://mathiasbynens.be/>. MIT license. */\nconst RE_LINEBREAK_COMBINING_MARKS =\n  /[\\0-\\x08\\x0E-\\x1F\\x7F-\\x84\\x86-\\x9F\\u0300-\\u034E\\u0350-\\u035B\\u0363-\\u036F\\u0483-\\u0489\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u0610-\\u061A\\u061C\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7\\u06E8\\u06EA-\\u06ED\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\\u07EB-\\u07F3\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08D4-\\u08E1\\u08E3-\\u0903\\u093A-\\u093C\\u093E-\\u094F\\u0951-\\u0957\\u0962\\u0963\\u0981-\\u0983\\u09BC\\u09BE-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CD\\u09D7\\u09E2\\u09E3\\u0A01-\\u0A03\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A70\\u0A71\\u0A75\\u0A81-\\u0A83\\u0ABC\\u0ABE-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AE2\\u0AE3\\u0B01-\\u0B03\\u0B3C\\u0B3E-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B62\\u0B63\\u0B82\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD7\\u0C00-\\u0C03\\u0C3E-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C62\\u0C63\\u0C81-\\u0C83\\u0CBC\\u0CBE-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CE2\\u0CE3\\u0D01-\\u0D03\\u0D3E-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4D\\u0D57\\u0D62\\u0D63\\u0D82\\u0D83\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DF2\\u0DF3\\u0F18\\u0F19\\u0F35\\u0F37\\u0F39\\u0F3E\\u0F3F\\u0F71-\\u0F7E\\u0F80-\\u0F84\\u0F86\\u0F87\\u0F8D-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u135D-\\u135F\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u180B-\\u180D\\u1885\\u1886\\u18A9\\u1920-\\u192B\\u1930-\\u193B\\u1A17-\\u1A1B\\u1A7F\\u1AB0-\\u1ABE\\u1B00-\\u1B04\\u1B34-\\u1B44\\u1B6B-\\u1B73\\u1B80-\\u1B82\\u1BA1-\\u1BAD\\u1BE6-\\u1BF3\\u1C24-\\u1C37\\u1CD0-\\u1CD2\\u1CD4-\\u1CE8\\u1CED\\u1CF2-\\u1CF4\\u1CF8\\u1CF9\\u1DC0-\\u1DF5\\u1DFB-\\u1DFF\\u200C\\u200E\\u200F\\u202A-\\u202E\\u2066-\\u206F\\u20D0-\\u20F0\\u2CEF-\\u2CF1\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302F\\u3035\\u3099\\u309A\\uA66F-\\uA672\\uA674-\\uA67D\\uA69E\\uA69F\\uA6F0\\uA6F1\\uA802\\uA806\\uA80B\\uA823-\\uA827\\uA880\\uA881\\uA8B4-\\uA8C5\\uA8E0-\\uA8F1\\uA926-\\uA92D\\uA947-\\uA953\\uA980-\\uA983\\uA9B3-\\uA9C0\\uAA29-\\uAA36\\uAA43\\uAA4C\\uAA4D\\uAAEB-\\uAAEF\\uAAF5\\uAAF6\\uABE3-\\uABEA\\uABEC\\uABED\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFFF9-\\uFFFB]|\\uD800[\\uDDFD\\uDEE0\\uDF76-\\uDF7A]|\\uD802[\\uDE01-\\uDE03\\uDE05\\uDE06\\uDE0C-\\uDE0F\\uDE38-\\uDE3A\\uDE3F\\uDEE5\\uDEE6]|\\uD804[\\uDC00-\\uDC02\\uDC38-\\uDC46\\uDC7F-\\uDC82\\uDCB0-\\uDCBA\\uDD00-\\uDD02\\uDD27-\\uDD34\\uDD73\\uDD80-\\uDD82\\uDDB3-\\uDDC0\\uDDCA-\\uDDCC\\uDE2C-\\uDE37\\uDE3E\\uDEDF-\\uDEEA\\uDF00-\\uDF03\\uDF3C\\uDF3E-\\uDF44\\uDF47\\uDF48\\uDF4B-\\uDF4D\\uDF57\\uDF62\\uDF63\\uDF66-\\uDF6C\\uDF70-\\uDF74]|\\uD805[\\uDC35-\\uDC46\\uDCB0-\\uDCC3\\uDDAF-\\uDDB5\\uDDB8-\\uDDC0\\uDDDC\\uDDDD\\uDE30-\\uDE40\\uDEAB-\\uDEB7]|\\uD807[\\uDC2F-\\uDC36\\uDC38-\\uDC3F\\uDC92-\\uDCA7\\uDCA9-\\uDCB6]|\\uD81A[\\uDEF0-\\uDEF4\\uDF30-\\uDF36]|\\uD81B[\\uDF51-\\uDF7E\\uDF8F-\\uDF92]|\\uD82F[\\uDC9D\\uDC9E\\uDCA0-\\uDCA3]|\\uD834[\\uDD65-\\uDD69\\uDD6D-\\uDD82\\uDD85-\\uDD8B\\uDDAA-\\uDDAD\\uDE42-\\uDE44]|\\uD836[\\uDE00-\\uDE36\\uDE3B-\\uDE6C\\uDE75\\uDE84\\uDE9B-\\uDE9F\\uDEA1-\\uDEAF]|\\uD838[\\uDC00-\\uDC06\\uDC08-\\uDC18\\uDC1B-\\uDC21\\uDC23\\uDC24\\uDC26-\\uDC2A]|\\uD83A[\\uDCD0-\\uDCD6\\uDD44-\\uDD4A]|\\uDB40[\\uDC01\\uDC20-\\uDC7F\\uDD00-\\uDDEF]/g;\nconst RE_SPACE_CHARS = /[\\n\\r]/g;\nconst RE_FAKE_DOTS = /[\\u0702\\u0701\\u2024\\u00B7\\u02D9\\u0971\\u1427\\u18DF\\u22C5\\u2027]/g;\nconst RE_EMPTY_CHARS = /[\\u200B-\\u200D\\uFEFF\\u2063]/g;\n/* eslint-enable @stylistic/max-len, no-misleading-character-class, no-control-regex, @stylistic/operator-linebreak */\n\n/** Skippable characters that are not confusables */\nexport const checkLNPRegex = /^(?:[~`!@#%^&*(){}[\\];:\"'<,.>?/\\\\|_+=-]|[a-zA-Z0-9\\s])+$/;\n\nexport function checkLNP(str: string) {\n  return checkLNPRegex.test(str);\n}\n\n/**\n * Utility function to call 2 other functions which remove Combining Marks/Invisible characters\n * @param str The text to clean.\n */\nexport function clean(str: string) {\n  return str\n    .replace(RE_LINEBREAK_COMBINING_MARKS, '')\n    .replace(RE_SYMBOL_WITH_COMBINING_MARKS, '$1')\n    .replace(RE_SPACE_CHARS, ' ')\n    .replace(RE_FAKE_DOTS, '.')\n    .replace(RE_EMPTY_CHARS, '');\n}\n","export const characters = new Map<string, string>([\n  [' ', ' '],\n  ['0', '⓿'],\n  ['1', '11⓵➊⑴¹𝟏𝟙１𝟷𝟣⒈𝟭1➀₁①❶⥠'],\n  ['2', '⓶⒉⑵➋ƻ²ᒿ𝟚２𝟮𝟤ᒾ𝟸Ƨ𝟐②ᴤ₂➁❷ᘝƨ'],\n  ['3', '³ȝჳⳌꞫ𝟑ℨ𝟛𝟯𝟥Ꝫ➌ЗȜ⓷ӠƷ３𝟹⑶⒊ʒʓǯǮƺ𝕴ᶾзᦡ➂③₃ᶚᴣᴟ❸ҘҙӬӡӭӟӞ'],\n  ['4', '𝟰𝟺𝟦𝟒➍ҶᏎ𝟜ҷ⓸ҸҹӴӵᶣ４чㄩ⁴➃₄④❹Ӌ⑷⒋'],\n  ['5', '𝟱⓹➎Ƽ𝟓𝟻𝟝𝟧５➄₅⑤⁵❺ƽ⑸⒌'],\n  ['6', 'Ⳓ🄇𝟼Ꮾ𝟲𝟞𝟨𝟔➏⓺Ϭϭ⁶б６ᧈ⑥➅₆❻⑹⒍'],\n  ['7', '𝟕𝟟𝟩𝟳𝟽🄈⓻𐓒➐７⁷⑦₇❼➆⑺⒎'],\n  ['8', '𐌚🄉➑⓼８𝟠𝟪৪⁸₈𝟴➇⑧❽𝟾𝟖⑻⒏'],\n  ['9', '൭Ꝯ𝝑𝞋𝟅🄊𝟡𝟵Ⳋ⓽➒੧৭୨９𝟫𝟿𝟗⁹₉Գ➈⑨❾⑼⒐'],\n  ['10', '⓾❿➉➓🔟⑩⑽⒑'],\n  ['11', '⑪⑾⒒⓫'],\n  ['12', '⑫⑿⒓⓬'],\n  ['13', '⑬⒀⒔⓭'],\n  ['14', '⑭⒁⒕⓮'],\n  ['15', '⑮⒂⒖⓯'],\n  ['16', '⑯⒃⒗⓰'],\n  ['17', '⑰⒄⒘⓱'],\n  ['18', '⑱⒅⒙⓲'],\n  ['19', '⑲⒆⒚⓳'],\n  ['20', '⑳⒇⒛⓴'],\n  ['ae', 'æ'],\n  ['OE', 'Œ'],\n  ['oe', 'œ'],\n  ['pi', 'ᒆ'],\n  ['Nj', 'ǋ'],\n  ['AE', 'ᴁ'],\n  ['A', '𝑨𝔄ᗄ𝖠𝗔ꓯ𝞐🄐🄰Ꭿ𐊠𝕬𝜜𝐴ꓮᎪ𝚨ꭺ𝝖🅐Å∀🇦₳🅰𝒜𝘈𝐀𝔸дǺᗅⒶＡΑᾋᗩĂÃÅǍȀȂĀȺĄʌΛλƛᴀᴬДАልÄₐᕱªǞӒΆẠẢẦẨẬẮẰẲẴẶᾸᾹᾺΆᾼᾈᾉᾊᾌᾍᾎᾏἈἉἊἋἌἍἎἏḀȦǠӐÀÁÂẤẪ𝛢𝓐𝙰𝘼ᗩ'],\n  ['a', '∂⍺ⓐձǟᵃᶏ⒜аɒａαȃȁคǎმäɑāɐąᾄẚạảǡầẵḁȧӑӓãåάὰάăẩằẳặᾀᾁᾂᾃᾅᾆᾰᾱᾲᾳᾴᶐᾶᾷἀἁἂἃἄἅἆἇᾇậắàáâấẫǻⱥ𝐚𝑎𝒂𝒶𝓪𝔞𝕒𝖆𝖺𝗮𝘢𝙖𝚊𝛂𝛼𝜶𝝰𝞪⍶'],\n  ['B', '🄑𝔙𝖁ꞵ𝛃𝛽𝜷𝝱𝞫Ᏸ𐌁𝑩𝕭🄱𐊡𝖡𝘽ꓐ𝗕𝘉𝜝𐊂𝚩𝐁𝛣𝝗𝐵𝙱𝔹Ᏼᏼ𝞑Ꞵ𝔅🅑฿𝓑ᗿᗾᗽ🅱ⒷＢвϐᗷƁ乃ßცჩ๖βɮБՅ๒ᙖʙᴮᵇጌḄℬΒВẞḂḆɃദᗹᗸᵝᙞᙟᙝᛒᙗᙘᴃ🇧'],\n  ['b', 'ꮟᏏ𝐛𝘣𝒷𝔟𝓫𝖇𝖻𝑏𝙗𝕓𝒃𝗯𝚋♭ᑳᒈｂᖚᕹᕺⓑḃḅҍъḇƃɓƅᖯƄЬᑲþƂ⒝ЪᶀᑿᒀᒂᒁᑾьƀҌѢѣᔎ'],\n  ['C', 'ꞆႠ℃🄒ᏟⲤ🄲ꓚ𐊢𐌂🅲𐐕🅒☾ČÇⒸＣↃƇᑕㄈ¢८↻ĈϾՇȻᙅᶜ⒞ĆҀĊ©टƆℂℭϹС匚ḈҪʗᑖᑡᑢᑣᑤᑥⅭ𝐂𝐶𝑪𝒞𝓒𝕮𝖢𝗖𝘊𝘾ᔍ'],\n  ['c', '🝌ｃⅽ𝐜𝑐𝒄𝒸𝓬𝔠𝕔𝖈𝖼𝗰𝘤𝙘𝚌ᴄϲⲥсꮯ𐐽ⲥ𐐽ꮯĉｃⓒćčċçҁƈḉȼↄсርᴄϲҫ꒝ςɽϛ𝙲ᑦ᧚𝐜𝑐𝒄𝒸𝓬𝔠𝕔𝖈𝖼𝗰𝘤𝙘𝚌₵🇨ᥴᒼⅽ'],\n  ['D', '🄓Ꭰ🄳𝔡𝖉𝔻𝗗𝘋𝙳𝐷𝓓𝐃𝑫𝕯𝖣𝔇𝘿ꭰⅅ𝒟ꓓ🅳🅓ⒹＤƉᗪƊÐԺᴅᴰↁḊĐÞⅮᗞᑯĎḌḐḒḎᗫᗬᗟᗠᶛᴆ🇩'],\n  ['d', 'Ꮷ𝔡𝖉ᑯꓒ𝓭ᵭ₫ԃⓓｄḋďḍḑḓḏđƌɖɗᵈ⒟ԁⅾᶁԀᑺᑻᑼᑽᒄᑰᑱᶑ𝕕𝖽𝑑𝘥𝒅𝙙𝐝𝗱𝚍ⅆ𝒹ʠժ'],\n  ['E', '£ᙓ⋿∃ⴺꓱ𝐄𝐸𝔈𝕰𝖤𝘌𝙴𝛦𝜠ꭼ🄔🄴𝙀𝔼𐊆𝚬ꓰ𝝚𝞔𝓔𝑬𝗘🅴🅔ⒺΈＥƎἝᕮƐモЄᴇᴱᵉÉ乇ЁɆꂅ€ÈℰΕЕⴹᎬĒĔĖĘĚÊËԐỀẾỄỂẼḔḖẺȄȆẸỆȨḜḘḚἘἙἚἛἜῈΈӖὲέЀϵ🇪'],\n  ['e', 'əәⅇꬲꞓ⋴𝛆𝛜𝜀𝜖𝜺𝝐𝝴𝞊𝞮𝟄ⲉꮛ𐐩ꞒⲈ⍷𝑒𝓮𝕖𝖊𝘦𝗲𝚎𝙚𝒆𝔢𝖾𝐞Ҿҿⓔｅ⒠èᧉéᶒêɘἔềếễ૯ǝєεēҽɛểẽḕḗĕėëẻěȅȇẹệȩɇₑęḝḙḛ℮еԑѐӗᥱёἐἑἒἓἕℯ'],\n  ['F', 'ᖵꘘꓞꟻᖷ𝐅𝐹𝑭𝔽𝕱𝖥𝗙𝙁𝙵𝟊℉🄕🄵𐊇𝔉𝘍𐊥ꓝꞘ🅵🅕𝓕ⒻＦғҒᖴƑԲϝቻḞℱϜ₣🇫Ⅎ'],\n  ['f', '𝐟ᵮ𝑓𝒇𝒻𝓯𝔣𝕗𝖿𝗳𝙛𝚏ꬵꞙẝ𝖋ⓕｆƒḟʃբᶠ⒡ſꊰʄ∱ᶂ𝘧'],\n  ['G', '𝗚𝘎🄖ꓖᏳ🄶Ꮐᏻ𝔾𝓖𝑮𝕲ꮐ𝒢𝙂𝖦𝙶𝔊𝐺𝐆🅶🅖ⒼＧɢƓʛĢᘜᴳǴĠԌĜḠĞǦǤԍ₲🇬⅁'],\n  ['g', 'ᶃᶢⓖｇǵĝḡğġǧģց૭ǥɠﻭﻮᵍ⒢ℊɡᧁ𝐠𝑔𝒈𝓰𝔤𝕘𝖌𝗀𝗴𝘨𝙜𝚐'],\n  ['H', 'Ἤ🄗𝆦🄷𝜢ꓧ𝘏𝐻𝝜𝖧𐋏𝗛ꮋℍᎻℌⲎ𝑯𝞖🅷🅗ዞǶԋⒽＨĤᚺḢḦȞḤḨḪĦⱧҢңҤῊΉῌἨἩἪἫἭἮἯᾘᾙᾚᾛᾜᾝᾞᾟӉӈҥΉн卄♓𝓗ℋН𝐇𝙃𝙷ʜ𝛨Η𝚮ᕼӇᴴᵸ🇭'],\n  ['h', 'ꞕ৸𝕳ꚕᏲℏӊԊꜧᏂҺ⒣ђⓗｈĥḣḧȟḥḩḫẖħⱨհһከኩኪካɦℎ𝐡𝒉𝒽𝓱𝔥𝕙𝖍𝗁𝗵𝘩𝙝𝚑իʰᑋᗁɧんɥ'],\n  ['I', 'ⲒἿ🄘🄸ЇꀤᏆ🅸🅘إﺇٳأﺃٲٵⒾＩ៸ÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗェエῘῙῚΊἸἹἺἻἼἽἾⅠΪΊɪᶦᑊᥣ𝛪𝐈𝙄𝙸𝓵𝙡𝐼ᴵ𝚰𝑰🇮'],\n  ['i', '⍳ℹⅈ𝑖𝒊𝒾ı𝚤ɩιιͺ𝛊𝜄𝜾𝞲ꙇӏꭵᎥⓘｉìíîĩīĭïḯỉǐȉȋịḭῐῑῒΐῖῗἰἱἲⅰⅼ∣ⵏ￨׀ا١۱ߊᛁἳἴἵɨіὶίᶖ𝔦𝚒𝝸𝗂𝐢𝕚𝖎𝗶𝘪𝙞ίⁱᵢ𝓲⒤'],\n  ['J', '𝐉𝐽𝑱𝒥𝓙𝔍𝕁𝕵𝖩𝗝𝘑𝙅𝙹ꞲͿꓙ🄙🄹🅹🅙ⒿＪЈʝᒍנﾌĴʆวلյʖᴊᴶﻝጋɈⱼՂๅႱįᎫȷ丿ℐℑᒘᒙᒚᒛᒴᒵᒎᒏ🇯'],\n  ['j', '𝚥ꭻⅉⓙｊϳʲ⒥ɉĵǰјڶᶨ𝒿𝘫𝗷𝑗𝙟𝔧𝒋𝗃𝓳𝕛𝚓𝖏𝐣'],\n  ['K', '𝐊ꝄꝀ𝐾𝑲𝓚𝕶𝖪𝙺𝚱𝝟🄚𝗞🄺𝜥𝘒ꓗ𝙆𝕂Ⲕ𝔎𝛫Ꮶ𝞙𝒦🅺🅚₭ⓀＫĸḰќƘкҠκқҟӄʞҚКҡᴋᴷᵏ⒦ᛕЌጕḲΚKҜҝҞĶḴǨⱩϗӃ🇰'],\n  ['k', 'ⓚꝁｋḱǩḳķḵƙⱪᶄ𝐤𝘬𝗄𝕜𝜅𝜘𝜿𝝒𝝹𝞌𝞳𝙠𝚔𝑘𝒌ϰ𝛋𝛞𝟆𝗸𝓴𝓀'],\n  ['L', '𝐋𝐿𝔏𝕃𝕷𝖫𝗟𝘓𝙇ﴼ🄛🄻𐐛Ⳑ𝑳𝙻𐑃𝓛ⳑꮮᏞꓡ🅻🅛ﺈ└ⓁւＬĿᒪ乚ՆʟꓶιԼᴸˡĹረḶₗΓլĻᄂⅬℒⱢᥧᥨᒻᒶᒷᶫﺎᒺᒹᒸᒫ⎳ㄥŁⱠﺄȽ🇱'],\n  ['l', 'ⓛｌŀĺľḷḹļӀℓḽḻłﾚɭƚɫⱡ|Ɩ⒧ʅǀוןΙІ｜ᶩӏ𝓘𝕀𝖨𝗜𝘐𝐥𝑙𝒍𝓁𝔩𝕝𝖑𝗅𝗹𝘭𝚕𝜤𝝞ı𝚤ɩι𝛊𝜄𝜾𝞲'],\n  ['M', 'ꮇ🄜🄼𐌑𐊰ꓟⲘᎷ🅼🅜ⓂＭмṂ൱ᗰ州ᘻო๓♏ʍᙏᴍᴹᵐ⒨ḾМṀ௱ⅯℳΜϺᛖӍӎ𝐌𝑀𝑴𝓜𝔐𝕄𝕸𝖬𝗠𝘔𝙈𝙼𝚳𝛭𝜧𝝡𝞛🇲'],\n  ['m', '₥ᵯ𝖒𝐦𝗆𝔪𝕞𝓂ⓜｍനᙢ൩ḿṁⅿϻṃጠɱ៳ᶆ𝙢𝓶𝚖𝑚𝗺᧕᧗'],\n  ['N', '𝇙𝇚𝇜🄝𝆧𝙉🄽ℕꓠ𝛮𝝢𝙽𝚴𝑵𝑁Ⲛ𝐍𝒩𝞜𝗡𝘕𝜨𝓝𝖭🅽₦🅝ЙЍⓃҋ៷ＮᴎɴƝᑎ几иՈռИהЛπᴺᶰŃ刀ክṄⁿÑПΝᴨոϖǸŇṆŅṊṈทŊӢӣӤӥћѝйᥢҊᴻ🇳'],\n  ['n', 'ոռח𝒏𝓷𝙣𝑛𝖓𝔫𝗇𝚗𝗻ᥒⓝήｎǹᴒńñᾗηṅňṇɲņṋṉղຖՌƞŋ⒩ภกɳпŉлԉȠἠἡῃդᾐᾑᾒᾓᾔᾕᾖῄῆῇῂἢἣἤἥἦἧὴήበቡቢባቤብቦȵ𝛈𝜂𝜼𝝶𝞰𝕟𝘯𝐧𝓃ᶇᵰᥥ∩'],\n  [\n    'O',\n    // eslint-disable-next-line @stylistic/max-len\n    '𝜽⭘🔿ꭴ⭕⏺🄁🄀Ꭴ𝚯𝚹𝛩𝛳𝜣𝜭𝝝𝝧𝞗𝞡ⴱᎾᏫ⍬𝞱𝝷𝛉𝟎𝜃θ𝟘𝑂𝑶𝓞𝔒𝕆𝕺𝗢𝘖𝙊𝛰㈇ꄲ🄞🔾🄾𐊒𝟬ꓳⲞ𐐄𐊫𐓂𝞞🅞⍥◯ⵁ⊖０⊝𝝤Ѳϴ𝚶𝜪ѺӦӨӪΌʘ𝐎ǑÒŎÓÔÕȌȎㇿ❍ⓄＯὋロ❤૦⊕ØФԾΘƠᴼᵒ⒪ŐÖₒ¤◊Φ〇ΟОՕଠഠ௦סỒỐỖỔṌȬṎŌṐṒȮȰȪỎỜỚỠỞỢỌỘǪǬǾƟⵔ߀៰⍜⎔⎕⦰⦱⦲⦳⦴⦵⦶⦷⦸⦹⦺⦻⦼⦽⦾⦿⧀⧁⧂⧃ὈὉὊὌὍ',\n  ],\n  [\n    'o',\n    // eslint-disable-next-line @stylistic/max-len\n    'ంಂംං૦௦۵ℴ𝑜𝒐𝖔ꬽ𝝄𝛔𝜎𝝈𝞂ჿ𝚘০୦ዐ𝛐𝗈𝞼ဝⲟ𝙤၀𐐬𝔬𐓪𝓸🇴⍤○ϙ🅾𝒪𝖮𝟢𝟶𝙾𝘰𝗼𝕠𝜊𝐨𝝾𝞸ᐤⓞѳ᧐ᥲðｏఠᦞՓòөӧóºōôǒȏŏồốȍỗổõσṍȭṏὄṑṓȯȫ๏ᴏőöѻоዐǭȱ০୦٥౦೦൦๐໐οօᴑ०੦ỏơờớỡởợọộǫøǿɵծὀὁόὸόὂὃὅ',\n  ],\n  ['P', '🄟🄿ꓑ𝚸𝙿𝞠𝙋ꮲⲢ𝒫𝝦𝑃𝑷𝗣𝐏𐊕𝜬𝘗𝓟𝖯𝛲Ꮲ🅟Ҏ🅿ⓅＰƤᑭ尸Ṗրφքᴘᴾᵖ⒫ṔｱקРየᴩⱣℙΡῬᑸᑶᑷᑹᑬᑮ🇵₱'],\n  ['p', 'ⲣҏ℗ⓟｐṕṗƥᵽῥρрƿǷῤ⍴𝓹𝓅𝐩𝑝𝒑𝔭𝕡𝖕𝗉𝗽𝘱𝙥𝚙𝛒𝝆𝞺𝜌𝞀'],\n  ['Q', '🅀🄠Ꝗ🆀🅠ⓆＱℚⵕԚ𝐐𝑄𝑸𝒬𝓠𝚀𝘘𝙌𝖰𝕼𝔔𝗤🇶'],\n  ['q', '𝓆ꝗ𝗾ⓠｑգ⒬۹զᑫɋɊԛ𝗊𝑞𝘲𝕢𝚚𝒒𝖖𝐪𝔮𝓺𝙦'],\n  ['R', '℞🄡℟ꭱᏒ𐒴ꮢᎡꓣ🆁🅡ⓇＲᴙȒʀᖇя尺ŔЯરƦᴿዪṚɌʁℛℜℝṘŘȐṜŖṞⱤ𝐑𝑅𝑹𝓡𝕽𝖱𝗥𝘙𝙍𝚁ᚱ🇷ᴚ'],\n  ['r', '𝚛ꭇᣴℾ𝚪𝛤𝜞𝝘𝞒ⲄГᎱᒥꭈⲅꮁⓡｒŕṙřȑȓṛṝŗгՐɾᥬṟɍʳ⒭ɼѓᴦᶉ𝐫𝑟𝒓𝓇𝓻𝔯𝕣𝖗𝗋𝗿𝘳𝙧ᵲґᵣ'],\n  ['S', '🅂🄪🄢ꇙ𝓢𝗦Ꮪ𝒮Ꮥ𝚂𝐒ꓢ𝖲𝔖𝙎𐊖𝕾𐐠𝘚𝕊𝑆𝑺🆂🅢ⓈＳṨŞֆՏȘˢ⒮ЅṠŠŚṤŜṦṢടᔕᔖᔢᔡᔣᔤ'],\n  ['s', 'ᣵⓢꜱ𐑈ꮪｓśṥŝṡšṧʂṣṩѕşșȿᶊక𝐬𝑠𝒔𝓈𝓼𝔰𝕤𝖘𝗌𝘀𝘴𝙨𝚜ގ🇸'],\n  ['T', '🅃🄣七ፒ𝜯🆃𐌕𝚻𝛵𝕋𝕿𝑻𐊱𐊗𝖳𝙏🝨𝝩𝞣𝚃𝘛𝑇ꓔ⟙𝐓Ⲧ𝗧⊤𝔗Ꭲꭲ𝒯🅣⏇⏉ⓉＴтҬҭƬイŦԵτᴛᵀｲፕϮŤ⊥ƮΤТ下ṪṬȚŢṰṮ丅丁ᐪ𝛕𝜏𝝉𝞃𝞽𝓣ㄒ🇹ጥ'],\n  ['t', 'ⓣｔṫẗťṭțȶ੮էʇ†ţṱṯƭŧᵗ⒯ʈեƫ𝐭𝑡𝒕𝓉𝓽𝔱𝕥𝖙𝗍𝘁𝘵𝙩𝚝ナ'],\n  ['U', '🅄Џ🄤ሀꓴ𐓎꒤🆄🅤ŨŬŮᑗᑘǓǕǗǙⓊＵȖᑌ凵ƱմԱꓵЦŪՄƲᙀᵁᵘ⒰ŰપÜՍÙÚÛṸṺǛỦȔƯỪỨỮỬỰỤṲŲṶṴɄᥩᑧ∪ᘮ⋃𝐔𝑈𝑼𝒰𝓤𝔘𝕌𝖀𝖴𝗨𝘜𝙐𝚄🇺'],\n  ['u', '𝘂𝘶𝙪𝚞ꞟꭎꭒ𝛖𝜐𝝊𝞄𝞾𐓶ὺύⓤｕùũūừṷṹŭǖữᥙǚǜὗυΰนսʊǘǔúůᴜűųยûṻцሁüᵾᵤµʋủȕȗưứửựụṳṵʉῠῡῢΰῦῧὐὑϋύὒὓὔὕὖᥔ𝐮𝑢𝒖𝓊𝓾𝔲𝕦𝖚𝗎ᶙ'],\n  ['V', '𝑉𝒱𝕍𝗩🄥🅅ꓦ𝑽𝖵𝘝Ꮩ𝚅𝙑𝐕🆅🅥ⓋＶᐯѴᵛ⒱۷ṾⅴⅤṼ٧ⴸѶᐺᐻ🇻𝓥'],\n  ['v', '∨⌄⋁ⅴ𝐯𝑣𝒗𝓋𝔳𝕧𝖛𝗏ꮩሀⓥｖ𝜐𝝊ṽṿ౮งѵעᴠνטᵥѷ៴ᘁ𝙫𝚟𝛎𝜈𝝂𝝼𝞶𝘷𝘃𝓿'],\n  ['W', '𝐖𝑊𝓦𝔚𝕎𝖂𝖶𝗪𝙒𝚆🄦🅆ᏔᎳ𝑾ꓪ𝒲𝘞🆆Ⓦ🅦ｗＷẂᾧᗯᥕ山ѠຟచաЩШώщฬшᙎᵂʷ⒲ฝሠẄԜẀŴẆẈധᘺѿᙡƜ₩🇼'],\n  ['w', '𝐰ꝡ𝑤𝒘𝓌𝔀𝔴𝕨𝖜𝗐𝘄𝘸𝙬𝚠աẁꮃẃⓦ⍵ŵẇẅẘẉⱳὼὠὡὢὣωὤὥὦὧῲῳῴῶῷⱲѡԝᴡώᾠᾡᾢᾣᾤᾥᾦɯ𝝕𝟉𝞏'],\n  ['X', 'ꭓꭕ𝛘𝜒𝝌𝞆𝟀ⲭ🞨𝑿𝛸🄧🞩🞪🅇🞫🞬𐌗Ⲭꓫ𝖃𝞦𝘟𐊐𝚾𝝬𝜲Ꭓ𐌢𝖷𝑋𝕏𝔛𐊴𝗫🆇🅧❌Ⓧ𝓧ＸẊ᙭χㄨ𝒳ӾჯӼҳЖΧҲᵡˣ⒳אሸẌꊼⅩХ╳᙮ᕁᕽⅹᚷⵝ𝙓𝚇乂𝐗🇽'],\n  ['x', '᙮ⅹ𝑥𝒙𝓍𝔵𝕩𝖝𝗑𝘅ᕁᕽⓧｘхẋ×ₓ⤫⤬⨯ẍᶍ𝙭ӽ𝘹𝐱𝚡⨰ﾒ𝔁'],\n  ['Y', '𝒴🄨𝓨𝔜𝖄𝖸𝘠𝙔𝚼𝛶𝝪𝞤УᎩᎽⲨ𝚈𝑌𝗬𝐘ꓬ𝒀𝜰𐊲🆈🅨ⓎＹὛƳㄚʏ⅄ϔ￥¥ՎϓγץӲЧЎሃŸɎϤΥϒҮỲÝŶỸȲẎỶỴῨῩῪΎὙὝὟΫΎӮӰҰұ𝕐🇾'],\n  ['y', '𝐲𝑦𝒚𝓎𝔂𝔶𝕪𝖞𝗒𝘆𝘺𝙮𝚢ʏỿꭚγℽ𝛄𝛾𝜸𝝲𝞬🅈ᎽᎩⓨｙỳýŷỹȳẏÿỷуყẙỵƴɏᵞɣʸᶌү⒴ӳӱӯўУʎ'],\n  ['Z', '🄩🅉ꓜ𝗭𝐙☡Ꮓ𝘡🆉🅩ⓏＺẔƵ乙ẐȤᶻ⒵ŹℤΖŻŽẒⱫ🇿'],\n  ['z', '𝑍𝒁𝒵𝓩𝖹𝙕𝚉𝚭𝛧𝜡𝝛𝞕ᵶꮓ𝐳𝑧𝒛𝓏𝔃𝔷𝕫𝖟𝗓𝘇𝘻𝙯𝚣ⓩｚźẑżžẓẕƶȥɀᴢጊʐⱬᶎʑᙆ'],\n]);\n","// Original repo: https://github.com/gc/confusables\n\nimport { checkLNP, clean } from './util';\nimport { characters } from './characters';\n\nconst alphabetMap = new Map<string, string[]>();\nconst confusablesMap = new Map<string, string>();\n\nfor (const [base, alts] of characters.entries()) {\n  alphabetMap.set(base, [...alts]);\n\n  for (const char of alts) {\n    confusablesMap.set(char, base);\n  }\n}\n\nexport function cleanText(str: string) {\n  if (checkLNP(str)) return str;\n\n  let newStr = '';\n\n  for (const char of clean(str)) {\n    newStr += confusablesMap.get(char) || char;\n  }\n\n  return newStr;\n}\n","import { APP_ENV, APP_VERSION, BRILLIANT_API_BASE_URL } from '../../config';\nimport { fetchJson, fetchWithRetry, handleFetchErrors } from '../../util/fetch';\nimport { getEnvironment } from '../environment';\n\nconst BAD_REQUEST_CODE = 400;\n\nexport async function callBackendPost<T>(path: string, data: AnyLiteral, options?: {\n  authToken?: string;\n  isAllowBadRequest?: boolean;\n  method?: string;\n  shouldRetry?: boolean;\n  retries?: number;\n  timeouts?: number | number[];\n}): Promise<T> {\n  const {\n    authToken, isAllowBadRequest, method, shouldRetry, retries, timeouts,\n  } = options ?? {};\n\n  const url = new URL(`${BRILLIANT_API_BASE_URL}${path}`);\n\n  const init: RequestInit = {\n    method: method ?? 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      ...getBackendHeaders(),\n      ...(authToken && { 'X-Auth-Token': authToken }),\n    },\n    body: JSON.stringify(data),\n  };\n\n  const response = shouldRetry\n    ? await fetchWithRetry(url, init, {\n      retries,\n      timeouts,\n      shouldSkipRetryFn: (message) => !message?.includes('signal is aborted'),\n    })\n    : await fetch(url.toString(), init);\n\n  await handleFetchErrors(response, isAllowBadRequest ? [BAD_REQUEST_CODE] : undefined);\n\n  return response.json();\n}\n\nexport function callBackendGet<T = any>(path: string, data?: AnyLiteral, headers?: HeadersInit): Promise<T> {\n  const url = new URL(`${BRILLIANT_API_BASE_URL}${path}`);\n\n  return fetchJson(url, data, {\n    headers: {\n      ...headers,\n      ...getBackendHeaders(),\n    },\n  });\n}\n\nexport function getBackendHeaders() {\n  return {\n    ...getEnvironment().apiHeaders,\n    'X-App-Version': APP_VERSION,\n    'X-App-Env': APP_ENV,\n  } as Record<string, string>;\n}\n\nexport function addBackendHeadersToSocketUrl(url: URL) {\n  for (const [name, value] of Object.entries(getBackendHeaders())) {\n    const match = /^X-App-(.+)$/i.exec(name);\n    if (match) {\n      url.searchParams.append(match[1].toLowerCase(), value);\n    }\n  }\n}\n","import type { ApiAddressInfo, ApiKnownAddresses, ApiNftSuperCollection } from '../types';\n\nimport { RE_LINK_TEMPLATE, RE_TG_BOT_MENTION } from '../../config';\nimport { cleanText } from '../../lib/confusables';\nimport Deferred from '../../util/Deferred';\nimport { logDebugError } from '../../util/logs';\nimport { callBackendGet } from './backend';\n\nlet knownAddresses: ApiKnownAddresses = {};\nlet scamMarkers: RegExp[] = [];\nlet trustedSites = new Set<string>();\nlet trustedCollections = new Set<string>();\nlet tonNftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection> = {};\nconst nftSuperCollectionsDeferred = new Deferred();\n\nexport async function tryUpdateKnownAddresses() {\n  try {\n    const data = await callBackendGet<{\n      knownAddresses: Record<string, ApiKnownAddresses>;\n      scamMarkers: string[];\n      trustedSites: string[];\n      trustedCollections: string[];\n      tonNftSuperCollections: (ApiNftSuperCollection & { collections: string[] })[];\n    }>('/known-addresses');\n\n    knownAddresses = data.knownAddresses;\n    scamMarkers = data.scamMarkers.map((x) => new RegExp(x, 'i'));\n    trustedSites = new Set(data.trustedSites);\n    trustedCollections = new Set(data.trustedCollections);\n    tonNftSuperCollectionsByCollectionAddress = data.tonNftSuperCollections.reduce((acc, superCollection) => {\n      const { collections, ...rest } = superCollection;\n\n      collections.forEach((address) => {\n        acc[address] = rest;\n      });\n\n      return acc;\n    }, {} as Record<string, ApiNftSuperCollection>);\n    nftSuperCollectionsDeferred.resolve();\n  } catch (err) {\n    logDebugError('tryUpdateKnownAddresses', err);\n  }\n}\n\nexport function getKnownAddresses() {\n  return knownAddresses;\n}\n\nexport async function getNftSuperCollectionsByCollectionAddress() {\n  await nftSuperCollectionsDeferred.promise;\n\n  return tonNftSuperCollectionsByCollectionAddress;\n}\n\nexport function getScamMarkers() {\n  return scamMarkers;\n}\n\nexport function getKnownAddressInfo(address: string): ApiAddressInfo | undefined {\n  return knownAddresses[address];\n}\n\nexport function checkIsTrustedSite(domain: string) {\n  return trustedSites.has(domain.toLowerCase());\n}\n\nexport function checkIsTrustedCollection(address: string) {\n  return trustedCollections.has(address);\n}\n\nexport function checkHasScamLink(text: string) {\n  const matches = cleanText(text).matchAll(RE_LINK_TEMPLATE);\n\n  for (const match of matches) {\n    const host = match.groups?.host;\n    if (host && !checkIsTrustedSite(host)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexport function checkHasTelegramBotMention(text: string) {\n  return RE_TG_BOT_MENTION.test(cleanText(text));\n}\n","import type { ApiActivity } from '../api/types';\n\nimport { getIsActivityPending } from './activities';\n\nexport function compareActivities(a: ApiActivity, b: ApiActivity, isAsc = false) {\n  // The activity sorting is tuned to match the Toncenter API sorting as close as possible.\n  // Putting the pending activities first, because when they get confirmed, their timestamp gets bigger than any current\n  // confirmed activity timestamp. This reduces the movement in the activity list.\n  let value = (getIsActivityPending(a) ? 1 : 0) - (getIsActivityPending(b) ? 1 : 0);\n  if (value === 0) {\n    value = a.timestamp - b.timestamp;\n    if (value === 0) {\n      value = a.id > b.id ? 1 : a.id < b.id ? -1 : 0;\n    }\n  }\n  return isAsc ? value : -value;\n}\n","import type { ApiActivity, ApiTransaction, ApiTransactionActivity, ApiTransactionType } from '../../api/types';\nimport type { LangFn } from '../langProvider';\n\nimport { ALL_STAKING_POOLS, BURN_ADDRESS } from '../../config';\nimport { compareActivities } from '../compareActivities';\nimport { extractKey, groupBy, unique } from '../iteratees';\nimport { getIsTransactionWithPoisoning } from '../poisoningHash';\n\ntype UnusualTxType = 'backend-swap' | 'local' | 'additional';\n\ntype TranslationTenses = [past: string, present: string, future: string];\n\nconst TRANSACTION_TYPE_TITLES: Partial<Record<ApiTransactionType & keyof any, TranslationTenses>> = {\n  stake: ['Staked', 'Staking', '$stake_action'],\n  unstake: ['Unstaked', 'Unstaking', '$unstake_action'],\n  unstakeRequest: ['Unstake Requested', 'Requesting Unstake', '$request_unstake_action'],\n  callContract: ['Contract Called', 'Calling Contract', '$call_contract_action'],\n  excess: ['Excess', 'Excess', 'Excess'],\n  contractDeploy: ['Contract Deployed', 'Deploying Contract', '$deploy_contract_action'],\n  bounced: ['Bounced', 'Bouncing', '$bounce_action'],\n  mint: ['Minted', 'Minting', '$mint_action'],\n  burn: ['Burned', 'Burning', '$burn_action'],\n  auctionBid: ['NFT Auction Bid', 'Bidding at NFT Auction', 'NFT Auction Bid'],\n  dnsChangeAddress: ['Address Updated', 'Updating Address', '$update_address_action'],\n  dnsChangeSite: ['Site Updated', 'Updating Site', '$update_site_action'],\n  dnsChangeSubdomains: ['Subdomains Updated', 'Updating Subdomains', '$update_subdomains_action'],\n  dnsChangeStorage: ['Storage Updated', 'Updating Storage', '$update_storage_action'],\n  dnsDelete: ['Domain Record Deleted', 'Deleting Domain Record', '$delete_domain_record_action'],\n  dnsRenew: ['Domain Renewed', 'Renewing Domain', '$renew_domain_action'],\n  liquidityDeposit: ['Liquidity Provided', 'Providing Liquidity', '$provide_liquidity_action'],\n  liquidityWithdraw: ['Liquidity Withdrawn', 'Withdrawing Liquidity', '$withdraw_liquidity_action'],\n};\n\nexport const STAKING_TRANSACTION_TYPES = new Set<ApiTransactionType | undefined>([\n  'stake', 'unstake', 'unstakeRequest',\n]);\n\nexport const DNS_TRANSACTION_TYPES = new Set<ApiTransactionType | undefined>([\n  'dnsChangeAddress', 'dnsChangeSite', 'dnsChangeStorage', 'dnsChangeSubdomains', 'dnsDelete', 'dnsRenew',\n]);\n\nexport function parseTxId(txId: string): {\n  hash: string;\n  subId?: string;\n  type?: UnusualTxType;\n} {\n  const [hash, subId, type] = txId.split(':') as [string, string | undefined, UnusualTxType | undefined];\n  return { hash, type, subId };\n}\n\nexport function getIsTxIdLocal(txId: string) {\n  return txId.endsWith(':local');\n}\n\nexport function getIsBackendSwapId(id: string) {\n  return id.endsWith(':backend-swap');\n}\n\nexport function buildBackendSwapId(backendId: string) {\n  return buildTxId(backendId, undefined, 'backend-swap');\n}\n\nexport function buildLocalTxId(hash: string, subId?: number) {\n  return buildTxId(hash, subId, 'local');\n}\n\nexport function buildTxId(hash: string, subId?: number | string, type?: UnusualTxType) {\n  if (!type && subId === undefined) return hash;\n  if (type === undefined) return `${hash}:${subId}`;\n  return `${hash}:${subId ?? ''}:${type}`;\n}\n\nexport function getActivityTokenSlugs(activity: ApiActivity): string[] {\n  switch (activity.kind) {\n    case 'transaction': {\n      if (activity.nft) return []; // We don't want NFT activities to get into any token activity list\n      return [activity.slug];\n    }\n    case 'swap': {\n      return [activity.from, activity.to];\n    }\n  }\n}\n\nexport function getIsActivitySuitableForFetchingTimestamp(activity: ApiActivity | undefined) {\n  return !!activity\n    && !getIsTxIdLocal(activity.id)\n    && !getIsBackendSwapId(activity.id)\n    && !getIsActivityPending(activity);\n}\n\nexport function getTransactionTitle(\n  { type, isIncoming, nft }: ApiTransaction,\n  tense: 'past' | 'present' | 'future',\n  translate: LangFn,\n) {\n  const tenseIndex = tense === 'past' ? 0 : tense === 'present' ? 1 : 2;\n  let titles: TranslationTenses;\n\n  if (type === 'nftTrade') {\n    titles = isIncoming\n      ? ['NFT Sold', 'Selling NFT', '$sell_nft_action']\n      : ['NFT Bought', 'Buying NFT', '$buy_nft_action'];\n  } else if (type && TRANSACTION_TYPE_TITLES[type]) {\n    titles = TRANSACTION_TYPE_TITLES[type];\n  } else {\n    titles = isIncoming\n      ? ['Received', 'Receiving', '$receive_action']\n      : ['Sent', 'Sending', '$send_action'];\n  }\n\n  let title = translate(titles[tenseIndex]);\n\n  if (nft && (!type || type === 'mint' || type === 'burn')) {\n    title += ' NFT';\n  }\n\n  return title;\n}\n\nexport function isScamTransaction(transaction: ApiTransaction) {\n  return Boolean(transaction.metadata?.isScam)\n    || (transaction.isIncoming && getIsTransactionWithPoisoning(transaction));\n}\n\nexport function shouldShowTransactionComment(transaction: ApiTransaction) {\n  return Boolean(transaction.comment || transaction.encryptedComment)\n    && !STAKING_TRANSACTION_TYPES.has(transaction.type)\n    && !isScamTransaction(transaction);\n}\n\nexport function getTransactionAmountDisplayMode({ type, amount, nft }: ApiTransaction) {\n  const isPlainTransfer = type === undefined && !nft;\n  if (!amount && !isPlainTransfer) {\n    return 'hide';\n  }\n  return type === 'stake' || type === 'unstake'\n    ? 'noSign'\n    : 'normal';\n}\n\n/** Returns the UI sections where the address should be shown */\nexport function shouldShowTransactionAddress(transaction: ApiTransactionActivity): ('list' | 'modal')[] {\n  const { type, isIncoming, nft, toAddress, fromAddress, extra } = transaction;\n\n  if (type === 'nftTrade') {\n    return extra?.marketplace ? ['list'] : [];\n  }\n\n  const shouldHide = isOurStakingTransaction(transaction)\n    || type === 'burn'\n    || (!isIncoming && nft && toAddress === nft.address)\n    || (isIncoming && type === 'excess' && fromAddress === BURN_ADDRESS);\n\n  return shouldHide ? [] : ['list', 'modal'];\n}\n\n/** \"Our\" is staking that can be controlled with MyTonWallet app */\nexport function isOurStakingTransaction({ type, isIncoming, toAddress, fromAddress }: ApiTransaction) {\n  return STAKING_TRANSACTION_TYPES.has(type) && ALL_STAKING_POOLS.includes(isIncoming ? fromAddress : toAddress);\n}\n\nexport function shouldShowTransactionAnnualYield(transaction: ApiTransaction) {\n  return transaction.type === 'stake' && isOurStakingTransaction(transaction);\n}\n\nexport function mergeActivitiesToMaxTime(array1: ApiActivity[], array2: ApiActivity[]) {\n  if (!array1.length && !array2.length) {\n    return [];\n  } else if (!array1.length && array2.length) {\n    return array2;\n  } else if (!array2.length && array1.length) {\n    return array1;\n  }\n\n  const fromTimestamp = Math.max(\n    array1[array1.length - 1].timestamp,\n    array2[array2.length - 1].timestamp,\n  );\n\n  return [...array1, ...array2]\n    .filter(({ timestamp }) => timestamp >= fromTimestamp)\n    .sort(compareActivities);\n}\n\nexport function mergeActivityIdsToMaxTime(array1: string[], array2: string[], byId: Record<string, ApiActivity>) {\n  if (!array1.length && !array2.length) {\n    return [];\n  } else if (!array1.length && array2.length) {\n    return array2;\n  } else if (!array2.length && array1.length) {\n    return array1;\n  }\n\n  const fromTimestamp = Math.max(\n    byId[array1[array1.length - 1]].timestamp,\n    byId[array2[array2.length - 1]].timestamp,\n  );\n\n  return unique([...array1, ...array2])\n    .filter((id) => byId[id].timestamp >= fromTimestamp)\n    .sort((a, b) => compareActivities(byId[a], byId[b]));\n}\n\nexport function getIsActivityWithHash(activity: ApiTransactionActivity) {\n  return !getIsTxIdLocal(activity.id) || !activity.extra?.withW5Gasless;\n}\n\nexport function getIsActivityPending(activity: ApiActivity) {\n  if (activity.kind === 'swap') {\n    // \"Pending\" is a blockchain term.\n    // CEX activities are never considered pending, because they are originated by the backend instead of the blockchains.\n    return !activity.cex && activity.status === 'pending';\n  } else {\n    return !!activity.isPending;\n  }\n}\n\n/**\n * Sometimes activity ids change. This function finds the new id withing `nextActivities` for each activity in\n * `prevActivities`. Currently only local and pending activity ids change, so it's enough to provide only such\n * activities in `prevActivities`.\n *\n * The ids should be unique within each input array. The returned map has previous activity ids as keys and next\n * activity ids as values. If the map has no value for a previous id, it means that there is no matching next activity.\n * The values may be not unique.\n */\nexport function getActivityIdReplacements(prevActivities: ApiActivity[], nextActivities: ApiActivity[]) {\n  // Each previous activity must fall into either of the groups, otherwise the resulting map will falsely miss previous ids\n  const prevLocalActivities: ApiActivity[] = [];\n  const prevChainActivities: ApiActivity[] = [];\n\n  for (const activity of prevActivities) {\n    const group = getIsTxIdLocal(activity.id) ? prevLocalActivities : prevChainActivities;\n    group.push(activity);\n  }\n\n  return {\n    ...getLocalActivityIdReplacements(prevLocalActivities, nextActivities),\n    ...getChainActivityIdReplacements(prevChainActivities, nextActivities),\n  };\n}\n\n/** Replaces local activity ids. See `getActivityIdReplacements` for more details. */\nfunction getLocalActivityIdReplacements(prevLocalActivities: ApiActivity[], nextActivities: ApiActivity[]) {\n  const idReplacements: Record<string, string> = {};\n\n  if (!prevLocalActivities.length) {\n    return idReplacements;\n  }\n\n  const nextActivityIds = new Set(extractKey(nextActivities, 'id'));\n  const nextChainActivities = nextActivities.filter((activity) => !getIsTxIdLocal(activity.id));\n\n  for (const localActivity of prevLocalActivities) {\n    const { id: prevId } = localActivity;\n\n    // Try a direct id match\n    if (nextActivityIds.has(prevId)) {\n      idReplacements[prevId] = prevId;\n      continue;\n    }\n\n    // Otherwise, try to find a match by a heuristic\n    const chainActivity = nextChainActivities.find((chainActivity) => {\n      return doesLocalActivityMatch(localActivity, chainActivity);\n    });\n    if (chainActivity) {\n      idReplacements[prevId] = chainActivity.id;\n    }\n\n    // Otherwise, there is no match\n  }\n\n  return idReplacements;\n}\n\n/** Replaces chain (i.e. not local) activity ids. See `getActivityIdReplacements` for more details. */\nfunction getChainActivityIdReplacements(prevActivities: ApiActivity[], nextActivities: ApiActivity[]) {\n  const idReplacements: Record<string, string> = {};\n\n  if (!prevActivities.length) {\n    return idReplacements;\n  }\n\n  const nextActivityIds = new Set(extractKey(nextActivities, 'id'));\n  const nextActivitiesByMessageHash = groupBy(nextActivities, 'externalMsgHashNorm');\n\n  for (const { id: prevId, externalMsgHashNorm } of prevActivities) {\n    // Try a direct id match\n    if (nextActivityIds.has(prevId)) {\n      idReplacements[prevId] = prevId;\n      continue;\n    }\n\n    // Otherwise, match by the message hash\n    if (externalMsgHashNorm) {\n      const nextSubActivities = nextActivitiesByMessageHash[externalMsgHashNorm];\n      if (nextSubActivities?.length) {\n        idReplacements[prevId] = nextSubActivities[0].id;\n\n        // Leaving 1 activity in each group to ensure there is a match for the further prev activities with the same hash\n        if (nextSubActivities.length > 1) {\n          nextSubActivities.shift();\n        }\n      }\n    }\n\n    // Otherwise, there is no match\n  }\n\n  return idReplacements;\n}\n\n/** Decides whether the local activity matches the activity from the blockchain */\nexport function doesLocalActivityMatch(localActivity: ApiActivity, chainActivity: ApiActivity) {\n  if (localActivity.extra?.withW5Gasless) {\n    if (localActivity.kind === 'transaction' && chainActivity.kind === 'transaction') {\n      return !chainActivity.isIncoming && localActivity.normalizedAddress === chainActivity.normalizedAddress\n        && localActivity.amount === chainActivity.amount\n        && localActivity.slug === chainActivity.slug;\n    } else if (localActivity.kind === 'swap' && chainActivity.kind === 'swap') {\n      return localActivity.from === chainActivity.from\n        && localActivity.to === chainActivity.to\n        && localActivity.fromAmount === chainActivity.fromAmount;\n    }\n  }\n\n  if (localActivity.externalMsgHashNorm) {\n    return localActivity.externalMsgHashNorm === chainActivity.externalMsgHashNorm && !chainActivity.shouldHide;\n  }\n\n  return parseTxId(localActivity.id).hash === parseTxId(chainActivity.id).hash;\n}\n","export function toMilliseconds(seconds: number) {\n  return seconds * 1000;\n}\n\nexport function toSeconds(ms: number) {\n  return Math.floor(ms / 1000);\n}\n","import type { ApiTransaction } from '../api/types';\n\nimport { TRANSACTION_ADDRESS_SHIFT } from '../config';\nimport { shortenAddress } from './shortenAddress';\n\nconst cache = new Map<string, {\n  timestamp: number;\n  amount: bigint;\n  address: string;\n}>();\n\nfunction getKey(address: string) {\n  return shortenAddress(address, TRANSACTION_ADDRESS_SHIFT)!;\n}\n\nfunction addToCache(address: string, amount: bigint, timestamp: number) {\n  const key = getKey(address);\n\n  cache.set(key, {\n    address,\n    amount,\n    timestamp,\n  });\n}\n\nfunction getFromCache(address: string) {\n  const key = getKey(address);\n\n  return cache.get(key);\n}\n\nexport function updatePoisoningCache(tx: ApiTransaction) {\n  const { fromAddress: address, amount, timestamp } = tx;\n\n  const cached = getFromCache(address);\n\n  if (!cached || cached.timestamp < timestamp || (cached.timestamp === timestamp && cached.amount > amount)) {\n    addToCache(address, amount, timestamp);\n  }\n}\n\nexport function getIsTransactionWithPoisoning(tx: ApiTransaction) {\n  const { fromAddress: address } = tx;\n\n  const cached = getFromCache(address);\n\n  return cached && cached.address !== address;\n}\n\nexport function clearPoisoningCache() {\n  cache.clear();\n}\n","export default function isEmptyObject(obj: object) {\n  return !isKeyCountGreater(obj, 0);\n}\n\nexport function isKeyCountGreater(obj: object, countToOutnumber: number) {\n  if (countToOutnumber < 0) return true;\n  let keyCount = 0;\n\n  for (const key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      keyCount++;\n      if (keyCount > countToOutnumber) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n","import type { Table, UpdateSpec } from 'dexie';\n\nconst IGNORED_DEXIE_ERRORS = new Set(['AbortError', 'BulkError', 'UnknownError']);\n\nasync function tryDbQuery<T>(cb: () => Promise<T>) {\n  try {\n    return await cb();\n  } catch (error: any) {\n    if (IGNORED_DEXIE_ERRORS.has(error?.name)) return undefined;\n    else throw error;\n  }\n}\n\nexport class DbRepository<T> {\n  table: Table<T>;\n\n  constructor(table: Table<T>) {\n    this.table = table;\n  }\n\n  all() {\n    return this.table.toArray();\n  }\n\n  find(where: Record<string, any>) {\n    return tryDbQuery(() => {\n      return this.table.where(where).toArray();\n    });\n  }\n\n  put(item: T) {\n    return tryDbQuery(() => {\n      return this.table.put(item);\n    });\n  }\n\n  bulkPut(items: T[]) {\n    return tryDbQuery(() => {\n      return this.table.bulkPut(items);\n    });\n  }\n\n  update(key: string[], update: UpdateSpec<T>) {\n    return tryDbQuery(() => {\n      return this.table.update(key, update);\n    });\n  }\n\n  delete(key: string[]) {\n    return tryDbQuery(() => {\n      return this.table.delete(key);\n    });\n  }\n\n  deleteWhere(where: Record<string, any>) {\n    return tryDbQuery(() => {\n      return this.table.where(where).delete();\n    });\n  }\n\n  clear() {\n    return tryDbQuery(() => {\n      return this.table.clear();\n    });\n  }\n}\n","import type { Table } from 'dexie';\nimport Dexie from 'dexie';\n\nimport type { ApiNft, ApiTokenWithPrice } from '../types';\n\nimport { DbRepository } from './repository';\n\nexport type ApiDbNft = ApiNft & {\n  accountId: string;\n  collectionAddress: string;\n};\n\nexport type ApiDbSseConnection = {\n  clientId: string;\n};\n\nconst DB_NANE = 'tables';\n\nexport class ApiDb extends Dexie {\n  nfts!: Table<ApiDbNft>;\n\n  tokens!: Table<ApiTokenWithPrice>;\n\n  constructor() {\n    super(DB_NANE);\n    this.version(1).stores({\n      nfts: '[accountId+address], accountId, address, collectionAddress',\n    });\n    this.version(2).stores({\n      sseConnections: '&clientId',\n    });\n    this.version(3).stores({\n      tokens: 'tokenAddress, chain, &slug',\n    });\n    this.version(4).upgrade((tx) => {\n      return tx.table('tokens').clear();\n    });\n    this.version(5).stores({\n      // eslint-disable-next-line no-null/no-null\n      nfts: null,\n      // eslint-disable-next-line no-null/no-null\n      sseConnections: null,\n    });\n  }\n}\n\nexport const apiDb = new ApiDb();\n\nexport const tokenRepository = new DbRepository(apiDb.tokens);\n","import type { ApiBaseCurrency, ApiChain, ApiTokenDetails, ApiTokenWithPrice, OnApiUpdate } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY, TOKEN_INFO } from '../../config';\nimport Deferred from '../../util/Deferred';\nimport { buildCollectionByKey, omitUndefined } from '../../util/iteratees';\nimport { tokenRepository } from '../db';\n\nexport const tokensPreload = new Deferred();\nconst tokensCache: {\n  baseCurrency: ApiBaseCurrency;\n  bySlug: Record<string, ApiTokenWithPrice>;\n} = {\n  baseCurrency: DEFAULT_PRICE_CURRENCY,\n  bySlug: { ...TOKEN_INFO },\n};\n\nexport async function loadTokensCache() {\n  const tokens = await tokenRepository.all();\n  await updateTokens(tokens);\n  tokensPreload.resolve();\n}\n\nexport async function updateTokens(\n  tokens: ApiTokenWithPrice[],\n  onUpdate?: OnApiUpdate,\n  tokenDetails?: ApiTokenDetails[],\n  baseCurrency?: ApiBaseCurrency,\n  shouldSendUpdate?: boolean,\n) {\n  const tokensForDb: ApiTokenWithPrice[] = [];\n  const detailsBySlug = buildCollectionByKey(tokenDetails ?? [], 'slug');\n\n  for (const { slug, ...details } of tokenDetails ?? []) {\n    const cachedToken = tokensCache.bySlug[slug] as ApiTokenWithPrice | undefined;\n    if (cachedToken) {\n      const token = { ...cachedToken, ...details };\n      tokensCache.bySlug[slug] = token;\n      tokensForDb.push(token);\n    }\n  }\n\n  for (const token of tokens) {\n    const { slug } = token;\n    const cachedToken = tokensCache.bySlug[slug] as ApiTokenWithPrice | undefined;\n    const mergedToken = mergeTokenWithCache(token, detailsBySlug, cachedToken);\n\n    if (!(token.slug in tokensCache)) {\n      shouldSendUpdate = true;\n    }\n\n    tokensCache.bySlug[token.slug] = mergedToken;\n    if (token.tokenAddress) {\n      tokensForDb.push(mergedToken);\n    }\n  }\n\n  if (baseCurrency) {\n    tokensCache.baseCurrency = baseCurrency;\n  }\n\n  await tokenRepository.bulkPut(tokensForDb);\n\n  if (shouldSendUpdate && onUpdate) {\n    sendUpdateTokens(onUpdate);\n  }\n}\n\nfunction mergeTokenWithCache(\n  token: ApiTokenWithPrice,\n  detailsBySlug: Record<string, ApiTokenDetails>,\n  cachedToken?: ApiTokenWithPrice,\n): ApiTokenWithPrice {\n  if (cachedToken) {\n    // Metadata from backend takes priority (e.g., image)\n    return {\n      ...omitUndefined(token.isFromBackend ? cachedToken : token),\n      ...omitUndefined(token.isFromBackend ? token : cachedToken),\n      price: token.price || cachedToken.price,\n      priceUsd: token.priceUsd || cachedToken.priceUsd,\n      percentChange24h: token.percentChange24h || cachedToken.percentChange24h,\n    };\n  } else if (token.slug in detailsBySlug) {\n    return {\n      ...token,\n      ...detailsBySlug[token.slug],\n    };\n  } else {\n    return token;\n  }\n}\n\nexport function getTokensCache() {\n  return tokensCache;\n}\n\nexport function getTokenBySlug(slug: string) {\n  return tokensCache.bySlug[slug];\n}\n\nexport function getTokenByAddress(tokenAddress: string) {\n  return getTokenBySlug(buildTokenSlug('ton', tokenAddress));\n}\n\nexport function sendUpdateTokens(onUpdate: OnApiUpdate) {\n  onUpdate({\n    type: 'updateTokens',\n    tokens: tokensCache.bySlug,\n    baseCurrency: tokensCache.baseCurrency,\n  });\n}\n\nexport function buildTokenSlug(chain: ApiChain, address: string) {\n  const addressPart = address.replace(/[^a-z\\d]/gi, '').slice(0, 10);\n  return `${chain}-${addressPart}`.toLowerCase();\n}\n","import type { ApiNetwork, ApiWalletInfo } from '../../../types';\nimport type { ApiTonWalletVersion } from '../types';\nimport type { AccountState, AddressBook, MetadataMap, WalletState, WalletVersion } from './types';\n\nimport { TONCENTER_ACTIONS_VERSION, TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL } from '../../../../config';\nimport { buildTxId } from '../../../../util/activities';\nimport { fetchJson } from '../../../../util/fetch';\nimport { buildCollectionByKey, split } from '../../../../util/iteratees';\nimport { toRawAddress } from '../util/tonCore';\nimport { getEnvironment } from '../../../environment';\n\nconst ADDRESS_BOOK_CHUNK_SIZE = 128;\nconst VERSION_MAP: Record<WalletVersion, ApiTonWalletVersion> = {\n  'wallet v1 r1': 'simpleR1',\n  'wallet v1 r2': 'simpleR2',\n  'wallet v1 r3': 'simpleR3',\n  'wallet v2 r1': 'v2R1',\n  'wallet v2 r2': 'v2R2',\n  'wallet v3 r1': 'v3R1',\n  'wallet v3 r2': 'v3R2',\n  // 'wallet v4 r1': '', // Not used in production, wrapper is missing\n  'wallet v4 r2': 'v4R2',\n  // 'wallet v5 beta': '', // Not used in production, wrapper is missing\n  'wallet v5 r1': 'W5',\n};\n\nexport async function fetchAddressBook(network: ApiNetwork, addresses: string[]): Promise<AddressBook> {\n  const chunks = split(addresses, ADDRESS_BOOK_CHUNK_SIZE);\n\n  const results = await Promise.all(chunks.map((chunk) => {\n    return callToncenterV3(network, '/addressBook', {\n      address: chunk,\n    });\n  }));\n\n  return results.reduce((acc, value) => {\n    return Object.assign(acc, value);\n  }, {} as AddressBook);\n}\n\nexport async function fixAddressFormat(network: ApiNetwork, address: string): Promise<string> {\n  const result: { address_book: Record<string, string> } = await callToncenterV3(network, '/addressBook', { address });\n  return result.address_book[address];\n}\n\n/**\n * The output dictionary is indexed by the input addresses.\n * Every input address is guaranteed to be a key of the dictionary.\n */\nexport async function getWalletInfos(network: ApiNetwork, addresses: string[]): Promise<Record<string, ApiWalletInfo>> {\n  const { wallets: states, address_book: addressBook } = await callToncenterV3<{\n    address_book: AddressBook;\n    wallets: WalletState[];\n  }>(network, '/walletStates', { address: addresses.join(',') });\n\n  const walletInfoByRawAddress = Object.fromEntries(states.map((state) => [\n    state.address.toLowerCase(),\n    buildWalletInfo(state, addressBook),\n  ]));\n\n  return Object.fromEntries(addresses.map((inputAddress) => {\n    const rawAddress = toRawAddress(inputAddress).toLowerCase();\n    return [\n      inputAddress,\n      walletInfoByRawAddress[rawAddress] ?? {\n        address: inputAddress,\n        balance: 0n,\n        isInitialized: false,\n        seqno: 0,\n      } satisfies ApiWalletInfo,\n    ];\n  }));\n}\n\nfunction buildWalletInfo(state: WalletState, addressBook: AddressBook): ApiWalletInfo {\n  return {\n    address: addressBook[state.address].user_friendly,\n    version: 'wallet_type' in state ? VERSION_MAP[state.wallet_type] : undefined,\n    balance: BigInt(state.balance),\n    isInitialized: state.status === 'active',\n    seqno: 'seqno' in state ? state.seqno : 0,\n    lastTxId: state.last_transaction_hash ? buildTxId(state.last_transaction_hash) : undefined,\n    domain: addressBook[state.address].domain ?? undefined,\n  };\n}\n\nexport async function getAccountStates(network: ApiNetwork, addresses: string[]) {\n  const { accounts: states } = await callToncenterV3<{\n    addressBook: AddressBook;\n    accounts: AccountState[];\n  }>(network, '/accountStates', { address: addresses.join(',') });\n\n  const addressByRaw = Object.fromEntries(addresses.map((address) => [toRawAddress(address), address]));\n  for (const state of states) {\n    state.address = addressByRaw[state.address.toLowerCase()];\n  }\n  return buildCollectionByKey(states, 'address');\n}\n\nexport function fetchMetadata(network: ApiNetwork, addresses: string[]): Promise<MetadataMap> {\n  return callToncenterV3<MetadataMap>(network, '/metadata', { address: addresses.join(',') });\n}\n\nexport function callToncenterV3<T = any>(network: ApiNetwork, path: string, data?: AnyLiteral) {\n  const baseUrl = network === 'testnet' ? TONCENTER_TESTNET_URL : TONCENTER_MAINNET_URL;\n  const url = `${baseUrl}/api/v3${path}`;\n\n  return fetchJson(url, data, {\n    headers: getToncenterHeaders(network),\n  }) as Promise<T>;\n}\n\nexport function getToncenterHeaders(network: ApiNetwork) {\n  const { apiHeaders, toncenterMainnetKey, toncenterTestnetKey } = getEnvironment();\n  const apiKey = network === 'testnet' ? toncenterTestnetKey : toncenterMainnetKey;\n\n  return {\n    ...apiHeaders,\n    ...(apiKey && { 'X-Api-Key': apiKey }),\n    'X-Actions-Version': TONCENTER_ACTIONS_VERSION,\n  };\n}\n","import { Api, HttpClient } from 'tonapi-sdk-js';\n\nimport type { ApiNetwork } from '../../../types';\n\nimport { TONAPIIO_MAINNET_URL, TONAPIIO_TESTNET_URL } from '../../../../config';\nimport { fetchWithRetry } from '../../../../util/fetch';\nimport { getEnvironment } from '../../../environment';\n\nconst MAX_LIMIT = 500;\nconst EVENTS_LIMIT = 100;\n\nlet apiByNetwork: Record<ApiNetwork, Api<unknown>> | undefined;\n\nfunction getApi(network: ApiNetwork) {\n  if (!apiByNetwork) {\n    const headers = {\n      ...getEnvironment().apiHeaders,\n      'Content-Type': 'application/json',\n    };\n\n    apiByNetwork = {\n      mainnet: new Api(new HttpClient({\n        baseUrl: TONAPIIO_MAINNET_URL,\n        baseApiParams: { headers },\n        customFetch: fetchWithRetry as typeof fetch,\n      })),\n      testnet: new Api(new HttpClient({\n        baseUrl: TONAPIIO_TESTNET_URL,\n        baseApiParams: { headers },\n        customFetch: fetchWithRetry as typeof fetch,\n      })),\n    };\n  }\n\n  return apiByNetwork[network];\n}\n\nexport async function fetchJettonBalances(network: ApiNetwork, account: string) {\n  return (await getApi(network).accounts.getAccountJettonsBalances(account, {\n    supported_extensions: ['custom_payload'],\n  })).balances;\n}\n\nexport async function fetchNftItems(network: ApiNetwork, addresses: string[]) {\n  return (await getApi(network).nft.getNftItemsByAddresses({\n    account_ids: addresses,\n  })).nft_items;\n}\n\nexport async function fetchAccountNfts(network: ApiNetwork, address: string, options?: {\n  collection?: string;\n  offset?: number;\n  limit?: number;\n}) {\n  const { collection, offset, limit } = options ?? {};\n\n  return (await getApi(network).accounts.getAccountNftItems(\n    address,\n    {\n      offset: offset ?? 0,\n      limit: limit ?? MAX_LIMIT,\n      indirect_ownership: true,\n      collection,\n    },\n  )).nft_items;\n}\n\nexport function fetchNftByAddress(network: ApiNetwork, nftAddress: string) {\n  return getApi(network).nft.getNftItemByAddress(nftAddress);\n}\n\nexport async function fetchAccountEvents(network: ApiNetwork, address: string, fromSec: number, limit?: number) {\n  return (await getApi(network).accounts.getAccountEvents(address, {\n    limit: limit ?? EVENTS_LIMIT,\n    start_date: fromSec,\n  })).events;\n}\n","import type { NftItem } from 'tonapi-sdk-js';\nimport type { DictionaryValue } from '@ton/core';\nimport { BitReader } from '@ton/core/dist/boc/BitReader';\nimport { BitString } from '@ton/core/dist/boc/BitString';\nimport { Builder } from '@ton/core/dist/boc/Builder';\nimport { Cell } from '@ton/core/dist/boc/Cell';\nimport { Slice } from '@ton/core/dist/boc/Slice';\nimport { Dictionary } from '@ton/core/dist/dict/Dictionary';\n\nimport type {\n  ApiMtwCardBorderShineType,\n  ApiMtwCardTextType,\n  ApiMtwCardType,\n  ApiNetwork,\n  ApiNft,\n  ApiNftAttribute,\n  ApiNftMetadata,\n  ApiNftSuperCollection,\n  ApiParsedPayload,\n  ApiTransaction,\n} from '../../../types';\nimport type { JettonMetadata } from '../types';\n\nimport {\n  DEBUG,\n  LIQUID_JETTON,\n  MTW_CARDS_COLLECTION,\n  NFT_FRAGMENT_COLLECTIONS,\n  NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX,\n  TELEGRAM_GIFTS_SUPER_COLLECTION,\n} from '../../../../config';\nimport { fetchJsonWithProxy, fixIpfsUrl, getProxiedLottieUrl } from '../../../../util/fetch';\nimport isEmptyObject from '../../../../util/isEmptyObject';\nimport { omitUndefined, pick, range } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport {\n  checkHasScamLink,\n  checkIsTrustedCollection,\n  getNftSuperCollectionsByCollectionAddress,\n} from '../../../common/addresses';\nimport { buildTokenSlug } from '../../../common/tokens';\nimport { base64ToString, sha256 } from '../../../common/utils';\nimport { DnsCategory, JettonStakingOpCode } from '../constants';\nimport {\n  DNS_CATEGORY_HASH_MAP,\n  DnsOpCode,\n  JettonOpCode,\n  LiquidStakingOpCode,\n  NftOpCode,\n  OpCode,\n  OtherOpCode,\n  SingleNominatorOpCode,\n  VestingV1OpCode,\n} from '../constants';\nimport { fixAddressFormat } from '../toncenter/other';\nimport { fetchNftItems } from './tonapiio';\nimport {\n  getDnsItemDomain, getJettonMinterData, resolveTokenAddress, toBase64Address,\n} from './tonCore';\n\ntype OpCodes = OpCode | JettonOpCode | NftOpCode | LiquidStakingOpCode | VestingV1OpCode | SingleNominatorOpCode\n  | DnsOpCode | OtherOpCode | JettonStakingOpCode;\n\nconst OFFCHAIN_CONTENT_PREFIX = 0x01;\nconst SNAKE_PREFIX = 0x00;\n\nexport function fixBase64ImageData(data: string) {\n  const decodedData = base64ToString(data);\n  if (decodedData.includes('<svg')) {\n    return `data:image/svg+xml;base64,${data}`;\n  }\n  return `data:image/png;base64,${data}`;\n}\n\nconst dictSnakeBufferValue: DictionaryValue<Buffer> = {\n  parse: (slice) => {\n    const buffer = Buffer.from('');\n\n    const sliceToVal = (s: Slice, v: Buffer, isFirst: boolean) => {\n      if (isFirst && s.loadUint(8) !== SNAKE_PREFIX) {\n        throw new Error('Only snake format is supported');\n      }\n\n      v = Buffer.concat([v, s.loadBuffer(s.remainingBits / 8)]);\n      if (s.remainingRefs === 1) {\n        v = sliceToVal(s.loadRef().beginParse(), v, false);\n      }\n\n      return v;\n    };\n\n    return sliceToVal(slice.loadRef().beginParse() as any, buffer, true);\n  },\n  serialize: () => {\n    // pass\n  },\n};\n\nconst jettonOnChainMetadataSpec: {\n  [key in keyof JettonMetadata]: 'utf8' | 'ascii' | undefined;\n} = {\n  uri: 'ascii',\n  name: 'utf8',\n  description: 'utf8',\n  image: 'ascii',\n  symbol: 'utf8',\n  decimals: 'utf8',\n  custom_payload_api_uri: 'ascii',\n};\n\nexport async function fetchJettonMetadata(network: ApiNetwork, address: string) {\n  const { content } = await getJettonMinterData(network, address);\n\n  let metadata: JettonMetadata;\n\n  const slice = content.asSlice();\n  const prefix = slice.loadUint(8);\n\n  if (prefix === OFFCHAIN_CONTENT_PREFIX) {\n    const bytes = readSnakeBytes(slice);\n    const contentUri = bytes.toString('utf-8');\n    metadata = await fetchJettonOffchainMetadata(contentUri);\n  } else {\n    // On-chain content\n    metadata = await parseJettonOnchainMetadata(slice);\n    if (metadata.uri) {\n      // Semi-chain content\n      const offchainMetadata = await fetchJettonOffchainMetadata(metadata.uri);\n      metadata = { ...offchainMetadata, ...metadata };\n    }\n  }\n\n  return metadata;\n}\n\nexport async function parseJettonOnchainMetadata(slice: Slice): Promise<JettonMetadata> {\n  const dict = slice.loadDict(Dictionary.Keys.Buffer(32), dictSnakeBufferValue);\n\n  const res: { [s in keyof JettonMetadata]?: string } = {};\n\n  for (const [key, value] of Object.entries(jettonOnChainMetadataSpec)) {\n    const sha256Key = Buffer.from(await sha256(Buffer.from(key, 'ascii')));\n    const val = dict.get(sha256Key)?.toString(value);\n\n    if (val) {\n      res[key as keyof JettonMetadata] = val;\n    }\n  }\n\n  return res as JettonMetadata;\n}\n\nexport async function fetchJettonOffchainMetadata(uri: string): Promise<JettonMetadata> {\n  const metadata = await fetchJsonWithProxy(uri);\n  return pick(metadata, [\n    'name',\n    'description',\n    'symbol',\n    'decimals',\n    'image',\n    'image_data',\n    'custom_payload_api_uri',\n  ]);\n}\n\nexport async function parsePayloadBase64(\n  network: ApiNetwork,\n  address: string,\n  base64: string,\n): Promise<ApiParsedPayload> {\n  const slice = dataToSlice(base64);\n  const result: ApiParsedPayload = { type: 'unknown', base64 };\n\n  if (!slice) return result;\n\n  return await parsePayloadSlice(network, address, slice, true) ?? result;\n}\n\nexport async function parsePayloadSlice(\n  network: ApiNetwork,\n  address: string,\n  slice: Slice,\n  shouldLoadItems?: boolean,\n  transactionDebug?: ApiTransaction,\n): Promise<ApiParsedPayload | undefined> {\n  let opCode: OpCodes | undefined;\n  try {\n    opCode = slice.loadUint(32);\n\n    if (opCode === OpCode.Comment) {\n      const buffer = readSnakeBytes(slice);\n      const comment = buffer.toString('utf-8');\n      return { type: 'comment', comment };\n    } else if (opCode === OpCode.Encrypted) {\n      const buffer = readSnakeBytes(slice);\n      const encryptedComment = buffer.toString('base64');\n      return { type: 'encrypted-comment', encryptedComment };\n    } else if (slice.remainingBits < 64) {\n      return undefined;\n    }\n\n    const queryId = slice.loadUintBig(64);\n\n    switch (opCode) {\n      case JettonOpCode.Transfer: {\n        const tokenAddress = await resolveTokenAddress(network, address).catch(() => '');\n        const slug = buildTokenSlug('ton', tokenAddress);\n\n        const amount = slice.loadCoins();\n        const destination = slice.loadAddress();\n        const responseDestination = slice.loadMaybeAddress();\n\n        if (!responseDestination) {\n          return {\n            type: 'tokens:transfer-non-standard',\n            queryId,\n            destination: toBase64Address(destination, undefined, network),\n            amount,\n            slug,\n          };\n        }\n\n        const customPayload = slice.loadMaybeRef();\n        const forwardAmount = slice.loadCoins();\n        let forwardPayload = slice.loadMaybeRef();\n        let forwardPayloadOpCode: number | undefined;\n\n        if (!forwardPayload && slice.remainingBits) {\n          const builder = new Builder().storeBits(slice.loadBits(slice.remainingBits));\n          range(0, slice.remainingRefs).forEach(() => {\n            builder.storeRef(slice.loadRef());\n          });\n          forwardPayload = builder.endCell();\n        }\n\n        if (forwardPayload) {\n          const forwardPayloadSlice = forwardPayload.beginParse();\n          if (forwardPayloadSlice.remainingBits > 32) {\n            forwardPayloadOpCode = forwardPayloadSlice.loadUint(32);\n          }\n        }\n\n        return {\n          type: 'tokens:transfer',\n          queryId,\n          amount,\n          destination: toBase64Address(destination, undefined, network),\n          responseDestination: toBase64Address(responseDestination, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          forwardAmount,\n          forwardPayload: forwardPayload?.toBoc().toString('base64'),\n          forwardPayloadOpCode,\n          slug,\n          tokenAddress,\n        };\n      }\n      case NftOpCode.TransferOwnership: {\n        const newOwner = slice.loadAddress();\n        const responseDestination = slice.loadAddress();\n        const customPayload = slice.loadMaybeRef();\n        const forwardAmount = slice.loadCoins();\n        const forwardPayload = readForwardPayloadCell(slice);\n        const comment = forwardPayload ? readComment(forwardPayload.asSlice()) : undefined;\n\n        let nft: ApiNft | undefined;\n        if (shouldLoadItems) {\n          const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n          const [rawNft] = await fetchNftItems(network, [address]);\n          if (rawNft) {\n            nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n          }\n        }\n\n        return {\n          type: 'nft:transfer',\n          queryId,\n          newOwner: toBase64Address(newOwner, undefined, network),\n          responseDestination: toBase64Address(responseDestination, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          forwardAmount,\n          forwardPayload: forwardPayload?.toBoc().toString('base64'),\n          nftAddress: address,\n          nftName: nft?.name,\n          nft,\n          comment,\n        };\n      }\n      case NftOpCode.OwnershipAssigned: {\n        const prevOwner = slice.loadAddress();\n        const forwardPayload = readForwardPayloadCell(slice);\n        const comment = forwardPayload ? readComment(forwardPayload.asSlice()) : undefined;\n\n        let nft: ApiNft | undefined;\n        if (shouldLoadItems) {\n          const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n          const [rawNft] = await fetchNftItems(network, [address]);\n          if (rawNft) {\n            nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n          }\n        }\n\n        return {\n          type: 'nft:ownership-assigned',\n          queryId,\n          prevOwner: toBase64Address(prevOwner, undefined, network),\n          comment,\n          nftAddress: address,\n          nft,\n        };\n      }\n      case JettonOpCode.Burn: {\n        const tokenAddress = await resolveTokenAddress(network, address);\n        const slug = buildTokenSlug('ton', tokenAddress);\n\n        const amount = slice.loadCoins();\n        const addressObj = slice.loadAddress();\n        const customPayload = slice.loadMaybeRef();\n        const isLiquidUnstakeRequest = tokenAddress === LIQUID_JETTON;\n\n        return {\n          type: 'tokens:burn',\n          queryId,\n          amount,\n          address: toBase64Address(addressObj, undefined, network),\n          customPayload: customPayload?.toBoc().toString('base64'),\n          slug,\n          isLiquidUnstakeRequest,\n        };\n      }\n      case LiquidStakingOpCode.DistributedAsset: {\n        return {\n          type: 'liquid-staking:withdrawal-nft',\n          queryId,\n        };\n      }\n      case LiquidStakingOpCode.Withdrawal: {\n        return {\n          type: 'liquid-staking:withdrawal',\n          queryId,\n        };\n      }\n      case LiquidStakingOpCode.Deposit: {\n        let appId: bigint | undefined;\n        if (slice.remainingBits > 0) {\n          appId = slice.loadUintBig(64);\n        }\n        return {\n          type: 'liquid-staking:deposit',\n          queryId,\n          appId,\n        };\n      }\n      case VestingV1OpCode.AddWhitelist: {\n        const toAddress = slice.loadAddress();\n        const addressString = shouldLoadItems\n          ? await fixAddressFormat(network, toAddress.toRawString())\n          : '';\n\n        return {\n          type: 'vesting:add-whitelist',\n          queryId,\n          address: addressString,\n        };\n      }\n      case SingleNominatorOpCode.Withdraw: {\n        const amount = slice.loadCoins();\n        return {\n          type: 'single-nominator:withdraw',\n          queryId,\n          amount,\n        };\n      }\n      case SingleNominatorOpCode.ChangeValidator: {\n        const toAddress = slice.loadAddress();\n        const addressString = shouldLoadItems\n          ? await fixAddressFormat(network, toAddress.toRawString())\n          : '';\n\n        return {\n          type: 'single-nominator:change-validator',\n          queryId,\n          address: addressString,\n        };\n      }\n      case LiquidStakingOpCode.Vote: {\n        const votingAddress = slice.loadAddress();\n        const expirationDate = slice.loadUint(48);\n        const vote = slice.loadBit();\n        const needConfirmation = slice.loadBit();\n\n        return {\n          type: 'liquid-staking:vote',\n          queryId,\n          votingAddress: toBase64Address(votingAddress, true),\n          expirationDate,\n          vote,\n          needConfirmation,\n        };\n      }\n      case DnsOpCode.ChangeRecord: {\n        const hash = slice.loadBuffer(32).toString('hex');\n        const category = Object.entries(DNS_CATEGORY_HASH_MAP)\n          .find(([, value]) => hash === value)?.[0] as DnsCategory ?? 'unknown';\n        const toAddress = slice.loadAddress();\n        const domain = shouldLoadItems\n          ? await getDnsItemDomain(network, toAddress)\n          : '';\n\n        if (category === DnsCategory.Wallet) {\n          if (slice.remainingRefs > 0) {\n            const dataSlice = slice.loadRef().beginParse();\n            slice.endParse();\n\n            const dataAddress = dataSlice.loadAddress();\n            const flags = dataSlice.loadUint(8);\n\n            const addressString = shouldLoadItems\n              ? await fixAddressFormat(network, dataAddress.toRawString())\n              : '';\n\n            return {\n              type: 'dns:change-record',\n              queryId,\n              record: {\n                type: 'wallet',\n                value: addressString,\n                flags,\n              },\n              domain,\n            };\n          } else {\n            return {\n              type: 'dns:change-record',\n              queryId,\n              record: {\n                type: 'wallet',\n                value: undefined,\n              },\n              domain,\n            };\n          }\n        } else if (slice.remainingRefs > 0) {\n          const value = slice.loadRef();\n          return {\n            type: 'dns:change-record',\n            queryId,\n            record: category === DnsCategory.Unknown ? {\n              type: 'unknown',\n              key: hash,\n              value: value.toBoc().toString('base64'),\n            } : {\n              type: category,\n              value: value.toBoc().toString('base64'),\n            },\n            domain,\n          };\n        } else {\n          return {\n            type: 'dns:change-record',\n            queryId,\n            record: category === DnsCategory.Unknown ? {\n              type: 'unknown',\n              key: hash,\n            } : {\n              type: category,\n            },\n            domain,\n          };\n        }\n      }\n      case OtherOpCode.TokenBridgePaySwap: {\n        const swapId = slice.loadBuffer(32).toString('hex');\n        return {\n          type: 'token-bridge:pay-swap',\n          queryId,\n          swapId,\n        };\n      }\n      case JettonStakingOpCode.UnstakeRequest: {\n        const amount = slice.loadCoins();\n        const isForce = slice.loadBoolean();\n        return {\n          type: 'jetton-staking:unstake',\n          queryId,\n          amount,\n          isForce,\n        };\n      }\n    }\n  } catch (err) {\n    if (DEBUG) {\n      const debugTxString = transactionDebug\n        && `${transactionDebug.txId} ${new Date(transactionDebug.timestamp).toISOString()}`;\n      const opCodeHex = `0x${opCode?.toString(16).padStart(8, '0')}`;\n      logDebugError('parsePayload', opCodeHex, debugTxString, '\\n', err);\n    }\n  }\n\n  return undefined;\n}\n\nfunction dataToSlice(data: string | Buffer | Uint8Array): Slice {\n  let buffer: Buffer;\n  if (typeof data === 'string') {\n    buffer = Buffer.from(data, 'base64');\n  } else if (data instanceof Buffer) {\n    buffer = data;\n  } else {\n    buffer = Buffer.from(data);\n  }\n\n  try {\n    return Cell.fromBoc(buffer)[0].beginParse();\n  } catch (err: any) {\n    if (err?.message !== 'Invalid magic') {\n      throw err;\n    }\n  }\n\n  return new Slice(new BitReader(new BitString(buffer, 0, buffer.length * 8)), []);\n}\n\nexport function readComment(slice: Slice) {\n  if (slice.remainingBits < 32) {\n    return undefined;\n  }\n\n  const opCode = slice.loadUint(32) as OpCode;\n  if (opCode !== OpCode.Comment || (!slice.remainingBits && !slice.remainingRefs)) {\n    return undefined;\n  }\n\n  const buffer = readSnakeBytes(slice);\n  return buffer.toString('utf-8');\n}\n\nfunction readForwardPayloadCell(slice: Slice) {\n  let forwardPayload = slice.loadBit() && slice.remainingRefs ? slice.loadRef() : undefined;\n\n  if (!forwardPayload && slice.remainingBits) {\n    const builder = new Builder().storeBits(slice.loadBits(slice.remainingBits));\n    range(0, slice.remainingRefs).forEach(() => {\n      builder.storeRef(slice.loadRef());\n    });\n    forwardPayload = builder.endCell();\n  }\n\n  return forwardPayload ?? undefined;\n}\n\nexport function readSnakeBytes(slice: Slice) {\n  let buffer = Buffer.alloc(0);\n\n  while (slice.remainingBits >= 8) {\n    buffer = Buffer.concat([buffer, slice.loadBuffer(slice.remainingBits / 8)]);\n    if (slice.remainingRefs) {\n      slice = slice.loadRef().beginParse();\n    } else {\n      break;\n    }\n  }\n\n  return buffer;\n}\n\nexport function buildMtwCardsNftMetadata(metadata: {\n  image?: string;\n  id?: number;\n  attributes?: ApiNftAttribute[];\n}): ApiNftMetadata | undefined {\n  const { id, image, attributes } = metadata;\n\n  let mtwCardType: ApiMtwCardType | undefined;\n  let mtwCardTextType: ApiMtwCardTextType | undefined;\n  let result: ApiNftMetadata = {};\n  if (image) result.imageUrl = image;\n  if (id !== undefined) result.mtwCardId = id;\n\n  if (attributes && Array.isArray(attributes) && attributes.length) {\n    mtwCardType = attributes\n      .find((attribute) => attribute.trait_type === 'Card Type')?.value\n      // Clean non-ascii characters with regex\n      .replace(/[^\\x20-\\x7E]/g, '')\n      .trim()\n      .toLowerCase() as ApiMtwCardType;\n\n    if (mtwCardType) {\n      mtwCardTextType = attributes\n        .find((attribute) => attribute.trait_type === 'Text')?.value\n        .toLowerCase() as ApiMtwCardTextType;\n\n      result.mtwCardType = mtwCardType;\n      if (mtwCardType === 'standard') {\n        result.mtwCardBorderShineType = attributes\n          .find((attribute) => attribute.trait_type === 'Shine')?.value\n          .toLowerCase() as ApiMtwCardBorderShineType;\n      }\n\n      if (mtwCardTextType === 'dark' || mtwCardType === 'silver') {\n        result.mtwCardTextType = 'dark';\n      } else {\n        result.mtwCardTextType = 'light';\n      }\n\n      result = omitUndefined(result);\n    }\n  }\n\n  return !isEmptyObject(result) ? result : undefined;\n}\n\nexport function parseTonapiioNft(\n  network: ApiNetwork,\n  rawNft: NftItem,\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n): ApiNft | undefined {\n  if (!rawNft.metadata) {\n    return undefined;\n  }\n\n  try {\n    const {\n      address,\n      index,\n      collection,\n      metadata: rawMetadata,\n      previews,\n      sale,\n      trust,\n      owner,\n    } = rawNft;\n\n    const {\n      name, image, description, render_type: renderType, attributes, lottie,\n    } = rawMetadata as {\n      name?: string;\n      image?: string;\n      description?: string;\n      render_type?: string;\n      attributes?: {\n        trait_type: string;\n        value: string;\n      }[];\n      lottie?: string;\n    };\n\n    const collectionAddress = collection && toBase64Address(collection.address, true, network);\n    let hasScamLink = false;\n\n    if (!collectionAddress || !checkIsTrustedCollection(collectionAddress)) {\n      for (const text of [name, description].filter(Boolean)) {\n        if (checkHasScamLink(text)) {\n          hasScamLink = true;\n        }\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison\n    const isWhitelisted = trust === 'whitelist';\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison\n    const isScam = hasScamLink || description === 'SCAM' || trust === 'blacklist';\n    const isHidden = renderType === 'hidden' || isScam;\n    const imageFromPreview = previews!.find((x) => x.resolution === '1500x1500')!.url;\n    const isFragmentGift = getIsFragmentGift(nftSuperCollectionsByCollectionAddress, collectionAddress);\n\n    const metadata = {\n      attributes,\n      ...(isWhitelisted && lottie && { lottie: getProxiedLottieUrl(lottie) }),\n      ...(collectionAddress === MTW_CARDS_COLLECTION && buildMtwCardsNftMetadata(rawMetadata)),\n      ...(isFragmentGift && { fragmentUrl: image!.replace(NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX, 'https://$1') }),\n    };\n\n    return omitUndefined<ApiNft>({\n      index,\n      name,\n      ownerAddress: owner ? toBase64Address(owner.address, false, network) : undefined,\n      address: toBase64Address(address, true, network),\n      image: fixIpfsUrl(imageFromPreview || image || ''),\n      thumbnail: previews!.find((x) => x.resolution === '500x500')!.url,\n      isOnSale: Boolean(sale),\n      isHidden,\n      isScam,\n      description,\n      ...(collection && {\n        collectionAddress,\n        collectionName: collection.name,\n        isOnFragment: isFragmentGift || NFT_FRAGMENT_COLLECTIONS.includes(collection.address),\n        isTelegramGift: isFragmentGift,\n      }),\n      metadata,\n    });\n  } catch (err) {\n    logDebugError('buildNft', err);\n    return undefined;\n  }\n}\n\nexport function getIsFragmentGift(\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n  collectionAddress?: string,\n) {\n  return collectionAddress\n    ? nftSuperCollectionsByCollectionAddress[collectionAddress]?.id === TELEGRAM_GIFTS_SUPER_COLLECTION\n    : false;\n}\n","export function areDeepEqual<T>(value1: T, value2: T): boolean {\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n  if (type1 !== type2) {\n    return false;\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  if (type1 !== 'object' || value1 === null || value2 === null) {\n    return value1 === value2;\n  }\n\n  const isArray1 = Array.isArray(value1);\n  const isArray2 = Array.isArray(value2);\n\n  if (isArray1 !== isArray2) {\n    return false;\n  }\n\n  if (isArray1) {\n    const array1 = value1 as any[];\n    const array2 = value2 as any[];\n\n    if (array1.length !== array2.length) {\n      return false;\n    }\n\n    return array1.every((member1, i) => areDeepEqual(member1, array2[i]));\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n  const keys2 = Object.keys(object2);\n\n  if (!keys1.every((key1) => object2.hasOwnProperty(key1))) {\n    return false;\n  }\n  if (!keys2.every((key2) => object1.hasOwnProperty(key2))) {\n    return false;\n  }\n\n  return keys1.every((key1) => areDeepEqual(object1[key1], object2[key1]));\n}\n","import type { ApiDapp, ApiDappRequest } from '../api/types';\n\nexport function getDappConnectionUniqueId(request: ApiDappRequest | ApiDapp): string {\n  return (request as any).sseOptions?.appClientId ?? (request as any).sse?.appClientId ?? 'jsbridge';\n}\n","import type chains from '../chains';\nimport type { ApiDbSseConnection } from '../db';\nimport type { StorageKey } from '../storages/types';\nimport type {\n  ApiActivity,\n  ApiDappsState,\n  ApiLocalTransactionParams,\n  ApiTonAccount,\n  ApiTonWallet,\n  ApiTransactionActivity,\n  OnApiUpdate,\n} from '../types';\n\nimport {\n  IS_CAPACITOR, IS_CORE_WALLET, IS_EXTENSION, MAIN_ACCOUNT_ID,\n} from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { buildLocalTxId } from '../../util/activities';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { assert } from '../../util/assert';\nimport { logDebugError } from '../../util/logs';\nimport { toBase64Address } from '../chains/ton/util/tonCore';\nimport { getEnvironment } from '../environment';\nimport * as migrations from '../migrations';\nimport { storage } from '../storages';\nimport capacitorStorage from '../storages/capacitorStorage';\nimport idbStorage from '../storages/idb';\nimport localStorage from '../storages/localStorage';\nimport {\n  checkHasScamLink,\n  checkHasTelegramBotMention,\n  getKnownAddresses,\n  getScamMarkers,\n} from './addresses';\nimport { hexToBytes } from './utils';\n\nconst actualStateVersion = 19;\nlet migrationEnsurePromise: Promise<void>;\n\nexport function buildLocalTransaction(\n  params: ApiLocalTransactionParams,\n  normalizedAddress: string,\n  subId?: number,\n): ApiTransactionActivity {\n  const { amount, ...restParams } = params;\n  const txId = buildLocalTxId(params.txId ?? params.externalMsgHashNorm!, subId);\n\n  return updateActivityMetadata({\n    id: txId,\n    isPending: true,\n    kind: 'transaction',\n    timestamp: Date.now(),\n    isIncoming: false,\n    amount: -amount,\n    normalizedAddress,\n    ...restParams,\n    txId,\n  });\n}\n\nexport function updateActivityMetadata<T extends ApiActivity>(activity: T): T {\n  if (activity.kind !== 'transaction') {\n    return activity;\n  }\n\n  const {\n    normalizedAddress, comment, isIncoming, nft,\n  } = activity;\n  let { metadata = {} } = activity;\n\n  const isNftTransfer = Boolean(nft);\n  const knownAddresses = getKnownAddresses();\n  const hasScamMarkers = comment ? getScamMarkers().some((sm) => sm.test(comment)) : false;\n  const shouldCheckComment = !hasScamMarkers && comment && isIncoming\n    && (isNftTransfer || comment.toLowerCase().includes('claim'));\n  const hasScamInComment = shouldCheckComment\n    ? (checkHasScamLink(comment) || checkHasTelegramBotMention(comment))\n    : false;\n\n  if (normalizedAddress in knownAddresses) {\n    metadata = { ...metadata, ...knownAddresses[normalizedAddress] };\n  }\n\n  if (hasScamMarkers || hasScamInComment) {\n    metadata.isScam = true;\n  }\n\n  return { ...activity, metadata };\n}\n\nlet currentOnUpdate: OnApiUpdate | undefined;\n\nexport function connectUpdater(onUpdate: OnApiUpdate) {\n  currentOnUpdate = onUpdate;\n}\n\nexport function disconnectUpdater() {\n  currentOnUpdate = undefined;\n}\n\nexport function isUpdaterAlive(onUpdate: OnApiUpdate) {\n  return currentOnUpdate === onUpdate;\n}\n\nexport function startStorageMigration(onUpdate: OnApiUpdate, ton: typeof chains.ton, accountIds?: string[]) {\n  migrationEnsurePromise = migrateStorage(onUpdate, ton, accountIds)\n    .catch((err) => {\n      logDebugError('Migration error', err);\n      currentOnUpdate?.({\n        type: 'showError',\n        error: 'Migration error',\n      });\n    });\n  return migrationEnsurePromise;\n}\n\nexport function waitStorageMigration() {\n  return migrationEnsurePromise;\n}\n\nexport async function migrateStorage(onUpdate: OnApiUpdate, ton: typeof chains.ton, accountIds?: string[]) {\n  let version = Number(await storage.getItem('stateVersion', true));\n\n  if (version === actualStateVersion) {\n    return;\n  }\n\n  if (IS_CORE_WALLET && !version) {\n    await migrateCoreWallet(onUpdate);\n  }\n\n  if (IS_CAPACITOR && !version) {\n    if (await storage.getItem('accounts' as StorageKey, true)) {\n      // Fix broken version\n      version = 10;\n    } else {\n      // Prepare for migration to secure storage\n      const idbVersion = await idbStorage.getItem('stateVersion');\n      if (idbVersion) {\n        version = Number(idbVersion);\n      }\n    }\n  }\n\n  // Migration to chrome.storage\n  if (IS_EXTENSION && !version && !(await storage.getItem('addresses' as StorageKey))) {\n    version = await idbStorage.getItem('stateVersion');\n\n    if (version) {\n      // Switching from IndexedDB to `chrome.storage.local`\n      const idbData = await idbStorage.getAll!();\n      await storage.setMany!(idbData);\n    }\n  }\n\n  if (!version) {\n    await storage.setItem('stateVersion', actualStateVersion);\n    return;\n  }\n\n  // First version (v1)\n  if (!version) {\n    // Support multi-accounts\n    const mnemonicEncrypted = await storage.getItem('mnemonicEncrypted' as StorageKey);\n    if (mnemonicEncrypted) {\n      await storage.setItem('mnemonicsEncrypted' as StorageKey, JSON.stringify({\n        [MAIN_ACCOUNT_ID]: mnemonicEncrypted,\n      }));\n      await storage.removeItem('mnemonicEncrypted' as StorageKey);\n    }\n\n    // Change accountId format ('0' -> '0-ton', '1-ton-mainnet' -> '1-ton')\n    if (!mnemonicEncrypted) {\n      for (const field of ['mnemonicsEncrypted', 'addresses', 'publicKeys'] as unknown as StorageKey[]) {\n        const raw = await storage.getItem(field);\n        if (!raw) continue;\n\n        const oldItem = JSON.parse(raw);\n\n        const newItem = Object.entries(oldItem).reduce((prevValue, [accountId, data]) => {\n          const [id, chain = 'ton'] = accountId.split('-');\n          const internalAccountId = [id, chain].join('-');\n          prevValue[internalAccountId] = data;\n          return prevValue;\n        }, {} as any);\n\n        await storage.setItem(field, JSON.stringify(newItem));\n      }\n    }\n\n    version = 1;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 1) {\n    const addresses = await storage.getItem('addresses' as StorageKey) as string | undefined;\n    if (addresses && addresses.includes('-undefined')) {\n      for (const field of ['mnemonicsEncrypted', 'addresses', 'publicKeys'] as unknown as StorageKey[]) {\n        const newValue = (await storage.getItem(field) as string).replace('-undefined', '-ton');\n        await storage.setItem(field, newValue);\n      }\n    }\n\n    version = 2;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version >= 2 && version <= 4) {\n    for (const key of ['addresses', 'mnemonicsEncrypted', 'publicKeys', 'dapps'] as StorageKey[]) {\n      const rawData = await storage.getItem(key);\n      if (typeof rawData === 'string') {\n        await storage.setItem(key, JSON.parse(rawData));\n      }\n    }\n\n    version = 5;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 5) {\n    const dapps = await storage.getItem('dapps') as ApiDappsState;\n    if (dapps) {\n      for (const accountDapps of Object.values(dapps)) {\n        for (const dapp of Object.values(accountDapps as Record<string, any>)) {\n          dapp.connectedAt = 1;\n        }\n      }\n      await storage.setItem('dapps', dapps);\n    }\n\n    version = 6;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 6) {\n    for (const key of ['addresses', 'mnemonicsEncrypted', 'publicKeys', 'accounts', 'dapps'] as StorageKey[]) {\n      let data = await storage.getItem(key) as AnyLiteral;\n      if (!data) continue;\n\n      data = Object.entries(data).reduce((byAccountId, [internalAccountId, accountData]) => {\n        const parsed = parseAccountId(internalAccountId);\n        const mainnetAccountId = buildOldAccountId({ ...parsed, network: 'mainnet' });\n        const testnetAccountId = buildOldAccountId({ ...parsed, network: 'testnet' });\n        return {\n          ...byAccountId,\n          [mainnetAccountId]: accountData,\n          [testnetAccountId]: accountData,\n        };\n      }, {} as AnyLiteral);\n\n      await storage.setItem(key, data);\n    }\n\n    version = 7;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 7) {\n    const addresses = (await storage.getItem('addresses' as StorageKey)) as Record<string, string> | undefined;\n\n    if (addresses) {\n      const publicKeys = (await storage.getItem('publicKeys' as StorageKey)) as Record<string, string>;\n      const accounts = (await storage.getItem('accounts') ?? {}) as Record<string, ApiTonWallet>;\n\n      for (const [accountId, oldAddress] of Object.entries(addresses)) {\n        const newAddress = toBase64Address(oldAddress, false);\n\n        accounts[accountId] = {\n          ...accounts[accountId],\n          address: newAddress,\n          publicKey: publicKeys[accountId],\n        };\n\n        onUpdate({\n          type: 'updateAccount',\n          accountId,\n          chain: 'ton',\n          address: newAddress,\n        });\n      }\n\n      await storage.setItem('accounts', accounts);\n\n      await storage.removeItem('addresses' as StorageKey);\n      await storage.removeItem('publicKeys' as StorageKey);\n    }\n\n    version = 8;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 8) {\n    if (getEnvironment().isSseSupported) {\n      const dapps = await storage.getItem('dapps') as ApiDappsState;\n\n      if (dapps) {\n        const items: ApiDbSseConnection[] = [];\n\n        for (const accountDapps of Object.values(dapps)) {\n          for (const dapp of Object.values(accountDapps as Record<string, any>)) {\n            if (dapp.sse?.appClientId) {\n              items.push({ clientId: dapp.sse?.appClientId });\n            }\n          }\n        }\n      }\n    }\n\n    version = 9;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 9) {\n    if (IS_CAPACITOR) {\n      const data = await idbStorage.getAll!();\n\n      for (const [key, value] of Object.entries(data)) {\n        await capacitorStorage.setItem(key as StorageKey, value);\n        const newValue = await capacitorStorage.getItem(key as StorageKey, true);\n\n        if (!areDeepEqual(value, newValue)) {\n          throw new Error('Migration error!');\n        }\n      }\n      await idbStorage.clear();\n    }\n\n    version = 10;\n    await storage.setItem('stateVersion', version);\n  }\n\n  let isIosKeychainModeMigrated = false;\n  if (getEnvironment().isIosApp && version >= 10 && version <= 13) {\n    await iosBackupAndMigrateKeychainMode();\n    isIosKeychainModeMigrated = true;\n  }\n\n  if (version === 10 || version === 11 || version === 12) {\n    const accounts: Record<string, {\n      publicKey: string;\n      address: string;\n      version?: string;\n    }> | undefined = await storage.getItem('accounts', true);\n\n    if (accounts) {\n      for (const account of Object.values(accounts)) {\n        const { publicKey, address, version: walletVersion } = account;\n\n        if (walletVersion || !publicKey) continue;\n\n        const publicKeyBytes = hexToBytes(publicKey);\n        const walletInfo = ton.pickWalletByAddress('mainnet', publicKeyBytes, address);\n\n        account.version = walletInfo.version;\n      }\n\n      await storage.setItem('accounts', accounts);\n    }\n\n    version = 13;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 13) {\n    const accounts: Record<string, {\n      publicKey: string;\n      address: string;\n      version?: string;\n    }> | undefined = await storage.getItem('accounts', true);\n\n    if (accounts) {\n      for (const [accountId, account] of Object.entries(accounts)) {\n        const { network } = parseAccountId(accountId);\n        if (network === 'testnet') {\n          account.address = toBase64Address(account.address, false, network);\n\n          onUpdate({\n            type: 'updateAccount',\n            accountId,\n            chain: 'ton',\n            address: account.address,\n          });\n        }\n      }\n\n      version = 14;\n      await storage.setItem('accounts', accounts);\n    }\n  }\n\n  if (version === 14 || version === 15) {\n    if (getEnvironment().isIosApp && !isIosKeychainModeMigrated) {\n      await iosBackupAndMigrateKeychainMode();\n    }\n\n    version = 16;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 16) {\n    await migrations.migration16.start();\n\n    version = 17;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 17) {\n    await migrations.migration17.start();\n\n    version = 18;\n    await storage.setItem('stateVersion', version);\n  }\n\n  if (version === 18) {\n    await migrations.migration18.start(accountIds);\n\n    version = 19;\n    await storage.setItem('stateVersion', version);\n  }\n}\n\nfunction buildOldAccountId(account: { id: number; network: string }) {\n  const { id, network } = account;\n  return `${id}-ton-${network}`;\n}\n\nasync function iosBackupAndMigrateKeychainMode() {\n  const keys = await capacitorStorage.getKeys();\n\n  if (keys?.length) {\n    const items: [string, any][] = [];\n\n    for (const key of keys) {\n      if (key.startsWith('backup_')) {\n        continue;\n      }\n\n      const backupKey = `backup_${key}` as StorageKey;\n      const value = await capacitorStorage.getItem(key as StorageKey, true);\n\n      assert(value !== undefined, 'Empty value!');\n      await capacitorStorage.setItem(backupKey, value);\n      const backupValue = await capacitorStorage.getItem(backupKey);\n      assert(areDeepEqual(value, backupValue), 'Data has not been saved!');\n\n      items.push([key, value]);\n    }\n\n    for (const [key, value] of items) {\n      let shouldRewrite = false;\n      await capacitorStorage.setItem(key as StorageKey, value).catch(() => {\n        shouldRewrite = true;\n      });\n\n      if (shouldRewrite) {\n        await capacitorStorage.removeItem(key as StorageKey);\n        await capacitorStorage.setItem(key as StorageKey, value);\n      }\n    }\n  }\n}\n\nasync function migrateCoreWallet(onUpdate: OnApiUpdate) {\n  const currentStorage = IS_EXTENSION ? storage : localStorage;\n\n  const [\n    // Default Core Wallet version is v3R2\n    // https://github.com/toncenter/ton-wallet/blob/master/src/js/Controller.js#L128\n    walletVersion = 'v3R2',\n    isTestnet,\n    address,\n    words,\n    publicKey,\n    isTonProxyEnabled,\n    isTonMagicEnabled,\n  ] = await Promise.all([\n    currentStorage.getItem('walletVersion' as StorageKey),\n    currentStorage.getItem('isTestnet' as StorageKey),\n    currentStorage.getItem('address' as StorageKey),\n    currentStorage.getItem('words' as StorageKey),\n    currentStorage.getItem('publicKey' as StorageKey),\n    currentStorage.getItem('proxy' as StorageKey),\n    currentStorage.getItem('magic' as StorageKey),\n  ]);\n\n  if (isTestnet) {\n    onUpdate({\n      type: 'updateSettings',\n      settings: {\n        isTestnet: true,\n      },\n    });\n  }\n\n  const network = isTestnet ? 'testnet' : 'mainnet';\n  const accountId = `0-ton-${network}`;\n\n  if (address && words && publicKey) {\n    const secondNetwork = network === 'mainnet' ? 'testnet' : 'mainnet';\n    const secondAccountId = `0-ton-${secondNetwork}`;\n    const secondAddress = toBase64Address(address, false, secondNetwork);\n\n    const newAccountById: Record<string, ApiTonAccount> = {};\n    newAccountById[accountId] = {\n      type: 'ton',\n      mnemonicEncrypted: words,\n      ton: {\n        type: 'ton',\n        address,\n        version: walletVersion,\n        publicKey,\n        index: 0,\n      },\n    };\n\n    newAccountById[secondAccountId] = {\n      type: 'ton',\n      mnemonicEncrypted: words,\n      ton: {\n        type: 'ton',\n        address: secondAddress,\n        version: walletVersion,\n        publicKey,\n        index: 0,\n      },\n    };\n\n    await storage.setItem('accounts', newAccountById);\n\n    onUpdate({\n      type: 'migrateCoreApplication',\n      isTestnet,\n      accountId,\n      address,\n      secondAccountId,\n      secondAddress,\n      isTonProxyEnabled,\n      isTonMagicEnabled,\n    });\n\n    // Clean up storage after migrate the app from Core Wallet\n    [\n      'walletVersion', 'isTestnet', 'words', 'address', 'publicKey', 'magic', 'proxy', 'isLedger',\n      'ledgerTransportType', '__time', 'isDebug',\n    ].forEach((key) => {\n      void currentStorage.removeItem(key as StorageKey);\n    });\n  }\n}\n","import { Cell } from '@ton/core';\n\nimport type {\n  ApiActivity,\n  ApiNetwork,\n  ApiNft,\n  ApiNftSuperCollection,\n  ApiSwapActivity,\n  ApiSwapDexLabel,\n  ApiToken,\n  ApiTransactionActivity,\n  ApiTransactionType,\n} from '../../../types';\nimport type {\n  AddressBook,\n  AnyAction,\n  AnyTokenMetadata,\n  AuctionBidAction,\n  CallContractAction,\n  ChangeDnsAction,\n  ContractDeployAction,\n  DeleteDnsAction,\n  DexDepositLiquidityAction,\n  DexSlug,\n  DexWithdrawLiquidityAction,\n  JettonBurnAction,\n  JettonMasterMetadata,\n  JettonMintAction,\n  JettonTransferAction,\n  MetadataMap,\n  NftCollectionMetadata,\n  NftItemMetadata,\n  NftMintAction,\n  NftTransferAction,\n  RenewDnsAction,\n  StakeDepositAction,\n  StakeWithdrawalAction,\n  StakeWithdrawalRequestAction,\n  SwapAction,\n  TonTransferAction,\n} from './types';\n\nimport {\n  BURN_ADDRESS,\n  DNS_IMAGE_GEN_URL,\n  ETHENA_STAKING_VAULT,\n  LIQUID_POOL,\n  MTW_CARDS_COLLECTION,\n  MYCOIN_STAKING_POOL,\n  NFT_FRAGMENT_COLLECTIONS,\n  NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX,\n  STON_PTON_ADDRESS,\n  TON_TSUSDE,\n  TON_USDE,\n  TONCOIN,\n} from '../../../../config';\nimport { buildTxId, parseTxId } from '../../../../util/activities';\nimport { toMilliseconds, toSeconds } from '../../../../util/datetime';\nimport { toDecimal } from '../../../../util/decimals';\nimport { getDnsDomainZone } from '../../../../util/dns';\nimport { fixIpfsUrl, getProxiedLottieUrl } from '../../../../util/fetch';\nimport { omitUndefined } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport safeExec from '../../../../util/safeExec';\nimport { buildMtwCardsNftMetadata, getIsFragmentGift, readComment } from '../util/metadata';\nimport { toBase64Address } from '../util/tonCore';\nimport {\n  checkHasScamLink,\n  checkIsTrustedCollection,\n  getNftSuperCollectionsByCollectionAddress,\n} from '../../../common/addresses';\nimport { updateActivityMetadata } from '../../../common/helpers';\nimport { buildTokenSlug, getTokenBySlug } from '../../../common/tokens';\nimport {\n  EXCESS_OP_CODES,\n  JettonStakingOpCode,\n  OpCode,\n  OUR_FEE_PAYLOAD_BOC,\n  TeleitemOpCode,\n} from '../constants';\nimport { callToncenterV3 } from './other';\n\ntype ActionsResponse = {\n  actions: AnyAction[];\n  address_book: AddressBook;\n  metadata?: MetadataMap;\n};\n\ntype ParseOptions = {\n  network: ApiNetwork;\n  addressBook: AddressBook;\n  walletAddress: string;\n  metadata: MetadataMap;\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>;\n  isPending?: boolean;\n};\n\nconst RAW_LIQUID_POOL_ADDRESS = '0:F6FF877DD4CE1355B101572045F09D54C29309737EB52CA542CFA6C195F7CC5B';\nconst RAW_NFT_CARD_COLLECTION = '0:901362FD85FC31D55F2C82617D91EADA1F1D6B34AF559A047572D56F20D046CA';\nconst TME_RENEW_HASH_SUFFIX = '0000000000000000000000000000000000000000000000';\n\nconst RAW_NFT_COLLECTIONS_TO_RELOAD_METADATA = new Set<string | null>([RAW_NFT_CARD_COLLECTION]);\n\ntype FetchActionsOptions = {\n  network: ApiNetwork;\n  filter: {\n    /** Mismatches `walletAddress` when actions are requested for a specific token */\n    address: string | string[];\n  } | {\n    actionId: string | string[];\n  };\n  limit: number;\n  walletAddress: string;\n  fromTimestamp?: number;\n  toTimestamp?: number;\n  shouldIncludeFrom?: boolean;\n  shouldIncludeTo?: boolean;\n  includeTypes?: AnyAction['type'][];\n  excludeTypes?: AnyAction['type'][];\n};\n\nexport async function fetchActions(options: FetchActionsOptions): Promise<ApiActivity[]> {\n  const {\n    network, filter, limit, toTimestamp, fromTimestamp,\n    shouldIncludeFrom, shouldIncludeTo, walletAddress,\n    includeTypes, excludeTypes,\n  } = options;\n\n  const data: AnyLiteral = {\n    account: 'address' in filter ? filter.address : undefined,\n    action_id: 'actionId' in filter ? filter.actionId : undefined,\n    limit,\n    start_utime: fromTimestamp && toSeconds(fromTimestamp) + (!shouldIncludeFrom ? 1 : 0),\n    end_utime: toTimestamp && toSeconds(toTimestamp) - (!shouldIncludeTo ? 1 : 0),\n    sort: 'desc',\n    ...(includeTypes?.length && { action_type: includeTypes.join(',') }),\n    ...(excludeTypes?.length && { exclude_action_type: excludeTypes.join(',') }),\n  };\n\n  // The API sorts the actions by trace_end_lt + trace_id + action_end_lt + action_id.\n  // That is, the actions are grouped by the trace, and sorted by the time inside the groups.\n  const {\n    actions: rawActions,\n    address_book: addressBook,\n    metadata = {},\n  } = await callToncenterV3<ActionsResponse>(network, '/actions', data);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  return parseActions(\n    network,\n    walletAddress,\n    rawActions,\n    addressBook,\n    metadata,\n    nftSuperCollectionsByCollectionAddress,\n  );\n}\n\nexport async function fetchPendingActions(network: ApiNetwork, address: string): Promise<ApiActivity[]> {\n  const {\n    actions,\n    address_book: addressBook,\n    metadata = {},\n  } = await callToncenterV3<ActionsResponse>(network, '/pendingActions', {\n    account: address,\n  });\n\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  return parseActions(\n    network,\n    address,\n    actions,\n    addressBook,\n    metadata,\n    nftSuperCollectionsByCollectionAddress,\n    true,\n  );\n}\n\nexport function parseActions(\n  network: ApiNetwork,\n  walletAddress: string,\n  rawActions: AnyAction[],\n  addressBook: AddressBook,\n  metadata: MetadataMap,\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n  isPending?: boolean,\n): ApiActivity[] {\n  const options: ParseOptions = {\n    network,\n    addressBook,\n    walletAddress,\n    metadata,\n    nftSuperCollectionsByCollectionAddress,\n    isPending,\n  };\n  const activities = [];\n\n  for (const action of rawActions) {\n    activities.push(...parseAction(action, options));\n  }\n\n  return activities;\n}\n\nfunction parseAction(action: AnyAction, options: ParseOptions): ApiActivity[] {\n  let result: (ApiActivity | undefined)[] = [];\n\n  switch (action.type) {\n    case 'ton_transfer': {\n      result = [parseTonTransfer(action, options)];\n      break;\n    }\n    case 'call_contract': {\n      result = [parseCallContract(action, options)];\n      break;\n    }\n    case 'contract_deploy': {\n      result = [parseContractDeploy(action, options)];\n      break;\n    }\n    case 'nft_transfer': {\n      result = [parseNftTransfer(action, options)];\n      break;\n    }\n    case 'nft_mint': {\n      result = [parseNftMint(action, options)];\n      break;\n    }\n    case 'jetton_transfer': {\n      result = [parseJettonTransfer(action, options)];\n      break;\n    }\n    case 'jetton_mint': {\n      result = [parseJettonMint(action, options)];\n      break;\n    }\n    case 'jetton_burn': {\n      result = [parseJettonBurn(action, options)];\n      break;\n    }\n    case 'stake_deposit': {\n      result = [parseStakeDeposit(action, options)];\n      break;\n    }\n    case 'stake_withdrawal': {\n      result = [parseStakeWithdrawal(action, options)];\n      break;\n    }\n    case 'stake_withdrawal_request': {\n      result = [parseStakeWithdrawalRequest(action, options)];\n      break;\n    }\n    case 'jetton_swap': {\n      result = [parseJettonSwap(action, options)];\n      break;\n    }\n    case 'change_dns':\n    case 'delete_dns':\n    case 'renew_dns': {\n      result = [parseDns(action, options)];\n      break;\n    }\n    case 'auction_bid': {\n      result = [parseAuctionBid(action, options)];\n      break;\n    }\n    case 'dex_deposit_liquidity': {\n      result = parseLiquidityDeposit(action, options);\n      break;\n    }\n    case 'dex_withdraw_liquidity': {\n      result = parseLiquidityWithdraw(action, options);\n      break;\n    }\n  }\n\n  for (let i = 0; i < result.length; i++) {\n    const activity = result[i];\n    if (!activity) continue;\n\n    if ('nft' in activity && activity.nft?.isHidden) {\n      activity.shouldHide = true;\n    }\n\n    if (activity.kind === 'transaction' && !activity.isIncoming) {\n      activity.shouldLoadDetails ??= true;\n    }\n\n    result[i] = updateActivityMetadata(activity);\n  }\n\n  return result.filter(Boolean);\n}\n\nfunction parseTonTransfer(action: TonTransferAction, options: ParseOptions): ApiTransactionActivity {\n  const { details, details: { encrypted: isEncrypted, source, destination, value } } = action;\n\n  const comment = (!isEncrypted && details.comment) || undefined;\n  const encryptedComment = (isEncrypted && details.comment) || undefined;\n\n  return {\n    ...parseCommonFields(action, options, source, destination, value),\n    slug: TONCOIN.slug,\n    comment,\n    encryptedComment,\n  };\n}\n\nfunction parseCallContract(action: CallContractAction, options: ParseOptions): ApiTransactionActivity | undefined {\n  const { walletAddress } = options;\n  const { details, details: { source, destination, value } } = action;\n\n  const common = parseCommonFields(action, options, source, destination, value);\n  const opCode = Number(details.opcode);\n  const shouldHide = !common.isIncoming && [OpCode.OurFee, TeleitemOpCode.Ok].includes(opCode);\n\n  let type: ApiTransactionType | undefined;\n  if (EXCESS_OP_CODES.includes(opCode)) {\n    type = 'excess';\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison\n  } else if (opCode === OpCode.Bounced) {\n    type = 'bounced';\n  } else if ([JettonStakingOpCode.UnstakeRequest, JettonStakingOpCode.ClaimRewards].includes(opCode)) {\n    type = 'unstakeRequest';\n  } else if (common.toAddress !== walletAddress) {\n    type = 'callContract';\n  }\n\n  return {\n    ...common,\n    slug: TONCOIN.slug,\n    type,\n    shouldHide,\n  };\n}\n\nfunction parseContractDeploy(action: ContractDeployAction, options: ParseOptions): ApiTransactionActivity | undefined {\n  const { details: { source, destination } } = action;\n\n  if (!source) {\n    return undefined;\n  }\n\n  // Deploy action is additional and always occurs alongside others (duplicating amount), so we hide amount and fee.\n\n  return {\n    ...parseCommonFields(action, options, source, destination),\n    slug: TONCOIN.slug,\n    type: 'contractDeploy',\n    shouldLoadDetails: false,\n    fee: 0n,\n  };\n}\n\nfunction parseJettonTransfer(action: JettonTransferAction, options: ParseOptions): ApiTransactionActivity {\n  const { addressBook } = options;\n  const {\n    details,\n    details: {\n      is_encrypted_comment: isEncrypted,\n      forward_payload: forwardPayload,\n      sender,\n      receiver,\n      amount,\n    },\n  } = action;\n\n  const common = parseCommonFields(action, options, sender, receiver, amount);\n  const { isIncoming, toAddress, fromAddress } = common;\n\n  const comment = (!isEncrypted && details.comment) || undefined;\n  const encryptedComment = (isEncrypted && details.comment) || undefined;\n  const tokenAddress = addressBook[details.asset].user_friendly;\n  const slug = buildTokenSlug('ton', tokenAddress);\n  const shouldHide = !isIncoming && forwardPayload === OUR_FEE_PAYLOAD_BOC;\n\n  let type: ApiTransactionType;\n  if (toAddress === BURN_ADDRESS) {\n    type = 'burn';\n  } else if (toAddress === MYCOIN_STAKING_POOL) {\n    type = 'stake';\n  } else if (fromAddress === MYCOIN_STAKING_POOL) {\n    type = 'unstake';\n  } else if (tokenAddress === TON_USDE.tokenAddress) {\n    if (fromAddress === ETHENA_STAKING_VAULT) {\n      type = 'unstake';\n    } else if (toAddress === ETHENA_STAKING_VAULT) {\n      type = 'stake';\n    }\n  }\n\n  return {\n    ...common,\n    slug,\n    comment,\n    encryptedComment,\n    shouldHide,\n    type,\n  };\n}\n\nfunction parseJettonMint(action: JettonMintAction, options: ParseOptions): ApiTransactionActivity {\n  const { addressBook } = options;\n  const {\n    details,\n    details: {\n      receiver,\n      receiver_jetton_wallet: jettonWalletRaw,\n      amount,\n    },\n  } = action;\n\n  const tokenAddress = addressBook[details.asset].user_friendly;\n  const slug = buildTokenSlug('ton', tokenAddress);\n\n  let commonFields: ReturnType<typeof parseCommonFields>;\n  let type: ApiTransactionType = 'mint';\n\n  if (\n    tokenAddress === TON_TSUSDE.tokenAddress\n    && action.end_lt !== action.trace_end_lt\n  ) {\n    // TODO After fix on Toncenter's side, move it to transfer parsing (currently it's mistakenly detected as mint)\n    type = 'unstakeRequest';\n    commonFields = {\n      ...parseCommonFields(action, options, receiver, receiver, 0),\n      toAddress: ETHENA_STAKING_VAULT,\n      isIncoming: false,\n      normalizedAddress: ETHENA_STAKING_VAULT,\n    };\n  } else {\n    commonFields = parseCommonFields(action, options, jettonWalletRaw, receiver, amount);\n  }\n\n  return {\n    ...commonFields,\n    slug,\n    type,\n  };\n}\n\nfunction parseJettonBurn(action: JettonBurnAction, options: ParseOptions): ApiTransactionActivity {\n  const { network } = options;\n  const { details, details: { owner, owner_jetton_wallet: jettonWallet, amount } } = action;\n\n  const slug = buildTokenSlug('ton', toBase64Address(details.asset, true, network));\n\n  return {\n    ...parseCommonFields(action, options, owner, jettonWallet, amount),\n    slug,\n    type: 'burn',\n  };\n}\n\nfunction parseNftTransfer(action: NftTransferAction, options: ParseOptions): ApiTransactionActivity {\n  const {\n    metadata,\n    walletAddress,\n    addressBook,\n    nftSuperCollectionsByCollectionAddress,\n  } = options;\n\n  const {\n    nft_item_index: index,\n    nft_item: rawNftAddress,\n    nft_collection: rawCollectionAddress,\n    new_owner: newOwner,\n    old_owner: oldOwner,\n    forward_payload: forwardPayload,\n    is_purchase: isPurchase,\n    price,\n    response_destination: responseDestination,\n    marketplace,\n  } = action.details;\n\n  const { nft, isMetadataMissing } = parseToncenterNft(\n    metadata,\n    rawNftAddress,\n    nftSuperCollectionsByCollectionAddress,\n    rawCollectionAddress ?? undefined,\n    index ?? undefined,\n  );\n\n  let shouldHide = !nft && rawCollectionAddress ? isHiddenCollection(rawCollectionAddress, metadata) : undefined;\n\n  // Hide duplicate NFT transfer actions that appear when listing NFT on Getgems marketplace\n  // These are actions where old_owner and new_owner are not the wallet address,\n  // but wallet address is only in response_destination\n  if (oldOwner && newOwner && responseDestination) {\n    const oldOwnerAddress = addressBook[oldOwner]?.user_friendly;\n    const newOwnerAddress = addressBook[newOwner]?.user_friendly;\n\n    if (oldOwnerAddress !== walletAddress && newOwnerAddress !== walletAddress) {\n      shouldHide = true;\n    }\n  }\n\n  const activity: ApiTransactionActivity = {\n    ...parseCommonFields(action, options, oldOwner ?? rawNftAddress, newOwner),\n    shouldHide,\n    slug: TONCOIN.slug,\n    nft,\n    comment: (forwardPayload && safeReadComment(forwardPayload)) || undefined,\n    shouldReload: (isMetadataMissing && RAW_NFT_COLLECTIONS_TO_RELOAD_METADATA.has(action.details.nft_collection))\n      || undefined,\n  };\n\n  if (activity.toAddress === BURN_ADDRESS) {\n    activity.type = 'burn';\n  } else if (isPurchase && price) {\n    const isBuying = addressBook[newOwner]?.user_friendly === walletAddress;\n    activity.type = 'nftTrade';\n    activity.isIncoming = !isBuying;\n    activity.amount = isBuying ? -BigInt(price) : BigInt(price);\n    activity.extra = {\n      marketplace: marketplace ?? undefined,\n    };\n  }\n\n  return activity;\n}\n\nfunction parseNftMint(action: NftMintAction, options: ParseOptions): ApiTransactionActivity {\n  const { metadata, nftSuperCollectionsByCollectionAddress } = options;\n\n  const {\n    owner,\n    nft_item_index: index,\n    nft_item: rawNftAddress,\n    nft_collection: rawCollectionAddress,\n  } = action.details;\n\n  const { nft, isMetadataMissing } = parseToncenterNft(\n    metadata,\n    rawNftAddress,\n    nftSuperCollectionsByCollectionAddress,\n    rawCollectionAddress ?? undefined,\n    index ?? undefined,\n  );\n\n  return {\n    ...parseCommonFields(action, options, owner, rawNftAddress),\n    slug: TONCOIN.slug,\n    nft,\n    type: 'mint',\n    shouldReload: (isMetadataMissing && RAW_NFT_COLLECTIONS_TO_RELOAD_METADATA.has(action.details.nft_collection))\n      || undefined,\n  };\n}\n\nfunction isHiddenCollection(rawCollectionAddress: string, metadata: MetadataMap) {\n  const collectionMetadata = metadata[rawCollectionAddress]?.token_info[0] as NftCollectionMetadata | undefined;\n  return collectionMetadata?.name?.includes('Withdrawal Payout');\n}\n\nfunction parseStakeDeposit(action: StakeDepositAction, options: ParseOptions): ApiTransactionActivity {\n  const { details: { stake_holder: holder, pool, amount } } = action;\n\n  return {\n    ...parseCommonFields(action, options, holder, pool, amount),\n    slug: TONCOIN.slug,\n    type: 'stake',\n  };\n}\n\nfunction parseStakeWithdrawal(action: StakeWithdrawalAction, options: ParseOptions): ApiTransactionActivity {\n  const { addressBook } = options;\n  const { details, details: { stake_holder: holder, amount } } = action;\n\n  // Fix issue with old data when pool is null\n  const pool = details.pool ?? RAW_LIQUID_POOL_ADDRESS;\n  const fixedOptions = pool in addressBook ? options : {\n    ...options,\n    addressBook: {\n      ...addressBook,\n      // eslint-disable-next-line no-null/no-null\n      [pool]: { user_friendly: LIQUID_POOL, domain: null },\n    },\n  };\n\n  return {\n    ...parseCommonFields(action, fixedOptions, pool, holder, amount),\n    slug: TONCOIN.slug,\n    type: 'unstake',\n    shouldLoadDetails: details.provider === 'tonstakers' && !details.payout_nft,\n  };\n}\n\nfunction parseStakeWithdrawalRequest(\n  action: StakeWithdrawalRequestAction,\n  options: ParseOptions,\n): ApiTransactionActivity {\n  const { details: { stake_holder: holder, pool } } = action;\n\n  return {\n    ...parseCommonFields(action, options, holder, pool, 0), // TODO (actions) Replace to real fee\n    slug: TONCOIN.slug,\n    type: 'unstakeRequest',\n  };\n}\n\nfunction parseJettonSwap(action: SwapAction, options: ParseOptions): ApiSwapActivity {\n  const { metadata, isPending } = options;\n  const {\n    end_utime: endUtime,\n    success: isSuccess,\n    details: {\n      dex_incoming_transfer: {\n        amount: fromAmount,\n        asset: fromAsset,\n      },\n      dex_outgoing_transfer: {\n        amount: toAmount,\n        asset: toAsset,\n      },\n    },\n  } = action;\n\n  const decimalsFrom = (fromAsset && parseToncenterJetton(fromAsset, metadata)?.decimals) || TONCOIN.decimals;\n  const decimalsTo = (toAsset && parseToncenterJetton(toAsset, metadata)?.decimals) || TONCOIN.decimals;\n\n  const fromTokenAddress = fromAsset ? toBase64Address(fromAsset, true) : undefined;\n  const toTokenAddress = toAsset ? toBase64Address(toAsset, true) : undefined;\n\n  const from = fromTokenAddress && fromTokenAddress !== STON_PTON_ADDRESS\n    ? buildTokenSlug('ton', fromTokenAddress) : TONCOIN.slug;\n  const to = toTokenAddress && toTokenAddress !== STON_PTON_ADDRESS\n    ? buildTokenSlug('ton', toTokenAddress) : TONCOIN.slug;\n\n  return {\n    kind: 'swap',\n    id: buildActionActivityId(action),\n    timestamp: toMilliseconds(endUtime),\n    from,\n    fromAmount: toDecimal(BigInt(fromAmount), decimalsFrom),\n    to,\n    toAmount: toDecimal(BigInt(toAmount), decimalsTo),\n    networkFee: '0',\n    swapFee: '0',\n    ourFee: '0',\n    status: isPending ? 'pending' : isSuccess ? 'completed' : 'failed',\n    hashes: [],\n    externalMsgHashNorm: action.trace_external_hash_norm ?? action.trace_external_hash,\n    shouldLoadDetails: true,\n  };\n}\n\nfunction parseDns(\n  action: ChangeDnsAction | RenewDnsAction | DeleteDnsAction,\n  options: ParseOptions,\n): ApiTransactionActivity {\n  const { metadata, nftSuperCollectionsByCollectionAddress } = options;\n  const { details: { source, asset } } = action;\n\n  const { nft } = parseToncenterNft(metadata, asset, nftSuperCollectionsByCollectionAddress);\n\n  let type: ApiTransactionType;\n  if (action.type === 'change_dns') {\n    const { sum_type: sumType } = action.details.value;\n    if (sumType === 'DNSSmcAddress') {\n      type = 'dnsChangeAddress';\n    } else if (sumType === 'DNSAdnlAddress') {\n      type = 'dnsChangeSite';\n    } else if (sumType === 'DNSStorageAddress') {\n      type = 'dnsChangeStorage';\n    } else if (sumType === 'DNSNextResolver') {\n      type = 'dnsChangeSubdomains';\n    }\n  } else if (\n    action.type === 'renew_dns'\n    || (action.type === 'delete_dns' && action.details.hash.endsWith(TME_RENEW_HASH_SUFFIX))\n  ) {\n    type = 'dnsRenew';\n  } else {\n    type = 'dnsDelete';\n  }\n\n  return {\n    ...parseCommonFields(action, options, source, asset, 0), // TODO (actions) Replace to real fee\n    slug: TONCOIN.slug,\n    type,\n    nft,\n  };\n}\n\nfunction parseAuctionBid(action: AuctionBidAction, options: ParseOptions): ApiTransactionActivity {\n  const { metadata, nftSuperCollectionsByCollectionAddress } = options;\n  const { details } = action;\n\n  const {\n    bidder,\n    auction,\n    nft_item_index: index,\n    nft_item: rawNftAddress,\n    nft_collection: rawCollectionAddress,\n  } = details;\n\n  const { nft } = parseToncenterNft(\n    metadata,\n    rawNftAddress ?? undefined,\n    nftSuperCollectionsByCollectionAddress,\n    rawCollectionAddress ?? undefined,\n    index ?? undefined,\n  );\n\n  return {\n    ...parseCommonFields(action, options, bidder, auction, details.amount),\n    slug: TONCOIN.slug,\n    type: 'auctionBid',\n    nft,\n  };\n}\n\nexport function parseLiquidityDeposit(\n  action: DexDepositLiquidityAction,\n  options: ParseOptions,\n): ApiTransactionActivity[] {\n  const { addressBook } = options;\n  const { details, details: { source, pool, destination_liquidity: destinationAddress, dex } } = action;\n\n  const common = parseCommonFields(action, options, source, pool ?? destinationAddress);\n\n  const partialExtended = {\n    ...common,\n    type: 'liquidityDeposit',\n    extra: {\n      dex: convertDexId(dex),\n    },\n  } as const;\n\n  const activities: ApiTransactionActivity[] = [{\n    ...partialExtended,\n    amount: -BigInt(details.amount_1 ?? 0n),\n    slug: getAssetSlug(addressBook, details.asset_1),\n  }];\n\n  // eslint-disable-next-line no-null/no-null\n  if (details.amount_2 !== null) {\n    const id = buildActionActivityId(action, 'additional');\n    activities.push({\n      ...partialExtended,\n      id,\n      txId: id,\n      amount: -BigInt(details.amount_2),\n      slug: getAssetSlug(addressBook, details.asset_2),\n    });\n  }\n\n  return activities;\n}\n\nfunction parseLiquidityWithdraw(action: DexWithdrawLiquidityAction, options: ParseOptions): ApiTransactionActivity[] {\n  const { addressBook } = options;\n  const { details, details: { source, pool, dex } } = action;\n\n  const common = parseCommonFields(action, options, pool, source);\n\n  const partialExtended = {\n    ...common,\n    shouldLoadDetails: true,\n    type: 'liquidityWithdraw',\n    extra: {\n      dex: convertDexId(dex),\n    },\n  } as const;\n\n  const additionalId = buildActionActivityId(action, 'additional');\n\n  return [\n    {\n      ...partialExtended,\n      amount: BigInt(details.amount_1),\n      slug: getAssetSlug(addressBook, details.asset_1),\n    },\n    {\n      ...partialExtended,\n      id: additionalId,\n      txId: additionalId,\n      amount: BigInt(details.amount_2),\n      slug: getAssetSlug(addressBook, details.asset_2),\n    },\n  ];\n}\n\nfunction getAssetSlug(addressBook: AddressBook, rawAddress?: string | null) {\n  return rawAddress ? buildTokenSlug('ton', addressBook[rawAddress].user_friendly) : TONCOIN.slug;\n}\n\nfunction parseCommonFields(\n  action: AnyAction,\n  options: ParseOptions,\n  rawFromAddress: string,\n  rawToAddress: string,\n  amountString: string | number = 0,\n) {\n  const id = buildActionActivityId(action);\n  const { walletAddress, network, addressBook, isPending } = options;\n  const fromAddress = addressBook[rawFromAddress].user_friendly;\n  const toAddress = addressBook[rawToAddress].user_friendly;\n  const isIncoming = toAddress === walletAddress;\n  const normalizedAddress = toBase64Address(isIncoming ? fromAddress : toAddress, true, network);\n  const amount = isIncoming ? BigInt(amountString) : -BigInt(amountString);\n  return {\n    kind: 'transaction',\n    id,\n    txId: id,\n    timestamp: toMilliseconds(action.end_utime),\n    externalMsgHashNorm: action.trace_external_hash_norm ?? action.trace_external_hash,\n    fee: 0n, // Calculated when TransactionModal opens\n    fromAddress,\n    toAddress,\n    isIncoming,\n    normalizedAddress,\n    amount,\n    isPending: isPending || undefined,\n  } satisfies Partial<ApiTransactionActivity>;\n}\n\nfunction parseToncenterNft(\n  metadataMap: MetadataMap,\n  rawNftAddress: string,\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n  rawCollectionAddress?: string,\n  index?: string,\n): { nft?: ApiNft; isMetadataMissing?: true } {\n  try {\n    const nftMetadata = extractMetadata<NftItemMetadata>(rawNftAddress, metadataMap, 'nft_items');\n\n    if (!nftMetadata) {\n      return { isMetadataMissing: true };\n    }\n\n    const { name, description, extra } = nftMetadata;\n    let { image } = nftMetadata;\n    const lottie = extra?.lottie ? getProxiedLottieUrl(extra.lottie) : undefined;\n\n    const nftAddress = toBase64Address(rawNftAddress, true);\n    const collectionMetadata = rawCollectionAddress\n      ? extractMetadata<NftCollectionMetadata>(rawCollectionAddress, metadataMap, 'nft_collections')\n      : undefined;\n    const collectionAddress = rawCollectionAddress ? toBase64Address(rawCollectionAddress, true) : undefined;\n\n    // TODO (actions) Determine that this is a domain by the collection address once Toncenter adds it\n    const domain = extra?.domain ?? name ?? '';\n    const { zone: domainZone, base: domainBase } = getDnsDomainZone(domain) ?? {};\n\n    if (domainZone && (!collectionAddress || !image)) {\n      if (domainZone.suffixes[0] === 'ton') {\n        image = `${DNS_IMAGE_GEN_URL}${domainBase}`;\n      }\n\n      const nft = omitUndefined<ApiNft>({\n        index: Number(index),\n        name: domain,\n        address: nftAddress,\n\n        thumbnail: extra?._image_medium ?? image!,\n        image: image!,\n        description,\n        isOnSale: false, // TODO (actions) Replace with real value when Toncenter supports it\n        collectionAddress: collectionAddress ?? domainZone.resolver,\n        collectionName: domainZone.collectionName,\n        metadata: {\n          ...(lottie && { lottie }),\n        },\n      });\n      return { nft };\n    }\n\n    let hasScamLink = false;\n\n    if (!collectionAddress || !checkIsTrustedCollection(collectionAddress)) {\n      for (const text of [name, description].filter(Boolean)) {\n        if (checkHasScamLink(text)) {\n          hasScamLink = true;\n        }\n      }\n    }\n\n    const isScam = hasScamLink; // TODO (actions) Replace with real value when Toncenter supports it\n    const isHidden = extra?.render_type === 'hidden' || isScam;\n    const isFragmentGift = getIsFragmentGift(nftSuperCollectionsByCollectionAddress, collectionAddress);\n    const isMtwCard = collectionAddress === MTW_CARDS_COLLECTION;\n    const fixedImage = image ? fixIpfsUrl(image) : undefined;\n\n    const thumbnail = extra?._image_medium ?? fixedImage!;\n\n    const nft: ApiNft = omitUndefined<ApiNft>({\n      index: Number(index),\n      name: name!,\n      address: nftAddress,\n      thumbnail,\n      image: fixedImage!,\n      description,\n      isOnSale: false, // TODO (actions) Replace with real value when Toncenter supports it\n      isHidden,\n      metadata: {\n        ...(isFragmentGift && {\n          fragmentUrl: image!.replace(NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX, 'https://$1'),\n        }),\n        // `id` must be set to `index + 1`. Unlike TonApi where this field is preformatted,\n        // we need to manually adjust it here due to data source differences.\n        ...(isMtwCard && buildMtwCardsNftMetadata({\n          id: Number(index || 0) + 1, image, attributes: extra?.attributes,\n        })),\n      },\n      ...(collectionAddress && {\n        collectionAddress,\n        collectionName: collectionMetadata?.name,\n        isOnFragment: isFragmentGift || NFT_FRAGMENT_COLLECTIONS.includes(rawCollectionAddress!),\n        isTelegramGift: isFragmentGift,\n      }),\n    });\n\n    return { nft };\n  } catch (err) {\n    logDebugError('parseToncenterNft', err);\n    return {};\n  }\n}\n\nfunction parseToncenterJetton(rawAddress: string, metadata: MetadataMap): ApiToken | undefined {\n  const tokenAddress = toBase64Address(rawAddress, true);\n  const slug = buildTokenSlug('ton', tokenAddress);\n  const token = getTokenBySlug(slug);\n\n  if (token) {\n    return token;\n  }\n\n  const jettonMetadata = extractMetadata<JettonMasterMetadata>(rawAddress, metadata, 'jetton_masters');\n\n  if (!jettonMetadata) {\n    return undefined;\n  }\n\n  return {\n    tokenAddress,\n    slug,\n    chain: 'ton',\n    name: jettonMetadata.name!,\n    symbol: jettonMetadata.symbol!,\n    image: jettonMetadata.image!,\n    decimals: Number(jettonMetadata.extra!.decimals),\n  };\n}\n\nfunction extractMetadata<T extends AnyTokenMetadata>(\n  rawAddress: string,\n  metadata: MetadataMap,\n  type: AnyTokenMetadata['type'],\n): T | undefined {\n  const data = metadata[rawAddress];\n  if (!data || !data.is_indexed) return undefined;\n  return data.token_info?.find((tokenInfo) => tokenInfo.type === type) as T;\n}\n\nfunction safeReadComment(payloadBase64: string) {\n  return safeExec(() => {\n    const cell = Cell.fromBase64(payloadBase64);\n    if (cell.isExotic) return undefined;\n    return readComment(cell.asSlice());\n  });\n}\n\nfunction buildActionActivityId(action: AnyAction, type?: 'additional') {\n  // `lt` in activity ID is needed for sorting when timestamps are same.\n  // The sorting is tuned to match the Toncenter API sorting as close as possible.\n  const subId = `${action.start_lt}-${action.action_id}`;\n  return buildTxId(\n    action.trace_id ?? action.trace_external_hash_norm ?? action.trace_external_hash,\n    subId,\n    type,\n  );\n}\n\nexport function parseActionActivityId(id: string) {\n  const { hash: traceId, subId } = parseTxId(id);\n  const [startLt, actionId] = subId!.split('-');\n  return { traceId, startLt, actionId };\n}\n\nfunction convertDexId(toncenterDex: DexSlug | undefined): ApiSwapDexLabel | undefined {\n  switch (toncenterDex) {\n    case 'dedust':\n      return 'dedust';\n    case 'stonfi':\n    case 'stonfi_v2':\n      return 'ston';\n    default:\n      return undefined;\n  }\n}\n","export function createCallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>() {\n  const callbacks = new Set<T>();\n\n  function addCallback(cb: T) {\n    callbacks.add(cb);\n\n    return () => {\n      removeCallback(cb);\n    };\n  }\n\n  function removeCallback(cb: T) {\n    callbacks.delete(cb);\n  }\n\n  function runCallbacks(...args: Parameters<T>) {\n    callbacks.forEach((callback) => {\n      callback(...args);\n    });\n  }\n\n  function hasCallbacks() {\n    return Boolean(callbacks.size);\n  }\n\n  return {\n    runCallbacks,\n    addCallback,\n    removeCallback,\n    hasCallbacks,\n  };\n}\n\nexport type CallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>\n  = ReturnType<typeof createCallbackManager<T>>;\n\nexport class EventEmitter {\n  private channels = new Map<string, CallbackManager>();\n\n  on(name: string, handler: AnyToVoidFunction) {\n    this.resolveChannel(name).addCallback(handler);\n    return this;\n  }\n\n  removeListener(name: string, handler: AnyToVoidFunction) {\n    this.resolveChannel(name).removeCallback(handler);\n    return this;\n  }\n\n  emit(name: string, ...args: any) {\n    this.resolveChannel(name).runCallbacks(...args);\n    return this;\n  }\n\n  private resolveChannel(name: string) {\n    let channel = this.channels.get(name);\n    if (!channel) {\n      channel = createCallbackManager();\n      this.channels.set(name, channel);\n    }\n\n    return channel;\n  }\n}\n","import { createCallbackManager } from './callbacks';\nimport { setCancellableTimeout } from './schedulers';\n\nconst focusListeners = createCallbackManager<NoneToVoidFunction>();\n\nlet isFocused = true;\n\n/**\n * Calls `cb` when `ms` milliseconds pass if the app is focused at that moment.\n * Otherwise, waits until the app is focused or `forceMs` millisecond pass (since the very beginning).\n * Returns a function to cancel the timers.\n */\nexport function onFocusAwareDelay(ms: number, forceMs: number, cb: NoneToVoidFunction) {\n  let cleanup: NoneToVoidFunction;\n\n  const callCb = () => {\n    cleanup();\n    cb();\n  };\n\n  // Stage 1: waiting for the minimum time to pass\n  cleanup = setCancellableTimeout(ms, () => {\n    if (isFocused) {\n      callCb();\n    } else {\n      // If the window is not focused, stage2: waiting for either the maximum time to pass or the window to get focused\n      const unsubscribeFocus = focusListeners.addCallback(callCb);\n      const cancelSecondTimeout = setCancellableTimeout(forceMs - ms, callCb);\n      cleanup = () => {\n        unsubscribeFocus();\n        cancelSecondTimeout();\n      };\n    }\n  });\n\n  // We don't return just `cleanup` because it's not constant\n  return () => cleanup();\n}\n\n/**\n * @see onFocusAwareDelay\n */\nexport function focusAwareDelay(ms: number, msWhenNotFocused: number) {\n  return new Promise<void>((resolve) => {\n    onFocusAwareDelay(ms, msWhenNotFocused, resolve);\n  });\n}\n\nexport function setIsAppFocused(_isFocused: boolean) {\n  isFocused = _isFocused;\n\n  if (_isFocused) {\n    focusListeners.runCallbacks();\n  }\n}\n","export const SEC = 1000;\nexport const MINUTE = 60 * SEC;\nexport const DAYS_IN_YEAR = 365;\nexport const FIRST_TRANSACTIONS_LIMIT = 50;\n\nexport const FAKE_TX_ID = 'fakeTxId';\n","import type { WalletPollingOptions } from './walletPolling';\n\nimport Deferred from '../../../util/Deferred';\nimport { focusAwareDelay, onFocusAwareDelay } from '../../../util/focusAwareDelay';\nimport { setCancellableTimeout, throttle } from '../../../util/schedulers';\nimport { MINUTE, SEC } from '../../constants';\n\nexport type Period = number | {\n  focused: number;\n  notFocused: number;\n};\n\nexport const activeWalletTiming = {\n  updateOnStart: true,\n  minUpdateDelay: { focused: SEC, notFocused: 3 * SEC },\n  fallbackUpdateStartDelay: 3 * SEC,\n  fallbackUpdatePeriod: { focused: 1.1 * SEC, notFocused: 10 * SEC },\n  forceUpdatePeriod: { focused: MINUTE, notFocused: 2 * MINUTE },\n} satisfies Partial<WalletPollingOptions>;\n\nexport const inactiveWalletTiming = {\n  updateOnStart: false,\n  minUpdateDelay: { focused: 5 * SEC, notFocused: 30 * SEC },\n  fallbackUpdateStartDelay: 5 * SEC,\n  fallbackUpdatePeriod: { focused: 30 * SEC, notFocused: MINUTE },\n  forceUpdatePeriod: { focused: 2 * MINUTE, notFocused: 5 * MINUTE },\n} satisfies Partial<WalletPollingOptions>;\n\ninterface PollingLoopOptions<Dep> {\n  period: Period;\n  /** The minimum time between the `poll` calls */\n  minDelay?: Period;\n  /** If `true`, `poll` won't be called at the loop start */\n  skipInitialPoll?: boolean;\n  /** Called before any `poll` call */\n  prepare?: () => Promise<Dep>;\n  /** Called periodically. Never executed in parallel. If returns 'stop', the polling stops. */\n  poll: (dependency: Dep) => MaybePromise<void | 'stop'>;\n}\n\n/**\n * Executes the given functions indefinitely with pauses.\n * An execution can be triggered manually, in which case the scheduled execution will be delayed.\n */\nexport function pollingLoop<Dep>({\n  period,\n  minDelay = 0,\n  skipInitialPoll,\n  prepare = () => Promise.resolve() as Promise<Dep>,\n  poll,\n}: PollingLoopOptions<Dep>) {\n  let isStopped = false;\n  let cancelPause: NoneToVoidFunction | undefined;\n  const dependenciesDeferred = new Deferred<Dep>();\n\n  // Using `throttle` to avoid parallel execution\n  const iteration = throttle(async () => {\n    if (isStopped) {\n      return;\n    }\n\n    cancelPause?.();\n    const dependencies = await dependenciesDeferred.promise;\n\n    try {\n      const response = await poll(dependencies);\n      if (response === 'stop') {\n        isStopped = true;\n      }\n    } finally {\n      if (!isStopped) {\n        scheduleIteration();\n      }\n    }\n  }, () => {\n    return focusAwareDelay(...periodToMs(minDelay));\n  });\n\n  function scheduleIteration() {\n    cancelPause?.();\n    cancelPause = onFocusAwareDelay(...periodToMs(period), iteration);\n  }\n\n  void prepare().then((dependencies) => {\n    if (isStopped) {\n      return;\n    }\n\n    dependenciesDeferred.resolve(dependencies);\n\n    if (skipInitialPoll) {\n      scheduleIteration();\n    } else {\n      iteration();\n    }\n  });\n\n  return {\n    poll: iteration,\n    stop() {\n      isStopped = true;\n      cancelPause?.();\n    },\n  };\n}\n\n/**\n * Wraps the given `action` function. When the wrapped function is executed, it executes `action` immediately, and\n * several times after that. The number of additional executions is equal to `pauses.length`. Each number in `pauses` is\n * the pause (in milliseconds) between the `action` executions. When the wrapped function is executed, the previously\n * scheduled additional executions are cancelled.\n *\n * `attemptNumber` starts from 0 and increments with each additional execution.\n */\nexport function withDoubleCheck<Args extends unknown[], Result>(\n  pauses: number[],\n  action: (attemptNumber: number, ...args: Args) => MaybePromise<Result>,\n) {\n  let isStopped = false;\n  let cancelDoubleCheck: NoneToVoidFunction | undefined;\n\n  async function makeAttempt(attemptNumber: number, args: Args) {\n    cancelDoubleCheck?.();\n\n    try {\n      return await action(attemptNumber, ...args);\n    } finally {\n      if (!isStopped && attemptNumber < pauses.length) {\n        cancelDoubleCheck?.(); // Cancelling again due to possible race conditions\n        cancelDoubleCheck = setCancellableTimeout(\n          pauses[attemptNumber],\n          () => makeAttempt(attemptNumber + 1, args),\n        );\n      }\n    }\n  }\n\n  return {\n    /** Executes `actions` and returns the result of the first execution */\n    run(...args: Args) {\n      isStopped = false;\n      return makeAttempt(0, args);\n    },\n    /** Cancels the scheduled additional executions */\n    cancel() {\n      isStopped = true;\n      cancelDoubleCheck?.();\n    },\n  };\n}\n\nexport function periodToMs(period: Period): [ms: number, forceMs: number] {\n  if (typeof period === 'number') {\n    return [period, period];\n  }\n\n  const { focused, notFocused } = period;\n  return [focused, notFocused];\n}\n","import type { Period } from './utils';\n\nimport { focusAwareDelay, onFocusAwareDelay } from '../../../util/focusAwareDelay';\nimport { handleError } from '../../../util/handleError';\nimport { setCancellableTimeout, throttle } from '../../../util/schedulers';\nimport { periodToMs } from './utils';\n\nexport type PollCallback = () => MaybePromise<void>;\n\nexport interface FallbackPollingOptions {\n  pollOnStart?: boolean;\n  minPollDelay: Period;\n  pollingStartDelay: number;\n  pollingPeriod: Period;\n  forcedPollingPeriod: Period;\n  /** Never executed in parallel */\n  poll: PollCallback;\n}\n\n/**\n * Schedules regular polling when the socket is disconnected.\n */\nexport class FallbackPollingScheduler {\n  #options: FallbackPollingOptions;\n\n  #cancelScheduledPoll?: NoneToVoidFunction;\n\n  #isDestroyed = false;\n\n  constructor(isSocketConnected: boolean, options: FallbackPollingOptions) {\n    this.#options = options;\n\n    if (isSocketConnected) {\n      this.#scheduleForcedPolling();\n    } else {\n      this.#schedulePolling();\n    }\n\n    if (options.pollOnStart) {\n      this.#poll();\n    }\n  }\n\n  /** Call this method when the socket source of data becomes available */\n  public onSocketConnect() {\n    if (this.#isDestroyed) return;\n    this.#scheduleForcedPolling();\n    this.#poll();\n  }\n\n  /** Call this method when the socket source of data becomes unavailable */\n  public onSocketDisconnect() {\n    if (this.#isDestroyed) return;\n    this.#schedulePolling();\n  }\n\n  /** Call this method when the socket shows that it's alive */\n  public onSocketMessage() {\n    if (this.#isDestroyed) return;\n    this.#scheduleForcedPolling();\n  }\n\n  public destroy() {\n    this.#isDestroyed = true;\n    this.#cancelScheduledPoll?.();\n  }\n\n  // Using `throttle` to avoid parallel execution.\n  #poll = throttle(async () => {\n    if (this.#isDestroyed) return;\n\n    try {\n      await this.#options.poll();\n    } catch (err: any) {\n      handleError(err);\n    }\n  }, () => {\n    return focusAwareDelay(...periodToMs(this.#options.minPollDelay));\n  });\n\n  /** Sets up a polling running when the socket is disconnected */\n  #schedulePolling() {\n    this.#cancelScheduledPoll?.();\n\n    const { pollingStartDelay, pollingPeriod } = this.#options;\n\n    const handleTimeout = () => {\n      this.#cancelScheduledPoll = onFocusAwareDelay(...periodToMs(pollingPeriod), handleTimeout);\n      this.#poll();\n    };\n\n    this.#cancelScheduledPoll = setCancellableTimeout(pollingStartDelay, handleTimeout);\n  }\n\n  /** Sets up a polling running when the socket is connected (to mitigate network and backend problems) */\n  #scheduleForcedPolling() {\n    this.#cancelScheduledPoll?.();\n\n    const schedule = () => {\n      const { forcedPollingPeriod } = this.#options;\n      this.#cancelScheduledPoll = onFocusAwareDelay(...periodToMs(forcedPollingPeriod), () => {\n        schedule();\n        this.#poll();\n      });\n    };\n\n    schedule();\n  }\n}\n","import { DEFAULT_TIMEOUT } from '../config';\nimport { createCallbackManager } from './callbacks';\nimport { logDebug, logDebugError } from './logs';\nimport { setCancellableTimeout } from './schedulers';\n\nexport type InMessageCallback<T> = (message: T) => void;\nexport type ConnectCallback = NoneToVoidFunction;\n/** isUnexpected is false when the socket is closed manually, i.e. by calling close() */\nexport type DisconnectCallback = (isUnexpected: boolean) => void;\n\nconst RECONNECT_BASE_DELAY = 500;\nconst RECONNECT_MAX_DELAY = 5000;\n\n/**\n * Like WebSocket, but reconnects automatically when the socket disconnects\n */\nexport default class ReconnectingWebSocket<OutMessage, InMessage> {\n  #url: string;\n\n  #socket?: WebSocket;\n\n  /** `true` between the `open` and the `close` events, i.e. when the socket can send and receive messages */\n  #isConnected = false;\n\n  #reconnectAttemptCount = 0;\n\n  /** Cancels setTimeout of the WebSocket open timeout and the reconnect delay (they never happen simultaneously) */\n  #cancelTimeout?: NoneToVoidFunction;\n\n  #outMessageQueue: OutMessage[] = [];\n\n  #inMessageListeners = createCallbackManager<InMessageCallback<InMessage>>();\n\n  #connectListeners = createCallbackManager<ConnectCallback>();\n\n  #disconnectListeners = createCallbackManager<DisconnectCallback>();\n\n  constructor(url: string | URL) {\n    this.#url = url.toString();\n    this.#startSocket();\n  }\n\n  /**\n   * Sends a message via the socket.\n   * If the socket is disconnected, stashes the message until the socket is connected.\n   */\n  public send(message: OutMessage) {\n    if (this.#socket && this.#isConnected) {\n      this.#sendMessageNow(message);\n    } else {\n      this.#outMessageQueue.push(message);\n    }\n  }\n\n  /**\n   * Returns `true` is the socket is connected now. You may send messages regardless of the connection status.\n   * The objects always initializes in the disconnected state.\n   */\n  public get isConnected() {\n    return this.#isConnected;\n  }\n\n  /** Closes the current socket connection and creates a new one. Call it when you suspect the socket has hung. */\n  public reconnect() {\n    this.close();\n    this.#startSocket();\n  }\n\n  /** Registers a callback firing when a message arrives from the socket */\n  public onMessage(callback: InMessageCallback<InMessage>) {\n    return this.#inMessageListeners.addCallback(callback);\n  }\n\n  /**\n   * Registers a callback firing when the socket is connected initially or reconnected.\n   * I.e. when isConnected switches from `false` to `true`.\n   */\n  public onConnect(callback: ConnectCallback) {\n    return this.#connectListeners.addCallback(callback);\n  }\n\n  /**\n   * Registers a callback firing when the socket is disconnected.\n   * I.e. when isConnected switches from `true` to `false`.\n   */\n  public onDisconnect(callback: DisconnectCallback) {\n    return this.#disconnectListeners.addCallback(callback);\n  }\n\n  /** Call it when you don't need the socket anymore. The callbacks won't fire after that. */\n  public close() {\n    this.#stopSocket();\n\n    if (this.#isConnected) {\n      this.#isConnected = false;\n      this.#disconnectListeners.runCallbacks(false);\n    }\n  }\n\n  #startSocket() {\n    this.#stopSocket();\n\n    this.#socket = new WebSocket(this.#url);\n    this.#socket.binaryType = 'arraybuffer';\n\n    this.#socket.onerror = () => logDebugError('WebSocket error event', this.#url);\n    this.#socket.onopen = this.#handleSocketOpen;\n    this.#socket.onclose = this.#handleSocketClose;\n    this.#socket.onmessage = this.#handleSocketMessage;\n\n    // If the socket doesn't open in several seconds, retry opening it\n    this.#cancelTimeout = setCancellableTimeout(DEFAULT_TIMEOUT, () => this.#handleSocketClose('openTimeout'));\n  }\n\n  #stopSocket() {\n    this.#cancelTimeout?.();\n\n    if (!this.#socket) {\n      return;\n    }\n\n    this.#socket.onerror = null; // eslint-disable-line no-null/no-null\n    this.#socket.onopen = null; // eslint-disable-line no-null/no-null\n    this.#socket.onclose = null; // eslint-disable-line no-null/no-null\n    this.#socket.onmessage = null; // eslint-disable-line no-null/no-null\n    this.#socket.close();\n\n    this.#socket = undefined;\n  }\n\n  #sendMessageNow(message: OutMessage) {\n    if (!this.#socket) throw new Error('No active socket');\n    this.#socket.send(JSON.stringify(message));\n  }\n\n  #handleSocketOpen = () => {\n    logDebug('WebSocket opened', this.#url);\n\n    this.#cancelTimeout?.();\n    this.#reconnectAttemptCount = 0;\n\n    while (this.#outMessageQueue.length) {\n      this.#sendMessageNow(this.#outMessageQueue.shift()!);\n    }\n\n    if (!this.#isConnected) {\n      this.#isConnected = true;\n      this.#connectListeners.runCallbacks();\n    }\n  };\n\n  #handleSocketClose = (event: CloseEvent | 'openTimeout') => {\n    if (event === 'openTimeout') {\n      logDebugError('WebSocket open timeout');\n    } else {\n      logDebugError('WebSocket closed unexpectedly', event.code, event.reason, event.wasClean);\n    }\n\n    this.#stopSocket();\n\n    this.#reconnectAttemptCount++;\n    const reconnectDelay = Math.min(RECONNECT_BASE_DELAY * this.#reconnectAttemptCount, RECONNECT_MAX_DELAY);\n    this.#cancelTimeout = setCancellableTimeout(reconnectDelay, () => this.#startSocket());\n\n    if (this.#isConnected) {\n      if (event === 'openTimeout') {\n        throw new Error('Unexpected timeout event in an open socket');\n      }\n\n      this.#isConnected = false;\n      this.#disconnectListeners.runCallbacks(true);\n    }\n  };\n\n  #handleSocketMessage = ({ data }: MessageEvent<string | ArrayBuffer>) => {\n    this.#inMessageListeners.runCallbacks(\n      data instanceof ArrayBuffer\n        ? data as InMessage\n        : JSON.parse(data),\n    );\n  };\n}\n","import type { ApiActivity, ApiNetwork } from '../../../types';\nimport type { ActionsSocketMessage, AddressBook, AnyAction, ClientSocketMessage, ServerSocketMessage } from './types';\n\nimport { TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL } from '../../../../config';\nimport { findDifference } from '../../../../util/iteratees';\nimport ReconnectingWebSocket, { type InMessageCallback } from '../../../../util/reconnectingWebsocket';\nimport safeExec from '../../../../util/safeExec';\nimport { forbidConcurrency, setCancellableTimeout, throttle } from '../../../../util/schedulers';\nimport { getNftSuperCollectionsByCollectionAddress } from '../../../common/addresses';\nimport { addBackendHeadersToSocketUrl } from '../../../common/backend';\nimport { SEC } from '../../../constants';\nimport { parseActions } from './actions';\n\nconst ACTUALIZATION_DELAY = 10;\n\n// Toncenter closes the socket after 30 seconds of inactivity\nconst PING_INTERVAL = 20 * SEC;\n\n// When the internet connection is interrupted, the Toncenter socket doesn't always disconnect automatically.\n// Disconnecting manually if there is no response for \"ping\".\nconst PONG_TIMEOUT = 5 * SEC;\n\nconst toncenterSockets: Partial<Record<ApiNetwork, ToncenterSocket>> = {};\n\nexport interface WalletWatcher {\n  /** Whether the socket is connected and subscribed to the given wallets */\n  readonly isConnected: boolean;\n  /** Removes the watcher and cleans the memory */\n  destroy(): void;\n}\n\ninterface WalletWatcherInternal extends WalletWatcher {\n  id: number;\n  addresses: string[];\n  isConnected: boolean;\n  /**\n   * Called when new activities (either regular or pending) arrive into one of the listened address.\n   *\n   * Called only when isConnected is true. Therefore, when the socket reconnects, the users should synchronize,\n   * otherwise the activities arriving during the reconnect will miss.\n   */\n  onNewActivities?: NewActivitiesCallback;\n  /** Called when isConnected turns true */\n  onConnect?: NoneToVoidFunction;\n  /** Called when isConnected turns false */\n  onDisconnect?: NoneToVoidFunction;\n}\n\nexport type NewActivitiesCallback = (update: ActivitiesUpdate) => void;\n\nexport interface ActivitiesUpdate {\n  address: string;\n  /**\n   * Multiple events with the same normalized hash can arrive. Every time it happens, the new event data must replace\n   * the previous event data in the app state. If the `activities` array is empty, the actions with that normalized hash\n   * must be removed from the app state. Pending actions are eventually either removed or replaced with confirmed actions.\n   */\n  messageHashNormalized: string;\n  /** Pending actions are not confirmed by the blockchain yet */\n  arePending: boolean;\n  activities: ApiActivity[];\n}\n\n/**\n * Connects to Toncenter to passively listen to updates.\n */\nclass ToncenterSocket {\n  #network: ApiNetwork;\n\n  #socket?: ReconnectingWebSocket<ClientSocketMessage, ServerSocketMessage>;\n\n  /** See #rememberAddressesOfNormalizedHash */\n  #addressesByHash: Record<string, string[]> = {};\n\n  #walletWatchers: WalletWatcherInternal[] = [];\n\n  /** The addresses that the socket is currently subscribed to */\n  #subscribedAddresses = new Set<string>();\n\n  /**\n   * A shared incremental counter for various unique ids. The fact that it's incremental is used to tell what actions\n   * happened earlier or later than others.\n   */\n  #currentUniqueId = 0;\n\n  #stopPing?: NoneToVoidFunction;\n  #cancelReconnect?: NoneToVoidFunction;\n\n  constructor(network: ApiNetwork) {\n    this.#network = network;\n  }\n\n  public watchWallets(\n    addresses: string[],\n    {\n      onNewActivities,\n      onConnect,\n      onDisconnect,\n    }: Pick<WalletWatcherInternal, 'onNewActivities' | 'onConnect' | 'onDisconnect'> = {},\n  ): WalletWatcher {\n    const id = this.#currentUniqueId++;\n    const watcher: WalletWatcherInternal = {\n      id,\n      addresses,\n      isConnected: false,\n      onNewActivities,\n      onConnect,\n      onDisconnect,\n      destroy: this.#destroyWalletWatcher.bind(this, id),\n    };\n    this.#walletWatchers.push(watcher);\n    this.#actualizeSocket();\n    return watcher;\n  }\n\n  /** Removes the given watcher and unsubscribes from its wallets. Brings the sockets to the proper state. */\n  #destroyWalletWatcher(watcherId: number) {\n    const index = this.#walletWatchers.findIndex((watcher) => watcher.id === watcherId);\n    if (index >= 0) {\n      this.#walletWatchers.splice(index, 1);\n      this.#actualizeSocket();\n    }\n  }\n\n  /**\n   * Creates or destroys the given socket (if needed) and subscribes to the watched wallets.\n   *\n   * The method is throttled in order to:\n   *  - Avoid sending too many requests when the watched addresses change many times in a short time range.\n   *  - Avoid reconnecting the socket when watched addresses arrive shortly after stopping watching all addresses.\n   */\n  #actualizeSocket = throttle(() => {\n    if (this.#doesHaveWatchedAddresses()) {\n      this.#socket ??= this.#createSocket();\n      if (this.#socket.isConnected) {\n        this.#sendWatchedWalletsToSocket();\n      } // Otherwise, the addresses will be sent when the socket gets connected\n    } else {\n      this.#socket?.close();\n      this.#socket = undefined;\n    }\n  }, ACTUALIZATION_DELAY, false);\n\n  #createSocket() {\n    const url = getSocketUrl(this.#network);\n    const socket = new ReconnectingWebSocket<ClientSocketMessage, ServerSocketMessage>(url);\n    socket.onMessage(this.#handleSocketMessage);\n    socket.onConnect(this.#handleSocketConnect);\n    socket.onDisconnect(this.#handleSocketDisconnect);\n    return socket;\n  }\n\n  #handleSocketMessage: InMessageCallback<ServerSocketMessage> = (message) => {\n    this.#cancelReconnect?.();\n\n    if ('status' in message) {\n      if (message.status === 'subscribed') {\n        this.#handleSubscribed(message);\n      }\n    }\n\n    if ('type' in message) {\n      if (message.type === 'trace_invalidated') {\n        message = {\n          ...message,\n          type: 'pending_actions',\n          actions: [],\n          address_book: {},\n          metadata: {},\n        };\n        // Falling down to the below `if` intentionally\n      }\n\n      if (message.type === 'actions' || message.type === 'pending_actions') {\n        void this.#handleNewActions(message);\n      }\n    }\n  };\n\n  #handleSocketConnect = () => {\n    this.#socket?.send({\n      operation: 'configure',\n      include_address_book: true,\n      include_metadata: true,\n    });\n    this.#sendWatchedWalletsToSocket();\n\n    this.#startPing();\n  };\n\n  #handleSocketDisconnect = () => {\n    this.#subscribedAddresses.clear();\n    this.#stopPing?.();\n\n    for (const watcher of this.#walletWatchers) {\n      if (watcher.isConnected) {\n        watcher.isConnected = false;\n        if (watcher.onDisconnect) safeExec(watcher.onDisconnect);\n      }\n    }\n  };\n\n  #handleSubscribed(message: Extract<ServerSocketMessage, { status: any }>) {\n    for (const watcher of this.#walletWatchers) {\n      // If message id < watcher id, then the watcher was created after the subscribe request was sent, therefore\n      // the socket may be not subscribed to all the watcher addresses yet.\n      if (message.id && Number(message.id) < watcher.id) {\n        continue;\n      }\n\n      if (!watcher.isConnected) {\n        watcher.isConnected = true;\n        if (watcher.onConnect) safeExec(watcher.onConnect);\n      }\n    }\n  }\n\n  // Limiting the concurrency to 1 to ensure the new activities are reported in the order they were received\n  #handleNewActions = forbidConcurrency(async (message: ActionsSocketMessage) => {\n    const arePending = message.type === 'pending_actions';\n    const messageHashNormalized = message.trace_external_hash_norm;\n    const activitiesByAddress = await parseSocketActions(this.#network, message, this.#getWatchedAddresses(true));\n    const addressesToNotify = this.#rememberAddressesOfHash(\n      messageHashNormalized,\n      Object.keys(activitiesByAddress),\n      arePending,\n    );\n\n    for (const watcher of this.#walletWatchers) {\n      if (!isWatcherReadyForNewActivities(watcher)) {\n        continue;\n      }\n\n      for (const address of watcher.addresses) {\n        if (!addressesToNotify.has(address)) {\n          continue;\n        }\n\n        safeExec(() => watcher.onNewActivities({\n          address,\n          messageHashNormalized,\n          arePending,\n          activities: activitiesByAddress[address] ?? [],\n        }));\n      }\n    }\n  });\n\n  #sendWatchedWalletsToSocket() {\n    // It's necessary to collect the watched addresses synchronously with locking the request id.\n    // It makes sure that all the watchers with ids < the response id will be subscribed.\n    const requestId = String(this.#currentUniqueId++);\n\n    const oldAddresses = this.#subscribedAddresses;\n    const newAddresses = this.#getWatchedAddresses();\n    const deletedAddresses = findDifference(oldAddresses, newAddresses);\n    const addedAddresses = findDifference(newAddresses, oldAddresses);\n\n    if (deletedAddresses.length) {\n      this.#socket!.send({\n        operation: 'unsubscribe',\n        addresses: deletedAddresses,\n      });\n    }\n\n    if (addedAddresses.length) {\n      this.#socket!.send({\n        operation: 'subscribe',\n        id: requestId,\n        addresses: addedAddresses,\n        types: ['actions', 'pending_actions'],\n      });\n    }\n\n    this.#subscribedAddresses = newAddresses;\n  }\n\n  #doesHaveWatchedAddresses() {\n    return this.#walletWatchers.some((watcher) => watcher.addresses.length);\n  }\n\n  #getWatchedAddresses(isOnlyReadyForNewActivities?: boolean) {\n    const watchedAddresses = new Set<string>();\n\n    for (const watcher of this.#walletWatchers) {\n      if (isOnlyReadyForNewActivities && !isWatcherReadyForNewActivities(watcher)) {\n        continue;\n      }\n\n      for (const address of watcher.addresses) {\n        watchedAddresses.add(address);\n      }\n    }\n\n    return watchedAddresses;\n  }\n\n  #startPing() {\n    this.#stopPing?.();\n\n    const pingIntervalId = setInterval(() => {\n      this.#socket?.send({ operation: 'ping' });\n\n      this.#cancelReconnect?.();\n      this.#cancelReconnect = setCancellableTimeout(PONG_TIMEOUT, () => {\n        this.#socket?.reconnect();\n      });\n    }, PING_INTERVAL);\n\n    this.#stopPing = () => clearInterval(pingIntervalId);\n  }\n\n  /**\n   * When a pending action is invalidated, a message arrives with no data except the normalized hash. In order to find\n   * what addresses it belongs to and notify those addresses, we save the addresses from the previous message with the\n   * same normalized hash.\n   *\n   * @returns The addresses that should be notified about the new actions, even if no new action belongs to the address\n   */\n  #rememberAddressesOfHash(\n    messageHashNormalized: string,\n    newActionAddresses: Iterable<string>,\n    areNewActionsPending: boolean,\n  ) {\n    const prevSavedAddresses = this.#addressesByHash[messageHashNormalized] ?? [];\n    const nextSavedAddresses: string[] = [];\n    const addressesToNotify = new Set<string>();\n\n    // Notifying the addresses where the actions were seen at previously. It is necessary to let the addresses know that\n    // the given normalized message hash is no longer in the activity history.\n    for (const address of prevSavedAddresses) {\n      addressesToNotify.add(address);\n    }\n\n    for (const address of newActionAddresses) {\n      addressesToNotify.add(address);\n\n      // Saving the corresponding addresses only for pending actions, because confirmed actions don't change or invalidate\n      if (areNewActionsPending) {\n        nextSavedAddresses.push(address);\n      }\n    }\n\n    if (nextSavedAddresses.length) {\n      this.#addressesByHash[messageHashNormalized] = nextSavedAddresses;\n    } else {\n      delete this.#addressesByHash[messageHashNormalized];\n    }\n\n    return addressesToNotify;\n  }\n}\n\nexport type { ToncenterSocket };\n\n/** Returns a singleton (one constant instance per a network) */\nexport function getToncenterSocket(network: ApiNetwork) {\n  toncenterSockets[network] ??= new ToncenterSocket(network);\n  return toncenterSockets[network];\n}\n\n/**\n * Returns true if the activities update is final, i.e. no other updates are expected for the corresponding message hash.\n */\nexport function isActivityUpdateFinal(update: ActivitiesUpdate) {\n  return !update.arePending || !update.activities.length;\n}\n\nfunction getSocketUrl(network: ApiNetwork) {\n  const url = new URL(network === 'testnet' ? TONCENTER_TESTNET_URL : TONCENTER_MAINNET_URL);\n  url.protocol = 'wss:';\n  url.pathname = '/api/streaming/v1/ws';\n  addBackendHeadersToSocketUrl(url);\n  return url;\n}\n\nasync function parseSocketActions(network: ApiNetwork, message: ActionsSocketMessage, addressWhitelist: Set<string>) {\n  const actionsByAddress = groupActionsByAddress(message.actions, message.address_book);\n  const activitiesByAddress: Record<string, ApiActivity[]> = {};\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  for (const [address, actions] of Object.entries(actionsByAddress)) {\n    if (!addressWhitelist.has(address)) {\n      continue;\n    }\n\n    activitiesByAddress[address] = parseActions(\n      network,\n      address,\n      actions,\n      message.address_book,\n      message.metadata,\n      nftSuperCollectionsByCollectionAddress,\n      message.type === 'pending_actions',\n    );\n  }\n\n  return activitiesByAddress;\n}\n\nfunction groupActionsByAddress(actions: AnyAction[], addressBook: AddressBook) {\n  const byAddress: Record<string, AnyAction[]> = {};\n\n  for (const action of actions) {\n    for (const rawAddress of action.accounts!) {\n      const address = addressBook[rawAddress]?.user_friendly ?? rawAddress;\n      byAddress[address] ??= [];\n      byAddress[address].push(action);\n    }\n  }\n\n  return byAddress;\n}\n\nfunction isWatcherReadyForNewActivities(\n  watcher: WalletWatcherInternal,\n): watcher is WalletWatcherInternal & { onNewActivities: NewActivitiesCallback } {\n  // Even though the socket may already listen to some wallet addresses, we promise the class users to trigger the\n  // onNewActions callback only in the connected state.\n  return watcher.isConnected && !!watcher.onNewActivities;\n}\n","import type { ActivitiesUpdate, NewActivitiesCallback } from './socket';\n\nimport { setCancellableTimeout } from '../../../../util/schedulers';\nimport { isActivityUpdateFinal } from './socket';\n\n/**\n * The Toncenter websocket sends too many updates of pending actions. For example, sends a pending activity right before\n * sending the confirmed version of that activity. This function throttles them, but makes sure the pending actions are\n * created immediately.\n */\nexport function throttleToncenterSocketActions(\n  delayMs: number,\n  onUpdates: (updates: ActivitiesUpdate[]) => void,\n): NewActivitiesCallback {\n  // A record item is created when the first pending version arrives and is removed when it gets confirmed or invalidated.\n  // All message hashes are throttled independently.\n  const updatesByHash: Record<string, { toReport?: ActivitiesUpdate; cancelReport?: NoneToVoidFunction }> = {};\n\n  const scheduleReport = (hash: string) => {\n    updatesByHash[hash] ??= {};\n    updatesByHash[hash].cancelReport ??= setCancellableTimeout(delayMs, () => {\n      delete updatesByHash[hash].cancelReport;\n      const { toReport } = updatesByHash[hash];\n      if (toReport) {\n        onUpdates([toReport]);\n      }\n    });\n  };\n\n  return (update) => {\n    const hash = update.messageHashNormalized;\n\n    if (isActivityUpdateFinal(update)) {\n      // This is the final update for the hash. It should be delivered immediately and removed.\n      updatesByHash[hash]?.cancelReport?.();\n      delete updatesByHash[hash];\n      onUpdates([update]);\n    } else if (!updatesByHash[hash]) {\n      // This is the first version of the hash's update. It should (and must for pendings) be delivered immediately.\n      onUpdates([update]);\n      scheduleReport(hash);\n    } else {\n      // Otherwise, throttle the update\n      updatesByHash[hash].toReport = update;\n      scheduleReport(hash);\n    }\n  };\n}\n","import type { ApiActivity, ApiNetwork } from '../../../types';\nimport type { ActivitiesUpdate, WalletWatcher } from './socket';\n\nimport { createCallbackManager } from '../../../../util/callbacks';\nimport { compareActivities } from '../../../../util/compareActivities';\nimport { focusAwareDelay } from '../../../../util/focusAwareDelay';\nimport { extractKey } from '../../../../util/iteratees';\nimport { logDebugError } from '../../../../util/logs';\nimport { FallbackPollingScheduler } from '../../../common/polling/fallbackPollingScheduler';\nimport { periodToMs } from '../../../common/polling/utils';\nimport { FIRST_TRANSACTIONS_LIMIT, MINUTE, SEC } from '../../../constants';\nimport { fetchActions, fetchPendingActions } from './actions';\nimport { getToncenterSocket, isActivityUpdateFinal } from './socket';\nimport { throttleToncenterSocketActions } from './throttleSocketActions';\n\nconst SOCKET_THROTTLE_DELAY = 250;\nconst MIN_POLL_DELAY = { focused: SEC, notFocused: 3 * SEC };\nconst POLLING_START_DELAY = 3 * SEC;\nconst POLLING_PERIOD = { focused: 1.1 * SEC, notFocused: 10 * SEC };\nconst FORCED_POLLING_PERIOD = { focused: MINUTE, notFocused: 2 * MINUTE };\n\nconst FINISHED_HASH_MEMORY_SIZE = 100;\n\n/**\n * The activities are sorted by timestamp descending.\n * The updates may arrive not in the order of activity time and may duplicate.\n * `allPendingActivities` doesn't contain activities with the hashes of the current or past confirmed activities.\n */\nexport type OnActivityUpdate = (\n  newConfirmedActivities: ApiActivity[],\n  allPendingActivities: readonly ApiActivity[],\n) => void;\n\nexport type OnLoadingChange = (isLoading: boolean) => void;\n\n/**\n * Streams the new activities (confirmed and pending) in the given TON wallet as they are received from the Toncenter\n * API (with no artificial activities like CEX swaps). Uses the socket, and fallbacks to HTTP polling when the socket is\n * unavailable.\n */\nexport class ActivityStream {\n  #network: ApiNetwork;\n  #address: string;\n\n  #newestConfirmedActivityTimestamp?: number;\n\n  #pendingActivities = managePendingActivities();\n\n  #walletWatcher: WalletWatcher;\n\n  #fallbackPollingScheduler: FallbackPollingScheduler;\n\n  #updateListeners = createCallbackManager<OnActivityUpdate>();\n  #loadingListeners = createCallbackManager<OnLoadingChange>();\n\n  /** When `true`, the polling retries until succeeds, and the confirmed actions from the socket get stashed */\n  #doesNeedToRestoreHistory = false;\n\n  /** Sorted by timestamp descending */\n  #socketConfirmedActionsStash: ApiActivity[] = [];\n\n  #isDestroyed = false;\n\n  constructor(\n    network: ApiNetwork,\n    address: string,\n    newestConfirmedActivityTimestamp: number | undefined,\n    pollOnStart: boolean,\n  ) {\n    this.#network = network;\n    this.#address = address;\n    this.#newestConfirmedActivityTimestamp = newestConfirmedActivityTimestamp;\n\n    this.#walletWatcher = getToncenterSocket(network).watchWallets(\n      [address],\n      {\n        onConnect: this.#handleSocketConnect,\n        onDisconnect: this.#handleSocketDisconnect,\n        onNewActivities: throttleToncenterSocketActions(SOCKET_THROTTLE_DELAY, this.#handleSocketNewActivities),\n      },\n    );\n\n    this.#doesNeedToRestoreHistory = this.#walletWatcher.isConnected;\n\n    this.#fallbackPollingScheduler = new FallbackPollingScheduler(this.#walletWatcher.isConnected, {\n      pollOnStart,\n      minPollDelay: MIN_POLL_DELAY,\n      pollingStartDelay: POLLING_START_DELAY,\n      pollingPeriod: POLLING_PERIOD,\n      forcedPollingPeriod: FORCED_POLLING_PERIOD,\n      poll: this.#poll,\n    });\n  }\n\n  /**\n   * Registers a callback firing then new activities arrive.\n   * The callback is calls are throttled.\n   */\n  public onUpdate(callback: OnActivityUpdate) {\n    return this.#updateListeners.addCallback(callback);\n  }\n\n  /**\n   * Registers a callback firing when the regular polling starts of finishes.\n   * Guaranteed to be called with `isLoading=false` after calling the `onUpdate` callbacks.\n   */\n  public onLoadingChange(callback: OnLoadingChange) {\n    return this.#loadingListeners.addCallback(callback);\n  }\n\n  public destroy() {\n    this.#isDestroyed = true;\n    this.#walletWatcher.destroy();\n    this.#fallbackPollingScheduler.destroy();\n  }\n\n  #handleSocketConnect = () => {\n    // When the socket gets connected, it's important to load the confirmed activities since the last activity,\n    // otherwise the activities arriving from the socket will create a gap in the activity history.\n    this.#doesNeedToRestoreHistory = true;\n    this.#fallbackPollingScheduler.onSocketConnect();\n  };\n\n  #handleSocketDisconnect = () => {\n    this.#doesNeedToRestoreHistory = false;\n    this.#fallbackPollingScheduler.onSocketDisconnect();\n  };\n\n  #handleSocketNewActivities = (updates: ActivitiesUpdate[]) => {\n    if (this.#isDestroyed) return;\n\n    const pendingUpdates = updates.filter((update) => update.arePending);\n    const confirmedActivities = updates\n      .filter((update) => !update.arePending)\n      .flatMap((update) => update.activities)\n      .sort(compareActivities);\n\n    const instantConfirmedActivities = this.#doesNeedToRestoreHistory ? [] : confirmedActivities;\n    const stashedConfirmedActivities = this.#doesNeedToRestoreHistory ? confirmedActivities : [];\n\n    // One of the goals here is preventing the stashed activities from removing pending activities (switching an activity\n    // from pending to confirmed must be seamless). Another goal is delivering the pending activities with no delay.\n    this.#socketConfirmedActionsStash.unshift(...stashedConfirmedActivities);\n    this.#handleNewActivities(instantConfirmedActivities, undefined, pendingUpdates);\n  };\n\n  /** Fetches the activities when the socket is not connected or has just connected */\n  #poll = async () => {\n    try {\n      this.#loadingListeners.runCallbacks(true);\n\n      const [pendingActivities, newConfirmedActivities] = await Promise.all([\n        loadPendingActivities(this.#network, this.#address),\n        this.#loadNewConfirmedActivities(),\n      ]);\n\n      if (this.#isDestroyed) return;\n\n      this.#handleNewActivities(\n        margeConfirmedActivitiesOnSocketConnect(\n          newConfirmedActivities,\n          this.#socketConfirmedActionsStash.splice(0),\n        ),\n        pendingActivities,\n      );\n\n      this.#doesNeedToRestoreHistory = false;\n    } finally {\n      if (!this.#isDestroyed) {\n        this.#loadingListeners.runCallbacks(false);\n      }\n    }\n  };\n\n  async #loadNewConfirmedActivities() {\n    while (!this.#isDestroyed) {\n      try {\n        return await fetchActions({\n          network: this.#network,\n          filter: { address: this.#address },\n          walletAddress: this.#address,\n          fromTimestamp: this.#newestConfirmedActivityTimestamp,\n          limit: FIRST_TRANSACTIONS_LIMIT,\n        });\n      } catch (err) {\n        logDebugError('loadNewConfirmedActivities', err);\n\n        if (this.#isDestroyed || !this.#doesNeedToRestoreHistory) {\n          break;\n        }\n\n        await focusAwareDelay(...periodToMs(MIN_POLL_DELAY));\n      }\n    }\n\n    return [];\n  }\n\n  /** The method expected one of `allPendingActivities` and `pendingUpdates`, not both at the same time */\n  #handleNewActivities(\n    confirmedActivities: ApiActivity[],\n    allPendingActivities?: ApiActivity[],\n    pendingUpdates?: ActivitiesUpdate[],\n  ) {\n    // If nothing new, do nothing\n    if (!confirmedActivities.length && !(allPendingActivities || pendingUpdates?.length)) {\n      return;\n    }\n\n    if (confirmedActivities.length) {\n      this.#newestConfirmedActivityTimestamp = confirmedActivities[0].timestamp;\n    }\n    this.#pendingActivities.update(confirmedActivities, allPendingActivities, pendingUpdates);\n    this.#updateListeners.runCallbacks(confirmedActivities, this.#pendingActivities.all);\n  }\n}\n\nasync function loadPendingActivities(network: ApiNetwork, address: string) {\n  try {\n    return await fetchPendingActions(network, address);\n  } catch (err) {\n    logDebugError('loadPendingActivities', err);\n    return undefined;\n  }\n}\n\n/**\n * Keeps the list of all current pending activities by merging the incoming updates.\n */\nfunction managePendingActivities() {\n  /** Sorted by timestamp descending */\n  let pendingActivities: readonly ApiActivity[] = [];\n\n  /**\n   * External message hash normalized of the recently confirmed activities and invalidated pending activities.\n   * Helps to avoid excessive pendings occurring because of race conditions that cause pendings to arrive after the\n   * corresponding confirmed activities. The race conditions can occur because of the socket and polling working together.\n   *\n   * There still can be situations where an older pending activity version replaces a newer one, but it is not a problem.\n   */\n  const finishedHashes = new Set<string>();\n\n  function update(\n    confirmedActivities: ApiActivity[],\n    allPendingActivities?: readonly ApiActivity[],\n    pendingUpdates?: ActivitiesUpdate[],\n  ) {\n    rememberFinishedHashes(extractKey(confirmedActivities, 'externalMsgHashNorm'));\n    if (pendingUpdates) {\n      rememberFinishedHashes(extractKey(pendingUpdates.filter(isActivityUpdateFinal), 'messageHashNormalized'));\n    }\n\n    if (allPendingActivities) {\n      pendingActivities = allPendingActivities;\n    } else if (pendingUpdates) {\n      pendingActivities = mergePendingActivities(pendingActivities, pendingUpdates);\n    }\n\n    pendingActivities = pendingActivities.filter(({ externalMsgHashNorm }) => !(\n      externalMsgHashNorm\n      && finishedHashes.has(externalMsgHashNorm)\n    ));\n  }\n\n  function rememberFinishedHashes(messageHashNorms: Iterable<string | undefined>) {\n    for (const hash of messageHashNorms) {\n      if (hash !== undefined) {\n        finishedHashes.add(hash);\n      }\n    }\n\n    releaseFinishedHashesMemory();\n  }\n\n  function releaseFinishedHashesMemory() {\n    // JS Set iterates the elements in the order of insertion.\n    // Deleting elements from Set during iteration doesn't disrupt the iteration.\n    // That is, this loop removes the oldest elements.\n    for (const hash of finishedHashes) {\n      if (finishedHashes.size <= FINISHED_HASH_MEMORY_SIZE) {\n        break;\n      }\n\n      finishedHashes.delete(hash);\n    }\n  }\n\n  return {\n    get all() {\n      return pendingActivities;\n    },\n    update,\n  };\n}\n\n/**\n * Merges the activities when the socket gets connected. At this moment of connection the socket starts receiving\n * activities, and activities are requested via the HTTP endpoint. These lists can contain duplicates, this function\n * eliminates them.\n *\n * Both the activity lists must be sorted by timestamp descending.\n */\nfunction margeConfirmedActivitiesOnSocketConnect(\n  polledActivities: ApiActivity[],\n  socketActivities: ApiActivity[],\n) {\n  const newestPolledActivityTimestamp = polledActivities[0]?.timestamp ?? -Infinity;\n  const mergedActivities: ApiActivity[] = [];\n\n  for (const activity of socketActivities) {\n    if (activity.timestamp <= newestPolledActivityTimestamp) {\n      break;\n    }\n\n    mergedActivities.push(activity);\n  }\n\n  mergedActivities.push(...polledActivities);\n\n  return mergedActivities;\n}\n\nfunction mergePendingActivities(\n  currentPendingActivities: readonly ApiActivity[],\n  socketUpdates: ActivitiesUpdate[],\n) {\n  if (!socketUpdates.length) {\n    return currentPendingActivities;\n  }\n\n  const hashesToRemove = new Set<string | undefined>(\n    extractKey(socketUpdates, 'messageHashNormalized'),\n  );\n\n  return [\n    ...currentPendingActivities.filter(\n      (activity) => !hashesToRemove.has(activity.externalMsgHashNorm),\n    ),\n    ...socketUpdates.flatMap((update) => update.arePending ? update.activities : []),\n  ].sort(compareActivities);\n}\n","import type { ApiNetwork, ApiTransaction } from '../../../types';\nimport type { ApiTransactionExtended } from '../types';\nimport type { AddressBook, Transaction, TransactionMessage } from './types';\n\nimport { TONCOIN } from '../../../../config';\nimport { buildTxId } from '../../../../util/activities';\nimport { toSeconds } from '../../../../util/datetime';\nimport { omitUndefined } from '../../../../util/iteratees';\nimport { toBase64Address } from '../util/tonCore';\nimport { callToncenterV3 } from './other';\n\nexport async function fetchTransactions(options: {\n  network: ApiNetwork;\n  address: string | string[];\n  limit: number;\n  fromTimestamp?: number;\n  toTimestamp?: number;\n  shouldIncludeFrom?: boolean;\n  shouldIncludeTo?: boolean;\n}): Promise<ApiTransaction[]> {\n  const {\n    network,\n    address,\n    limit,\n    toTimestamp,\n    fromTimestamp,\n    shouldIncludeFrom,\n    shouldIncludeTo,\n  } = options;\n\n  const data: {\n    transactions: Transaction[];\n    address_book: AddressBook;\n  } = await callToncenterV3(network, '/transactions', {\n    account: address,\n    limit,\n    start_utime: fromTimestamp && toSeconds(fromTimestamp) + (!shouldIncludeFrom ? 1 : 0),\n    end_utime: toTimestamp && toSeconds(toTimestamp) - (!shouldIncludeTo ? 1 : 0),\n    sort: 'desc',\n  });\n\n  const {\n    transactions: rawTransactions,\n    address_book: addressBook,\n  } = data;\n\n  if (!rawTransactions.length) {\n    return [];\n  }\n\n  return rawTransactions\n    .map((rawTx) => parseRawTransaction(network, rawTx, addressBook))\n    .flat();\n}\n\nexport function parseRawTransaction(\n  network: ApiNetwork,\n  rawTx: Transaction,\n  addressBook: AddressBook,\n): ApiTransactionExtended[] {\n  const {\n    now,\n    hash,\n    total_fees: totalFees,\n    description: {\n      compute_ph: {\n        exit_code: exitCode,\n      },\n    },\n  } = rawTx;\n\n  const timestamp = now * 1000;\n  const isIncoming = !!rawTx.in_msg.source && !rawTx.out_msgs.length;\n  const inMsgHash = rawTx.in_msg.hash;\n  const msgs: TransactionMessage[] = isIncoming ? [rawTx.in_msg] : rawTx.out_msgs;\n\n  if (!msgs.length) return [];\n\n  const oneMsgFee = BigInt(totalFees) / BigInt(msgs.length);\n\n  const transactions: ApiTransactionExtended[] = [];\n\n  msgs.forEach((msg, i) => {\n    const {\n      source,\n      destination,\n      value,\n      fwd_fee: fwdFee,\n      opcode,\n      hash: msgHash,\n      bounced,\n    } = msg;\n\n    if (!destination) {\n      // This is log\n      return;\n    }\n\n    const fromAddress = addressBook[source!].user_friendly;\n    const toAddress = addressBook[destination].user_friendly;\n    const normalizedAddress = toBase64Address(isIncoming ? source! : destination, true, network);\n    const fee = oneMsgFee + BigInt(fwdFee ?? 0);\n\n    const tx: ApiTransactionExtended = omitUndefined({\n      txId: msgs.length > 1 ? buildTxId(hash, i) : buildTxId(hash),\n      timestamp,\n      isIncoming,\n      fromAddress,\n      toAddress,\n      amount: isIncoming ? BigInt(value!) : -BigInt(value!),\n      slug: TONCOIN.slug,\n      fee,\n      externalMsgHash: isIncoming ? undefined : inMsgHash,\n      normalizedAddress,\n      shouldHide: exitCode ? true : undefined,\n      hash,\n      opCode: Number(opcode) || undefined,\n      msgHash,\n      type: bounced ? 'bounced' : undefined,\n    });\n\n    transactions.push(tx);\n  });\n\n  return transactions;\n}\n\nexport async function fetchLatestTxLt(network: ApiNetwork, address: string): Promise<number | undefined> {\n  const { transactions }: { transactions: any[] } = await callToncenterV3(network, '/transactions', {\n    account: address,\n    limit: 1,\n    sort: 'desc',\n  });\n\n  if (!transactions.length) {\n    return undefined;\n  }\n\n  return Number(transactions[0].lt);\n}\n","import { Address } from '@ton/core';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { getDnsDomainZone, isDnsDomain } from '../../../util/dns';\nimport { dnsResolve } from './util/dns';\nimport { getTonClient, toBase64Address } from './util/tonCore';\nimport { getKnownAddressInfo } from '../../common/addresses';\nimport { DnsCategory } from './constants';\nimport { fetchAddressBook } from './toncenter';\n\nexport async function resolveAddress(network: ApiNetwork, address: string, skipFormatSelection?: boolean): Promise<{\n  address: string;\n  name?: string;\n  isMemoRequired?: boolean;\n  isScam?: boolean;\n} | 'dnsNotResolved' | 'invalidAddress'> {\n  const isDomain = isDnsDomain(address);\n  let domain: string | undefined;\n\n  if (isDomain) {\n    const resolvedAddress = await resolveAddressByDomain(network, address);\n    if (!resolvedAddress) {\n      return 'dnsNotResolved';\n    }\n\n    domain = address;\n    address = resolvedAddress;\n\n    if (!skipFormatSelection) {\n      const addressBook = await fetchAddressBook(network, [address]);\n      address = addressBook[address].user_friendly;\n    }\n  }\n\n  let normalizedAddress: string;\n  try {\n    normalizedAddress = normalizeAddress(address);\n  } catch {\n    return 'invalidAddress';\n  }\n  const known = getKnownAddressInfo(normalizedAddress);\n\n  if (known) {\n    return {\n      address,\n      ...known,\n      name: domain ?? known.name,\n    };\n  }\n\n  return { address, name: domain };\n}\n\nasync function resolveAddressByDomain(network: ApiNetwork, domain: string) {\n  try {\n    const zoneMatch = getDnsDomainZone(domain);\n    if (!zoneMatch) {\n      return undefined;\n    }\n\n    const result = await dnsResolve(\n      getTonClient(network),\n      zoneMatch.zone.resolver,\n      zoneMatch.base,\n      DnsCategory.Wallet,\n    );\n\n    if (!(result instanceof Address)) {\n      return undefined;\n    }\n\n    return toBase64Address(result, undefined, network);\n  } catch (err: any) {\n    if (!err.message?.includes('exit_code')) {\n      throw err;\n    }\n    return undefined;\n  }\n}\n\nexport function normalizeAddress(address: string, network?: ApiNetwork) {\n  return toBase64Address(address, true, network);\n}\n","import { beginCell, Cell, storeStateInit } from '@ton/core';\n\nimport type { ApiNetwork, ApiTonWallet, ApiWalletInfo, ApiWalletWithVersionInfo } from '../../types';\nimport type { ApiTonWalletVersion, ContractInfo } from './types';\nimport type { TonWallet } from './util/tonCore';\n\nimport { DEFAULT_WALLET_VERSION } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { extractKey, findLast } from '../../../util/iteratees';\nimport withCacheAsync from '../../../util/withCacheAsync';\nimport { fetchJettonBalances } from './util/tonapiio';\nimport {\n  getTonClient, toBase64Address, walletClassMap,\n} from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { base64ToBytes, hexToBytes, sha256 } from '../../common/utils';\nimport { ALL_WALLET_VERSIONS, ContractType, KnownContracts, WORKCHAIN } from './constants';\nimport { getWalletInfos } from './toncenter';\n\nexport const isAddressInitialized = withCacheAsync(\n  async (network: ApiNetwork, walletOrAddress: TonWallet | string) => {\n    return (await getWalletInfo(network, walletOrAddress)).isInitialized;\n  },\n);\n\nexport const isActiveSmartContract = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  const { isInitialized, version } = await getWalletInfo(network, address);\n  return isInitialized ? !version : undefined;\n}, (value) => value !== undefined);\n\nexport function publicKeyToAddress(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  walletVersion: ApiTonWalletVersion,\n) {\n  const wallet = buildWallet(publicKey, walletVersion);\n  return toBase64Address(wallet.address, false, network);\n}\n\nexport function buildWallet(publicKey: Uint8Array | string, walletVersion: ApiTonWalletVersion): TonWallet {\n  if (typeof publicKey === 'string') {\n    publicKey = hexToBytes(publicKey);\n  }\n\n  const WalletClass = walletClassMap[walletVersion];\n  if (!WalletClass) {\n    throw new Error(`Unsupported wallet contract version \"${walletVersion}\"`);\n  }\n\n  return WalletClass.create({\n    publicKey: Buffer.from(publicKey),\n    workchain: WORKCHAIN,\n  });\n}\n\nexport async function getWalletInfo(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<ApiWalletInfo> {\n  const address = typeof walletOrAddress === 'string'\n    ? walletOrAddress\n    : toBase64Address(walletOrAddress.address, undefined, network);\n\n  return (await getWalletInfos(network, [address]))[address];\n}\n\nexport async function getContractInfo(network: ApiNetwork, address: string): Promise<{\n  isInitialized: boolean;\n  isSwapAllowed?: boolean;\n  isWallet?: boolean;\n  contractInfo?: ContractInfo;\n  codeHash?: string;\n}> {\n  const data = await getTonClient(network).getAddressInfo(address);\n\n  const { code, state } = data;\n\n  const codeHashOld = Buffer.from(await sha256(base64ToBytes(code))).toString('hex');\n  const contractInfo = Object.values(KnownContracts).find((info) => info.hash === codeHashOld);\n  // For inactive addresses, `code` is an empty string. Cell.fromBase64 throws when `code` is an empty string.\n  const codeHash = code && Cell.fromBase64(code).hash().toString('hex');\n\n  const isInitialized = state === 'active';\n  const isWallet = state === 'active' ? contractInfo?.type === ContractType.Wallet : undefined;\n  const isSwapAllowed = contractInfo?.isSwapAllowed;\n\n  return {\n    isInitialized,\n    isWallet,\n    isSwapAllowed,\n    contractInfo,\n    codeHash,\n  };\n}\n\nexport async function getAccountBalance(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return getWalletBalance(network, address);\n}\n\nexport async function getWalletBalance(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<bigint> {\n  return (await getWalletInfo(network, walletOrAddress)).balance;\n}\n\nexport async function getWalletSeqno(network: ApiNetwork, walletOrAddress: TonWallet | string): Promise<number> {\n  const { seqno } = await getWalletInfo(network, walletOrAddress);\n  return seqno || 0;\n}\n\nexport async function pickBestWallet(network: ApiNetwork, publicKey: Uint8Array): Promise<{\n  wallet: TonWallet;\n  version: ApiTonWalletVersion;\n  balance: bigint;\n  lastTxId?: string;\n}> {\n  const allWallets = await getWalletVersionInfos(network, publicKey);\n  const defaultWallet = allWallets.filter(({ version }) => version === DEFAULT_WALLET_VERSION)[0];\n\n  if (defaultWallet.lastTxId) {\n    return defaultWallet;\n  }\n\n  const withBiggestBalance = allWallets.reduce<typeof allWallets[0] | undefined>((best, current) => {\n    return current.balance > (best?.balance ?? 0n) ? current : best;\n  }, undefined);\n\n  if (withBiggestBalance) {\n    return withBiggestBalance;\n  }\n\n  const withLastTx = findLast(allWallets, ({ lastTxId }) => !!lastTxId);\n\n  if (withLastTx) {\n    return withLastTx;\n  }\n\n  // Workaround for NOT holders who do not have transactions\n  const v4Wallet = allWallets.find(({ version }) => version === 'v4R2')!;\n  const v4JettonBalances = await fetchJettonBalances(network, v4Wallet.address);\n  if (v4JettonBalances.length > 0) {\n    return v4Wallet;\n  }\n\n  return defaultWallet;\n}\n\nexport async function getWalletVersionInfos(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  versions: ApiTonWalletVersion[] = ALL_WALLET_VERSIONS,\n): Promise<(ApiWalletWithVersionInfo & { wallet: TonWallet })[]> {\n  const items = versions.map((version) => {\n    const wallet = buildWallet(publicKey, version);\n    const address = toBase64Address(wallet.address, false, network);\n    return { wallet, address, version };\n  });\n\n  const walletInfos = await getWalletInfos(network, extractKey(items, 'address'));\n\n  return items.map((item) => {\n    return {\n      ...walletInfos[item.address] ?? {\n        balance: 0n,\n        isInitialized: false,\n      },\n      ...item,\n    };\n  });\n}\n\nexport function getWalletVersions(\n  network: ApiNetwork,\n  publicKey: Uint8Array,\n  versions: ApiTonWalletVersion[] = ALL_WALLET_VERSIONS,\n): {\n    wallet: TonWallet;\n    address: string;\n    version: ApiTonWalletVersion;\n  }[] {\n  return versions.map((version) => {\n    const wallet = buildWallet(publicKey, version);\n    const address = toBase64Address(wallet.address, false, network);\n\n    return {\n      wallet,\n      address,\n      version,\n    };\n  });\n}\n\nexport async function getWalletStateInit(accountId: string, storedWallet: ApiTonWallet) {\n  const wallet = await getTonWallet(accountId, storedWallet);\n\n  return beginCell()\n    .storeWritable(storeStateInit(wallet.init))\n    .endCell();\n}\n\nexport function pickWalletByAddress(network: ApiNetwork, publicKey: Uint8Array, address: string) {\n  address = toBase64Address(address, false, network);\n\n  const allWallets = getWalletVersions(network, publicKey);\n\n  return allWallets.find((w) => w.address === address)!;\n}\n\nexport async function getTonWallet(accountId: string, tonWallet?: ApiTonWallet) {\n  const { publicKey, version } = tonWallet ?? await fetchStoredTonWallet(accountId);\n  if (!publicKey) {\n    throw new Error('Public key is missing');\n  }\n\n  return buildWallet(publicKey, version);\n}\n","import * as tonWebMnemonic from 'tonweb-mnemonic';\nimport * as bip39 from 'bip39';\nimport nacl from 'tweetnacl';\n\nimport type { ApiAccountWithMnemonic, ApiNetwork, ApiTonWallet } from '../../types';\nimport type { ApiTonWalletVersion } from './types';\nimport type { TonWallet } from './util/tonCore';\nimport { ApiAuthError } from '../../types';\n\nimport { DEFAULT_WALLET_VERSION } from '../../../config';\nimport * as HDKey from '../../../lib/ed25519-hd-key';\nimport isMnemonicPrivateKey from '../../../util/isMnemonicPrivateKey';\nimport { omitUndefined } from '../../../util/iteratees';\nimport { logDebugError } from '../../../util/logs';\nimport { getWalletPublicKey, toBase64Address } from './util/tonCore';\nimport { fetchStoredAccount } from '../../common/accounts';\nimport { getMnemonic } from '../../common/mnemonic';\nimport { bytesToHex, hexToBytes } from '../../common/utils';\nimport { resolveAddress } from './address';\nimport { TON_BIP39_PATH } from './constants';\nimport { buildWallet, getWalletInfo, pickBestWallet, publicKeyToAddress } from './wallet';\n\nexport function generateMnemonic() {\n  return tonWebMnemonic.generateMnemonic();\n}\n\nexport function validateMnemonic(mnemonic: string[]) {\n  return tonWebMnemonic.validateMnemonic(mnemonic);\n}\n\nexport function privateKeyHexToKeyPair(privateKeyHex: string) {\n  return nacl.sign.keyPair.fromSeed(hexToBytes(privateKeyHex));\n}\n\nexport async function fetchPrivateKey(accountId: string, password: string, account?: ApiAccountWithMnemonic) {\n  try {\n    const { secretKey: privateKey } = await fetchKeyPair(accountId, password, account) || {};\n\n    return privateKey;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n\n    return undefined;\n  }\n}\n\nexport async function fetchKeyPair(accountId: string, password: string, account?: ApiAccountWithMnemonic) {\n  try {\n    account = account ?? await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const mnemonic = await getMnemonic(accountId, password, account);\n    if (!mnemonic) {\n      return undefined;\n    }\n\n    if (isMnemonicPrivateKey(mnemonic)) {\n      return privateKeyHexToKeyPair(mnemonic[0]);\n    } else if (account.type === 'bip39') {\n      return bip39MnemonicToKeyPair(mnemonic);\n    } else {\n      return await tonWebMnemonic.mnemonicToKeyPair(mnemonic);\n    }\n  } catch (err) {\n    logDebugError('fetchKeyPair', err);\n\n    return undefined;\n  }\n}\n\nexport async function rawSign(accountId: string, password: string, dataHex: string) {\n  const privateKey = await fetchPrivateKey(accountId, password);\n  if (!privateKey) {\n    return undefined;\n  }\n\n  const signature = nacl.sign.detached(hexToBytes(dataHex), privateKey);\n\n  return bytesToHex(signature);\n}\n\nexport function getWalletFromBip39Mnemonic(\n  network: ApiNetwork,\n  mnemonic: string[],\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet> {\n  const { publicKey } = bip39MnemonicToKeyPair(mnemonic);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nexport async function getWalletFromMnemonic(\n  mnemonic: string[],\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet & { lastTxId?: string }> {\n  const { publicKey } = await tonWebMnemonic.mnemonicToKeyPair(mnemonic);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nexport function getWalletFromPrivateKey(\n  privateKey: string,\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet> {\n  const { publicKey } = privateKeyHexToKeyPair(privateKey);\n  return getWalletFromKeys(publicKey, network, version);\n}\n\nasync function getWalletFromKeys(\n  publicKey: Uint8Array,\n  network: ApiNetwork,\n  version?: ApiTonWalletVersion,\n): Promise<ApiTonWallet & { lastTxId?: string }> {\n  let wallet: TonWallet;\n  let lastTxId: string | undefined;\n  if (version) {\n    wallet = buildWallet(publicKey, version);\n  } else {\n    ({ wallet, version, lastTxId } = await pickBestWallet(network, publicKey));\n  }\n\n  const address = toBase64Address(wallet.address, false, network);\n  const publicKeyHex = bytesToHex(publicKey);\n\n  return {\n    type: 'ton',\n    publicKey: publicKeyHex,\n    address,\n    version,\n    index: 0,\n    lastTxId,\n  };\n}\n\nfunction bip39MnemonicToKeyPair(mnemonic: string[]) {\n  const hexSeed = bip39.mnemonicToSeedSync(mnemonic.join(' '));\n  const { key: privateKey } = HDKey.derivePath(TON_BIP39_PATH, hexSeed.toString('hex'));\n  return nacl.sign.keyPair.fromSeed(privateKey);\n}\n\nexport function getOtherVersionWallet(\n  network: ApiNetwork,\n  wallet: ApiTonWallet,\n  otherVersion: ApiTonWalletVersion,\n): ApiTonWallet {\n  if (!wallet.publicKey) {\n    throw new Error('The wallet has no public key');\n  }\n\n  const publicKey = hexToBytes(wallet.publicKey);\n  const newAddress = publicKeyToAddress(network, publicKey, otherVersion);\n  return {\n    type: 'ton',\n    address: newAddress,\n    publicKey: wallet.publicKey,\n    version: otherVersion,\n    index: wallet.index,\n  };\n}\n\nexport async function getWalletFromAddress(\n  network: ApiNetwork,\n  addressOrDomain: string,\n): Promise<{ title?: string; wallet: ApiTonWallet } | { error: ApiAuthError }> {\n  const resolvedAddress = await resolveAddress(network, addressOrDomain, true);\n  if (resolvedAddress === 'dnsNotResolved') return { error: ApiAuthError.DomainNotResolved };\n  if (resolvedAddress === 'invalidAddress') return { error: ApiAuthError.InvalidAddress };\n  const rawAddress = resolvedAddress.address;\n\n  const [walletInfo, publicKey] = await Promise.all([\n    getWalletInfo(network, rawAddress),\n    getWalletPublicKey(network, rawAddress),\n  ]);\n\n  return {\n    title: resolvedAddress.name,\n    wallet: omitUndefined<ApiTonWallet>({\n      type: 'ton',\n      publicKey: publicKey ? bytesToHex(publicKey) : undefined,\n      address: walletInfo.address,\n      // The wallet has no version until it's initialized as a wallet. Using the default version just for the type\n      // compliance, it plays no role for view wallets anyway.\n      version: walletInfo?.version ?? DEFAULT_WALLET_VERSION,\n      index: 0,\n      isInitialized: walletInfo?.isInitialized ?? false,\n    }),\n  };\n}\n","import type { ApiChain } from '../api/types';\n\nimport { CHAIN_CONFIG } from '../config';\n\nexport function getChainConfig<T extends ApiChain>(chain: T) {\n  return CHAIN_CONFIG[chain];\n}\n\nexport function findChainConfig(chain: any) {\n  return chain in CHAIN_CONFIG ? CHAIN_CONFIG[chain as ApiChain] : undefined;\n}\n","import type { ApiCheckTransactionDraftResult, ApiFetchEstimateDieselResult } from '../../api/chains/ton/types';\nimport type { FeePrecision, FeeTerms } from './types';\n\nimport { TONCOIN } from '../../config';\nimport { Big } from '../../lib/big.js';\nimport { bigintMax, bigintMin } from '../bigint';\nimport { getIsNativeToken } from '../tokens';\n\ntype ApiFee = Pick<ApiCheckTransactionDraftResult, 'fee' | 'realFee' | 'diesel'> & {\n  /** The slug of the token that is being transferred */\n  tokenSlug: string;\n};\n\nexport type ExplainedTransferFee = {\n  /** Whether the result implies paying the fee with a diesel */\n  isGasless: boolean;\n  /**\n   * The fee that will be sent with the transfer. The wallet must have it on the balance to send the transfer.\n   * Show this in the transfer form when the input amount is ≤ the balance, but the remaining balance can't cover the\n   * full fee; show `realFee` otherwise. Undefined means that it's unknown.\n   */\n  fullFee?: {\n    precision: FeePrecision;\n    terms: FeeTerms<bigint>;\n    /** The sum of `terms` measured in the native token */\n    nativeSum: bigint;\n  };\n  /**\n   * The real fee (the full fee minus the excess). Undefined means that it's unknown. There is no need to fall back to\n   * `fullFee` when `realFee` is undefined (because it's undefined too in this case).\n   */\n  realFee?: {\n    precision: FeePrecision;\n    terms: FeeTerms<bigint>;\n    /** The sum of `terms` measured in the native token */\n    nativeSum: bigint;\n  };\n  /** The excess fee. Measured in the native token. It's always approximate. Undefined means that it's unknown. */\n  excessFee?: bigint;\n  /**\n   * Whether the full token balance can be transferred despite the fee.\n   * If yes, the fee will be taken from the transferred amount.\n   */\n  canTransferFullBalance: boolean;\n};\n\ntype AvailableDiesel = ApiFetchEstimateDieselResult & { amount: bigint };\ntype ApiFeeWithDiesel = ApiFee & { diesel: AvailableDiesel };\n\ntype MaxTransferAmountInput = {\n  /** The wallet balance of the transferred token. Undefined means that it's unknown. */\n  tokenBalance: bigint | undefined;\n  /** The slug of the token that is being transferred */\n  tokenSlug: string;\n  /** The full fee terms calculated by `explainApiTransferFee`. Undefined means that they're unknown. */\n  fullFee: FeeTerms<bigint> | undefined;\n  /** Whether the full token balance can be transferred despite the fee. */\n  canTransferFullBalance: boolean;\n};\n\ntype BalanceSufficientForTransferInput = Omit<MaxTransferAmountInput, 'tokenSlug'> & {\n  /** The wallet balance of the native token of the transfer chain. Undefined means that it's unknown. */\n  nativeTokenBalance: bigint | undefined;\n  /** The transferred amount. Use 0 for NFT transfers. Undefined means that it's unspecified. */\n  transferAmount: bigint | undefined;\n};\n\n/**\n * Converts the transfer fee data returned from API into data that is ready to be displayed in the transfer form UI.\n */\nexport function explainApiTransferFee(input: ApiFee): ExplainedTransferFee {\n  return shouldUseDiesel(input)\n    ? explainGaslessTransferFee(input)\n    : explainGasfullTransferFee(input);\n}\n\n/**\n * Calculates the maximum amount available for the transfer.\n * Returns undefined when it can't be calculated because of insufficient input data.\n */\nexport function getMaxTransferAmount({\n  tokenBalance,\n  tokenSlug,\n  fullFee,\n  canTransferFullBalance,\n}: MaxTransferAmountInput): bigint | undefined {\n  if (tokenBalance === undefined) {\n    return undefined;\n  }\n\n  // Returning the full balance when the fee is unknown for a better UX\n  if (canTransferFullBalance || !fullFee) {\n    return tokenBalance;\n  }\n\n  let fee = fullFee.token ?? 0n;\n  if (getIsNativeToken(tokenSlug)) {\n    // When the token is native, both `token` and `native` refer to the same currency, so they should be added\n    fee += fullFee.native ?? 0n;\n  }\n\n  return bigintMax(tokenBalance - fee, 0n);\n}\n\n/**\n * Decides whether the balance is sufficient to transfer the amount and pay the fees.\n * Returns undefined when it can't be calculated because of insufficient input data.\n */\nexport function isBalanceSufficientForTransfer({\n  tokenBalance,\n  nativeTokenBalance,\n  transferAmount,\n  fullFee,\n  canTransferFullBalance,\n}: BalanceSufficientForTransferInput) {\n  if (transferAmount === undefined || tokenBalance === undefined || nativeTokenBalance === undefined || !fullFee) {\n    return undefined;\n  }\n\n  const isFullTokenTransfer = transferAmount === tokenBalance && canTransferFullBalance;\n  const tokenRequiredAmount = (fullFee.token ?? 0n) + (isFullTokenTransfer ? 0n : transferAmount);\n  const nativeTokenRequiredAmount = fullFee.native ?? 0n;\n\n  return tokenRequiredAmount <= tokenBalance && nativeTokenRequiredAmount <= nativeTokenBalance;\n}\n\nexport function isDieselAvailable(diesel: ApiFetchEstimateDieselResult): diesel is AvailableDiesel {\n  return diesel.status !== 'not-available' && diesel.amount !== undefined;\n}\n\nexport function getDieselTokenAmount(diesel: ApiFetchEstimateDieselResult) {\n  return diesel.status === 'stars-fee' ? 0n : (diesel.amount ?? 0n);\n}\n\nfunction shouldUseDiesel(input: ApiFee): input is ApiFeeWithDiesel {\n  return input.diesel !== undefined && isDieselAvailable(input.diesel);\n}\n\n/**\n * Converts the data of a transfer not involving diesel\n */\nfunction explainGasfullTransferFee(input: ApiFee) {\n  const result: ExplainedTransferFee = {\n    isGasless: false,\n    canTransferFullBalance: input.tokenSlug === TONCOIN.slug,\n  };\n\n  if (input.fee !== undefined) {\n    result.fullFee = {\n      precision: input.realFee === input.fee ? 'exact' : 'lessThan',\n      terms: { native: input.fee },\n      nativeSum: input.fee,\n    };\n    result.realFee = result.fullFee;\n  }\n\n  if (input.realFee !== undefined) {\n    result.realFee = {\n      precision: input.realFee === input.fee ? 'exact' : 'approximate',\n      terms: { native: input.realFee },\n      nativeSum: input.realFee,\n    };\n  }\n\n  if (input.fee !== undefined && input.realFee !== undefined) {\n    result.excessFee = input.fee - input.realFee;\n  }\n\n  return result;\n}\n\n/**\n * Converts the diesel of semi-diesel transfer data\n */\nfunction explainGaslessTransferFee({ diesel }: ApiFeeWithDiesel) {\n  const isStarsDiesel = diesel.status === 'stars-fee';\n  const dieselKey = isStarsDiesel ? 'stars' : 'token';\n  const realFeeInDiesel = convertFee(diesel.realFee, diesel.nativeAmount, diesel.amount);\n  // Cover as much displayed real fee as possible with diesel, because in the excess it will return as the native token.\n  const dieselRealFee = bigintMin(diesel.amount, realFeeInDiesel);\n  // Cover the remaining real fee with the native token.\n  const nativeRealFee = bigintMax(0n, diesel.realFee - diesel.nativeAmount);\n\n  return {\n    isGasless: true,\n    canTransferFullBalance: false,\n    fullFee: {\n      precision: 'lessThan',\n      terms: {\n        [dieselKey]: diesel.amount,\n        native: diesel.remainingFee,\n      },\n      nativeSum: diesel.nativeAmount + diesel.remainingFee,\n    },\n    realFee: {\n      precision: 'approximate',\n      terms: {\n        [dieselKey]: dieselRealFee,\n        native: nativeRealFee,\n      },\n      nativeSum: diesel.realFee,\n    },\n    excessFee: diesel.nativeAmount + diesel.remainingFee - diesel.realFee,\n  } satisfies ExplainedTransferFee;\n}\n\n/**\n * `exampleFromAmount` and `exampleToAmount` define the exchange rate used to convert `amount`.\n * `exampleFromAmount` is defined in the same currency as `amount`. Mustn't be 0.\n * `exampleToAmount` is defined in the currency you want to get.\n */\nfunction convertFee(\n  amount: bigint,\n  exampleFromAmount: bigint,\n  exampleToAmount: bigint,\n) {\n  const exchangeRate = Big(exampleToAmount.toString()).div(exampleFromAmount.toString());\n  return BigInt(Big(amount.toString()).mul(exchangeRate).round().toString());\n}\n","import type { ApiChain, ApiToken, ApiTokenWithPrice } from '../api/types';\nimport type { UserToken } from '../global/types';\n\nimport { CHAIN_CONFIG, PRICELESS_TOKEN_HASHES, STAKED_TOKEN_SLUGS, TONCOIN } from '../config';\nimport { getChainConfig } from './chain';\nimport { pick } from './iteratees';\n\nconst chainByNativeSlug = Object.fromEntries(\n  Object.entries(CHAIN_CONFIG).map(([chain, { nativeToken }]) => [nativeToken.slug, chain]),\n) as Record<string, ApiChain>;\n\nexport function getIsNativeToken(slug?: string) {\n  return slug ? slug in chainByNativeSlug : false;\n}\n\nexport function getIsTonToken(slug: string, withNative?: boolean) {\n  return Boolean(slug.startsWith('ton-') || (withNative && slug === TONCOIN.slug));\n}\n\nexport function getNativeToken(chain: ApiChain): ApiToken {\n  return getChainConfig(chain).nativeToken;\n}\n\nexport function getChainBySlug(slug: string) {\n  const items = slug.split('-');\n  return items.length > 1 ? items[0] as ApiChain : chainByNativeSlug[slug];\n}\n\nexport function getIsServiceToken(token?: ApiToken) {\n  const { type, codeHash = '', slug = '' } = token ?? {};\n\n  return type === 'lp_token'\n    || STAKED_TOKEN_SLUGS.has(slug)\n    || PRICELESS_TOKEN_HASHES.has(codeHash);\n}\n\nexport function buildUserToken(token: ApiTokenWithPrice | ApiToken): UserToken {\n  return {\n    ...pick(token, [\n      'symbol',\n      'slug',\n      'name',\n      'image',\n      'decimals',\n      'keywords',\n      'chain',\n      'tokenAddress',\n      'type',\n    ]),\n    amount: 0n,\n    totalValue: '0',\n    price: 0,\n    priceUsd: 0,\n    change24h: 0,\n  };\n}\n","// This JS library implements TON message comment encryption and decryption for Web\n// Reference C++ code - SimpleEncryptionV2 - https://github.com/ton-blockchain/ton/blob/cc0eb453cb3bf69f92693160103d33112856c056/tonlib/tonlib/keys/SimpleEncryption.cpp#L110\n// Dependencies:\n// - TonWeb 0.0.60\n// - aes-js - 3.1.2 - https://github.com/ricmoo/aes-js/releases/tag/v3.1.2 - for aes-cbc without padding\n// - noble-ed25519 - 1.7.3 - // https://github.com/paulmillr/noble-ed25519/releases/tag/1.7.3 - for getSharedKey\n\nimport type { Address } from '@ton/core';\n\nimport aesjs from '../../../../lib/aes-js';\nimport { getSharedSecret } from '../../../../lib/noble-ed25519';\nimport { OpCode } from '../constants';\nimport { toBase64Address } from './tonCore';\n\nasync function hmacSha512(key: Uint8Array, data: Uint8Array): Promise<Uint8Array> {\n  const hmacAlgo = { name: 'HMAC', hash: 'SHA-512' };\n  const hmacKey = await crypto.subtle.importKey('raw', key, hmacAlgo, false, ['sign']);\n  const signature = await crypto.subtle.sign(hmacAlgo, hmacKey, data);\n  const result = new Uint8Array(signature);\n  if (result.length !== 512 / 8) throw new Error();\n  return result;\n}\n\nfunction getAesCbcState(hash: Uint8Array) {\n  if (hash.length < 48) throw new Error();\n  const key = hash.slice(0, 32);\n  const iv = hash.slice(32, 32 + 16);\n\n  // Note that native crypto.subtle AES-CBC not suitable here because\n  // even if the data IS a multiple of 16 bytes, padding will still be added\n  // So we use aes-js\n\n  return new aesjs.ModeOfOperation.cbc(key, iv);\n}\n\nfunction getRandomPrefix(dataLength: number, minPadding: number): Uint8Array {\n  const prefixLength = ((minPadding + 15 + dataLength) & -16) - dataLength;\n  const prefix = crypto.getRandomValues(new Uint8Array(prefixLength));\n  prefix[0] = prefixLength;\n  if ((prefixLength + dataLength) % 16 !== 0) throw new Error();\n  return prefix;\n}\n\nfunction combineSecrets(a: Uint8Array, b: Uint8Array) {\n  return hmacSha512(a, b);\n}\n\nasync function encryptDataWithPrefix(data: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array) {\n  if (data.length % 16 !== 0) throw new Error();\n  const dataHash = await combineSecrets(salt, data);\n  const msgKey = dataHash.slice(0, 16);\n\n  const res = new Uint8Array(data.length + 16);\n  res.set(msgKey, 0);\n\n  const cbcStateSecret = await combineSecrets(sharedSecret, msgKey);\n  const encrypted = getAesCbcState(cbcStateSecret).encrypt(data);\n  res.set(encrypted, 16);\n\n  return res;\n}\n\nasync function encryptDataImpl(data: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array) {\n  const prefix = getRandomPrefix(data.length, 16);\n  const combined = new Uint8Array(prefix.length + data.length);\n  combined.set(prefix, 0);\n  combined.set(data, prefix.length);\n  return encryptDataWithPrefix(combined, sharedSecret, salt);\n}\n\nexport async function encryptData(\n  data: Uint8Array, myPublicKey: Uint8Array, theirPublicKey: Uint8Array, privateKey: Uint8Array, salt: Uint8Array,\n) {\n  const sharedSecret = await getSharedSecret(privateKey, theirPublicKey);\n\n  const encrypted = await encryptDataImpl(data, sharedSecret, salt);\n  const prefixedEncrypted = new Uint8Array(myPublicKey.length + encrypted.length);\n  for (let i = 0; i < myPublicKey.length; i++) {\n    prefixedEncrypted[i] = theirPublicKey[i] ^ myPublicKey[i];\n  }\n  prefixedEncrypted.set(encrypted, myPublicKey.length);\n  return prefixedEncrypted;\n}\n\nexport async function encryptMessageComment(\n  comment: string,\n  myPublicKey: Uint8Array,\n  theirPublicKey: Uint8Array,\n  myPrivateKey: Uint8Array,\n  senderAddress: Address | string,\n) {\n  if (!comment || !comment.length) throw new Error('empty comment');\n\n  if (myPrivateKey.length === 64) {\n    myPrivateKey = myPrivateKey.slice(0, 32); // convert nacl private key\n  }\n\n  const commentBytes = new TextEncoder().encode(comment);\n\n  const salt = new TextEncoder().encode(toBase64Address(senderAddress, true));\n\n  const encryptedBytes = await encryptData(commentBytes, myPublicKey, theirPublicKey, myPrivateKey, salt);\n\n  const payload = new Uint8Array(encryptedBytes.length + 4);\n\n  const buffer = Buffer.alloc(4);\n  buffer.writeUInt32BE(OpCode.Encrypted);\n\n  payload.set(buffer, 0);\n  payload.set(encryptedBytes, 4);\n\n  return payload;\n}\n\nasync function doDecrypt(\n  cbcStateSecret: Uint8Array, msgKey: Uint8Array, encryptedData: Uint8Array, salt: Uint8Array,\n): Promise<Uint8Array> {\n  const decryptedData = getAesCbcState(cbcStateSecret).decrypt(encryptedData);\n  const dataHash = await combineSecrets(salt, decryptedData);\n  const gotMsgKey = dataHash.slice(0, 16);\n  if (msgKey.join(',') !== gotMsgKey.join(',')) {\n    throw new Error('Failed to decrypt: hash mismatch');\n  }\n  const prefixLength = decryptedData[0];\n  if (prefixLength > decryptedData.length || prefixLength < 16) {\n    throw new Error('Failed to decrypt: invalid prefix size');\n  }\n  return decryptedData.slice(prefixLength);\n}\n\nasync function decryptDataImpl(\n  encryptedData: Uint8Array, sharedSecret: Uint8Array, salt: Uint8Array,\n): Promise<Uint8Array> {\n  if (encryptedData.length < 16) throw new Error('Failed to decrypt: data is too small');\n  if (encryptedData.length % 16 !== 0) throw new Error('Failed to decrypt: data size is not divisible by 16');\n  const msgKey = encryptedData.slice(0, 16);\n  const data = encryptedData.slice(16);\n  const cbcStateSecret = await combineSecrets(sharedSecret, msgKey);\n  const res = await doDecrypt(cbcStateSecret, msgKey, data, salt);\n  return res;\n}\n\nexport async function decryptData(data: Uint8Array, publicKey: Uint8Array, privateKey: Uint8Array, salt: Uint8Array) {\n  if (data.length < publicKey.length) {\n    throw new Error('Failed to decrypt: data is too small');\n  }\n  const theirPublicKey = new Uint8Array(publicKey.length);\n  for (let i = 0; i < publicKey.length; i++) {\n    theirPublicKey[i] = data[i] ^ publicKey[i];\n  }\n  const sharedSecret = await getSharedSecret(privateKey, theirPublicKey);\n\n  const decrypted = await decryptDataImpl(data.slice(publicKey.length), sharedSecret, salt);\n  return decrypted;\n}\n\nexport async function decryptMessageComment(\n  encryptedData: Uint8Array, myPublicKey: Uint8Array, myPrivateKey: Uint8Array, senderAddress: Address | string,\n) {\n  if (myPrivateKey.length === 64) {\n    myPrivateKey = myPrivateKey.slice(0, 32); // convert nacl private key\n  }\n\n  const salt = new TextEncoder().encode(toBase64Address(senderAddress, true));\n\n  const decryptedBytes = await decryptData(encryptedData, myPublicKey, myPrivateKey, salt);\n  return new TextDecoder().decode(decryptedBytes);\n}\n","import { callBackendPost } from '../../../common/backend';\n\nconst DIESEL_URL = '/diesel';\n\nexport function dieselSendBoc(boc: string) {\n  return callBackendPost<{ result: string; paymentLink?: string }>(\n    `${DIESEL_URL}/sendBoc`, { boc, isAddition: true }, { shouldRetry: true },\n  );\n}\n","import { callBackendPost } from '../../../common/backend';\n\nconst DIESEL_URL = '/diesel';\n\nexport function dieselW5SendRequest(boc: string) {\n  return callBackendPost<{ result: string; paymentLink?: string }>(\n    `${DIESEL_URL}/w5/sendBoc`, { boc, isAddition: true }, { shouldRetry: true },\n  );\n}\n","import type { Cell, Message } from '@ton/core';\nimport { beginCell, external, storeMessage } from '@ton/core';\n\nimport type { GaslessType } from '../transfer';\nimport type { TonClient } from './TonClient';\nimport type { TonWallet } from './tonCore';\n\nimport { dieselSendBoc } from './diesel';\nimport { dieselW5SendRequest } from './w5diesel';\n\nexport async function sendExternal(\n  client: TonClient,\n  wallet: TonWallet,\n  message: Cell,\n  gaslessType?: GaslessType,\n) {\n  const {\n    address,\n    init,\n  } = wallet;\n\n  let neededInit: { data: Cell; code: Cell } | undefined;\n  if (init && !await client.isContractDeployed(address)) {\n    neededInit = init;\n  }\n\n  const ext = external({\n    to: address,\n    init: neededInit ? {\n      code: neededInit.code,\n      data: neededInit.data,\n    } : undefined,\n    body: message,\n  });\n\n  const cell = beginCell()\n    .store(storeMessage(ext))\n    .endCell();\n\n  const isW5Gasless = gaslessType === 'w5';\n\n  const msgHash = cell.hash().toString('base64');\n  const msgHashNormalized = getExternalMsgHashNormalized(ext);\n  const bodyMessageHash = message.hash().toString('base64');\n  const boc = cell.toBoc().toString('base64');\n\n  let paymentLink;\n  if (isW5Gasless) {\n    const result = await dieselW5SendRequest(boc);\n    paymentLink = result.paymentLink;\n  } else if (gaslessType === 'diesel') {\n    const result = await dieselSendBoc(boc);\n    paymentLink = result.paymentLink;\n  } else {\n    await client.sendFile(boc);\n  }\n\n  return {\n    boc,\n    msgHash: isW5Gasless ? bodyMessageHash : msgHash,\n    msgHashNormalized,\n    paymentLink,\n  };\n}\n\nfunction getExternalMsgHashNormalized(message: Message): string {\n  const cell = beginCell()\n    .storeUint(2, 2) // Message type: external-in\n    .storeUint(0, 2) // No sender address for external messages\n    .storeAddress(message.info.dest) // Store recipient address\n    .storeUint(0, 4) // Import fee is always zero for external messages\n    .storeBit(false) // No StateInit in this message\n    .storeBit(true) // Store the body as a reference\n    .storeRef(message.body) // Store the message body\n    .endCell();\n\n  return cell.hash().toString('base64');\n}\n","import type { ApiNetwork } from '../types';\n\nimport Deferred from '../../util/Deferred';\nimport generateUniqueId from '../../util/generateUniqueId';\n\nconst byId: Record<string, Deferred> = {};\nconst byAddress: Record<string, Deferred> = {};\n\nexport async function waitAndCreatePendingTransfer(network: ApiNetwork, address: string) {\n  const key = `${network}:${address}`;\n  const prevPending = byAddress[key];\n\n  const id = generateUniqueId();\n  const pendingTransfer = new Deferred();\n  byAddress[key] = pendingTransfer;\n  byId[id] = pendingTransfer;\n\n  if (prevPending) {\n    await prevPending.promise;\n  }\n\n  return { id, pendingTransfer };\n}\n\nexport function getPendingTransfer(id: string): Deferred | undefined {\n  return byId[id];\n}\n","import type { ApiNetwork } from '../../types';\nimport type { AddressBook, AnyAction, TraceDetail, Transaction } from './toncenter/types';\nimport type { ParsedTrace, ParsedTracePart } from './types';\n\nimport { bigintAbs } from '../../../util/bigint';\nimport { groupBy } from '../../../util/iteratees';\nimport { fetchTrace } from './toncenter/traces';\nimport { parseRawTransaction } from './toncenter';\n\n/**\n * Returns `undefined` when there is no trace for the given hash. It may be unavailable YET, for example if the trace is\n * requested immediately after receiving an action from the socket.\n */\nexport async function fetchAndParseTrace(\n  network: ApiNetwork,\n  walletAddress: string,\n  msgHashNormalized: string,\n  isActionPending?: boolean,\n): Promise<ParsedTrace | undefined> {\n  const { trace, addressBook } = await fetchTrace({ network, msgHashNormalized, isActionPending });\n\n  return trace && parseTrace({\n    network,\n    walletAddress,\n    actions: trace.actions,\n    traceDetail: trace.trace,\n    addressBook,\n    transactions: trace.transactions,\n  });\n}\n\nexport function parseTrace(options: {\n  network: ApiNetwork;\n  walletAddress: string;\n  actions: AnyAction[];\n  traceDetail: TraceDetail;\n  addressBook: AddressBook;\n  transactions: Record<string, Transaction>;\n}): ParsedTrace {\n  const {\n    network,\n    walletAddress,\n    actions,\n    traceDetail,\n    addressBook,\n    transactions: rawTransactions,\n  } = options;\n\n  const transactions = Object.values(rawTransactions)\n    .map((rawTx) => parseRawTransaction(network, rawTx, addressBook))\n    .flat();\n\n  const byHash = groupBy(transactions, 'hash');\n\n  let totalSent = 0n;\n  let totalReceived = 0n;\n  let totalNetworkFee = 0n;\n\n  const byTransactionIndex: ParsedTracePart[] = [];\n\n  let isWalletTransactionFound = false;\n\n  function processTrace(_traceDetail: TraceDetail, _index?: number) {\n    const hash = _traceDetail.tx_hash;\n    const txs = byHash[hash] || [];\n\n    if (!isWalletTransactionFound) {\n      isWalletTransactionFound = txs.some(({\n        fromAddress,\n        isIncoming,\n      }) => {\n        return fromAddress === walletAddress && !isIncoming;\n      });\n\n      // In gasless operations, we need to skip transactions before our wallet\n      if (!isWalletTransactionFound) {\n        _traceDetail.children.forEach(processTrace);\n        return;\n      }\n    }\n\n    for (const [i, tx] of txs.entries()) {\n      const {\n        fromAddress,\n        toAddress,\n        amount,\n        isIncoming,\n        fee,\n        msgHash,\n        type,\n      } = tx;\n\n      const index = _index ?? i;\n\n      if (!(index in byTransactionIndex)) {\n        // First transaction from wallet includes all sub-transactions, and its hash is not unique\n        byTransactionIndex.push({\n          hashes: new Set(),\n          sent: 0n,\n          received: 0n,\n          networkFee: 0n,\n        });\n      } else {\n        byTransactionIndex[index].hashes.add(hash);\n      }\n\n      if (fromAddress === walletAddress && !isIncoming) {\n        byTransactionIndex[index].sent += bigintAbs(amount);\n        byTransactionIndex[index].networkFee = fee;\n        totalSent += bigintAbs(amount);\n        totalNetworkFee += fee;\n      } else if (toAddress === walletAddress && isIncoming && type !== 'bounced') {\n        byTransactionIndex[index].received += bigintAbs(amount);\n        totalReceived += bigintAbs(amount);\n      }\n\n      const child = _traceDetail.children.find(({ in_msg_hash }) => in_msg_hash === msgHash);\n      if (child) {\n        processTrace(child, index);\n      }\n    }\n  }\n\n  processTrace(traceDetail);\n\n  return {\n    actions,\n    traceDetail,\n    addressBook,\n    byTransactionIndex,\n    totalSent,\n    totalReceived,\n    totalNetworkFee,\n  };\n}\n","import type { ApiNetwork } from '../../../types';\nimport type { AddressBook, MetadataMap, Trace } from './types';\n\nimport { callToncenterV3 } from './other';\n\nexport type TracesResponse = {\n  traces: Trace[];\n  address_book: AddressBook;\n  metadata: MetadataMap;\n};\n\nexport async function fetchTrace(options: {\n  network: ApiNetwork;\n  msgHashNormalized: string;\n  isActionPending?: boolean;\n}): Promise<{\n    trace?: Trace;\n    addressBook: AddressBook;\n    metadata: MetadataMap;\n  }> {\n  const { network, msgHashNormalized, isActionPending } = options;\n\n  const response = await callToncenterV3<TracesResponse>(\n    network,\n    isActionPending ? '/pendingTraces' : '/traces',\n    {\n      [isActionPending ? 'ext_msg_hash' : 'msg_hash']: msgHashNormalized,\n      include_actions: true,\n    },\n  );\n\n  return {\n    trace: response.traces[0],\n    addressBook: response.address_book,\n    metadata: response.metadata,\n  };\n}\n","import type { ApiActivity, ApiNetwork, ApiSwapActivity, ApiTransactionActivity } from '../../types';\nimport type { AnyAction, CallContractAction, JettonTransferAction, SwapAction } from './toncenter/types';\nimport type { ParsedTrace } from './types';\n\nimport { TONCOIN } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { getActivityTokenSlugs, getIsActivityPending } from '../../../util/activities';\nimport { fromDecimal, toDecimal } from '../../../util/decimals';\nimport { intersection } from '../../../util/iteratees';\nimport { logDebug, logDebugError } from '../../../util/logs';\nimport { pause } from '../../../util/schedulers';\nimport withCacheAsync from '../../../util/withCacheAsync';\nimport { resolveTokenWalletAddress } from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { getTokenBySlug } from '../../common/tokens';\nimport { SEC } from '../../constants';\nimport { OpCode, OUR_FEE_PAYLOAD_BOC } from './constants';\nimport { fetchActions, fetchTransactions, parseActionActivityId, parseLiquidityDeposit } from './toncenter';\nimport { fetchAndParseTrace } from './traces';\n\ntype ActivityDetailsResult = {\n  activity: ApiActivity;\n  sentForFee: bigint;\n  excess: bigint;\n};\n\nconst GET_TRANSACTIONS_LIMIT = 128;\n\nconst TRACE_ATTEMPT_COUNT = 5;\nconst TRACE_RETRY_DELAY = SEC;\n\nexport const checkHasTransaction = withCacheAsync(async (network: ApiNetwork, address: string) => {\n  const transactions = await fetchTransactions({\n    network,\n    address,\n    limit: 1,\n  });\n  return Boolean(transactions.length);\n});\n\nexport async function fetchActivitySlice(\n  accountId: string,\n  tokenSlug?: string,\n  toTimestamp?: number,\n  fromTimestamp?: number,\n  limit?: number,\n  shouldIncludeFrom?: boolean,\n): Promise<ApiActivity[]> {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  if (!tokenSlug) {\n    return fetchActions({\n      network,\n      filter: { address },\n      walletAddress: address,\n      limit: limit ?? GET_TRANSACTIONS_LIMIT,\n      fromTimestamp,\n      toTimestamp,\n      shouldIncludeFrom,\n    });\n  } else {\n    const activities = await fetchActions({\n      network,\n      filter: {\n        address: tokenSlug === TONCOIN.slug\n          ? address\n          : await resolveTokenWalletAddress(network, address, getTokenBySlug(tokenSlug).tokenAddress!),\n      },\n      walletAddress: address,\n      limit: limit ?? GET_TRANSACTIONS_LIMIT,\n      fromTimestamp,\n      toTimestamp,\n      shouldIncludeFrom,\n    });\n\n    return activities.filter((activity) => getActivityTokenSlugs(activity).includes(tokenSlug));\n  }\n}\n\nexport async function fetchNewestActionId(network: ApiNetwork, address: string) {\n  const transactions = await fetchTransactions({\n    network,\n    address,\n    limit: 1,\n  });\n\n  if (!transactions.length) {\n    return undefined;\n  }\n\n  return transactions[0].txId;\n}\n\nexport async function fetchActivityDetails(\n  accountId: string,\n  activity: ApiActivity,\n): Promise<ActivityDetailsResult | undefined> {\n  const { network } = parseAccountId(accountId);\n  const { address: walletAddress } = await fetchStoredTonWallet(accountId);\n  let result: ActivityDetailsResult | undefined;\n\n  // The trace can be unavailable immediately after the action is received, so a couple of delayed retries are made\n  for (let attempt = 0; attempt < TRACE_ATTEMPT_COUNT && !result; attempt++) {\n    if (attempt > 0) {\n      await pause(TRACE_RETRY_DELAY);\n    }\n\n    const parsedTrace = await fetchAndParseTrace(\n      network,\n      walletAddress,\n      activity.externalMsgHashNorm!,\n      getIsActivityPending(activity),\n    );\n    if (!parsedTrace) {\n      continue;\n    }\n\n    result = calculateActivityDetails(activity, parsedTrace);\n  }\n\n  if (!result) {\n    logDebugError('Trace unavailable for activity', activity.id);\n  }\n\n  return result;\n}\n\nexport function calculateActivityDetails(\n  activity: ApiActivity,\n  parsedTrace: ParsedTrace,\n): ActivityDetailsResult | undefined {\n  const { actionId } = parseActionActivityId(activity.id);\n  const { actions, byTransactionIndex } = parsedTrace;\n\n  const action = actions.find(({ action_id }) => action_id === actionId);\n  if (!action) {\n    // This can happen when the trace is requested too early, for example right after receiving the action from a socket\n    return undefined;\n  }\n\n  const actionHashes = new Set(action.transactions);\n\n  const {\n    sent,\n    received,\n    networkFee,\n  } = byTransactionIndex.find((item) => {\n    return intersection(item.hashes, actionHashes).size;\n  })!;\n\n  let result: ActivityDetailsResult;\n\n  if (activity.kind === 'swap') {\n    result = setSwapDetails({\n      parsedTrace, activity, action: action as SwapAction, sent, received, networkFee,\n    });\n  } else {\n    result = setTransactionDetails({\n      parsedTrace, activity, action, sent, received, networkFee,\n    });\n  }\n\n  logDebug('Calculation of fee for action', {\n    actionId: action.action_id,\n    externalMsgHashNorm: activity.externalMsgHashNorm,\n    isPending: getIsActivityPending(activity),\n    networkFee: toDecimal(networkFee),\n    realFee: toDecimal(getActivityRealFee(result.activity)),\n    sentForFee: toDecimal(result.sentForFee),\n    excess: toDecimal(result.excess),\n    details: action.details,\n  });\n\n  return result;\n}\n\nfunction setSwapDetails(options: {\n  parsedTrace: ParsedTrace;\n  action: SwapAction;\n  activity: ApiSwapActivity;\n  sent: bigint;\n  received: bigint;\n  networkFee: bigint;\n}): ActivityDetailsResult {\n  const { action, networkFee, received, sent, parsedTrace: { actions } } = options;\n  let { activity } = options;\n\n  const { details } = action;\n\n  let sentForFee = sent;\n  let excess = received;\n\n  if (!details.asset_in) {\n    // TON -> token\n    sentForFee -= BigInt(details.dex_incoming_transfer.amount);\n  } else if (!details.asset_out) {\n    // Token -> TON\n    excess -= BigInt(details.dex_outgoing_transfer.amount);\n  }\n\n  const realFee = networkFee + sentForFee - excess;\n\n  activity = {\n    ...activity,\n    networkFee: toDecimal(realFee),\n  };\n\n  let ourFee: bigint | undefined;\n  if (!details.asset_in) {\n    const ourFeeAction = actions.find((_action) => {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-enum-comparison\n      return _action.type === 'call_contract' && Number(_action.details.opcode) === OpCode.OurFee;\n    }) as CallContractAction | undefined;\n    if (ourFeeAction) {\n      ourFee = BigInt(ourFeeAction.details.value);\n    }\n  } else {\n    const ourFeeAction = actions.find((_action) => {\n      return _action.type === 'jetton_transfer' && _action.details.forward_payload === OUR_FEE_PAYLOAD_BOC;\n    }) as JettonTransferAction | undefined;\n    if (ourFeeAction) {\n      ourFee = BigInt(ourFeeAction.details.amount);\n    }\n  }\n\n  if (ourFee) {\n    const tokenIn = getTokenBySlug(activity.from);\n    activity.ourFee = toDecimal(ourFee, tokenIn?.decimals);\n  }\n\n  delete activity.shouldLoadDetails;\n\n  return { activity, sentForFee, excess };\n}\n\nfunction setTransactionDetails(options: {\n  parsedTrace: ParsedTrace;\n  action: AnyAction;\n  activity: ApiTransactionActivity;\n  sent: bigint;\n  received: bigint;\n  networkFee: bigint;\n}): ActivityDetailsResult {\n  const {\n    action,\n    received,\n    sent,\n    parsedTrace: {\n      addressBook,\n      totalSent,\n      totalReceived,\n      totalNetworkFee,\n    },\n  } = options;\n\n  let { activity, networkFee } = options;\n  let sentForFee = sent;\n  let excess = received;\n\n  switch (action.type) {\n    case 'ton_transfer':\n    case 'call_contract': {\n      sentForFee -= BigInt(action.details.value);\n      break;\n    }\n    case 'nft_transfer': {\n      if (action.details.is_purchase) {\n        sentForFee -= BigInt(action.details.price!);\n      }\n      break;\n    }\n    case 'stake_deposit': {\n      sentForFee -= BigInt(action.details.amount);\n      break;\n    }\n    case 'stake_withdrawal': {\n      excess -= BigInt(action.details.amount);\n      break;\n    }\n    case 'dex_deposit_liquidity': {\n      // Liquidity deposit can be either a dual transaction or two separate single transactions.\n      // We display the deposit as separate actions, so we divide by the number of actions.\n      const activitiesPerAction = BigInt(parseLiquidityDeposit(action, {\n        addressBook,\n        // The below fields don't matter here, they are only to satisfy the type requirements:\n        network: 'mainnet',\n        walletAddress: '',\n        metadata: {},\n        nftSuperCollectionsByCollectionAddress: {},\n      }).length);\n\n      networkFee = totalNetworkFee / activitiesPerAction;\n      sentForFee = totalSent / activitiesPerAction;\n      excess = totalReceived / activitiesPerAction;\n\n      if (!action.details.asset_1) {\n        sentForFee -= BigInt(action.details.amount_1 ?? 0n) / activitiesPerAction;\n      } else if (!action.details.asset_2) {\n        sentForFee -= BigInt(action.details.amount_2 ?? 0n) / activitiesPerAction;\n      }\n      break;\n    }\n    case 'dex_withdraw_liquidity': {\n      if (!action.details.asset_1) {\n        excess -= BigInt(action.details.amount_1);\n      } else if (!action.details.asset_2) {\n        excess -= BigInt(action.details.amount_2);\n      }\n\n      sentForFee /= 2n;\n      excess /= 2n;\n      break;\n    }\n  }\n\n  const realFee = networkFee + sentForFee - excess;\n\n  activity = {\n    ...activity,\n    fee: realFee,\n  };\n\n  delete activity.shouldLoadDetails;\n\n  return { activity, sentForFee, excess };\n}\n\nexport function getActivityRealFee(activity: ApiActivity) {\n  return activity.kind === 'swap' ? fromDecimal(activity.networkFee, TONCOIN.decimals) : activity.fee;\n}\n","import type { Cell } from '@ton/core';\nimport { beginCell, external, storeMessage } from '@ton/core';\n\nimport type {\n  ApiActivity,\n  ApiEmulationResult,\n  ApiNetwork,\n  ApiNftSuperCollection,\n  ApiTransactionActivity,\n} from '../../types';\nimport type { EmulationResponse } from './toncenter/emulation';\nimport type { TonWallet } from './util/tonCore';\n\nimport { BURN_ADDRESS, TONCOIN } from '../../../config';\nimport { logDebugError } from '../../../util/logs';\nimport { toBase64Address } from './util/tonCore';\nimport { getNftSuperCollectionsByCollectionAddress } from '../../common/addresses';\nimport { FAKE_TX_ID } from '../../constants';\nimport { fetchEmulateTrace } from './toncenter/emulation';\nimport { calculateActivityDetails, getActivityRealFee } from './activities';\nimport { parseActions } from './toncenter';\nimport { parseTrace } from './traces';\n\nexport async function emulateTransaction(\n  network: ApiNetwork,\n  wallet: TonWallet,\n  transaction: Cell,\n  isInitialized?: boolean,\n) {\n  const boc = buildExternalBoc(wallet, transaction, isInitialized);\n  const emulation = await fetchEmulateTrace(network, boc);\n  const walletAddress = toBase64Address(wallet.address, false, network);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n  return parseEmulation(network, walletAddress, emulation, nftSuperCollectionsByCollectionAddress);\n}\n\nfunction parseFailedEmulation(emulation: EmulationResponse) {\n  const fallbackFee = Object.values(emulation.transactions).reduce((acc, tx) => {\n    const { total_fees: totalFees } = tx;\n    return acc + BigInt(totalFees);\n  }, 0n);\n\n  return {\n    networkFee: fallbackFee,\n    received: 0n,\n    byTransactionIndex: [],\n    activities: [],\n    realFee: fallbackFee,\n  };\n}\n\nfunction parseEmulation(\n  network: ApiNetwork,\n  walletAddress: string,\n  emulation: EmulationResponse,\n  nftSuperCollectionsByCollectionAddress: Record<string, ApiNftSuperCollection>,\n): ApiEmulationResult {\n  const parsedTrace = parseTrace({\n    network,\n    walletAddress,\n    actions: emulation.actions,\n    traceDetail: emulation.trace,\n    addressBook: emulation.address_book,\n    transactions: emulation.transactions,\n  });\n\n  const allActivities = parseActions(\n    network,\n    walletAddress,\n    emulation.actions,\n    emulation.address_book,\n    emulation.metadata,\n    nftSuperCollectionsByCollectionAddress,\n  );\n\n  const walletActivities: ApiActivity[] = [];\n  let totalRealFee = 0n;\n  let totalExcess = 0n;\n\n  for (let activity of allActivities) {\n    if (\n      activity.shouldHide || (\n        activity.kind === 'transaction'\n        && activity.fromAddress !== walletAddress\n        && activity.toAddress !== walletAddress\n      )) {\n      continue;\n    }\n\n    if (activity.shouldLoadDetails) {\n      const result = calculateActivityDetails(activity, parsedTrace);\n      if (result) {\n        activity = result.activity;\n        totalExcess += result.excess;\n      } else {\n        logDebugError('Unparsable trace for emulated activity', activity.id);\n      }\n    }\n\n    walletActivities.push(activity);\n    totalRealFee += getActivityRealFee(activity);\n  }\n\n  if (totalExcess) {\n    addExcessActivity(walletAddress, walletActivities, totalExcess);\n  }\n\n  if (allActivities.length === 0) {\n    // Expected to happen when the wallet balance is insufficient\n    return parseFailedEmulation(emulation);\n  }\n\n  return {\n    networkFee: parsedTrace.totalNetworkFee,\n    received: parsedTrace.totalReceived,\n    byTransactionIndex: parsedTrace.byTransactionIndex,\n    activities: walletActivities,\n    realFee: totalRealFee,\n  };\n}\n\nfunction addExcessActivity(walletAddress: string, activities: ApiActivity[], excess: bigint) {\n  const index = activities.findIndex((activity) => {\n    return activity.kind === 'transaction' && activity.type === 'excess';\n  });\n\n  if (index !== -1) {\n    const excessActivity = activities.splice(index, 1)[0] as ApiTransactionActivity;\n    activities.push({\n      ...excessActivity,\n      amount: excessActivity.amount + excess,\n    });\n  } else {\n    activities.push({\n      id: FAKE_TX_ID,\n      txId: FAKE_TX_ID,\n      timestamp: activities[activities.length - 1].timestamp,\n      kind: 'transaction',\n      amount: excess,\n      slug: TONCOIN.slug,\n      normalizedAddress: BURN_ADDRESS,\n      fromAddress: BURN_ADDRESS,\n      toAddress: walletAddress,\n      isIncoming: true,\n      fee: 0n,\n      type: 'excess',\n    });\n  }\n}\n\nfunction buildExternalBoc(wallet: TonWallet, body: Cell, isInitialized?: boolean) {\n  const externalMessage = external({\n    to: wallet.address,\n    init: !isInitialized ? {\n      code: wallet.init.code,\n      data: wallet.init.data,\n    } : undefined,\n    body,\n  });\n\n  return beginCell()\n    .store(storeMessage(externalMessage))\n    .endCell()\n    .toBoc()\n    .toString('base64');\n}\n","import type { ApiNetwork } from '../../../types';\nimport type { AccountState, AddressBook, AnyAction, MetadataMap, TraceDetail, Transaction } from './types';\n\nimport { TONCENTER_MAINNET_URL, TONCENTER_TESTNET_URL } from '../../../../config';\nimport { fetchWithRetry } from '../../../../util/fetch';\nimport { getToncenterHeaders } from './other';\n\nexport type EmulationResponse = {\n  mc_block_seqno: number;\n  trace: TraceDetail;\n  actions: AnyAction[];\n  transactions: Record<string, Transaction>;\n  account_states: Record<string, AccountState>;\n  rand_seed: string;\n  metadata: MetadataMap;\n  address_book: AddressBook;\n};\n\nexport async function fetchEmulateTrace(network: ApiNetwork, boc: string): Promise<EmulationResponse> {\n  const baseUrl = network === 'testnet' ? TONCENTER_TESTNET_URL : TONCENTER_MAINNET_URL;\n\n  const response = await fetchWithRetry(`${baseUrl}/api/emulate/v1/emulateTrace`, {\n    method: 'POST',\n    headers: {\n      ...getToncenterHeaders(network),\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      boc,\n      ignore_chksig: true,\n      include_code_data: false,\n      with_actions: true,\n      include_address_book: true,\n      include_metadata: true,\n    }),\n  });\n\n  return response.json();\n}\n","import type { JettonBalance } from 'tonapi-sdk-js';\nimport { Address, Cell } from '@ton/core';\n\nimport type { ApiBalanceBySlug, ApiNetwork, ApiToken, ApiTokenWithPrice, OnApiUpdate } from '../../types';\nimport type { AnyPayload, JettonMetadata, TonTransferParams } from './types';\n\nimport { TON_USDT_SLUG } from '../../../config';\nimport { fetchJsonWithProxy, fixIpfsUrl } from '../../../util/fetch';\nimport { logDebugError } from '../../../util/logs';\nimport { fetchJettonMetadata, fixBase64ImageData, parsePayloadBase64 } from './util/metadata';\nimport { fetchJettonBalances } from './util/tonapiio';\nimport {\n  buildTokenTransferBody,\n  getTokenBalance,\n  getTonClient,\n  resolveTokenAddress,\n  resolveTokenWalletAddress,\n  toBase64Address, toRawAddress,\n} from './util/tonCore';\nimport { buildTokenSlug, getTokenByAddress, updateTokens } from '../../common/tokens';\nimport {\n  CLAIM_MINTLESS_AMOUNT,\n  DEFAULT_DECIMALS,\n  TINIEST_TOKEN_TRANSFER_REAL_AMOUNT,\n  TINY_TOKEN_TRANSFER_AMOUNT,\n  TINY_TOKEN_TRANSFER_REAL_AMOUNT,\n  TOKEN_TRANSFER_AMOUNT,\n  TOKEN_TRANSFER_FORWARD_AMOUNT,\n  TOKEN_TRANSFER_REAL_AMOUNT,\n} from './constants';\nimport { updateTokenHashes } from './priceless';\nimport { isActiveSmartContract } from './wallet';\n\nexport type TokenBalanceParsed = {\n  slug: string;\n  balance: bigint;\n  token: ApiToken;\n  jettonWallet: string;\n};\n\nasync function getTokenBalances(network: ApiNetwork, address: string) {\n  const balancesRaw = await fetchJettonBalances(network, address);\n  return balancesRaw.map((balance) => parseTokenBalance(network, balance)).filter(Boolean);\n}\n\nfunction parseTokenBalance(network: ApiNetwork, balanceRaw: JettonBalance): TokenBalanceParsed | undefined {\n  if (!balanceRaw.jetton) {\n    return undefined;\n  }\n\n  try {\n    const { balance, jetton, wallet_address: walletAddress } = balanceRaw;\n    const tokenAddress = toBase64Address(jetton.address, true, network);\n    const token = buildTokenByMetadata(tokenAddress, jetton);\n\n    return {\n      slug: token.slug,\n      balance: BigInt(balance),\n      token,\n      jettonWallet: toBase64Address(walletAddress.address, undefined, network),\n    };\n  } catch (err) {\n    logDebugError('parseTokenBalance', err);\n    return undefined;\n  }\n}\n\nexport async function insertMintlessPayload(\n  network: ApiNetwork,\n  fromAddress: string,\n  tokenAddress: string,\n  transfer: TonTransferParams,\n): Promise<TonTransferParams> {\n  const { toAddress, payload } = transfer;\n\n  const token = getTokenByAddress(tokenAddress);\n  if (typeof payload !== 'string' || !token?.customPayloadApiUrl) {\n    return transfer;\n  }\n\n  const parsedPayload = await parsePayloadBase64(network, toAddress, payload);\n  if (parsedPayload.type !== 'tokens:transfer') {\n    throw new Error('Invalid payload');\n  }\n\n  const {\n    mintlessTokenBalance,\n    isMintlessClaimed,\n    stateInit,\n    customPayload,\n  } = await getMintlessParams({\n    network,\n    token,\n    fromAddress,\n    tokenWalletAddress: transfer.toAddress,\n  });\n\n  if (!mintlessTokenBalance || isMintlessClaimed) {\n    return transfer;\n  }\n\n  const newPayload = buildTokenTransferBody({\n    toAddress: parsedPayload.destination,\n    queryId: parsedPayload.queryId,\n    tokenAmount: parsedPayload.amount,\n    forwardAmount: parsedPayload.forwardAmount,\n    forwardPayload: Cell.fromBase64(parsedPayload.forwardPayload!),\n    responseAddress: parsedPayload.responseDestination,\n    customPayload: Cell.fromBase64(customPayload!),\n  });\n\n  return {\n    ...transfer,\n    stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    payload: newPayload,\n    isBase64Payload: false,\n  };\n}\n\nexport async function buildTokenTransfer(options: {\n  network: ApiNetwork;\n  tokenAddress: string;\n  fromAddress: string;\n  toAddress: string;\n  amount: bigint;\n  payload?: AnyPayload;\n  shouldSkipMintless?: boolean;\n  forwardAmount?: bigint;\n}) {\n  const {\n    network,\n    tokenAddress,\n    fromAddress,\n    toAddress,\n    amount,\n    shouldSkipMintless,\n    forwardAmount = TOKEN_TRANSFER_FORWARD_AMOUNT,\n  } = options;\n  let { payload } = options;\n\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, fromAddress, tokenAddress);\n  const token = getTokenByAddress(tokenAddress);\n\n  const {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress)),\n    isMintlessClaimed,\n    mintlessTokenBalance,\n    customPayload,\n    stateInit,\n  } = await getMintlessParams({\n    network, fromAddress, token, tokenWalletAddress, shouldSkipMintless,\n  });\n\n  if (isTokenWalletDeployed) {\n    const realTokenAddress = await resolveTokenAddress(network, tokenWalletAddress);\n    if (tokenAddress !== realTokenAddress) {\n      throw new Error('Invalid contract');\n    }\n  }\n\n  payload = buildTokenTransferBody({\n    tokenAmount: amount,\n    toAddress,\n    forwardAmount,\n    forwardPayload: payload,\n    responseAddress: fromAddress,\n    customPayload: customPayload ? Cell.fromBase64(customPayload) : undefined,\n  });\n\n  // eslint-disable-next-line prefer-const\n  let { amount: toncoinAmount, realAmount } = getToncoinAmountForTransfer(\n    token, Boolean(mintlessTokenBalance) && !isMintlessClaimed,\n  );\n\n  if (forwardAmount > TOKEN_TRANSFER_FORWARD_AMOUNT) {\n    toncoinAmount += forwardAmount;\n  }\n\n  return {\n    amount: toncoinAmount,\n    realAmount,\n    toAddress: tokenWalletAddress,\n    payload,\n    stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    mintlessTokenBalance,\n    isTokenWalletDeployed,\n  };\n}\n\nexport async function getTokenBalanceWithMintless(network: ApiNetwork, accountAddress: string, tokenAddress: string) {\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, accountAddress, tokenAddress);\n  const token = getTokenByAddress(tokenAddress);\n\n  const {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress)),\n    mintlessTokenBalance,\n  } = await getMintlessParams({\n    network, fromAddress: accountAddress, token, tokenWalletAddress,\n  });\n\n  return calculateTokenBalanceWithMintless(network, tokenWalletAddress, isTokenWalletDeployed, mintlessTokenBalance);\n}\n\nexport async function calculateTokenBalanceWithMintless(\n  network: ApiNetwork,\n  tokenWalletAddress: string,\n  isTokenWalletDeployed?: boolean,\n  mintlessTokenBalance = 0n,\n) {\n  let balance = 0n;\n  if (isTokenWalletDeployed) {\n    balance += await getTokenBalance(network, tokenWalletAddress);\n  }\n  if (mintlessTokenBalance) {\n    balance += mintlessTokenBalance;\n  }\n  return balance;\n}\n\nasync function getMintlessParams(options: {\n  network: ApiNetwork;\n  fromAddress: string;\n  token: ApiToken;\n  tokenWalletAddress: string;\n  shouldSkipMintless?: boolean;\n}) {\n  const {\n    network, fromAddress, token, tokenWalletAddress, shouldSkipMintless,\n  } = options;\n\n  const isMintlessToken = !!token.customPayloadApiUrl;\n  let isTokenWalletDeployed: boolean | undefined;\n  let customPayload: string | undefined;\n  let stateInit: string | undefined;\n\n  let isMintlessClaimed: boolean | undefined;\n  let mintlessTokenBalance: bigint | undefined;\n\n  if (isMintlessToken && !shouldSkipMintless) {\n    isTokenWalletDeployed = !!(await isActiveSmartContract(network, tokenWalletAddress));\n    isMintlessClaimed = isTokenWalletDeployed && await checkMintlessTokenWalletIsClaimed(network, tokenWalletAddress);\n\n    if (!isMintlessClaimed) {\n      const data = await fetchMintlessTokenWalletData(token.customPayloadApiUrl!, fromAddress);\n      const isExpired = data\n        ? Date.now() > new Date(Number(data.compressed_info.expired_at) * 1000).getTime()\n        : true;\n\n      if (data && !isExpired) {\n        customPayload = data.custom_payload;\n        mintlessTokenBalance = BigInt(data.compressed_info.amount);\n\n        if (!isTokenWalletDeployed) {\n          stateInit = data.state_init;\n        }\n      }\n    }\n  }\n\n  return {\n    isTokenWalletDeployed,\n    isMintlessClaimed,\n    mintlessTokenBalance,\n    customPayload,\n    stateInit,\n  };\n}\n\nexport async function checkMintlessTokenWalletIsClaimed(network: ApiNetwork, tokenWalletAddress: string) {\n  const res = await getTonClient(network)\n    .runMethod(Address.parse(tokenWalletAddress), 'is_claimed');\n  return res.stack.readBoolean();\n}\n\nasync function fetchMintlessTokenWalletData(customPayloadApiUrl: string, address: string) {\n  const rawAddress = toRawAddress(address);\n\n  return (await fetchJsonWithProxy(`${customPayloadApiUrl}/wallet/${rawAddress}`).catch(() => undefined)) as {\n    custom_payload: string;\n    state_init: string;\n    compressed_info: {\n      amount: string;\n      start_from: string;\n      expired_at: string;\n    };\n  } | undefined;\n}\n\nexport async function fetchToken(network: ApiNetwork, address: string) {\n  const metadata = await fetchJettonMetadata(network, address);\n\n  return buildTokenByMetadata(address, metadata);\n}\n\nfunction buildTokenByMetadata(address: string, metadata: JettonMetadata): ApiToken {\n  const {\n    name,\n    symbol,\n    image,\n    image_data: imageData,\n    decimals,\n    custom_payload_api_uri: customPayloadApiUrl,\n  } = metadata;\n\n  return {\n    slug: buildTokenSlug('ton', address),\n    name,\n    symbol,\n    decimals: decimals === undefined ? DEFAULT_DECIMALS : Number(decimals),\n    chain: 'ton',\n    tokenAddress: address,\n    image: (image && fixIpfsUrl(image)) || (imageData && fixBase64ImageData(imageData)) || undefined,\n    customPayloadApiUrl,\n  };\n}\n\n/**\n * A pure function guessing the \"fee\" that needs to be attached to the token transfer.\n * In contrast to the blockchain fee, this fee is a part of the transfer itself.\n *\n * `amount` is what should be attached (acts as a fee for the user);\n * `realAmount` is approximately what will be actually spent (the rest will return in the excess).\n */\nexport function getToncoinAmountForTransfer(token: ApiToken, willClaimMintless: boolean) {\n  let amount = 0n;\n  let realAmount = 0n;\n\n  if (token.slug === TON_USDT_SLUG) {\n    amount += TINY_TOKEN_TRANSFER_AMOUNT;\n    realAmount += TINIEST_TOKEN_TRANSFER_REAL_AMOUNT;\n  } else if (token.isTiny) {\n    amount += TINY_TOKEN_TRANSFER_AMOUNT;\n    realAmount += TINY_TOKEN_TRANSFER_REAL_AMOUNT;\n  } else {\n    amount += TOKEN_TRANSFER_AMOUNT;\n    realAmount += TOKEN_TRANSFER_REAL_AMOUNT;\n  }\n\n  if (willClaimMintless) {\n    amount += CLAIM_MINTLESS_AMOUNT;\n    realAmount += CLAIM_MINTLESS_AMOUNT;\n  }\n\n  return { amount, realAmount };\n}\n\nexport async function loadTokenBalances(\n  network: ApiNetwork,\n  address: string,\n  onUpdate: OnApiUpdate,\n): Promise<ApiBalanceBySlug> {\n  const tokenBalances = await getTokenBalances(network, address);\n  const tokens: ApiTokenWithPrice[] = tokenBalances.map(({ token }) => ({\n    ...token,\n    price: 0,\n    priceUsd: 0,\n    percentChange24h: 0,\n  }));\n  await updateTokens(tokens, onUpdate);\n  await updateTokenHashes(network, tokens.map((token) => token.slug), onUpdate);\n  return Object.fromEntries(tokenBalances.map(({ slug, balance }) => [slug, balance]));\n}\n","import type { ApiNetwork, ApiTokenWithPrice, OnApiUpdate } from '../../types';\n\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { logDebugError } from '../../../util/logs';\nimport { getTokensCache, tokensPreload, updateTokens } from '../../common/tokens';\nimport { getAccountStates } from './toncenter';\n\nexport async function updateTokenHashes(network: ApiNetwork, tokenSlugs: string[], onUpdate?: OnApiUpdate) {\n  await tokensPreload.promise;\n  const cachedTokens = getTokensCache().bySlug;\n\n  const tokensToFetch = tokenSlugs.reduce<ApiTokenWithPrice[]>((tokensToFetch, tokenSlug) => {\n    const token = cachedTokens[tokenSlug];\n\n    if (\n      token\n      && token.chain === 'ton'\n      && !token.codeHash\n      && ['LP', 'STAKED', 'POOL'].some((option) => token.symbol.toUpperCase().includes(option))\n    ) {\n      tokensToFetch.push(token);\n    }\n\n    return tokensToFetch;\n  }, []);\n\n  if (!tokensToFetch.length) {\n    return;\n  }\n\n  const tokensByAddress = buildCollectionByKey(tokensToFetch, 'tokenAddress');\n\n  try {\n    const states = await getAccountStates(network, tokensToFetch.map((token) => token.tokenAddress!));\n\n    for (const address of Object.keys(states)) {\n      if (!tokensByAddress[address]) continue;\n      tokensByAddress[address].codeHash = Buffer.from(states[address].code_hash, 'base64').toString('hex');\n    }\n\n    await updateTokens(Object.values(tokensByAddress).filter((token) => token.codeHash), onUpdate);\n  } catch (err) {\n    logDebugError('Failed to fetch contract code hashes for tokens', err);\n  }\n}\n","import { Cell, internal, loadStateInit, SendMode } from '@ton/core';\nimport { WalletContractV5R1 } from '@ton/ton/dist/wallets/WalletContractV5R1';\n\nimport type { DieselStatus } from '../../../global/types';\nimport type Deferred from '../../../util/Deferred';\nimport type { CheckTransactionDraftOptions } from '../../methods/types';\nimport type {\n  ApiAccountWithMnemonic,\n  ApiAnyDisplayError,\n  ApiNetwork,\n  ApiParsedPayload,\n  ApiSignedTransfer,\n  ApiToken,\n} from '../../types';\nimport type {\n  AnyPayload,\n  ApiCheckMultiTransactionDraftResult,\n  ApiCheckTransactionDraftResult,\n  ApiEmulationWithFallbackResult,\n  ApiFetchEstimateDieselResult,\n  ApiSubmitMultiTransferResult,\n  ApiSubmitTransferOptions,\n  ApiSubmitTransferTonResult,\n  ApiSubmitTransferWithDieselResult,\n  ApiTonWalletVersion,\n  TonTransferParams,\n} from './types';\nimport type { TonWallet } from './util/tonCore';\nimport { ApiTransactionDraftError, ApiTransactionError } from '../../types';\n\nimport { DEFAULT_FEE, DIESEL_ADDRESS } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintMultiplyToNumber } from '../../../util/bigint';\nimport { fromDecimal, toDecimal } from '../../../util/decimals';\nimport { getDieselTokenAmount, isDieselAvailable } from '../../../util/fee/transferFee';\nimport { omit, pick } from '../../../util/iteratees';\nimport { logDebug, logDebugError } from '../../../util/logs';\nimport { pause } from '../../../util/schedulers';\nimport { decryptMessageComment, encryptMessageComment } from './util/encryption';\nimport { parsePayloadBase64 } from './util/metadata';\nimport { sendExternal } from './util/sendExternal';\nimport {\n  commentToBytes,\n  getOurFeePayload,\n  getTonClient,\n  getWalletPublicKey,\n  packBytesAsSnake,\n  packBytesAsSnakeCell,\n  packBytesAsSnakeForEncryptedData,\n  parseAddress,\n  parseBase64,\n} from './util/tonCore';\nimport { fetchStoredAccount, fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\nimport { getPendingTransfer, waitAndCreatePendingTransfer } from '../../common/pendingTransfers';\nimport { getTokenByAddress } from '../../common/tokens';\nimport { base64ToBytes } from '../../common/utils';\nimport { MINUTE, SEC } from '../../constants';\nimport { ApiServerError, handleServerError } from '../../errors';\nimport { checkHasTransaction, fetchNewestActionId } from './activities';\nimport { resolveAddress } from './address';\nimport { fetchKeyPair, fetchPrivateKey } from './auth';\nimport { ATTEMPTS, FEE_FACTOR, TRANSFER_TIMEOUT_SEC } from './constants';\nimport { emulateTransaction } from './emulation';\nimport {\n  buildTokenTransfer,\n  calculateTokenBalanceWithMintless,\n  getTokenBalanceWithMintless,\n  getToncoinAmountForTransfer,\n} from './tokens';\nimport { buildWallet, getContractInfo, getTonWallet, getWalletBalance, getWalletInfo } from './wallet';\n\nconst WAIT_TRANSFER_TIMEOUT = MINUTE;\nconst WAIT_PAUSE = SEC;\n\nconst MAX_BALANCE_WITH_CHECK_DIESEL = 100000000n; // 0.1 TON\nconst PENDING_DIESEL_TIMEOUT_SEC = 15 * 60; // 15 min\n\nconst DIESEL_NOT_AVAILABLE: ApiFetchEstimateDieselResult = {\n  status: 'not-available',\n  nativeAmount: 0n,\n  remainingFee: 0n,\n  realFee: 0n,\n};\n\nexport async function checkTransactionDraft(\n  options: CheckTransactionDraftOptions,\n): Promise<ApiCheckTransactionDraftResult> {\n  const {\n    accountId,\n    amount = 0n,\n    tokenAddress,\n    shouldEncrypt,\n    isBase64Data,\n    stateInit: stateInitString,\n    forwardAmount,\n    allowGasless,\n  } = options;\n  let { toAddress, data } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  let result: ApiCheckTransactionDraftResult = {};\n\n  try {\n    result = await checkToAddress(network, toAddress);\n    if ('error' in result) {\n      return result;\n    }\n\n    toAddress = result.resolvedAddress!;\n\n    const { isInitialized } = await getContractInfo(network, toAddress);\n\n    if (stateInitString && !isBase64Data) {\n      return {\n        ...result,\n        error: ApiTransactionDraftError.StateInitWithoutBin,\n      };\n    }\n\n    let stateInit;\n\n    if (stateInitString) {\n      try {\n        stateInit = Cell.fromBase64(stateInitString);\n      } catch {\n        return {\n          ...result,\n          error: ApiTransactionDraftError.InvalidStateInit,\n        };\n      }\n    }\n\n    if (result.isBounceable && !isInitialized && !stateInit) {\n      result.isToAddressNew = !(await checkHasTransaction(network, toAddress));\n      return {\n        ...result,\n        error: ApiTransactionDraftError.InactiveContract,\n      };\n    }\n\n    result.resolvedAddress = toAddress;\n\n    if (amount < 0n) {\n      return {\n        ...result,\n        error: ApiTransactionDraftError.InvalidAmount,\n      };\n    }\n\n    const wallet = await getTonWallet(accountId);\n\n    if (typeof data === 'string' && isBase64Data) {\n      data = base64ToBytes(data);\n    }\n\n    if (data && typeof data === 'string' && shouldEncrypt) {\n      const toPublicKey = await getWalletPublicKey(network, toAddress);\n      if (!toPublicKey) {\n        return {\n          ...result,\n          error: ApiTransactionDraftError.WalletNotInitialized,\n        };\n      }\n    }\n\n    const { address, isInitialized: isWalletInitialized } = await fetchStoredTonWallet(accountId);\n\n    if (data && typeof data === 'string' && !isBase64Data) {\n      data = commentToBytes(data);\n    }\n\n    let toncoinAmount: bigint;\n    const toncoinBalance = await getWalletBalance(network, wallet);\n    let balance: bigint;\n    let fee: bigint;\n    let realFee: bigint;\n\n    if (!tokenAddress) {\n      balance = toncoinBalance;\n      toncoinAmount = amount;\n      fee = 0n;\n      realFee = 0n;\n\n      if (data instanceof Uint8Array) {\n        data = shouldEncrypt ? packBytesAsSnakeForEncryptedData(data) : packBytesAsSnake(data);\n      }\n    } else {\n      const tokenTransfer = await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress: address,\n        toAddress,\n        amount,\n        payload: data,\n        forwardAmount,\n      });\n      ({ amount: toncoinAmount, toAddress, payload: data } = tokenTransfer);\n      const { realAmount: realToncoinAmount, isTokenWalletDeployed, mintlessTokenBalance } = tokenTransfer;\n\n      // When the token is transferred, actually some TON is transferred, and the token sits inside the payload.\n      // From the user perspective, this TON amount is a fee.\n      fee = toncoinAmount;\n      realFee = realToncoinAmount;\n\n      const tokenWalletAddress = toAddress;\n      balance = await calculateTokenBalanceWithMintless(\n        network, tokenWalletAddress, isTokenWalletDeployed, mintlessTokenBalance,\n      );\n    }\n\n    const isFullTonTransfer = !tokenAddress && toncoinBalance === amount;\n    const { transaction } = await signTransaction({\n      network,\n      wallet,\n      toAddress,\n      amount: toncoinAmount,\n      payload: data,\n      stateInit,\n      isFullBalance: isFullTonTransfer,\n      shouldEncrypt,\n    });\n    // todo: Use `received` from the emulation to calculate the real fee. Check what happens when the receiver is the same wallet.\n    const { networkFee } = applyFeeFactorToEmulationResult(\n      await emulateTransactionWithFallback(network, wallet, transaction, isWalletInitialized),\n    );\n    fee += networkFee;\n    realFee += networkFee;\n    result.fee = fee;\n    result.realFee = realFee;\n    result.diesel = DIESEL_NOT_AVAILABLE;\n\n    let isEnoughBalance: boolean;\n\n    if (!tokenAddress) {\n      isEnoughBalance = toncoinBalance >= fee + (isFullTonTransfer ? 0n : amount);\n    } else {\n      const canTransferGasfully = toncoinBalance >= fee;\n\n      if (allowGasless) {\n        result.diesel = await getDiesel({\n          accountId,\n          tokenAddress,\n          canTransferGasfully,\n          toncoinBalance,\n          tokenBalance: balance,\n        });\n      }\n\n      if (isDieselAvailable(result.diesel)) {\n        isEnoughBalance = amount + getDieselTokenAmount(result.diesel) <= balance;\n      } else {\n        isEnoughBalance = canTransferGasfully && amount <= balance;\n      }\n    }\n\n    return isEnoughBalance ? result : {\n      ...result,\n      error: ApiTransactionDraftError.InsufficientBalance,\n    };\n  } catch (err: any) {\n    return {\n      ...handleServerError(err),\n      ...result,\n    };\n  }\n}\n\nfunction estimateDiesel(\n  address: string,\n  tokenAddress: string,\n  toncoinAmount: string,\n  isW5?: boolean,\n  isStars?: boolean,\n) {\n  return callBackendGet<{\n    status: DieselStatus;\n    // The amount is defined only when the status is \"available\" or \"stars-fee\": https://github.com/mytonwallet-org/mytonwallet-backend/blob/44c1bf43fb776286152db8901b45fe8341752e35/src/endpoints/diesel.ts#L163\n    amount?: string;\n    pendingCreatedAt?: string;\n  }>('/diesel/estimate', {\n    address, tokenAddress, toncoinAmount, isW5, isStars,\n  });\n}\n\nexport async function checkToAddress(network: ApiNetwork, toAddress: string) {\n  const result: {\n    addressName?: string;\n    isScam?: boolean;\n    resolvedAddress?: string;\n    isToAddressNew?: boolean;\n    isBounceable?: boolean;\n    isMemoRequired?: boolean;\n  } = {};\n\n  const resolved = await resolveAddress(network, toAddress);\n  if (resolved === 'dnsNotResolved') return { ...result, error: ApiTransactionDraftError.DomainNotResolved };\n  if (resolved === 'invalidAddress') return { ...result, error: ApiTransactionDraftError.InvalidToAddress };\n  result.addressName = resolved.name;\n  result.resolvedAddress = resolved.address;\n  result.isMemoRequired = resolved.isMemoRequired;\n  result.isScam = resolved.isScam;\n  toAddress = resolved.address;\n\n  const { isUserFriendly, isTestOnly, isBounceable } = parseAddress(toAddress);\n\n  result.isBounceable = isBounceable;\n\n  const regex = /[+=/]/;\n  const isUrlSafe = !regex.test(toAddress);\n\n  if (!isUserFriendly || !isUrlSafe || (network === 'mainnet' && isTestOnly)) {\n    return {\n      ...result,\n      error: ApiTransactionDraftError.InvalidAddressFormat,\n    };\n  }\n\n  return result;\n}\n\nexport async function submitTransfer(options: ApiSubmitTransferOptions): Promise<ApiSubmitTransferTonResult> {\n  const {\n    accountId,\n    password,\n    amount,\n    tokenAddress,\n    shouldEncrypt,\n    isBase64Data,\n    forwardAmount,\n  } = options;\n  let { stateInit } = options;\n\n  let { toAddress, data } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  try {\n    const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const { address: fromAddress, isInitialized } = account.ton;\n    const wallet = await getTonWallet(accountId, account.ton);\n    const { publicKey, secretKey } = (await fetchKeyPair(accountId, password, account))!;\n\n    let encryptedComment: string | undefined;\n\n    if (typeof data === 'string') {\n      ({ payload: data, encryptedComment } = await stringToPayload({\n        network, toAddress, fromAddress, data, secretKey, publicKey, shouldEncrypt, isBase64Data,\n      }));\n    }\n\n    let toncoinAmount: bigint;\n\n    if (!tokenAddress) {\n      toncoinAmount = amount;\n\n      if (data instanceof Uint8Array) {\n        data = shouldEncrypt ? packBytesAsSnakeForEncryptedData(data) : packBytesAsSnake(data);\n      }\n    } else {\n      ({\n        amount: toncoinAmount,\n        toAddress,\n        payload: data,\n        stateInit,\n      } = await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress,\n        toAddress,\n        amount,\n        payload: data,\n        forwardAmount,\n      }));\n    }\n\n    const { pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress);\n\n    const toncoinBalance = await getWalletBalance(network, wallet);\n    const isFullTonTransfer = !tokenAddress && toncoinBalance === amount;\n\n    const { seqno, transaction } = await signTransaction({\n      network,\n      wallet,\n      toAddress,\n      amount: toncoinAmount,\n      payload: data,\n      stateInit,\n      privateKey: secretKey,\n      isFullBalance: isFullTonTransfer,\n      shouldEncrypt,\n    });\n\n    const { networkFee } = await emulateTransactionWithFallback(network, wallet, transaction, isInitialized);\n\n    const isEnoughBalance = isFullTonTransfer\n      ? toncoinBalance > networkFee\n      : toncoinBalance >= toncoinAmount + networkFee;\n\n    if (!isEnoughBalance) {\n      return { error: ApiTransactionError.InsufficientBalance };\n    }\n\n    const client = getTonClient(network);\n    const { msgHash, boc, msgHashNormalized } = await sendExternal(client, wallet, transaction);\n\n    void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n    return {\n      amount,\n      seqno,\n      encryptedComment,\n      toAddress,\n      msgHash,\n      msgHashNormalized,\n      toncoinAmount,\n    };\n  } catch (err: any) {\n    logDebugError('submitTransfer', err);\n\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nexport async function submitTransferWithDiesel(options: {\n  accountId: string;\n  password: string;\n  toAddress: string;\n  amount: bigint;\n  data?: AnyPayload;\n  tokenAddress: string;\n  shouldEncrypt?: boolean;\n  dieselAmount: bigint;\n  isGaslessWithStars?: boolean;\n}): Promise<ApiSubmitTransferWithDieselResult> {\n  try {\n    const {\n      toAddress,\n      amount,\n      accountId,\n      password,\n      tokenAddress,\n      shouldEncrypt,\n      dieselAmount,\n      isGaslessWithStars,\n    } = options;\n\n    let { data } = options;\n\n    const { network } = parseAccountId(accountId);\n\n    const [{ address: fromAddress, version }, keyPair] = await Promise.all([\n      fetchStoredTonWallet(accountId),\n      fetchKeyPair(accountId, password),\n    ]);\n\n    const { publicKey, secretKey } = keyPair!;\n\n    let encryptedComment: string | undefined;\n\n    if (typeof data === 'string') {\n      ({ payload: data, encryptedComment } = await stringToPayload({\n        network, toAddress, fromAddress, data, secretKey, publicKey, shouldEncrypt,\n      }));\n    }\n\n    const messages: TonTransferParams[] = [\n      await buildTokenTransfer({\n        network,\n        tokenAddress,\n        fromAddress,\n        toAddress,\n        amount,\n        payload: data,\n      }),\n    ];\n\n    if (!isGaslessWithStars) {\n      messages.push(\n        await buildTokenTransfer({\n          network,\n          tokenAddress,\n          fromAddress,\n          toAddress: DIESEL_ADDRESS,\n          amount: dieselAmount,\n          shouldSkipMintless: true,\n          payload: getOurFeePayload(),\n        }),\n      );\n    }\n\n    const result = await submitMultiTransfer({\n      accountId,\n      password,\n      messages,\n      isGasless: true,\n    });\n\n    return {\n      ...result,\n      encryptedComment,\n      withW5Gasless: version === 'W5',\n    };\n  } catch (err) {\n    logDebugError('submitTransferWithDiesel', err);\n\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nasync function stringToPayload({\n  network, toAddress, data, shouldEncrypt, publicKey, secretKey, fromAddress, isBase64Data,\n}: {\n  network: ApiNetwork;\n  data: string;\n  shouldEncrypt?: boolean;\n  toAddress: string;\n  publicKey: Uint8Array;\n  secretKey: Uint8Array;\n  fromAddress: string;\n  isBase64Data?: boolean;\n}): Promise<{\n    payload?: Uint8Array | Cell;\n    encryptedComment?: string;\n  }> {\n  let payload: Uint8Array | Cell | undefined;\n  let encryptedComment: string | undefined;\n\n  if (!data) {\n    payload = undefined;\n  } else if (isBase64Data) {\n    payload = parseBase64(data);\n  } else if (shouldEncrypt) {\n    const toPublicKey = (await getWalletPublicKey(network, toAddress))!;\n    payload = await encryptMessageComment(data, publicKey, toPublicKey, secretKey, fromAddress);\n    encryptedComment = Buffer.from(payload.slice(4)).toString('base64');\n  } else {\n    payload = commentToBytes(data);\n  }\n\n  return { payload, encryptedComment };\n}\n\nexport function resolveTransactionError(error: any): ApiAnyDisplayError | string {\n  if (error instanceof ApiServerError) {\n    if (error.message.includes('exitcode=35,')) {\n      return ApiTransactionError.IncorrectDeviceTime;\n    } else if (error.statusCode === 400) {\n      return error.message;\n    } else if (error.displayError) {\n      return error.displayError;\n    }\n  }\n  return ApiTransactionError.UnsuccesfulTransfer;\n}\n\nasync function signTransaction({\n  network,\n  wallet,\n  toAddress,\n  amount,\n  payload,\n  stateInit,\n  privateKey,\n  isFullBalance,\n  expireAt,\n  shouldEncrypt,\n}: {\n  network: ApiNetwork;\n  wallet: TonWallet;\n  toAddress: string;\n  amount: bigint;\n  payload?: AnyPayload;\n  stateInit?: Cell;\n  privateKey?: Uint8Array;\n  isFullBalance?: boolean;\n  expireAt?: number;\n  shouldEncrypt?: boolean;\n}) {\n  const { seqno } = await getWalletInfo(network, wallet);\n\n  if (!privateKey) {\n    privateKey = new Uint8Array(64);\n  } else {\n    logDebug('Signing transactions', { seqno, toAddress, amount });\n  }\n\n  if (!expireAt) {\n    expireAt = Math.round(Date.now() / 1000) + TRANSFER_TIMEOUT_SEC;\n  }\n\n  if (payload instanceof Uint8Array) {\n    payload = shouldEncrypt\n      ? packBytesAsSnakeForEncryptedData(payload) as Cell\n      : packBytesAsSnake(payload, 0) as Cell;\n  }\n\n  const init = stateInit ? loadStateInit(\n    stateInit.asSlice(),\n  ) : undefined;\n\n  const sendMode = (isFullBalance\n    ? SendMode.CARRY_ALL_REMAINING_BALANCE\n    : SendMode.PAY_GAS_SEPARATELY) + SendMode.IGNORE_ERRORS;\n\n  const transferParams = {\n    seqno,\n    secretKey: Buffer.from(privateKey),\n    messages: [internal({\n      value: amount,\n      to: toAddress,\n      body: payload,\n      init,\n      bounce: parseAddress(toAddress).isBounceable,\n    })],\n    sendMode,\n    timeout: expireAt,\n  };\n  const transaction = wallet instanceof WalletContractV5R1 // Otherwise, TypeScript emits an error\n    ? wallet.createTransfer(transferParams)\n    : wallet.createTransfer(transferParams);\n\n  return { seqno, transaction };\n}\n\nexport async function getAccountNewestActionId(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return fetchNewestActionId(network, address);\n}\n\nexport async function checkMultiTransactionDraft(\n  accountId: string,\n  messages: TonTransferParams[],\n  withDiesel?: boolean,\n): Promise<ApiCheckMultiTransactionDraftResult> {\n  let totalAmount: bigint = 0n;\n\n  const { network } = parseAccountId(accountId);\n  const tonWallet = await fetchStoredTonWallet(accountId);\n  const { isInitialized, version } = tonWallet;\n\n  try {\n    for (const { toAddress, amount } of messages) {\n      if (amount < 0n) {\n        return { error: ApiTransactionDraftError.InvalidAmount };\n      }\n\n      const isMainnet = network === 'mainnet';\n      const { isValid, isTestOnly } = parseAddress(toAddress);\n\n      if (!isValid || (isMainnet && isTestOnly)) {\n        return { error: ApiTransactionDraftError.InvalidToAddress };\n      }\n\n      totalAmount += amount;\n    }\n\n    // Check individual token balances\n    const { hasInsufficientTokenBalance, parsedPayloads } = await isTokenBalanceInsufficient(\n      network,\n      tonWallet.address,\n      messages,\n    );\n\n    const wallet = await getTonWallet(accountId, tonWallet);\n    const { balance } = await getWalletInfo(network, wallet);\n\n    const { transaction } = await signMultiTransaction({ network, wallet, messages, version });\n    const emulation = applyFeeFactorToEmulationResult(\n      await emulateTransactionWithFallback(network, wallet, transaction, isInitialized),\n    );\n    const result = { emulation, parsedPayloads };\n\n    // TODO Should `totalAmount` be `0` for `withDiesel`?\n    // Check for insufficient balance (both tokens and TON) and return error\n    const hasInsufficientTonBalance = !withDiesel && balance < totalAmount + result.emulation.networkFee;\n\n    if (hasInsufficientTokenBalance || hasInsufficientTonBalance) {\n      return { ...result, error: ApiTransactionDraftError.InsufficientBalance };\n    }\n\n    return result;\n  } catch (err: any) {\n    return handleServerError(err);\n  }\n}\n\nasync function isTokenBalanceInsufficient(\n  network: ApiNetwork,\n  walletAddress: string,\n  messages: TonTransferParams[],\n): Promise<{\n    hasInsufficientTokenBalance: boolean;\n    parsedPayloads: (ApiParsedPayload | undefined)[];\n  }> {\n  const payloadParsingResults = await Promise.all(\n    messages.map(async ({ payload, toAddress }) => {\n      if (!payload) return { tokenResult: undefined, parsedPayload: undefined };\n\n      try {\n        const payloadAsString = getPayloadFromTransfer({ payload, isBase64Payload: true })!.toBoc().toString('base64');\n        const parsedPayload = await parsePayloadBase64(network, toAddress, payloadAsString);\n\n        if (parsedPayload?.type === 'tokens:transfer') {\n          return {\n            tokenResult: {\n              tokenAddress: parsedPayload.tokenAddress,\n              amount: parsedPayload.amount,\n            },\n            parsedPayload,\n          };\n        }\n\n        return { tokenResult: undefined, parsedPayload };\n      } catch (e) {\n        // If payload parsing fails, treat as regular TON transfer\n        logDebugError('isTokenBalanceInsufficient', 'Error parsing payload', e);\n      }\n\n      return { tokenResult: undefined, parsedPayload: undefined };\n    }),\n  );\n\n  // Accumulate token amounts by address\n  const tokenAmountsByAddress: Record<string, bigint> = {};\n  const parsedPayloads = payloadParsingResults.map((result) => result?.parsedPayload);\n\n  for (const result of payloadParsingResults) {\n    if (result?.tokenResult) {\n      const { tokenAddress, amount } = result.tokenResult;\n      if (!tokenAmountsByAddress[tokenAddress]) {\n        tokenAmountsByAddress[tokenAddress] = 0n;\n      }\n      tokenAmountsByAddress[tokenAddress] += amount;\n    }\n  }\n\n  const tokenAddresses = Object.keys(tokenAmountsByAddress);\n  if (tokenAddresses.length === 0) {\n    return { hasInsufficientTokenBalance: false, parsedPayloads }; // No token transfers\n  }\n\n  const tokenBalances = await Promise.all(\n    tokenAddresses.map((tokenAddress) =>\n      getTokenBalanceWithMintless(network, walletAddress, tokenAddress),\n    ),\n  );\n\n  // Check if any token has insufficient balance\n  for (let i = 0; i < tokenAddresses.length; i++) {\n    const tokenAddress = tokenAddresses[i];\n    const requiredAmount = tokenAmountsByAddress[tokenAddress];\n    const availableBalance = tokenBalances[i];\n\n    if (availableBalance < requiredAmount) {\n      return { hasInsufficientTokenBalance: true, parsedPayloads };\n    }\n  }\n\n  return { hasInsufficientTokenBalance: false, parsedPayloads };\n}\n\nexport type GaslessType = 'diesel' | 'w5';\n\ninterface SubmitMultiTransferOptions {\n  accountId: string;\n  password: string;\n  messages: TonTransferParams[];\n  expireAt?: number;\n  isGasless?: boolean;\n}\n\nexport async function submitMultiTransfer({\n  accountId, password, messages, expireAt, isGasless,\n}: SubmitMultiTransferOptions): Promise<ApiSubmitMultiTransferResult> {\n  const { network } = parseAccountId(accountId);\n\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  const { address: fromAddress, isInitialized, version } = account.ton;\n  const { pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress);\n\n  try {\n    const wallet = await getTonWallet(accountId, account.ton);\n    const privateKey = await fetchPrivateKey(accountId, password, account);\n\n    let totalAmount = 0n;\n    messages.forEach((message) => {\n      totalAmount += BigInt(message.amount);\n    });\n\n    const { balance } = await getWalletInfo(network, wallet);\n\n    const gaslessType = isGasless ? version === 'W5' ? 'w5' : 'diesel' : undefined;\n    const withW5Gasless = gaslessType === 'w5';\n\n    const { seqno, transaction } = await signMultiTransaction({\n      network, wallet, messages, version, privateKey, expireAt, withW5Gasless,\n    });\n\n    if (!isGasless) {\n      const { networkFee } = await emulateTransactionWithFallback(network, wallet, transaction, isInitialized);\n      if (balance < totalAmount + networkFee) {\n        return { error: ApiTransactionError.InsufficientBalance };\n      }\n    }\n\n    const client = getTonClient(network);\n    const { msgHash, boc, paymentLink, msgHashNormalized } = await sendExternal(\n      client, wallet, transaction, gaslessType,\n    );\n\n    if (!isGasless) {\n      void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n    } else {\n      // TODO: Wait for gasless transfer\n      pendingTransfer.resolve();\n    }\n\n    const clearedMessages = messages.map((message) => {\n      if (typeof message.payload !== 'string' && typeof message.payload !== 'undefined') {\n        return omit(message, ['payload']);\n      }\n      return message;\n    });\n\n    return {\n      seqno,\n      amount: totalAmount.toString(),\n      messages: clearedMessages,\n      boc,\n      msgHash,\n      msgHashNormalized,\n      paymentLink,\n      withW5Gasless,\n    };\n  } catch (err) {\n    pendingTransfer.resolve();\n\n    logDebugError('submitMultiTransfer', err);\n    return { error: resolveTransactionError(err) };\n  }\n}\n\nasync function signMultiTransaction({\n  network,\n  wallet,\n  messages,\n  version,\n  privateKey,\n  expireAt,\n  withW5Gasless,\n}: {\n  network: ApiNetwork;\n  wallet: TonWallet;\n  messages: TonTransferParams[];\n  version: ApiTonWalletVersion;\n  privateKey?: Uint8Array;\n  /** Unix seconds */\n  expireAt?: number;\n  withW5Gasless?: boolean;\n}) {\n  const { seqno } = await getWalletInfo(network, wallet);\n\n  if (!privateKey) {\n    privateKey = new Uint8Array(64);\n  } else {\n    logDebug('Signing transaction', {\n      seqno,\n      messages: messages.map((msg) => pick(msg, ['toAddress', 'amount'])),\n    });\n  }\n\n  if (!expireAt) {\n    expireAt = Math.round(Date.now() / 1000) + (withW5Gasless ? PENDING_DIESEL_TIMEOUT_SEC : TRANSFER_TIMEOUT_SEC);\n  }\n\n  let hasPayload = false;\n\n  const preparedMessages = messages.map((message) => {\n    const {\n      amount, toAddress, stateInit, isBase64Payload,\n    } = message;\n    let { payload } = message;\n\n    payload = getPayloadFromTransfer({ payload, isBase64Payload });\n\n    const init = stateInit ? loadStateInit(\n      stateInit.asSlice(),\n    ) : undefined;\n\n    if (!hasPayload && payload) {\n      hasPayload = true;\n    }\n\n    return internal({\n      value: amount,\n      to: toAddress,\n      body: payload,\n      bounce: parseAddress(toAddress).isBounceable,\n      init,\n    });\n  });\n\n  if (version === 'W5') {\n    // TODO Remove it. There is bug in @ton/ton library that causes transactions to be executed in reverse order.\n    preparedMessages.reverse();\n  }\n\n  const transferParams = {\n    authType: withW5Gasless ? 'internal' as const : undefined,\n    seqno,\n    secretKey: Buffer.from(privateKey),\n    messages: preparedMessages,\n    sendMode: SendMode.PAY_GAS_SEPARATELY + SendMode.IGNORE_ERRORS,\n    timeout: expireAt,\n  };\n\n  const transaction = wallet instanceof WalletContractV5R1 // Otherwise, TypeScript emits an error\n    ? wallet.createTransfer(transferParams)\n    : wallet.createTransfer(transferParams);\n\n  return { seqno, transaction };\n}\n\nasync function retrySendBoc(\n  network: ApiNetwork,\n  address: string,\n  boc: string,\n  seqno: number,\n  pendingTransfer?: Deferred,\n) {\n  const tonClient = getTonClient(network);\n  const waitUntil = Date.now() + WAIT_TRANSFER_TIMEOUT;\n\n  while (Date.now() < waitUntil) {\n    const [error, walletInfo] = await Promise.all([\n      tonClient.sendFile(boc).catch((err) => String(err)),\n      getWalletInfo(network, address).catch(() => undefined),\n    ]);\n\n    // Errors mean that `seqno` was changed or not enough of balance\n    if (error?.match(/(exitcode=33|exitcode=133|inbound external message rejected by account)/)) {\n      break;\n    }\n\n    // seqno here may change before exit code appears\n    if (walletInfo && walletInfo.seqno > seqno) {\n      break;\n    }\n\n    await pause(WAIT_PAUSE);\n  }\n\n  pendingTransfer?.resolve();\n}\n\nasync function emulateTransactionWithFallback(\n  network: ApiNetwork,\n  wallet: TonWallet,\n  transaction: Cell,\n  isInitialized?: boolean,\n): Promise<ApiEmulationWithFallbackResult> {\n  try {\n    const emulation = await emulateTransaction(network, wallet, transaction, isInitialized);\n    return { isFallback: false, ...emulation };\n  } catch (err) {\n    logDebugError('Failed to emulate a transaction', err);\n  }\n\n  // Falling back to the legacy fee estimation method just in case.\n  // It doesn't support estimating more than 20 transactions (inside `transaction`) at once.\n  // eslint-disable-next-line no-null/no-null\n  const { code = null, data = null } = !isInitialized ? wallet.init : {};\n  const { source_fees: fees } = await getTonClient(network).estimateExternalMessageFee(wallet.address, {\n    body: transaction,\n    initCode: code,\n    initData: data,\n    ignoreSignature: true,\n  });\n  const networkFee = BigInt(fees.in_fwd_fee + fees.storage_fee + fees.gas_fee + fees.fwd_fee);\n  return { isFallback: true, networkFee };\n}\n\nexport async function sendSignedMessage(accountId: string, message: ApiSignedTransfer, pendingTransferId?: string) {\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress, publicKey, version } = await fetchStoredTonWallet(accountId);\n  const client = getTonClient(network);\n  const wallet = buildWallet(publicKey!, version);\n  const { base64, seqno } = message;\n  const pendingTransfer = pendingTransferId ? getPendingTransfer(pendingTransferId) : undefined;\n\n  try {\n    const { boc, msgHashNormalized } = await sendExternal(client, wallet, Cell.fromBase64(base64));\n\n    void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n    return { boc, msgHashNormalized };\n  } catch (err) {\n    pendingTransfer?.resolve();\n    throw err;\n  }\n}\n\nexport async function sendSignedMessages(accountId: string, messages: ApiSignedTransfer[]) {\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress, publicKey, version } = await fetchStoredTonWallet(accountId);\n  const client = getTonClient(network);\n  const wallet = buildWallet(publicKey!, version);\n\n  const attempts = ATTEMPTS + messages.length;\n  let index = 0;\n  let attempt = 0;\n\n  let firstBoc: string | undefined;\n\n  const msgHashesNormalized: string[] = [];\n  let pendingTransfer: Deferred | undefined;\n\n  while (index < messages.length && attempt < attempts) {\n    const { base64, seqno } = messages[index];\n    try {\n      ({ pendingTransfer } = await waitAndCreatePendingTransfer(network, fromAddress));\n\n      const { boc, msgHashNormalized } = await sendExternal(client, wallet, Cell.fromBase64(base64));\n      msgHashesNormalized.push(msgHashNormalized);\n\n      if (index === 0) {\n        firstBoc = boc;\n      }\n\n      void retrySendBoc(network, fromAddress, boc, seqno, pendingTransfer);\n\n      index++;\n    } catch (err) {\n      pendingTransfer?.resolve();\n      logDebugError('sendSignedMessages', err);\n    }\n    attempt++;\n  }\n\n  return { successNumber: index, firstBoc, msgHashesNormalized };\n}\n\nexport async function decryptComment(\n  accountId: string, encryptedComment: string, fromAddress: string, password: string,\n) {\n  const keyPair = await fetchKeyPair(accountId, password);\n  if (!keyPair) {\n    return undefined;\n  }\n\n  const { secretKey, publicKey } = keyPair;\n\n  const buffer = Buffer.from(encryptedComment, 'base64');\n\n  return decryptMessageComment(buffer, publicKey, secretKey, fromAddress);\n}\n\n/**\n * The goal of the function is acting like `checkTransactionDraft` but return only the diesel information\n */\nexport function fetchEstimateDiesel(\n  accountId: string, tokenAddress: string,\n): Promise<ApiFetchEstimateDieselResult> {\n  return getDiesel({\n    accountId,\n    tokenAddress,\n    // We pass `false` because `fetchEstimateDiesel` assumes that the transfer is gasless anyway\n    canTransferGasfully: false,\n  });\n}\n\n/**\n * Decides whether the transfer must be gasless and fetches the diesel estimate from the backend.\n */\nasync function getDiesel({\n  accountId,\n  tokenAddress,\n  canTransferGasfully,\n  toncoinBalance,\n  tokenBalance,\n}: {\n  accountId: string;\n  tokenAddress: string;\n  canTransferGasfully: boolean;\n  // The below fields allow to avoid network requests if you already have these data\n  toncoinBalance?: bigint;\n  tokenBalance?: bigint;\n}): Promise<ApiFetchEstimateDieselResult> {\n  const { network } = parseAccountId(accountId);\n  if (network !== 'mainnet') return DIESEL_NOT_AVAILABLE;\n\n  const storedTonWallet = await fetchStoredTonWallet(accountId);\n  const wallet = await getTonWallet(accountId, storedTonWallet);\n\n  const token = getTokenByAddress(tokenAddress);\n  if (!token.isGaslessEnabled && !token.isStarsEnabled) return DIESEL_NOT_AVAILABLE;\n\n  const { address, version } = storedTonWallet;\n  toncoinBalance ??= await getWalletBalance(network, wallet);\n  const fee = getDieselToncoinFee(token);\n  const toncoinNeeded = fee.amount - toncoinBalance;\n\n  if (toncoinBalance >= MAX_BALANCE_WITH_CHECK_DIESEL || toncoinNeeded <= 0n) return DIESEL_NOT_AVAILABLE;\n\n  const rawDiesel = await estimateDiesel(\n    address,\n    tokenAddress,\n    toDecimal(toncoinNeeded),\n    version === 'W5',\n    fee.isStars,\n  );\n  const diesel: ApiFetchEstimateDieselResult = {\n    status: rawDiesel.status,\n    amount: rawDiesel.amount === undefined\n      ? undefined\n      : fromDecimal(rawDiesel.amount, rawDiesel.status === 'stars-fee' ? 0 : token.decimals),\n    nativeAmount: toncoinNeeded,\n    remainingFee: toncoinBalance,\n    realFee: fee.realFee,\n  };\n\n  const tokenAmount = getDieselTokenAmount(diesel);\n  if (tokenAmount === 0n) {\n    return diesel;\n  }\n\n  tokenBalance ??= await getTokenBalanceWithMintless(network, address, tokenAddress);\n  const canPayDiesel = tokenBalance >= tokenAmount;\n  const isAwaitingNotExpiredPrevious = Boolean(\n    rawDiesel.pendingCreatedAt\n    && Date.now() - new Date(rawDiesel.pendingCreatedAt).getTime() < PENDING_DIESEL_TIMEOUT_SEC * SEC,\n  );\n\n  // When both TON and diesel are insufficient, we want to show the TON fee\n  const shouldBeGasless = (!canTransferGasfully && canPayDiesel) || isAwaitingNotExpiredPrevious;\n  return shouldBeGasless ? diesel : DIESEL_NOT_AVAILABLE;\n}\n\n/**\n * Guesses the total TON fee (including the gas attached to the transaction) that will be spent on a diesel transfer.\n *\n * `amount` is what will be taken from the wallet;\n * `realFee` is approximately what will be actually spent (the rest will return in the excess);\n * `isStars` tells whether the fee is estimated considering that the diesel will be paid in stars.\n */\nfunction getDieselToncoinFee(token: ApiToken) {\n  const isStars = !token.isGaslessEnabled && token.isStarsEnabled;\n  let { amount, realAmount: realFee } = getToncoinAmountForTransfer(token, false);\n\n  // Multiplying by 2 because the diesel transfer has 2 transactions:\n  // - for the transfer itself,\n  // - for sending the diesel to the MTW wallet.\n  if (!isStars) {\n    amount *= 2n;\n    realFee *= 2n;\n  }\n\n  amount += DEFAULT_FEE;\n  realFee += DEFAULT_FEE;\n\n  return { amount, realFee, isStars };\n}\n\nfunction applyFeeFactorToEmulationResult(estimation: ApiEmulationWithFallbackResult): ApiEmulationWithFallbackResult {\n  estimation = {\n    ...estimation,\n    networkFee: bigintMultiplyToNumber(estimation.networkFee, FEE_FACTOR),\n  };\n\n  if ('byTransactionIndex' in estimation) {\n    estimation.byTransactionIndex = estimation.byTransactionIndex.map((transaction) => ({\n      ...transaction,\n      networkFee: bigintMultiplyToNumber(transaction.networkFee, FEE_FACTOR),\n    }));\n  }\n\n  return estimation;\n}\n\nfunction getPayloadFromTransfer(\n  { payload, isBase64Payload }: Pick<TonTransferParams, 'payload' | 'isBase64Payload'>,\n): Cell | undefined {\n  if (payload === undefined) {\n    return undefined;\n  }\n\n  if (payload instanceof Cell) {\n    return payload;\n  }\n\n  if (typeof payload === 'string') {\n    if (isBase64Payload) {\n      return Cell.fromBase64(payload);\n    }\n\n    // This is what @ton/core does under the hood when a string payload is passed to `internal()`\n    return packBytesAsSnakeCell(commentToBytes(payload));\n  }\n\n  if (payload instanceof Uint8Array) {\n    return payload.length ? packBytesAsSnakeCell(payload) : undefined;\n  }\n\n  throw new TypeError(`Unexpected payload type ${typeof payload}`);\n}\n","import type { NftItem } from 'tonapi-sdk-js';\nimport type { Cell } from '@ton/core';\nimport { Address, Builder } from '@ton/core';\n\nimport type { ApiNft, ApiNftUpdate } from '../../types';\nimport type { ApiCheckTransactionDraftResult } from './types';\n\nimport {\n  BURN_ADDRESS,\n  NFT_BATCH_SIZE,\n  NOTCOIN_EXCHANGERS,\n  NOTCOIN_FORWARD_TON_AMOUNT,\n  NOTCOIN_VOUCHERS_ADDRESS,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintMultiplyToNumber } from '../../../util/bigint';\nimport { compact } from '../../../util/iteratees';\nimport { generateQueryId } from './util';\nimport { parseTonapiioNft } from './util/metadata';\nimport {\n  fetchAccountEvents, fetchAccountNfts, fetchNftByAddress, fetchNftItems,\n} from './util/tonapiio';\nimport { commentToBytes, packBytesAsSnake, toBase64Address } from './util/tonCore';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { getNftSuperCollectionsByCollectionAddress } from '../../common/addresses';\nimport {\n  NFT_PAYLOAD_SAFE_MARGIN,\n  NFT_TRANSFER_AMOUNT,\n  NFT_TRANSFER_FORWARD_AMOUNT,\n  NFT_TRANSFER_REAL_AMOUNT,\n  NftOpCode,\n} from './constants';\nimport { checkMultiTransactionDraft, checkToAddress, submitMultiTransfer } from './transfer';\nimport { isActiveSmartContract } from './wallet';\n\nexport async function getAccountNfts(accountId: string, offset?: number, limit?: number): Promise<ApiNft[]> {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  const rawNfts = await fetchAccountNfts(network, address, { offset, limit });\n  return compact(rawNfts.map((rawNft) => parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress)));\n}\n\nexport async function checkNftOwnership(accountId: string, nftAddress: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const rawNft = await fetchNftByAddress(network, nftAddress);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  const nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n\n  return address === nft?.ownerAddress;\n}\n\nexport async function getNftUpdates(accountId: string, fromSec: number) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  const events = await fetchAccountEvents(network, address, fromSec);\n  fromSec = events[0]?.timestamp ?? fromSec;\n  events.reverse();\n  const updates: ApiNftUpdate[] = [];\n\n  for (const event of events) {\n    for (const action of event.actions) {\n      let to: string;\n      let nftAddress: string;\n      let rawNft: NftItem | undefined;\n      const isPurchase = !!action.NftPurchase;\n\n      if (action.NftItemTransfer) {\n        const { sender, recipient, nft: rawNftAddress } = action.NftItemTransfer;\n        if (!sender || !recipient) continue;\n        to = recipient.address;\n        nftAddress = toBase64Address(rawNftAddress, true, network);\n      } else if (action.NftPurchase) {\n        const { buyer } = action.NftPurchase;\n        to = buyer.address;\n        rawNft = action.NftPurchase.nft;\n        if (!rawNft) {\n          continue;\n        }\n        nftAddress = toBase64Address(rawNft.address, true, network);\n      } else {\n        continue;\n      }\n\n      if (Address.parse(to).equals(Address.parse(address))) {\n        if (!rawNft) {\n          [rawNft] = await fetchNftItems(network, [nftAddress]);\n        }\n\n        if (rawNft) {\n          const nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n\n          if (nft) {\n            updates.push({\n              type: 'nftReceived',\n              accountId,\n              nftAddress,\n              nft,\n            });\n          }\n        }\n      } else if (!isPurchase && await isActiveSmartContract(network, to)) {\n        updates.push({\n          type: 'nftPutUpForSale',\n          accountId,\n          nftAddress,\n        });\n      } else {\n        updates.push({\n          type: 'nftSent',\n          accountId,\n          nftAddress,\n          newOwnerAddress: to,\n        });\n      }\n    }\n  }\n\n  return [fromSec, updates] as [number, ApiNftUpdate[]];\n}\n\nexport async function checkNftTransferDraft(options: {\n  accountId: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}): Promise<ApiCheckTransactionDraftResult> {\n  const { accountId, nfts, comment } = options;\n  let { toAddress } = options;\n\n  const { network } = parseAccountId(accountId);\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result: ApiCheckTransactionDraftResult = await checkToAddress(network, toAddress);\n  if ('error' in result) {\n    return result;\n  }\n\n  toAddress = result.resolvedAddress!;\n\n  const messages = nfts\n    .slice(0, NFT_BATCH_SIZE) // We only need to check the first batch of a multi-transaction\n    .map((nft) => buildNftTransferMessage(nft, fromAddress, toAddress, comment));\n\n  const checkResult = await checkMultiTransactionDraft(accountId, messages);\n\n  if (checkResult.emulation) {\n    // todo: Use `received` from the emulation to calculate the real fee. Check what happens when the receiver is the same wallet.\n    const batchFee = checkResult.emulation.networkFee;\n    result.fee = calculateNftTransferFee(nfts.length, messages.length, batchFee, NFT_TRANSFER_AMOUNT);\n    result.realFee = calculateNftTransferFee(nfts.length, messages.length, batchFee, NFT_TRANSFER_REAL_AMOUNT);\n  }\n\n  if ('error' in checkResult) {\n    result.error = checkResult.error;\n  }\n\n  return result;\n}\n\nexport async function submitNftTransfers(options: {\n  accountId: string;\n  password: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}) {\n  const {\n    accountId, password, nfts, toAddress, comment,\n  } = options;\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n  const messages = nfts.map((nft) => buildNftTransferMessage(nft, fromAddress, toAddress, comment));\n  return submitMultiTransfer({ accountId, password, messages });\n}\n\nfunction buildNftTransferMessage(nft: ApiNft, fromAddress: string, toAddress: string, comment?: string) {\n  const isNotcoinBurn = nft.collectionAddress === NOTCOIN_VOUCHERS_ADDRESS\n    && (toAddress === BURN_ADDRESS || NOTCOIN_EXCHANGERS.includes(toAddress as any));\n  const payload = isNotcoinBurn\n    ? buildNotcoinVoucherExchange(fromAddress, nft.address, nft.index)\n    : buildNftTransferPayload(fromAddress, toAddress, comment);\n\n  return {\n    payload,\n    amount: NFT_TRANSFER_AMOUNT,\n    toAddress: nft.address,\n  };\n}\n\nfunction buildNotcoinVoucherExchange(fromAddress: string, nftAddress: string, nftIndex: number) {\n  const first4Bits = Address.parse(nftAddress).hash.readUint8() >> 4;\n  const toAddress = NOTCOIN_EXCHANGERS[first4Bits];\n\n  const payload = new Builder()\n    .storeUint(0x5fec6642, 32)\n    .storeUint(nftIndex, 64)\n    .endCell();\n\n  return buildNftTransferPayload(fromAddress, toAddress, payload, NOTCOIN_FORWARD_TON_AMOUNT);\n}\n\nfunction buildNftTransferPayload(\n  fromAddress: string,\n  toAddress: string,\n  payload?: string | Cell,\n  forwardAmount = NFT_TRANSFER_FORWARD_AMOUNT,\n) {\n  let builder = new Builder()\n    .storeUint(NftOpCode.TransferOwnership, 32)\n    .storeUint(generateQueryId(), 64)\n    .storeAddress(Address.parse(toAddress))\n    .storeAddress(Address.parse(fromAddress))\n    .storeBit(false) // null custom_payload\n    .storeCoins(forwardAmount);\n\n  let forwardPayload: Cell | Uint8Array | undefined;\n\n  if (payload) {\n    if (typeof payload === 'string') {\n      const bytes = commentToBytes(payload);\n      const freeBytes = Math.floor((builder.availableBits - NFT_PAYLOAD_SAFE_MARGIN) / 8);\n      forwardPayload = packBytesAsSnake(bytes, freeBytes);\n    } else {\n      forwardPayload = payload;\n    }\n  }\n\n  if (forwardPayload instanceof Uint8Array) {\n    builder.storeBit(0);\n    builder = builder.storeBuffer(Buffer.from(forwardPayload));\n  } else {\n    builder = builder.storeMaybeRef(forwardPayload);\n  }\n\n  return builder.endCell();\n}\n\nexport function calculateNftTransferFee(\n  totalNftCount: number,\n  // How many NFTs were added to the multi-transaction before estimating it\n  estimatedBatchSize: number,\n  // The blockchain fee of the estimated multi-transaction\n  estimatedBatchBlockchainFee: bigint,\n  // How much TON is attached to each NFT during the transfer\n  amountPerNft: bigint,\n) {\n  const fullBatchCount = Math.floor(totalNftCount / estimatedBatchSize);\n  let remainingBatchSize = totalNftCount % estimatedBatchSize;\n\n  // The blockchain fee for the first NFT in a batch is almost twice higher than the fee for the other NFTs. Therefore,\n  // simply using the average NFT fee to calculate the last incomplete batch fee gives an insufficient number. To fix\n  // that, we increase the last batch size.\n  //\n  // A real life example:\n  // 1 NFT  in the batch: 0.002939195 TON\n  // 2 NFTs in the batch: 0.004470516 TON\n  // 3 NFTs in the batch: 0.006001837 TON\n  // 4 NFTs in the batch: 0.007533158 TON\n  if (remainingBatchSize > 0 && remainingBatchSize < estimatedBatchSize) {\n    remainingBatchSize += 1;\n  }\n\n  const totalBlockchainFee = bigintMultiplyToNumber(\n    estimatedBatchBlockchainFee,\n    (fullBatchCount * estimatedBatchSize + remainingBatchSize) / estimatedBatchSize,\n  );\n  return totalBlockchainFee + BigInt(totalNftCount) * amountPerNft;\n}\n","import type {\n  ApiAccountWithTon,\n  ApiNftTransferPayload,\n  ApiParsedPayload,\n  ApiTokensTransferNonStandardPayload,\n  ApiTokensTransferPayload,\n} from '../../api/types';\n\nimport { DEFAULT_MAX_MESSAGES, LEDGER_MAX_MESSAGES, W5_MAX_MESSAGES } from '../../api/chains/ton/constants';\n\nexport function isNftTransferPayload(payload: ApiParsedPayload | undefined): payload is ApiNftTransferPayload {\n  return payload?.type === 'nft:transfer';\n}\n\nexport function isTokenTransferPayload(\n  payload: ApiParsedPayload | undefined,\n): payload is ApiTokensTransferPayload | ApiTokensTransferNonStandardPayload {\n  return payload?.type === 'tokens:transfer' || payload?.type === 'tokens:transfer-non-standard';\n}\n\n/** How many messages can be sent in a single transaction */\nexport function getMaxMessagesInTransaction(account: ApiAccountWithTon) {\n  const { type, ton: { version } } = account;\n\n  if (type === 'ledger') {\n    return LEDGER_MAX_MESSAGES;\n  } else if (version === 'W5') {\n    return W5_MAX_MESSAGES;\n  } else {\n    return DEFAULT_MAX_MESSAGES;\n  }\n}\n","import type { ApiDomainData, ApiNft } from '../../types';\nimport type { TonTransferParams } from './types';\n\nimport { parseAccountId } from '../../../util/account';\nimport { YEAR } from '../../../util/dateFormat';\nimport { split } from '../../../util/iteratees';\nimport { getMaxMessagesInTransaction } from '../../../util/ton/transfer';\nimport { parseTonapiioNft } from './util/metadata';\nimport { DnsItem } from './contracts/DnsItem';\nimport { fetchStoredTonAccount, fetchStoredTonWallet } from '../../common/accounts';\nimport { getNftSuperCollectionsByCollectionAddress } from '../../common/addresses';\nimport { callBackendGet } from '../../common/backend';\nimport { TON_GAS } from './constants';\nimport { checkMultiTransactionDraft, submitMultiTransfer } from './transfer';\n\nexport async function checkDnsRenewalDraft(accountId: string, nftAddresses: string[]) {\n  const account = await fetchStoredTonAccount(accountId);\n  const maxMessages = getMaxMessagesInTransaction(account);\n  const transactionCount = Math.ceil(nftAddresses.length / maxMessages);\n\n  const messages = nftAddresses\n    .slice(0, maxMessages)\n    .map(makeRenewMessage);\n\n  const result = await checkMultiTransactionDraft(accountId, messages);\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const totalAmount = TON_GAS.changeDns * BigInt(nftAddresses.length);\n  const realFee = totalAmount + result.emulation.networkFee * BigInt(transactionCount); // Not very correct, but ≥ the actual fee\n\n  return { realFee };\n}\n\nexport async function* submitDnsRenewal(accountId: string, password: string, nftAddresses: string[]) {\n  const account = await fetchStoredTonAccount(accountId);\n  const maxMessages = getMaxMessagesInTransaction(account);\n  const nftBatches = split(nftAddresses, maxMessages);\n\n  for (const nftBatch of nftBatches) {\n    const messages: TonTransferParams[] = nftBatch.map(makeRenewMessage);\n\n    yield {\n      addresses: nftBatch,\n      result: await submitMultiTransfer({ accountId, password, messages }),\n    };\n  }\n}\n\nexport async function checkDnsChangeWalletDraft(accountId: string, nftAddress: string, address: string) {\n  const result = await checkMultiTransactionDraft(accountId, [makeChangeMessage(nftAddress, address)]);\n\n  if ('error' in result) {\n    return result;\n  }\n\n  return { realFee: result.emulation.networkFee + TON_GAS.changeDns };\n}\n\nexport function submitDnsChangeWallet(accountId: string, password: string, nftAddress: string, address: string) {\n  return submitMultiTransfer({\n    accountId,\n    password,\n    messages: [makeChangeMessage(nftAddress, address)],\n  });\n}\n\nfunction makeRenewMessage(nftAddress: string) {\n  return {\n    toAddress: nftAddress,\n    payload: DnsItem.buildFillUpMessage(),\n    amount: TON_GAS.changeDns,\n  };\n}\n\nfunction makeChangeMessage(nftAddress: string, linkedAddress: string) {\n  return {\n    toAddress: nftAddress,\n    payload: DnsItem.buildChangeDnsWalletMessage(linkedAddress),\n    amount: TON_GAS.changeDns,\n  };\n}\n\nexport async function fetchDomains(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const data = await callBackendGet<Record<string, ApiDomainData>>('/dns/getDomains', { address });\n  const nftSuperCollectionsByCollectionAddress = await getNftSuperCollectionsByCollectionAddress();\n\n  const expirationByAddress: Record<string, number> = {};\n  const linkedAddressByAddress: Record<string, string> = {};\n  const nfts: Record<string, ApiNft> = {};\n\n  Object.keys(data).forEach((nftAddress) => {\n    const { lastFillUpTime, linkedAddress, nft: rawNft } = data[nftAddress];\n    expirationByAddress[nftAddress] = new Date(lastFillUpTime).getTime() + YEAR;\n    if (linkedAddress) {\n      linkedAddressByAddress[nftAddress] = linkedAddress;\n    }\n    const nft = parseTonapiioNft(network, rawNft, nftSuperCollectionsByCollectionAddress);\n    if (nft) {\n      nfts[nftAddress] = nft;\n    }\n  });\n\n  return {\n    expirationByAddress,\n    linkedAddressByAddress,\n    nfts,\n  };\n}\n","/*\nTo activate dev setting, enter `devSettings.simulateLongUnstaking = true;` in the browser console,\neither in the main frame or in the worker (different commands for different frames).\n*/\n\ndeclare const self: (WorkerGlobalScope | Window) & {\n  devSettings: {\n    simulateLongUnstaking?: boolean;\n  };\n};\n\nexport function getDevSettings() {\n  return self.devSettings ?? {};\n}\n\nself.devSettings = {};\n","import type {\n  Cell, Contract, ContractProvider,\n} from '@ton/core';\nimport {\n  Address, beginCell, contractAddress, TupleReader,\n} from '@ton/core';\n\nexport type NominatorPoolConfig = object;\n\nexport type Nominator = {\n  address: Address;\n  amount: bigint;\n  pendingDepositAmount: bigint;\n  withdrawRequested: boolean;\n};\n\nexport function nominatorPoolConfigToCell(config: NominatorPoolConfig): Cell {\n  return beginCell().endCell();\n}\n\nexport class NominatorPool implements Contract {\n  constructor(readonly address: Address, readonly init?: { code: Cell; data: Cell }) {}\n\n  static createFromAddress(address: Address) {\n    return new NominatorPool(address);\n  }\n\n  static createFromConfig(config: NominatorPoolConfig, code: Cell, workchain = 0) {\n    const data = nominatorPoolConfigToCell(config);\n    const init = { code, data };\n    return new NominatorPool(contractAddress(workchain, init), init);\n  }\n\n  async getListNominators(provider: ContractProvider): Promise<Nominator[]> {\n    const res = await provider.get('list_nominators', []);\n    const tupleReader = (res.stack).readTuple();\n    const itemsArray = (tupleReader as any).items as bigint[][];\n\n    return itemsArray.map((items: bigint[]) => {\n      const tupleItems = items.map((value) => ({ type: 'int' as const, value }));\n      const tuple = new TupleReader(tupleItems);\n\n      const hash = tuple.readBigNumber().toString(16).padStart(64, '0');\n      const address = Address.parse(`0:${hash}`);\n      const amount = tuple.readBigNumber();\n      const pendingDepositAmount = tuple.readBigNumber();\n      const withdrawRequested = Boolean(tuple.readNumber());\n\n      return {\n        address,\n        amount,\n        pendingDepositAmount,\n        withdrawRequested,\n      };\n    });\n  }\n}\n","import type { ApiBackendConfig, ApiStakingCommonData } from '../types';\n\nimport Deferred from '../../util/Deferred';\n\nexport type AccountCache = { stakedAt?: number };\n\nlet stakingCommonCache: ApiStakingCommonData | undefined;\nconst stakingCommonCacheDeferred = new Deferred();\n\nconst accountCache: Record<string, AccountCache> = {};\n\nlet backendConfig: ApiBackendConfig | undefined;\nconst configDeferred = new Deferred();\n\nexport function getAccountCache(accountId: string, address: string) {\n  return accountCache[`${accountId}:${address}`] ?? {};\n}\n\nexport function updateAccountCache(accountId: string, address: string, partial: Partial<AccountCache>) {\n  const key = `${accountId}:${address}`;\n  accountCache[key] = { ...accountCache[key], ...partial };\n}\n\nexport function setStakingCommonCache(data: ApiStakingCommonData) {\n  stakingCommonCache = data;\n  stakingCommonCacheDeferred.resolve();\n}\n\nexport async function getStakingCommonCache() {\n  await stakingCommonCacheDeferred.promise;\n  return stakingCommonCache!;\n}\n\nexport function setBackendConfigCache(config: ApiBackendConfig) {\n  backendConfig = config;\n  configDeferred.resolve();\n}\n\n/** Returns the config provided by the backend */\nexport async function getBackendConfigCache() {\n  await configDeferred.promise;\n  return backendConfig!;\n}\n","import { randomBytes } from '../../util/random';\nimport { storage } from '../storages';\n\nlet clientId: string | undefined;\n\nexport async function getClientId() {\n  clientId = await storage.getItem('clientId');\n\n  if (!clientId) {\n    clientId = Buffer.from(randomBytes(10)).toString('hex');\n\n    const referrer = await storage.getItem('referrer');\n    if (referrer) clientId = `${clientId}:${referrer}`;\n\n    await storage.setItem('clientId', clientId);\n  }\n  return clientId;\n}\n","import { Address } from '@ton/core';\n\nimport type {\n  ApiBackendStakingState,\n  ApiBalanceBySlug,\n  ApiEthenaStakingState,\n  ApiJettonStakingState,\n  ApiLoyaltyType,\n  ApiNetwork,\n  ApiStakingCommonData,\n  ApiStakingJettonPool,\n  ApiStakingState,\n} from '../../types';\nimport type { StakingPoolConfigUnpacked } from './contracts/JettonStaking/StakingPool';\nimport type { Nominator } from './contracts/NominatorPool';\nimport type { ApiCheckTransactionDraftResult, ApiSubmitTransferTonResult, TonTransferParams } from './types';\nimport { ApiLiquidUnstakeMode, ApiTransactionDraftError } from '../../types';\n\nimport {\n  DEBUG,\n  ETHENA_STAKING_VAULT,\n  LIQUID_JETTON,\n  LIQUID_POOL,\n  TON_TSUSDE,\n  TON_USDE,\n  TONCOIN,\n  UNSTAKE_TON_GRACE_PERIOD,\n  VALIDATION_PERIOD_MS,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { bigintDivideToNumber, bigintMultiplyToNumber } from '../../../util/bigint';\nimport { fromDecimal } from '../../../util/decimals';\nimport { getDevSettings } from '../../../util/devSettings';\nimport { getIsActiveStakingState } from '../../../util/staking';\nimport calcJettonStakingApr from '../../../util/ton/calcJettonStakingApr';\nimport {\n  buildJettonClaimPayload,\n  buildJettonUnstakePayload,\n  buildLiquidStakingDepositBody,\n  buildLiquidStakingWithdrawBody,\n  getJettonPoolStakeWallet,\n  getTonClient,\n  resolveTokenWalletAddress,\n  toBase64Address,\n  unpackDicts,\n} from './util/tonCore';\nimport { TsUSDeWallet } from './contracts/Ethena/TsUSDeWallet';\nimport { StakeWallet } from './contracts/JettonStaking/StakeWallet';\nimport { StakingPool } from './contracts/JettonStaking/StakingPool';\nimport { NominatorPool } from './contracts/NominatorPool';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\nimport { getAccountCache, getStakingCommonCache, updateAccountCache } from '../../common/cache';\nimport { getClientId } from '../../common/other';\nimport { buildTokenSlug, getTokenByAddress, getTokenBySlug } from '../../common/tokens';\nimport { isKnownStakingPool } from '../../common/utils';\nimport { STAKE_COMMENT, TON_GAS, UNSTAKE_COMMENT } from './constants';\nimport { checkTransactionDraft, submitTransfer } from './transfer';\n\nexport async function checkStakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  let result: ApiCheckTransactionDraftResult;\n\n  switch (state.type) {\n    case 'nominators': {\n      if (amount < TON_GAS.stakeNominators) {\n        return { error: ApiTransactionDraftError.InvalidAmount };\n      }\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.pool,\n        amount: amount + TON_GAS.stakeNominators,\n        data: STAKE_COMMENT,\n      });\n      if ('fee' in result && result.fee) {\n        result.fee = TON_GAS.stakeNominators + result.fee;\n      }\n      break;\n    }\n    case 'liquid': {\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: LIQUID_POOL,\n        amount: amount + TON_GAS.stakeLiquid,\n        data: buildLiquidStakingDepositBody(),\n      });\n      if ('fee' in result && result.fee) {\n        result.fee = TON_GAS.stakeLiquid + result.fee;\n      }\n      break;\n    }\n    case 'jetton': {\n      const { tokenSlug, pool, period } = state;\n      const { tokenAddress } = getTokenBySlug(tokenSlug);\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: pool,\n        tokenAddress,\n        amount,\n        data: StakingPool.stakePayload(period),\n        forwardAmount: TON_GAS.stakeJettonsForward,\n      });\n      break;\n    }\n    case 'ethena': {\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: ETHENA_STAKING_VAULT,\n        tokenAddress: TON_USDE.tokenAddress,\n        amount,\n        forwardAmount: TON_GAS.stakeEthenaForward,\n      });\n      break;\n    }\n  }\n\n  return result;\n}\n\nexport async function checkUnstakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n  const commonData = await getStakingCommonCache();\n\n  let result: ApiCheckTransactionDraftResult;\n  let tokenAmount: bigint | undefined;\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.pool,\n        amount: TON_GAS.unstakeNominators,\n        data: UNSTAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      if (amount > state.balance) {\n        return { error: ApiTransactionDraftError.InsufficientBalance };\n      } else if (amount === state.balance) {\n        tokenAmount = state.tokenBalance;\n      } else {\n        tokenAmount = bigintDivideToNumber(amount, commonData.liquid.currentRate);\n      }\n\n      const params = await buildLiquidStakingWithdraw(network, address, tokenAmount);\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: params.toAddress,\n        amount: params.amount,\n        data: params.payload,\n      });\n      break;\n    }\n    case 'jetton': {\n      tokenAmount = amount;\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: state.stakeWalletAddress,\n        amount: TON_GAS.unstakeJettons,\n        data: buildJettonUnstakePayload(amount, true),\n      });\n      break;\n    }\n    case 'ethena': {\n      if (amount > state.balance) {\n        return { error: ApiTransactionDraftError.InsufficientBalance };\n      } else if (amount === state.balance) {\n        tokenAmount = state.tokenBalance;\n      } else {\n        const rate = network === 'testnet' ? 1 : commonData.ethena.rate;\n        tokenAmount = bigintDivideToNumber(amount, rate);\n      }\n\n      result = await checkTransactionDraft({\n        accountId,\n        toAddress: TON_TSUSDE.tokenAddress,\n        amount: tokenAmount,\n        tokenAddress: TON_TSUSDE.tokenAddress,\n        forwardAmount: TON_GAS.unstakeEthenaForward,\n      });\n      break;\n    }\n  }\n\n  return {\n    ...result,\n    type: state.type,\n    tokenAmount,\n  };\n}\n\nexport async function submitStake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n) {\n  let result: ApiSubmitTransferTonResult;\n\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: toBase64Address(state.pool, true, network),\n        amount: amount + TON_GAS.stakeNominators,\n        data: STAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: LIQUID_POOL,\n        amount: amount + TON_GAS.stakeLiquid,\n        data: buildLiquidStakingDepositBody(),\n      });\n      break;\n    }\n    case 'jetton': {\n      const { tokenSlug, pool, period } = state;\n      const { tokenAddress } = getTokenBySlug(tokenSlug);\n\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: pool,\n        tokenAddress,\n        amount,\n        data: StakingPool.stakePayload(period),\n        forwardAmount: TON_GAS.stakeJettonsForward,\n      });\n      if (!('error' in result)) {\n        result.toAddress = pool;\n      }\n      break;\n    }\n    case 'ethena': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: ETHENA_STAKING_VAULT,\n        tokenAddress: TON_USDE.tokenAddress,\n        amount,\n        forwardAmount: TON_GAS.stakeEthenaForward,\n      });\n      break;\n    }\n  }\n\n  if (!('error' in result)) {\n    updateAccountCache(accountId, address, { stakedAt: Date.now() });\n  }\n\n  return result;\n}\n\nexport async function submitUnstake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  let result: ApiSubmitTransferTonResult;\n\n  switch (state.type) {\n    case 'nominators': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: toBase64Address(state.pool, true, network),\n        amount: TON_GAS.unstakeNominators,\n        data: UNSTAKE_COMMENT,\n      });\n      break;\n    }\n    case 'liquid': {\n      const mode = !state.instantAvailable\n        ? ApiLiquidUnstakeMode.BestRate\n        : ApiLiquidUnstakeMode.Default;\n\n      const params = await buildLiquidStakingWithdraw(network, address, amount, mode);\n\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: params.toAddress,\n        amount: params.amount,\n        data: params.payload,\n      });\n      break;\n    }\n    case 'jetton': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: state.stakeWalletAddress,\n        amount: TON_GAS.unstakeJettons,\n        data: buildJettonUnstakePayload(amount, true),\n      });\n      break;\n    }\n    case 'ethena': {\n      result = await submitTransfer({\n        accountId,\n        password,\n        toAddress: TON_TSUSDE.tokenAddress,\n        amount,\n        tokenAddress: TON_TSUSDE.tokenAddress,\n        forwardAmount: TON_GAS.unstakeEthenaForward,\n      });\n      if (!('error' in result)) {\n        result.localActivityParams = {\n          slug: TON_TSUSDE.slug,\n          amount: 0n,\n          toAddress: TON_TSUSDE.tokenAddress,\n        };\n      }\n    }\n  }\n\n  return result;\n}\n\nexport async function buildLiquidStakingWithdraw(\n  network: ApiNetwork,\n  address: string,\n  amount: bigint,\n  mode: ApiLiquidUnstakeMode = ApiLiquidUnstakeMode.Default,\n): Promise<TonTransferParams> {\n  const tokenWalletAddress = await resolveTokenWalletAddress(network, address, LIQUID_JETTON);\n\n  const payload = buildLiquidStakingWithdrawBody({\n    amount,\n    responseAddress: address,\n    fillOrKill: mode === ApiLiquidUnstakeMode.Instant,\n    waitTillRoundEnd: mode === ApiLiquidUnstakeMode.BestRate,\n  });\n\n  return {\n    amount: TON_GAS.unstakeLiquid,\n    toAddress: tokenWalletAddress,\n    payload,\n  };\n}\n\ntype StakingStateOptions = {\n  accountId: string;\n  backendState: ApiBackendStakingState;\n  commonData: ApiStakingCommonData;\n  address: string;\n  loyaltyType?: ApiLoyaltyType;\n  network: ApiNetwork;\n  balances: ApiBalanceBySlug;\n};\n\nexport async function getStakingStates(\n  accountId: string,\n  commonData: ApiStakingCommonData,\n  backendState: ApiBackendStakingState,\n  balances: ApiBalanceBySlug,\n): Promise<ApiStakingState[]> {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const {\n    loyaltyType,\n    shouldUseNominators,\n    type: backendType,\n  } = backendState;\n\n  const options: StakingStateOptions = {\n    accountId,\n    backendState,\n    commonData,\n    address,\n    loyaltyType,\n    network,\n    balances,\n  };\n\n  const promises: Promise<ApiStakingState>[] = [];\n\n  for (const poolConfig of commonData.jettonPools) {\n    const slug = buildTokenSlug('ton', poolConfig.token);\n    if (slug in balances) {\n      promises.push(buildJettonState(options, poolConfig));\n    }\n  }\n\n  if (shouldUseNominators || backendType === 'nominators') {\n    promises.push(buildNominatorsState(options));\n  }\n\n  if (TON_USDE.slug in balances && (!commonData.ethena.isDisabled || DEBUG)) {\n    promises.push(buildEthenaState(options));\n  }\n\n  return [buildLiquidState(options), ...await Promise.all(promises)];\n}\n\nfunction buildLiquidState({\n  accountId,\n  address,\n  backendState,\n  commonData,\n  loyaltyType,\n  balances,\n}: StakingStateOptions): ApiStakingState {\n  const { currentRate } = commonData.liquid;\n  const tokenSlug = buildTokenSlug('ton', LIQUID_JETTON);\n  const tokenBalance = balances[tokenSlug] ?? 0n;\n  const unstakeRequestAmount = fromDecimal(backendState.liquid?.unstakeRequestAmount ?? 0);\n\n  const accountCache = getAccountCache(accountId, address);\n  const stakedAt = Math.max(accountCache.stakedAt ?? 0, backendState.stakedAt ?? 0);\n\n  const isInstantUnstake = Date.now() - stakedAt > VALIDATION_PERIOD_MS && !getDevSettings().simulateLongUnstaking;\n  const liquidAvailable = isInstantUnstake ? commonData.liquid.available : 0n;\n  const { start, end } = getLiquidStakingTimeRange(commonData);\n\n  let liquidApy = commonData.liquid.apy;\n  if (loyaltyType && loyaltyType in commonData.liquid.loyaltyApy) {\n    liquidApy = commonData.liquid.loyaltyApy[loyaltyType];\n  }\n\n  const fullTokenAmount = tokenBalance + unstakeRequestAmount;\n  const balance = bigintMultiplyToNumber(fullTokenAmount, currentRate);\n\n  return {\n    type: 'liquid',\n    id: 'liquid',\n    tokenSlug: TONCOIN.slug,\n    pool: LIQUID_POOL,\n    balance,\n    annualYield: liquidApy,\n    yieldType: 'APY',\n    tokenBalance,\n    unstakeRequestAmount,\n    instantAvailable: liquidAvailable,\n    start,\n    end,\n  };\n}\n\nasync function buildNominatorsState({\n  network,\n  address,\n  backendState,\n  commonData,\n}: StakingStateOptions): Promise<ApiStakingState> {\n  const balance = backendState.balance;\n  const { address: pool, apy } = backendState.nominatorsPool;\n\n  const isPrevRoundUnlocked = Date.now() > commonData.prevRound.unlock;\n  const start = isPrevRoundUnlocked ? commonData.round.start : commonData.prevRound.start;\n  const end = isPrevRoundUnlocked ? commonData.round.unlock : commonData.prevRound.unlock;\n\n  let currentNominator: Nominator | undefined;\n\n  if (backendState.type === 'nominators') {\n    const nominatorPool = getTonClient(network).open(new NominatorPool(Address.parse(pool)));\n    const nominators = await nominatorPool.getListNominators();\n    const addressObject = Address.parse(address);\n    currentNominator = nominators.find((n) => n.address.equals(addressObject));\n  }\n\n  return {\n    type: 'nominators',\n    id: 'nominators',\n    tokenSlug: TONCOIN.slug,\n    balance: currentNominator ? balance : 0n,\n    annualYield: apy,\n    yieldType: 'APY',\n    pool,\n    start,\n    end,\n    pendingDepositAmount: currentNominator?.pendingDepositAmount ?? 0n,\n    unstakeRequestAmount: currentNominator?.withdrawRequested ? balance : 0n,\n  };\n}\n\nasync function buildJettonState(\n  options: StakingStateOptions,\n  pool: ApiStakingJettonPool,\n): Promise<ApiJettonStakingState> {\n  const { network } = options;\n\n  // common\n  const {\n    pool: poolAddress,\n    token: tokenAddress,\n    poolConfig,\n  } = pool;\n\n  const { decimals, slug: tokenSlug } = getTokenByAddress(tokenAddress);\n\n  // pool\n  const { tvl, rewardJettons } = unpackDicts(poolConfig) as StakingPoolConfigUnpacked;\n  const { rewardsDeposits } = Object.values(rewardJettons!)[0];\n  const now = Math.floor(Date.now() / 1000);\n\n  let dailyReward: bigint = 0n;\n  for (const { startTime, endTime, distributionSpeed } of Object.values(rewardsDeposits)) {\n    if (startTime < now && endTime > now) {\n      dailyReward += distributionSpeed;\n    }\n  }\n\n  const apr = calcJettonStakingApr({ tvl, dailyReward, decimals });\n\n  // wallet\n  const { address, balances } = options;\n  const periodConfig = pool.periods[0];\n  const stakedTokenSlug = buildTokenSlug('ton', periodConfig.token);\n\n  const stakeWallet = await getJettonPoolStakeWallet(network, poolAddress, periodConfig.period, address);\n\n  let unclaimedRewards = 0n;\n  let balance = 0n;\n  let poolWallets: string[] | undefined;\n\n  if (stakedTokenSlug in balances) { // Avoiding the request when it's unnecessary\n    const walletData = await stakeWallet.getStorageData().catch(() => undefined);\n\n    if (walletData) {\n      const poolWalletAddress = await resolveTokenWalletAddress(network, poolAddress, tokenAddress);\n      const rewards = StakeWallet.getAvailableRewards(walletData, poolConfig);\n      unclaimedRewards = (rewards && rewards[poolWalletAddress]) ?? 0n;\n      balance = walletData.jettonBalance;\n      poolWallets = Object.keys(rewards);\n    }\n  }\n\n  const state: ApiJettonStakingState = {\n    type: 'jetton',\n    id: poolAddress,\n    pool: poolAddress,\n    tokenAddress,\n    tokenSlug,\n    annualYield: apr,\n    yieldType: 'APR',\n    balance,\n    unclaimedRewards,\n    poolWallets,\n    stakeWalletAddress: toBase64Address(stakeWallet.address, true),\n    tokenAmount: 0n,\n    tvl,\n    dailyReward,\n    period: periodConfig.period,\n  };\n\n  return state;\n}\n\nasync function buildEthenaState(options: StakingStateOptions): Promise<ApiEthenaStakingState> {\n  const {\n    network, balances, address: walletAddress,\n    commonData, commonData: { ethena: { apy, apyVerified } },\n    backendState: { ethena: { isVerified } },\n  } = options;\n\n  const rate = network === 'testnet' ? 1 : commonData.ethena.rate;\n\n  const tonClient = getTonClient(network);\n  const tsUsdeWalletAddress = await resolveTokenWalletAddress(network, walletAddress, TON_TSUSDE.tokenAddress);\n  const tsUsdeWallet = tonClient.open(TsUSDeWallet.createFromAddress(Address.parse(tsUsdeWalletAddress)));\n  const { lockedBalance, unlockTime } = await tsUsdeWallet.getTimeLockData();\n\n  const tokenBalance = balances[TON_TSUSDE.slug] ?? 0n;\n  const balance = bigintMultiplyToNumber(tokenBalance, rate);\n  const unstakeRequestAmount = bigintMultiplyToNumber(lockedBalance, rate);\n\n  const state: ApiEthenaStakingState = {\n    id: 'ethena',\n    type: 'ethena',\n    tokenSlug: TON_USDE.slug,\n    yieldType: 'APY',\n    annualYield: isVerified ? apyVerified : apy,\n    annualYieldStandard: apy,\n    annualYieldVerified: apyVerified,\n    balance,\n    pool: ETHENA_STAKING_VAULT,\n    tokenBalance,\n    unstakeRequestAmount,\n    lockedBalance,\n    unlockTime: unlockTime && lockedBalance ? unlockTime * 1000 : undefined,\n    tsUsdeWalletAddress,\n  };\n\n  // If the user never passed verification and has no active USDe staking, we should optimistically show the high APY.\n  if (isVerified === undefined && !getIsActiveStakingState(state)) {\n    state.annualYield = apyVerified;\n  }\n\n  return state;\n}\n\nfunction getLiquidStakingTimeRange(commonData: ApiStakingCommonData) {\n  const { prevRound, round: currentRound } = commonData;\n  const now = Date.now();\n  const gracePeriod = UNSTAKE_TON_GRACE_PERIOD;\n\n  const round = (\n    // Show date of next unlock plus few minutes\n    // (except when grace period is active and payout has already occurred — i.e. collection has disappeared).\n    (now > prevRound.unlock && now < prevRound.unlock + gracePeriod && !commonData.liquid.collection)\n    || now >= prevRound.unlock + gracePeriod\n  ) ? currentRound : prevRound;\n\n  return {\n    start: round.start,\n    end: round.unlock + gracePeriod,\n  };\n}\n\nexport async function getBackendStakingState(accountId: string): Promise<ApiBackendStakingState> {\n  const { address } = await fetchStoredTonWallet(accountId);\n  const state = await fetchBackendStakingState(address);\n  return {\n    ...state,\n    nominatorsPool: {\n      ...state.nominatorsPool,\n      start: state.nominatorsPool.start * 1000,\n      end: state.nominatorsPool.end * 1000,\n    },\n  };\n}\n\nexport async function fetchBackendStakingState(address: string): Promise<ApiBackendStakingState> {\n  const clientId = await getClientId();\n  const stakingState = await callBackendGet(`/staking/state/${address}`, undefined, {\n    'X-App-ClientID': clientId,\n  });\n\n  stakingState.balance = fromDecimal(stakingState.balance);\n  stakingState.totalProfit = fromDecimal(stakingState.totalProfit);\n\n  if (!isKnownStakingPool(stakingState.nominatorsPool.address)) {\n    throw Error('Unexpected pool address, likely a malicious activity');\n  }\n\n  return stakingState;\n}\n\nexport function submitTokenStakingClaim(\n  accountId: string,\n  password: string,\n  state: ApiJettonStakingState,\n) {\n  return submitTransfer({\n    accountId,\n    password,\n    toAddress: state.stakeWalletAddress,\n    amount: TON_GAS.claimJettons,\n    data: buildJettonClaimPayload(state.poolWallets!),\n  });\n}\n\nexport async function submitUnstakeEthenaLocked(\n  accountId: string,\n  password: string,\n  state: ApiEthenaStakingState,\n) {\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  const result = await submitTransfer({\n    accountId,\n    password,\n    toAddress: state.tsUsdeWalletAddress,\n    amount: TON_GAS.unstakeEthenaLocked,\n    data: TsUSDeWallet.transferTimelockedMessage({\n      jettonAmount: state.lockedBalance,\n      to: Address.parse(TON_TSUSDE.tokenAddress),\n      responseAddress: Address.parse(address),\n      forwardTonAmount: TON_GAS.unstakeEthenaLockedForward,\n    }),\n  });\n\n  if (!('error' in result)) {\n    result.localActivityParams = {\n      type: 'unstake',\n      amount: state.unstakeRequestAmount,\n      isIncoming: true,\n      slug: TON_USDE.slug,\n      fromAddress: ETHENA_STAKING_VAULT,\n      toAddress: address,\n    };\n  }\n\n  return result;\n}\n","import type { ApiStakingState, ApiStakingType } from '../../api/types';\n\nimport {\n  ETHENA_STAKING_MIN_AMOUNT,\n  MIN_ACTIVE_STAKING_REWARDS,\n  NOMINATORS_STAKING_MIN_AMOUNT,\n  STAKING_MIN_AMOUNT,\n} from '../../config';\n\nexport function getStakingMinAmount(type?: ApiStakingType) {\n  switch (type) {\n    case 'nominators':\n      return NOMINATORS_STAKING_MIN_AMOUNT;\n    case 'ethena':\n      return ETHENA_STAKING_MIN_AMOUNT;\n    default:\n      return STAKING_MIN_AMOUNT;\n  }\n}\n\nexport function getUnstakeTime(state?: ApiStakingState) {\n  switch (state?.type) {\n    case 'nominators':\n    case 'liquid':\n      return state.end;\n    case 'ethena':\n      return state.unlockTime;\n    default:\n      return undefined;\n  }\n}\n\nexport function getStakingTitle(stakingType?: ApiStakingState['type']) {\n  return stakingType === 'ethena' ? 'How does it work?' : 'Why this is safe';\n}\n\nexport type StakingStateStatus = 'inactive' | 'active' | 'unstakeRequested' | 'readyToClaim';\n\nexport function getStakingStateStatus(state: ApiStakingState): StakingStateStatus {\n  if (state.unstakeRequestAmount) {\n    if (state.type === 'ethena' && state.unlockTime && state.unlockTime <= Date.now()) {\n      return 'readyToClaim';\n    }\n\n    return 'unstakeRequested';\n  }\n  if (getIsActiveStakingState(state)) {\n    return 'active';\n  }\n  return 'inactive';\n}\n\nexport function getIsActiveStakingState(state: ApiStakingState) {\n  return Boolean(\n    state.balance\n    || state.unstakeRequestAmount\n    || ('unclaimedRewards' in state && state.unclaimedRewards > MIN_ACTIVE_STAKING_REWARDS),\n  );\n}\n\nexport function getIsLongUnstake(state: ApiStakingState, amount?: bigint): boolean | undefined {\n  switch (state.type) {\n    case 'nominators': {\n      return true;\n    }\n    case 'liquid': {\n      return amount === undefined ? false : amount > state.instantAvailable;\n    }\n    case 'jetton': {\n      return false;\n    }\n    case 'ethena': {\n      return true;\n    }\n  }\n\n  return undefined;\n}\n\nexport function getFullStakingBalance(state: ApiStakingState): bigint {\n  switch (state.type) {\n    case 'jetton': {\n      return state.balance + state.unclaimedRewards;\n    }\n    case 'ethena': {\n      return state.balance + state.unstakeRequestAmount;\n    }\n  }\n\n  return state.balance;\n}\n","import { DAYS_IN_YEAR } from '../../api/constants';\nimport { toBig } from '../decimals';\n\nexport default function calcJettonStakingApr({\n  tvl, dailyReward, decimals,\n}: {\n  tvl: bigint;\n  dailyReward: bigint;\n  decimals: number;\n}) {\n  if (!tvl) {\n    return 0;\n  }\n\n  const apr = toBig(dailyReward, decimals)\n    .div(toBig(tvl, decimals))\n    .mul(DAYS_IN_YEAR)\n    .mul(100)\n    .toFixed(2);\n\n  return Number(apr);\n}\n","import { Builder, Cell } from '@ton/core';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { getTonClient } from './util/tonCore';\n\nexport function packPayloadToBoc(payload: string | Uint8Array) {\n  let cell = new Cell();\n  if (payload) {\n    if (payload instanceof Cell) {\n      cell = payload;\n    } else if (typeof payload === 'string') {\n      if (payload.length > 0) {\n        cell = new Builder()\n          .storeUint(0, 32)\n          .storeStringTail(payload)\n          .asCell();\n      }\n    } else {\n      cell = new Builder()\n        .storeBuffer(Buffer.from(payload))\n        .asCell();\n    }\n  }\n  return cell.toBoc().toString('base64');\n}\n\nexport async function checkApiAvailability(network: ApiNetwork) {\n  try {\n    await getTonClient(network).getMasterchainInfo();\n    return true;\n  } catch (err: any) {\n    return false;\n  }\n}\n","import type {\n  ApiNetwork,\n  ApiSwapBuildRequest,\n  ApiTokensTransferPayload,\n} from '../../types';\nimport type { TonTransferParams } from './types';\n\nimport { DIESEL_ADDRESS, SWAP_FEE_ADDRESS, TONCOIN } from '../../../config';\nimport { assert as originalAssert } from '../../../util/assert';\nimport { fromDecimal } from '../../../util/decimals';\nimport { isTokenTransferPayload } from '../../../util/ton/transfer';\nimport { parsePayloadBase64 } from './util/metadata';\nimport { resolveTokenWalletAddress, toBase64Address } from './util/tonCore';\nimport { getTokenByAddress } from '../../common/tokens';\nimport { getContractInfo } from './wallet';\n\nconst FEE_ADDRESSES = [SWAP_FEE_ADDRESS, DIESEL_ADDRESS];\nconst MAX_NETWORK_FEE = 1000000000n; // 1 TON\n\nexport async function validateDexSwapTransfers(\n  network: ApiNetwork,\n  address: string,\n  request: ApiSwapBuildRequest,\n  transfers: TonTransferParams[],\n) {\n  const assert = (condition: boolean, message: string) => {\n    originalAssert(condition, message, {\n      network, address, request, transfers,\n    });\n  };\n\n  assert(transfers.length <= 2, 'Too many transfers');\n\n  const [mainTransfer, feeTransfer] = transfers;\n\n  if (request.from === TONCOIN.symbol) {\n    const maxAmount = fromDecimal(request.fromAmount) + fromDecimal(request.ourFee) + MAX_NETWORK_FEE;\n    const { isSwapAllowed, codeHash } = await getContractInfo(network, mainTransfer.toAddress);\n\n    assert(!!isSwapAllowed, `Not allowed swap contract: ${codeHash}`);\n    assert(mainTransfer.amount <= maxAmount, 'Main transfer amount is too big');\n\n    if (feeTransfer) {\n      assert(feeTransfer.amount <= mainTransfer.amount, 'Fee transfer amount is too big');\n      assert(feeTransfer.amount + mainTransfer.amount < maxAmount, 'Total amount is too big');\n      assert(FEE_ADDRESSES.includes(toBase64Address(feeTransfer.toAddress, false)), 'Unexpected fee transfer address');\n    }\n  } else {\n    const token = getTokenByAddress(request.from);\n    assert(!!token, 'Unknown \"from\" token');\n\n    const maxAmount = fromDecimal(request.fromAmount, token.decimals)\n      + fromDecimal(request.ourFee ?? 0, token.decimals)\n      + fromDecimal(request.dieselFee ?? 0, token.decimals);\n    const maxTonAmount = MAX_NETWORK_FEE;\n\n    const walletAddress = await resolveTokenWalletAddress(network, address, token.tokenAddress!);\n    const parsedPayload = await parsePayloadBase64(network, mainTransfer.toAddress, mainTransfer.payload as string);\n\n    assert(mainTransfer.toAddress === walletAddress, 'Main transfer address is not the token wallet address');\n    assert(isTokenTransferPayload(parsedPayload), 'Main transfer payload is not a token transfer');\n\n    const { amount: tokenAmount, destination } = parsedPayload as ApiTokensTransferPayload;\n    assert(tokenAmount <= maxAmount, 'Main transfer token amount is too big');\n\n    assert(mainTransfer.amount < maxTonAmount, 'Main transfer TON amount is too big');\n\n    const { isSwapAllowed } = await getContractInfo(network, destination);\n\n    assert(!!isSwapAllowed, 'Main transfer destination is not a swap smart contract');\n\n    if (feeTransfer) {\n      const feePayload = await parsePayloadBase64(network, feeTransfer.toAddress, feeTransfer.payload as string);\n\n      assert(feeTransfer.amount + mainTransfer.amount < maxTonAmount, 'Total TON amount is too big');\n      assert(feeTransfer.toAddress === walletAddress, 'Fee transfer address is not the token wallet address');\n      assert(isTokenTransferPayload(feePayload), 'Fee transfer payload is not a token transfer');\n\n      const { amount: tokenFeeAmount, destination: feeDestination } = feePayload as ApiTokensTransferPayload;\n\n      assert(tokenAmount + tokenFeeAmount <= maxAmount, 'Total token amount is too big');\n      assert(FEE_ADDRESSES.includes(toBase64Address(feeDestination, false)), 'Unexpected fee transfer destination');\n    }\n  }\n}\n","import type { ApiActivity, ApiSwapActivity, ApiSwapHistoryItem } from '../types';\n\nimport { SWAP_API_VERSION, SWAP_CROSSCHAIN_SLUGS, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { buildBackendSwapId, getActivityTokenSlugs, parseTxId } from '../../util/activities';\nimport { compareActivities } from '../../util/compareActivities';\nimport { logDebugError } from '../../util/logs';\nimport { fetchStoredAccount } from './accounts';\nimport { callBackendGet, callBackendPost } from './backend';\nimport { buildTokenSlug, getTokenByAddress, getTokenBySlug } from './tokens';\n\nexport function swapGetHistory(address: string, params: {\n  fromTimestamp?: number;\n  toTimestamp?: number;\n  status?: ApiSwapHistoryItem['status'];\n  isCex?: boolean;\n  asset?: string;\n  hashes?: string[];\n}): Promise<ApiSwapHistoryItem[]> {\n  return callBackendPost(`/swap/history/${address}`, {\n    ...params,\n    swapVersion: SWAP_API_VERSION,\n  });\n}\n\nexport function swapGetHistoryItem(address: string, id: string): Promise<ApiSwapHistoryItem> {\n  return callBackendGet(`/swap/history/${address}/${id}`, {\n    swapVersion: SWAP_API_VERSION,\n  });\n}\n\nexport function swapItemToActivity(swap: ApiSwapHistoryItem): ApiSwapActivity {\n  return {\n    ...swap,\n    id: buildBackendSwapId(swap.id),\n    kind: 'swap',\n    from: getSwapItemSlug(swap, swap.from),\n    to: getSwapItemSlug(swap, swap.to),\n    shouldLoadDetails: !swap.cex,\n  };\n}\n\nexport function getSwapItemSlug(item: ApiSwapHistoryItem, asset: string) {\n  if (asset === TONCOIN.symbol) {\n    return TONCOIN.slug;\n  }\n  if (item.cex) {\n    return getTokenByAddress(asset)?.slug ?? asset;\n  }\n  return buildTokenSlug('ton', asset);\n}\n\nexport async function patchSwapItem(options: {\n  address: string;\n  swapId: string;\n  authToken: string;\n  msgHash?: string;\n  error?: string;\n}) {\n  const {\n    address, swapId, authToken, msgHash, error,\n  } = options;\n  await callBackendPost(`/swap/history/${address}/${swapId}/update`, {\n    swapVersion: SWAP_API_VERSION,\n    msgHash,\n    error,\n  }, {\n    method: 'PATCH',\n    authToken,\n  });\n}\n\nexport async function swapReplaceCexActivities(\n  accountId: string,\n  activities: ApiActivity[],\n  slug?: string,\n  isToNow?: boolean,\n): Promise<ApiActivity[]> {\n  if (!activities.length || parseAccountId(accountId).network === 'testnet' || !canHaveCexSwap(slug, activities)) {\n    return activities;\n  }\n\n  try {\n    const { ton: { address } = {} } = await fetchStoredAccount(accountId);\n    if (!address) {\n      return activities;\n    }\n\n    const firstTimestamp = activities[0].timestamp;\n    const lastTimestamp = activities[activities.length - 1].timestamp;\n\n    const [fromTime, toTime] = firstTimestamp < lastTimestamp\n      ? [firstTimestamp, isToNow ? Date.now() : lastTimestamp]\n      : [lastTimestamp, isToNow ? Date.now() : firstTimestamp];\n\n    const hashes = activities.map(({ id }) => parseTxId(id).hash);\n\n    const swaps = await swapGetHistory(address, {\n      fromTimestamp: fromTime,\n      toTimestamp: toTime,\n      asset: slug ? getTokenBySlug(slug).tokenAddress ?? TONCOIN.symbol : undefined,\n      hashes,\n      isCex: true,\n    });\n\n    if (!swaps.length) {\n      return activities;\n    }\n\n    const result: ApiActivity[] = [];\n    const allSwapHashes = new Set<string>();\n\n    for (const swap of swaps) {\n      swap.hashes.forEach((hash) => allSwapHashes.add(hash));\n\n      const isSwapHere = swap.timestamp > fromTime && swap.timestamp < toTime;\n      if (isSwapHere) {\n        result.push(swapItemToActivity(swap));\n      }\n    }\n\n    for (const activity of activities) {\n      if (activity.kind === 'transaction' && allSwapHashes.has(parseTxId(activity.id).hash)) {\n        result.push({ ...activity, shouldHide: true });\n      } else {\n        result.push(activity);\n      }\n    }\n\n    result.sort(compareActivities);\n\n    return result;\n  } catch (err) {\n    logDebugError('swapReplaceCexActivities', err);\n    return activities;\n  }\n}\n\nfunction canHaveCexSwap(slug: string | undefined, activities: ApiActivity[]): boolean {\n  if (slug) {\n    return SWAP_CROSSCHAIN_SLUGS.has(slug);\n  }\n\n  return activities.some((activity) => {\n    return getActivityTokenSlugs(activity).some((slug) => {\n      return SWAP_CROSSCHAIN_SLUGS.has(slug);\n    });\n  });\n}\n","import type { ApiActivity, ApiNetwork } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport { buildCollectionByKey, findDifference, split } from '../../util/iteratees';\nimport { logDebug, logDebugError } from '../../util/logs';\nimport { pause } from '../../util/schedulers';\nimport { fetchActions, parseActionActivityId } from '../chains/ton/toncenter';\nimport { SEC } from '../constants';\nimport { fetchStoredTonWallet } from './accounts';\nimport { swapReplaceCexActivities } from './swap';\n\nconst RELOAD_ACTIVITIES_ATTEMPTS = 4;\nconst RELOAD_ACTIVITIES_PAUSE = SEC;\nconst FETCH_ACTIONS_BATCH_SIZE = 100;\n\n/** Enriches the activities with missing metadata and CEX swap activities */\nexport async function enrichActivities(\n  accountId: string,\n  activities: ApiActivity[],\n  tokenSlug?: string,\n  isToNow?: boolean,\n) {\n  try {\n    activities = await reloadIncompleteActivities(accountId, activities);\n    activities = await swapReplaceCexActivities(accountId, activities, tokenSlug, isToNow);\n  } catch (err) {\n    logDebugError('enrichActivities', err);\n  }\n\n  return activities;\n}\n\nasync function reloadIncompleteActivities(accountId: string, activities: ApiActivity[]) {\n  try {\n    const { network } = parseAccountId(accountId);\n    const { address } = await fetchStoredTonWallet(accountId);\n\n    let actionIdsToReload = activities\n      .filter((activity) => activity.shouldReload)\n      .map((activity) => parseActionActivityId(activity.id).actionId);\n\n    for (let attempt = 0; attempt < RELOAD_ACTIVITIES_ATTEMPTS && actionIdsToReload.length; attempt++) {\n      logDebug(`Reload incomplete activities #${attempt + 1}`, actionIdsToReload);\n      await pause(RELOAD_ACTIVITIES_PAUSE);\n\n      ({ activities, actionIdsToReload } = await tryReloadIncompleteActivities(\n        network,\n        address,\n        activities,\n        actionIdsToReload,\n      ));\n    }\n  } catch (err) {\n    logDebugError('reloadIncompleteActivities', err);\n  }\n\n  return activities;\n}\n\nasync function tryReloadIncompleteActivities(\n  network: ApiNetwork,\n  address: string,\n  activities: ApiActivity[],\n  actionIdsToReload: string[],\n) {\n  const actionIdBatches = split(actionIdsToReload, FETCH_ACTIONS_BATCH_SIZE);\n\n  const batchResults = await Promise.all(actionIdBatches.map(async (actionIds) => {\n    const reloadedActivities = await fetchActions({\n      network,\n      filter: { actionId: actionIds },\n      walletAddress: address,\n      limit: FETCH_ACTIONS_BATCH_SIZE,\n    });\n    return reloadedActivities.filter((activity) => !activity.shouldReload);\n  }));\n\n  const reloadedActivities = batchResults.flat();\n\n  if (reloadedActivities.length) {\n    const replaceById = buildCollectionByKey(reloadedActivities, 'id');\n    const reloadedActionIds = reloadedActivities.map((activity) => parseActionActivityId(activity.id).actionId);\n\n    activities = activities.map((activity) => replaceById[activity.id] ?? activity);\n    actionIdsToReload = findDifference(actionIdsToReload, reloadedActionIds);\n  }\n\n  return { activities, actionIdsToReload };\n}\n","import type { InMessageCallback } from '../../util/reconnectingWebsocket';\nimport type {\n  ApiChain,\n  ApiClientSocketMessage,\n  ApiNetwork,\n  ApiNewActivitySocketMessage,\n  ApiServerSocketMessage,\n  ApiSocketEventType,\n  ApiSubscribedSocketMessage,\n} from '../types';\n\nimport { BRILLIANT_API_BASE_URL } from '../../config';\nimport ReconnectingWebSocket from '../../util/reconnectingWebsocket';\nimport safeExec from '../../util/safeExec';\nimport { throttle } from '../../util/schedulers';\nimport { addBackendHeadersToSocketUrl } from './backend';\nimport { getBackendConfigCache } from './cache';\n\nconst ACTUALIZATION_DELAY = 10;\n\ninterface WatchedWallet {\n  chain: ApiChain;\n  events: ApiSocketEventType[];\n  address: string;\n}\n\nexport interface WalletWatcher {\n  /** Whether the socket is connected and subscribed to the given wallets */\n  readonly isConnected: boolean;\n  /** Removes the watcher and cleans the memory */\n  destroy(): void;\n}\n\ninterface WalletWatcherInternal extends WalletWatcher {\n  id: number;\n  wallets: WatchedWallet[];\n  isConnected: boolean;\n  /**\n   * Called when a new activity arrives into one of the listened address.\n   * In this context activity is any confirmed wallet change.\n   * Called only for wallets with an `activity` event.\n   *\n   * Called only when isConnected is true. Therefore, when the socket reconnects, the users should synchronize,\n   * otherwise the activity happening during the reconnect will miss.\n   */\n  onNewActivity?: NewActivityCallback;\n  /** Called when isConnected turns true */\n  onConnect?: NoneToVoidFunction;\n  /** Called when isConnected turns false */\n  onDisconnect?: NoneToVoidFunction;\n}\n\nexport type NewActivityCallback = (wallet: WatchedWallet) => void;\n\n/**\n * Connects to the MTW backend to passively listen to updates.\n */\nclass BackendSocket {\n  #network: ApiNetwork;\n\n  /** Defined only when the socket it needed (i.e. somebody wants to watch something) */\n  #socket?: ReconnectingWebSocket<ApiClientSocketMessage, ApiServerSocketMessage>;\n\n  #walletWatchers: WalletWatcherInternal[] = [];\n\n  /**\n   * A shared incremental counter for various unique ids. The fact that it's incremental is used to tell what actions\n   * happened earlier or later than others.\n   */\n  #currentUniqueId = 0;\n\n  constructor(network: ApiNetwork) {\n    this.#network = network;\n  }\n\n  public watchWallets(\n    wallets: WatchedWallet[],\n    {\n      onNewActivity,\n      onConnect,\n      onDisconnect,\n    }: Pick<WalletWatcherInternal, 'onNewActivity' | 'onConnect' | 'onDisconnect'> = {},\n  ): WalletWatcher {\n    const id = this.#currentUniqueId++;\n    const watcher: WalletWatcherInternal = {\n      id,\n      wallets,\n      isConnected: false,\n      onNewActivity,\n      onConnect,\n      onDisconnect,\n      destroy: this.#destroyWalletWatcher.bind(this, id),\n    };\n    this.#walletWatchers.push(watcher);\n    this.#actualizeSocket();\n    return watcher;\n  }\n\n  /** Removes the given watcher and unsubscribes from its wallets. Brings the sockets to the proper state. */\n  #destroyWalletWatcher(watcherId: number) {\n    const index = this.#walletWatchers.findIndex((watcher) => watcher.id === watcherId);\n    if (index >= 0) {\n      this.#walletWatchers.splice(index, 1);\n      this.#actualizeSocket();\n    }\n  }\n\n  /**\n   * Creates or destroys the given socket (if needed) and subscribes to the watched wallets.\n   *\n   * The method is throttled in order to:\n   *  - Avoid sending too many requests when the watched addresses change many times in a short time range.\n   *  - Avoid reconnecting the socket when watched addresses arrive shortly after stopping watching all addresses.\n   */\n  #actualizeSocket = throttle(async () => {\n    const { isWebSocketEnabled } = await getBackendConfigCache();\n\n    if (isWebSocketEnabled && this.#doesHaveWatchedAddresses()) {\n      this.#socket ??= this.#createSocket();\n      if (this.#socket.isConnected) {\n        this.#sendWatchedWalletsToSocket();\n      } // Otherwise, the addresses will be sent when the socket gets connected\n    } else {\n      this.#socket?.close();\n      this.#socket = undefined;\n    }\n  }, ACTUALIZATION_DELAY, false);\n\n  #createSocket() {\n    const url = getSocketUrl(this.#network);\n    const socket = new ReconnectingWebSocket<ApiClientSocketMessage, ApiServerSocketMessage>(url);\n    socket.onMessage(this.#handleSocketMessage);\n    socket.onConnect(this.#handleSocketConnect);\n    socket.onDisconnect(this.#handleSocketDisconnect);\n    return socket;\n  }\n\n  #handleSocketMessage: InMessageCallback<ApiServerSocketMessage> = (message) => {\n    switch (message.type) {\n      case 'subscribed':\n        this.#handleSubscribed(message);\n        break;\n      case 'newActivity':\n        this.#handleNewActivity(message);\n        break;\n    }\n  };\n\n  #handleSocketConnect = () => {\n    this.#sendWatchedWalletsToSocket();\n  };\n\n  #handleSocketDisconnect = () => {\n    for (const watcher of this.#walletWatchers) {\n      if (watcher.isConnected) {\n        watcher.isConnected = false;\n        if (watcher.onDisconnect) safeExec(watcher.onDisconnect);\n      }\n    }\n  };\n\n  #handleSubscribed(message: ApiSubscribedSocketMessage) {\n    for (const watcher of this.#walletWatchers) {\n      // If message id < watcher id, then the watcher was created after the subscribe request was sent, therefore\n      // the socket may be not subscribed to all the watcher addresses yet.\n      if (message.id < watcher.id) {\n        continue;\n      }\n\n      if (!watcher.isConnected) {\n        watcher.isConnected = true;\n        if (watcher.onConnect) safeExec(watcher.onConnect);\n      }\n    }\n  }\n\n  #handleNewActivity(message: ApiNewActivitySocketMessage) {\n    const messageAddresses = new Set(message.addresses);\n\n    for (const { wallets, isConnected, onNewActivity } of this.#walletWatchers) {\n      // Even though the socket may already listen to some wallet addresses, we promise the class users to trigger the\n      // onNewActivity callback only in the connected state.\n      if (!isConnected || !onNewActivity) {\n        continue;\n      }\n\n      for (const wallet of wallets) {\n        const doesWalletMatch = (\n          wallet.chain === message.chain\n          && messageAddresses.has(wallet.address)\n          && wallet.events.includes('activity')\n        );\n\n        if (doesWalletMatch) {\n          safeExec(() => onNewActivity(wallet));\n        }\n      }\n    }\n  }\n\n  #sendWatchedWalletsToSocket() {\n    // It's necessary to collect the watched addresses synchronously with locking the request id.\n    // It makes sure that all the watchers with ids < the response id will be subscribed.\n    const addresses = this.#getWatchedAddresses(['activity']);\n    const requestId = this.#currentUniqueId++;\n\n    this.#socket!.send({\n      type: 'subscribe',\n      id: requestId,\n      addresses: addresses.map((address) => ({\n        ...address,\n        events: ['activity'],\n      })),\n    });\n  }\n\n  #doesHaveWatchedAddresses() {\n    return this.#walletWatchers.some((watcher) => watcher.wallets.length);\n  }\n\n  /** Collects the addresses (grouped by chain) from the current watchers */\n  #getWatchedAddresses(events: ApiSocketEventType[]) {\n    const addresses: { chain: ApiChain; address: string }[] = [];\n\n    for (const watcher of this.#walletWatchers) {\n      for (const wallet of watcher.wallets) {\n        if (!wallet.events.some((event) => events.includes(event))) {\n          continue;\n        }\n\n        addresses.push({\n          chain: wallet.chain,\n          address: wallet.address,\n        });\n      }\n    }\n\n    return addresses;\n  }\n}\n\nfunction getSocketUrl(network: ApiNetwork) {\n  const url = new URL(BRILLIANT_API_BASE_URL);\n  url.protocol = url.protocol === 'http' ? 'ws' : 'wss';\n  url.pathname += `${network === 'testnet' ? 'testnet/' : ''}ws`;\n  addBackendHeadersToSocketUrl(url);\n  return url;\n}\n\nconst backendSockets: Partial<Record<ApiNetwork, BackendSocket>> = {};\n\n/** Returns a singleton (one constant instance per a network) */\nexport function getBackendSocket(network: ApiNetwork) {\n  backendSockets[network] ??= new BackendSocket(network);\n  return backendSockets[network];\n}\n\nexport type { BackendSocket };\n","import type { ApiChain, ApiNetwork } from '../../types';\nimport type { WalletWatcher } from '../backendSocket';\nimport type { Period } from './utils';\n\nimport { focusAwareDelay } from '../../../util/focusAwareDelay';\nimport { pause, throttle } from '../../../util/schedulers';\nimport { getBackendSocket } from '../backendSocket';\nimport { FallbackPollingScheduler } from './fallbackPollingScheduler';\nimport { periodToMs } from './utils';\n\nconst UPDATE_CALLBACK_DELAY = 10;\n\nexport interface WalletPollingOptions {\n  chain: ApiChain;\n  network: ApiNetwork;\n  address: string;\n  /** Whether an update should be triggerred when the polling object is created */\n  updateOnStart?: boolean;\n  /** The minimum delay between `onUpdate` calls */\n  minUpdateDelay: Period;\n  /**\n   * How much time the fallback polling will start after the socket disconnects.\n   * Also applies at the very beginning (until the socket is connected).\n   */\n  fallbackUpdateStartDelay: number;\n  /** Update periods when the socket is disconnected */\n  fallbackUpdatePeriod: Period;\n  /** Update periods when the socket is connected but there is no new activity coming */\n  forceUpdatePeriod: Period;\n  /**\n   * Called whenever the wallet data should be updated.\n   * The polling always waits until the returned promise resolves before running this callback again.\n   *\n   * @param isConfident `true` when the update was reported by the socket. `false` when the update is initiated by a\n   *  timer. If `false`, the app should check a piece of wallet before refreshing the whole data (to avoid excessive\n   *  network requests).\n   */\n  onUpdate(isConfident: boolean): MaybePromise<unknown>;\n}\n\n/**\n * Helps polling wallet balance and activity. Uses the backend websocket as the primary signal source and falls back\n * to simple time intervals if the websocket is unavailable. It doesn't provide the updated data, it provides signals\n * when the data should be fetched using the plain HTTP API.\n */\nexport class WalletPolling {\n  #options: WalletPollingOptions;\n\n  #walletWatcher: WalletWatcher;\n\n  #fallbackPollingScheduler: FallbackPollingScheduler;\n\n  #isDestroyed = false;\n\n  /** Undefined when no update is pending. Otherwise, holds the `isConfident` value (see `onUpdate` for more details) */\n  #pendingUpdate?: boolean;\n\n  constructor(options: WalletPollingOptions) {\n    this.#options = options;\n\n    this.#walletWatcher = getBackendSocket(options.network).watchWallets(\n      [{\n        chain: options.chain,\n        events: ['activity'],\n        address: options.address,\n      }],\n      {\n        onNewActivity: this.#handleSocketNewActivity,\n        onConnect: this.#handleSocketConnect,\n        onDisconnect: this.#handleSocketDisconnect,\n      },\n    );\n\n    this.#fallbackPollingScheduler = new FallbackPollingScheduler(this.#walletWatcher.isConnected, {\n      pollOnStart: options.updateOnStart,\n      minPollDelay: options.minUpdateDelay,\n      pollingStartDelay: options.fallbackUpdateStartDelay,\n      pollingPeriod: options.fallbackUpdatePeriod,\n      forcedPollingPeriod: options.forceUpdatePeriod,\n      poll: this.#triggerBackupNotifications,\n    });\n  }\n\n  public destroy() {\n    this.#isDestroyed = true;\n    this.#walletWatcher.destroy();\n    this.#fallbackPollingScheduler.destroy();\n  }\n\n  #handleSocketNewActivity = () => {\n    this.#pendingUpdate = true;\n    this.#runUpdateCallback();\n    this.#fallbackPollingScheduler.onSocketMessage();\n  };\n\n  #handleSocketConnect = () => {\n    this.#triggerBackupNotifications();\n    this.#fallbackPollingScheduler.onSocketConnect();\n  };\n\n  #handleSocketDisconnect = () => {\n    this.#fallbackPollingScheduler.onSocketDisconnect();\n  };\n\n  #triggerBackupNotifications = () => {\n    this.#pendingUpdate ??= false;\n    this.#runUpdateCallback();\n  };\n\n  #runUpdateCallback = throttle(async () => {\n    if (this.#pendingUpdate === undefined) {\n      return;\n    }\n\n    // To let sneak in the updates arriving in short-time batches. Otherwise, they will cause another onUpdate call.\n    await pause(UPDATE_CALLBACK_DELAY);\n    if (this.#isDestroyed) return;\n\n    const isConfident = this.#pendingUpdate;\n    this.#pendingUpdate = undefined;\n    await this.#options.onUpdate(isConfident);\n  }, () => {\n    const [ms, forceMs] = periodToMs(this.#options.minUpdateDelay);\n    return focusAwareDelay(\n      ms - UPDATE_CALLBACK_DELAY,\n      forceMs - UPDATE_CALLBACK_DELAY,\n    );\n  });\n}\n","import type { ApiTransactionActivity } from '../types';\n\nimport { createCallbackManager } from '../../util/callbacks';\n\nexport const txCallbacks = createCallbackManager();\n\nexport function whenTxComplete(normalizedAddress: string, amount: bigint) {\n  return new Promise<{ result: boolean; transaction: ApiTransactionActivity }>((resolve) => {\n    txCallbacks.addCallback(\n      function callback(transaction: ApiTransactionActivity) {\n        if (transaction.normalizedAddress === normalizedAddress && transaction.amount === -amount) {\n          txCallbacks.removeCallback(callback);\n          resolve({ result: true, transaction });\n        }\n      },\n    );\n  });\n}\n","type OnSwitch = (isOn: boolean) => void;\n\n/**\n * A virtual multi-input OR gate (https://en.wikipedia.org/wiki/OR_gate).\n * Triggers the callback when the gate output changes.\n */\nexport class OrGate<T> {\n  #enabledItems = new Set<T>();\n  #onSwitch: OnSwitch;\n\n  constructor(onSwitch: OnSwitch) {\n    this.#onSwitch = onSwitch;\n  }\n\n  get isOn() {\n    return this.#enabledItems.size > 0;\n  }\n\n  on(item: T) {\n    this.toggle(item, true);\n  }\n\n  off(item: T) {\n    this.toggle(item, false);\n  }\n\n  toggle(item: T, isItemOn: boolean) {\n    const prevIsOn = this.isOn;\n    this.#enabledItems[isItemOn ? 'add' : 'delete'](item);\n    const nextIsOn = this.isOn;\n\n    if (prevIsOn !== nextIsOn) {\n      this.#onSwitch(nextIsOn);\n    }\n  }\n}\n","import type { ApiActivity } from '../../types';\nimport type { ActivityStream, OnActivityUpdate, OnLoadingChange } from './toncenter';\n\nimport { createCallbackManager } from '../../../util/callbacks';\nimport { compareActivities } from '../../../util/compareActivities';\nimport { areSortedArraysEqual, extractKey } from '../../../util/iteratees';\nimport { OrGate } from '../../../util/orGate';\nimport { throttle } from '../../../util/schedulers';\nimport { enrichActivities } from '../../common/activities';\n\n/**\n * Like `ActivityStream` but applies `enrichActivities` to the confirmed activities.\n *\n * @see enrichActivities\n */\nexport class RichActivityStream {\n  #accountId: string;\n\n  /** Sorted by timestamp descending */\n  #confirmedActivitiesToReport: ApiActivity[] = [];\n\n  #pendingActivities = managePendingActivities();\n\n  #isLoading = new OrGate<'raw' | 'enrich'>((isLoading) => this.#loadingListeners.runCallbacks(isLoading));\n\n  #updateListeners = createCallbackManager<OnActivityUpdate>();\n  #triggerUpdateListeners = deduplicateActivityUpdates(this.#updateListeners.runCallbacks);\n  #loadingListeners = createCallbackManager<OnLoadingChange>();\n\n  #isDestroyed = false;\n\n  #onDestroy: NoneToVoidFunction[];\n\n  constructor(\n    accountId: string,\n    rawActivityStream: ActivityStream,\n  ) {\n    this.#accountId = accountId;\n\n    this.#onDestroy = [\n      rawActivityStream.onUpdate(this.#handleRawActivitiesUpdate),\n      rawActivityStream.onLoadingChange((isLoading) => this.#isLoading.toggle('raw', isLoading)),\n    ];\n  }\n\n  /**\n   * Registers a callback firing then new activities arrive.\n   * The callback is throttled under the hood.\n   */\n  public onUpdate(callback: OnActivityUpdate) {\n    return this.#updateListeners.addCallback(callback);\n  }\n\n  /**\n   * Registers a callback firing when the data from HTTP endpoints starts of finishes loading.\n   * The \"loading\" state includes the time when `rawActivityStream` is polling.\n   */\n  public onLoadingChange(callback: OnLoadingChange) {\n    return this.#loadingListeners.addCallback(callback);\n  }\n\n  public destroy() {\n    this.#isDestroyed = true;\n\n    for (const unsubscribe of this.#onDestroy) {\n      unsubscribe();\n    }\n  }\n\n  #handleRawActivitiesUpdate: OnActivityUpdate = (confirmedActivities, pendingActivities) => {\n    this.#pendingActivities.updateAfterRawUpdate(confirmedActivities, pendingActivities);\n    this.#reportActivities([]);\n\n    if (confirmedActivities.length) {\n      this.#confirmedActivitiesToReport.unshift(...confirmedActivities);\n      this.#enrichAndReportActivities();\n    }\n  };\n\n  // Using `throttle` to batch the new activities and ensure that they are reported in the order they were received\n  #enrichAndReportActivities = throttle(async () => {\n    if (this.#isDestroyed) return;\n\n    try {\n      this.#isLoading.on('enrich');\n\n      const rawConfirmedActivities = this.#confirmedActivitiesToReport;\n      this.#confirmedActivitiesToReport = [];\n      const richConfirmedActivities = await enrichActivities(this.#accountId, rawConfirmedActivities, undefined, true);\n\n      this.#pendingActivities.updateAfterEnrichment(rawConfirmedActivities);\n      this.#reportActivities(richConfirmedActivities);\n    } finally {\n      this.#isLoading.off('enrich');\n    }\n  }, 0);\n\n  #reportActivities(confirmedActivities: ApiActivity[]) {\n    if (!this.#isDestroyed) {\n      this.#triggerUpdateListeners(confirmedActivities, this.#pendingActivities.all);\n    }\n  }\n}\n\n/**\n * Manages pending activities to ensure that switching activities from pending to confirmed is seamless.\n * If not used, the pending activities received from `ActivityStream` will disappear temporarily while the confirmed\n * activities are being enriched.\n */\nfunction managePendingActivities() {\n  /** The latest pending activities provided by `rawActivityStream` */\n  let pendingActivities: readonly ApiActivity[] = [];\n  /** Pending activities that no longer exist but their corresponding confirmed activities are being enriched */\n  let zombiePendingActivities: ApiActivity[] = [];\n\n  const updateAfterRawUpdate = (confirmedActivities: ApiActivity[], newPendingActivities: readonly ApiActivity[]) => {\n    const confirmedHashes = new Set(extractKey(confirmedActivities, 'externalMsgHashNorm'));\n\n    zombiePendingActivities = [\n      ...zombiePendingActivities,\n      ...pendingActivities.filter((activity) => confirmedHashes.has(activity.externalMsgHashNorm)),\n    ].sort(compareActivities);\n\n    pendingActivities = newPendingActivities;\n  };\n\n  const updateAfterEnrichment = (rawConfirmedActivities: ApiActivity[]) => {\n    const confirmedHashes = new Set(extractKey(rawConfirmedActivities, 'externalMsgHashNorm'));\n\n    zombiePendingActivities = zombiePendingActivities\n      .filter((activity) => !confirmedHashes.has(activity.externalMsgHashNorm));\n  };\n\n  return {\n    /** Sorted by timestamp descending */\n    get all() {\n      return [...pendingActivities, ...zombiePendingActivities].sort(compareActivities);\n    },\n    updateAfterRawUpdate,\n    updateAfterEnrichment,\n  };\n}\n\n/**\n * Makes sure the update callback is not called uselessly. For example, with no confirmed activities and with the\n * same pending activities.\n */\nfunction deduplicateActivityUpdates(onUpdate: OnActivityUpdate): OnActivityUpdate {\n  let lastPendingActivities: readonly ApiActivity[] = [];\n\n  return (newConfirmedActivities, pendingActivities) => {\n    if (newConfirmedActivities.length || !areSortedArraysEqual(lastPendingActivities, pendingActivities)) {\n      onUpdate(newConfirmedActivities, pendingActivities);\n    }\n\n    lastPendingActivities = pendingActivities;\n  };\n}\n","import type {\n  ApiAccountAny,\n  ApiActivity,\n  ApiActivityTimestamps,\n  ApiBalanceBySlug,\n  ApiNftUpdate,\n  ApiStakingState,\n  ApiTonWallet,\n  ApiUpdatingStatus,\n  ApiVestingInfo,\n  ApiWalletInfo,\n  OnApiUpdate,\n} from '../../types';\n\nimport {\n  IS_CORE_WALLET,\n  IS_STAKING_DISABLED,\n  LEDGER_WALLET_VERSIONS,\n  POPULAR_WALLET_VERSIONS,\n  TONCOIN,\n} from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { getActivityTokenSlugs } from '../../../util/activities';\nimport { areDeepEqual } from '../../../util/areDeepEqual';\nimport Deferred from '../../../util/Deferred';\nimport { focusAwareDelay } from '../../../util/focusAwareDelay';\nimport { compact, pick } from '../../../util/iteratees';\nimport { logDebugError } from '../../../util/logs';\nimport { createTaskQueue, pause, throttle } from '../../../util/schedulers';\nimport { fetchStoredAccount, fetchStoredTonWallet, updateStoredTonWallet } from '../../common/accounts';\nimport { enrichActivities } from '../../common/activities';\nimport { getBackendConfigCache, getStakingCommonCache } from '../../common/cache';\nimport { inactiveWalletTiming, periodToMs, pollingLoop, withDoubleCheck } from '../../common/polling/utils';\nimport { WalletPolling } from '../../common/polling/walletPolling';\nimport { txCallbacks } from '../../common/txCallbacks';\nimport { hexToBytes } from '../../common/utils';\nimport { FIRST_TRANSACTIONS_LIMIT, MINUTE, SEC } from '../../constants';\nimport { fetchActivitySlice } from './activities';\nimport { getWalletFromAddress } from './auth';\nimport { fetchDomains } from './domains';\nimport { getAccountNfts, getNftUpdates } from './nfts';\nimport { RichActivityStream } from './richActivityStream';\nimport { getBackendStakingState, getStakingStates } from './staking';\nimport { loadTokenBalances } from './tokens';\nimport { ActivityStream } from './toncenter';\nimport { fetchVestings } from './vesting';\nimport { getWalletInfo, getWalletVersionInfos, isAddressInitialized } from './wallet';\n\ntype OnUpdatingStatusChange = (kind: ApiUpdatingStatus['kind'], isUpdating: boolean) => void;\n\nconst POLL_DELAY_AFTER_SOCKET = 3 * SEC;\nconst POLL_MIN_INTERVAL = { focused: 2 * SEC, notFocused: 10 * SEC };\nconst BALANCE_INTERVAL = { focused: MINUTE, notFocused: 5 * MINUTE };\nconst INITIALIZATION_INTERVAL = { focused: MINUTE, notFocused: 5 * MINUTE };\nconst STAKING_INTERVAL = { focused: 5 * SEC, notFocused: 20 * SEC };\nconst VERSIONS_INTERVAL = { focused: 5 * MINUTE, notFocused: 15 * MINUTE };\nconst VESTING_INTERVAL = { focused: 10 * SEC, notFocused: MINUTE };\nconst TON_DNS_INTERVAL = { focused: 15 * SEC, notFocused: 2 * MINUTE };\n\nconst NFT_FULL_INTERVAL = { focused: MINUTE, notFocused: 5 * MINUTE };\nconst DOUBLE_CHECK_NFT_PAUSE = 5 * SEC;\n\nconst MAX_ACTIVITY_LOAD_CONCURRENCY = 10;\n\nconst inactiveUpdateConcurrencyLimiter = createTaskQueue();\n\nexport function setupActivePolling(\n  accountId: string,\n  account: ApiAccountAny,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange: OnUpdatingStatusChange,\n  newestActivityTimestamps: ApiActivityTimestamps,\n): NoneToVoidFunction {\n  if (!('ton' in account) || !account.ton) {\n    return () => {};\n  }\n\n  const balanceAndDomainPolling = setupBalanceAndDomainPolling(\n    accountId,\n    onUpdate,\n    onUpdatingStatusChange.bind(undefined, 'balance'),\n  );\n  const stopActivityPolling = setupActivityPolling(\n    accountId,\n    account.ton.address,\n    newestActivityTimestamps,\n    balanceAndDomainPolling.getBalances,\n    handleWalletUpdate,\n    onUpdate,\n    onUpdatingStatusChange.bind(undefined, 'activities'),\n  );\n  const nftPolling = setupNftPolling(accountId, onUpdate);\n  const walletInitializationPolling = setupWalletInitializationPolling(accountId);\n  const stopWalletVersionPolling = setupWalletVersionsPolling(accountId, onUpdate);\n  const stopTonDnsPolling = setupTonDnsPolling(accountId, onUpdate);\n  const stopStakingPolling = setupStakingPolling(accountId, balanceAndDomainPolling.getBalances, onUpdate);\n  const stopVestingPolling = setupVestingPolling(accountId, onUpdate);\n\n  async function handleWalletUpdate() {\n    // The TON balance updates in `getWalletInfo` several seconds after an activity arrive from the Toncenter socket.\n    // This delay is up to 2 seconds, and 1 second is added as a safety margin.\n    // We suppose that the other HTTP API data can be delayed, so we delay all socket-triggerred pollings.\n    await pause(POLL_DELAY_AFTER_SOCKET);\n\n    // These data change only when the wallet gets new activities. The other pollings don't depend on the wallet content.\n    balanceAndDomainPolling.poll();\n    nftPolling.poll();\n    walletInitializationPolling.poll();\n  }\n\n  return () => {\n    balanceAndDomainPolling.stop();\n    stopActivityPolling();\n    nftPolling.stop();\n    stopWalletVersionPolling();\n    stopTonDnsPolling();\n    stopStakingPolling();\n    stopVestingPolling();\n  };\n}\n\nfunction setupBalanceAndDomainPolling(\n  accountId: string,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange?: (isUpdating: boolean) => void,\n) {\n  const balanceUpdater = makeBalanceAndDomainUpdater(accountId, onUpdate, onUpdatingStatusChange);\n\n  const polling = pollingLoop({\n    period: BALANCE_INTERVAL,\n    minDelay: POLL_MIN_INTERVAL,\n    poll: balanceUpdater.update,\n  });\n\n  return {\n    ...polling,\n    getBalances: balanceUpdater.get,\n  };\n}\n\nfunction makeBalanceAndDomainUpdater(\n  accountId: string,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange?: (isUpdating: boolean) => void,\n) {\n  const { network } = parseAccountId(accountId);\n  let balances: ApiBalanceBySlug | undefined;\n  let balancesDeferred = new Deferred();\n  let lastDomain: string | false | undefined; // Undefined means unknown, false means no domain\n\n  async function get() {\n    await balancesDeferred.promise;\n    return balances!;\n  }\n\n  async function update() {\n    onUpdatingStatusChange?.(true);\n\n    try {\n      const wallet = await fetchStoredTonWallet(accountId);\n      const [tonBalance, tokenBalances] = await Promise.all([\n        getTonBalanceAndCheckDomain(wallet.address),\n        loadTokenBalances(network, wallet.address, onUpdate),\n      ]);\n\n      const newBalances = {\n        [TONCOIN.slug]: tonBalance,\n        ...tokenBalances,\n      };\n      const hasChanged = !areDeepEqual(balances, newBalances);\n      balances = newBalances;\n\n      if (hasChanged) {\n        onUpdate({\n          type: 'updateBalances',\n          accountId,\n          chain: 'ton',\n          balances,\n        });\n      }\n\n      balancesDeferred.resolve();\n    } catch (err) {\n      logDebugError('setupBalanceAndDomainPolling update', err);\n\n      // It's important to reject the deferred instead of keeping it unsettled, because otherwise the main polling cycle\n      // will stuck and never retry. Creating a new deferred gives the `getBalances` callers another chance on retry.\n      balancesDeferred.reject(err);\n      balancesDeferred = new Deferred();\n    } finally {\n      onUpdatingStatusChange?.(false);\n    }\n  }\n\n  async function getTonBalanceAndCheckDomain(address: string) {\n    // Getting the balance and the domain go together, only because they arrive from the same endpoint\n    const { balance, domain = false } = await getWalletInfo(network, address);\n\n    if (domain !== lastDomain) {\n      onUpdate({\n        type: 'updateAccount',\n        accountId,\n        chain: 'ton',\n        domain,\n      });\n      lastDomain = domain;\n    }\n\n    return balance;\n  }\n\n  return { get, update };\n}\n\n// A good address for testing: UQD5mxRgCuRNLxKxeOjG6r14iSroLF5FtomPnet-sgP5xI-e\nfunction setupActivityPolling(\n  accountId: string,\n  address: string,\n  newestConfirmedActivityTimestamps: ApiActivityTimestamps,\n  getBalances: () => Promise<ApiBalanceBySlug>,\n  onRawActivity: NoneToVoidFunction,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange: (isUpdating: boolean) => void,\n) {\n  let isStopped = false;\n  let rawActivityStream: ActivityStream | undefined;\n  let richActivityStream: RichActivityStream | undefined;\n\n  const newestTimestamps = compact(Object.values(newestConfirmedActivityTimestamps));\n  let newestConfirmedActivityTimestamp = newestTimestamps.length ? Math.max(...newestTimestamps) : undefined;\n\n  async function loadInitialActivities() {\n    try {\n      onUpdatingStatusChange(true);\n      const tokenSlugs = Object.keys(await getBalances());\n      return await loadInitialConfirmedActivities(accountId, tokenSlugs, onUpdate);\n    } catch (err) {\n      logDebugError('loadInitialConfirmedActivities', err);\n      return undefined;\n    } finally {\n      onUpdatingStatusChange(false);\n    }\n  }\n\n  function onRawActivities(confirmedActivities: ApiActivity[]) {\n    if (confirmedActivities.length) {\n      onRawActivity();\n    }\n  }\n\n  function onRichActivities(confirmedActivities: ApiActivity[], pendingActivities: readonly ApiActivity[]) {\n    confirmedActivities.slice().reverse().forEach((activity) => {\n      txCallbacks.runCallbacks(activity);\n    });\n\n    onUpdate({\n      type: 'newActivities',\n      chain: 'ton',\n      activities: confirmedActivities,\n      pendingActivities,\n      accountId,\n    });\n  }\n\n  void (async () => {\n    const doesNeedInitial = newestConfirmedActivityTimestamp === undefined;\n    if (doesNeedInitial) {\n      newestConfirmedActivityTimestamp = await loadInitialActivities();\n      onRawActivity(); // Just in case, because new activities may have arrived while loading the initial ones\n    }\n\n    if (isStopped) return;\n\n    rawActivityStream = new ActivityStream(\n      parseAccountId(accountId).network,\n      address,\n      newestConfirmedActivityTimestamp,\n      // If the initial activities are loaded, the polling on start is excessive\n      !doesNeedInitial,\n    );\n\n    richActivityStream = new RichActivityStream(accountId, rawActivityStream);\n\n    rawActivityStream.onUpdate(onRawActivities);\n    richActivityStream.onUpdate(onRichActivities);\n    richActivityStream.onLoadingChange(onUpdatingStatusChange);\n  })();\n\n  return () => {\n    isStopped = true;\n    richActivityStream?.destroy();\n    rawActivityStream?.destroy();\n  };\n}\n\nfunction setupNftPolling(accountId: string, onUpdate: OnApiUpdate) {\n  let nftFromSec = Math.round(Date.now() / 1000);\n\n  // The NFT updates may not become available immediately after the socket message.\n  // So we check again in a few seconds.\n  const updatePartial = withDoubleCheck(\n    [DOUBLE_CHECK_NFT_PAUSE],\n    async () => {\n      try {\n        const nftResult = await getNftUpdates(accountId, nftFromSec).catch(logAndRescue);\n\n        if (nftResult) {\n          let nftUpdates: ApiNftUpdate[];\n          [nftFromSec, nftUpdates] = nftResult;\n          nftUpdates\n            .filter((update) => !(update.type === 'nftReceived' && update.nft.isHidden))\n            .forEach(onUpdate);\n        }\n      } catch (err) {\n        logDebugError('setupNftPolling updatePartial', err);\n      }\n    },\n  );\n\n  const fullPolling = pollingLoop({\n    period: NFT_FULL_INTERVAL,\n    async poll() {\n      updatePartial.cancel();\n\n      try {\n        const nfts = await getAccountNfts(accountId).catch(logAndRescue);\n\n        if (nfts) {\n          nftFromSec = Math.round(Date.now() / 1000);\n          onUpdate({\n            type: 'updateNfts',\n            accountId,\n            nfts,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupNftPolling updateFull', err);\n      }\n    },\n  });\n\n  return {\n    poll: throttle(\n      updatePartial.run,\n      () => focusAwareDelay(...periodToMs(POLL_MIN_INTERVAL)),\n    ),\n    stop() {\n      updatePartial.cancel();\n      fullPolling.stop();\n    },\n  };\n}\n\nfunction setupStakingPolling(accountId: string, getBalances: () => Promise<ApiBalanceBySlug>, onUpdate: OnApiUpdate) {\n  if (IS_STAKING_DISABLED || parseAccountId(accountId).network !== 'mainnet') {\n    return () => {};\n  }\n\n  let lastStates: ApiStakingState[] | undefined;\n\n  return pollingLoop({\n    period: STAKING_INTERVAL,\n    async poll() {\n      try {\n        const [common, balances, backendState] = await Promise.all([\n          getStakingCommonCache(),\n          getBalances(),\n          getBackendStakingState(accountId),\n        ]);\n        const states = await getStakingStates(accountId, common, backendState, balances);\n\n        const { shouldUseNominators, totalProfit } = backendState;\n\n        if (!areDeepEqual(states, lastStates)) {\n          lastStates = states;\n          onUpdate({\n            type: 'updateStaking',\n            accountId,\n            states,\n            totalProfit,\n            shouldUseNominators,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupStakingPolling', err);\n      }\n    },\n  }).stop;\n}\n\nasync function loadInitialConfirmedActivities(accountId: string, tokenSlugs: string[], onUpdate: OnApiUpdate) {\n  const concurrencyLimiter = createTaskQueue(MAX_ACTIVITY_LOAD_CONCURRENCY);\n\n  const bySlug: Record<string, ApiActivity[]> = {};\n  let mainActivities: ApiActivity[] = [];\n\n  let newestActivityTimestamp: number | undefined;\n\n  const loadTokenActivity = concurrencyLimiter.wrap(async (slug: string) => {\n    try {\n      const tokenSlug = slug !== TONCOIN.slug ? slug : undefined;\n      let activities = await fetchActivitySlice(accountId, tokenSlug, undefined, undefined, FIRST_TRANSACTIONS_LIMIT);\n\n      activities = await enrichActivities(accountId, activities, slug, true);\n\n      if (slug === TONCOIN.slug && activities.length) {\n        // Activities for each Jetton wallet are loaded only the first time.\n        // New token activities will be loaded along with TON.\n        newestActivityTimestamp = activities[0].timestamp;\n\n        // There is no way to load TON activities without loading activities of other tokens\n        mainActivities = activities;\n        activities = activities.filter((activity) => getActivityTokenSlugs(activity).includes(TONCOIN.slug));\n      }\n\n      bySlug[slug] = activities;\n    } catch (err) {\n      // If a token history fails to load, the UI will re-request its history when the user opens its activity feed\n      logDebugError('loadTokenActivity', slug, err);\n    }\n  });\n\n  await Promise.allSettled(tokenSlugs.map(loadTokenActivity));\n\n  onUpdate({\n    type: 'initialActivities',\n    chain: 'ton',\n    accountId,\n    mainActivities,\n    bySlug,\n  });\n\n  return newestActivityTimestamp;\n}\n\nfunction logAndRescue(err: Error) {\n  logDebugError('Polling error', err);\n\n  return undefined;\n}\n\nfunction setupWalletVersionsPolling(accountId: string, onUpdate: OnApiUpdate) {\n  const { network } = parseAccountId(accountId);\n  let lastResult: ApiWalletInfo[] | undefined;\n\n  return pollingLoop({\n    period: VERSIONS_INTERVAL,\n    async poll() {\n      try {\n        const { type: accountType, ton: tonWallet } = await fetchStoredAccount(accountId);\n        if (accountType === 'bip39' || !tonWallet) return 'stop';\n\n        const { publicKey, version, isInitialized } = tonWallet;\n\n        if (!publicKey) {\n          if (!isInitialized) {\n            // Keep polling because `publicKey` may arrive later (for example, when the view wallet becomes initialized)\n            return undefined;\n          }\n\n          // This happens when this address is not a wallet address (for example, a contract address)\n          onUpdate({\n            type: 'updateWalletVersions',\n            accountId,\n            currentVersion: version,\n            versions: [],\n          });\n          return 'stop';\n        }\n\n        const publicKeyBytes = hexToBytes(publicKey);\n        const versions = (accountType === 'ledger' ? LEDGER_WALLET_VERSIONS : POPULAR_WALLET_VERSIONS)\n          .filter((value) => value !== version);\n        const versionInfos = (await getWalletVersionInfos(\n          network, publicKeyBytes, versions,\n        ));\n\n        const filteredVersions = versionInfos.map(({ wallet, ...rest }) => rest);\n\n        if (!areDeepEqual(versionInfos, lastResult)) {\n          lastResult = versionInfos;\n          onUpdate({\n            type: 'updateWalletVersions',\n            accountId,\n            currentVersion: version,\n            versions: filteredVersions,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupWalletVersionsPolling', err);\n      }\n\n      return undefined;\n    },\n  }).stop;\n}\n\nfunction setupTonDnsPolling(accountId: string, onUpdate: OnApiUpdate) {\n  let lastResult: Awaited<ReturnType<typeof fetchDomains>> | undefined;\n\n  return pollingLoop({\n    period: TON_DNS_INTERVAL,\n    async poll() {\n      try {\n        const result = await fetchDomains(accountId);\n\n        if (!areDeepEqual(result, lastResult)) {\n          lastResult = result;\n\n          onUpdate({\n            type: 'updateAccountDomainData',\n            accountId,\n            ...pick(result, [\n              'expirationByAddress',\n              'linkedAddressByAddress',\n              'nfts',\n            ]),\n          });\n        }\n      } catch (err) {\n        logDebugError('setupTonDnsPolling', err);\n      }\n    },\n  }).stop;\n}\n\nfunction setupVestingPolling(accountId: string, onUpdate: OnApiUpdate) {\n  if (IS_CORE_WALLET) {\n    return () => {};\n  }\n\n  let lastVestingInfo: ApiVestingInfo[] | undefined;\n\n  return pollingLoop({\n    period: VESTING_INTERVAL,\n    async prepare() {\n      const { isVestingEnabled } = await getBackendConfigCache();\n      return isVestingEnabled;\n    },\n    async poll(isEnabled) {\n      if (!isEnabled) {\n        return 'stop';\n      }\n\n      try {\n        const vestingInfo = await fetchVestings(accountId);\n\n        if (!areDeepEqual(lastVestingInfo, vestingInfo)) {\n          lastVestingInfo = vestingInfo;\n          onUpdate({\n            type: 'updateVesting',\n            accountId,\n            vestingInfo,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupVestingPolling', err);\n      }\n\n      return undefined;\n    },\n  }).stop;\n}\n\nexport function setupInactivePolling(\n  accountId: string,\n  account: ApiAccountAny,\n  onUpdate: OnApiUpdate,\n): NoneToVoidFunction {\n  if (!('ton' in account) || !account.ton) {\n    return () => {};\n  }\n\n  const balanceUpdater = makeBalanceAndDomainUpdater(accountId, onUpdate);\n\n  const walletPolling = new WalletPolling({\n    ...inactiveWalletTiming,\n    chain: 'ton',\n    network: parseAccountId(accountId).network,\n    address: account.ton.address,\n    onUpdate: inactiveUpdateConcurrencyLimiter.wrap(async () => {\n      await balanceUpdater.update();\n    }),\n  });\n\n  return () => {\n    walletPolling.destroy();\n  };\n}\n\nfunction setupWalletInitializationPolling(accountId: string) {\n  return pollingLoop({\n    period: INITIALIZATION_INTERVAL,\n    minDelay: POLL_MIN_INTERVAL,\n    async poll() {\n      try {\n        const wallet = await fetchStoredTonWallet(accountId);\n\n        if (wallet.isInitialized) {\n          return 'stop';\n        }\n\n        const { network } = parseAccountId(accountId);\n        const doesNeedPublicKey = !wallet.publicKey;\n        let walletUpdate: Partial<ApiTonWallet> | undefined;\n\n        if (doesNeedPublicKey) {\n          // This branch isn't used always, because it makes more network requests than the other\n          const updatedWallet = await getWalletFromAddress(network, wallet.address);\n          if (!('error' in updatedWallet) && updatedWallet.wallet.isInitialized) {\n            // It's important to load and save `version` along with `publicKey` because the app couldn't get the proper\n            // wallet version without knowing the `publicKey`.\n            walletUpdate = pick(updatedWallet.wallet, ['isInitialized', 'publicKey', 'version']);\n          }\n        } else {\n          const isInitialized = await isAddressInitialized(network, wallet.address);\n          if (isInitialized) {\n            walletUpdate = { isInitialized };\n          }\n        }\n\n        if (walletUpdate) {\n          await updateStoredTonWallet(accountId, walletUpdate);\n        }\n      } catch (err) {\n        logDebugError('checkWalletInitialization', err);\n      }\n    },\n  });\n}\n","import type { ApiVestingInfo } from '../../types';\n\nimport { parseAccountId } from '../../../util/account';\nimport { fetchStoredTonWallet } from '../../common/accounts';\nimport { callBackendGet } from '../../common/backend';\n\nexport async function fetchVestings(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const isTestnet = network === 'testnet';\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return callBackendGet<ApiVestingInfo[]>(`/vesting/${address}`, { isTestnet });\n}\n","import { TronWeb } from 'tronweb';\n\nimport type { ApiNetwork } from '../../../types';\n\nimport { getChainConfig } from '../../../../util/chain';\n\nlet clientByNetwork: Record<ApiNetwork, TronWeb> | undefined;\n\nconst parametersByNetwork: Partial<Record<ApiNetwork, {\n  energyUnitFee: number;\n  bandwidthUnitFee: number;\n}>> = {};\n\nconst chainConfig = getChainConfig('tron');\n\nexport function getTronClient(network: ApiNetwork = 'mainnet') {\n  if (!clientByNetwork) {\n    clientByNetwork = {\n      mainnet: new TronWeb({\n        fullHost: chainConfig.mainnet.apiUrl,\n      }),\n      testnet: new TronWeb({\n        fullHost: chainConfig.testnet.apiUrl,\n      }),\n    };\n  }\n\n  return clientByNetwork[network];\n}\n\nexport async function getChainParameters(network: ApiNetwork) {\n  if (!(network in parametersByNetwork)) {\n    const chainParameters = await getTronClient(network).trx.getChainParameters();\n    const energyUnitFee = chainParameters.find((param) => param.key === 'getEnergyFee')!.value;\n    const bandwidthUnitFee = chainParameters.find((param) => param.key === 'getTransactionFee')!.value;\n    parametersByNetwork[network] = { energyUnitFee, bandwidthUnitFee };\n  }\n\n  return parametersByNetwork[network]!;\n}\n","import { TronWeb } from 'tronweb';\n\nimport type { ApiActivity, ApiNetwork, ApiTransactionActivity } from '../../types';\n\nimport { TRX } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { getChainConfig } from '../../../util/chain';\nimport { compareActivities } from '../../../util/compareActivities';\nimport { fetchJson } from '../../../util/fetch';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { fetchStoredTronWallet } from '../../common/accounts';\nimport { buildTokenSlug, getTokenBySlug } from '../../common/tokens';\n\nexport async function getTokenTransactionSlice(\n  accountId: string,\n  slug: string,\n  toTimestamp?: number,\n  fromTimestamp?: number,\n  limit?: number,\n) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTronWallet(accountId);\n\n  if (slug === TRX.slug) {\n    const rawTransactions = await getTrxTransactions(network, address, {\n      min_timestamp: fromTimestamp ? fromTimestamp + 1000 : undefined,\n      max_timestamp: toTimestamp ? toTimestamp - 1000 : undefined,\n      limit,\n      search_internal: false, // The parsing is not supported and not needed currently\n    });\n    return rawTransactions.map((rawTx) => parseRawTrxTransaction(address, rawTx)).filter(Boolean);\n  } else {\n    const { tokenAddress } = getTokenBySlug(slug);\n    const rawTransactions = await getTrc20Transactions(network, address, {\n      contract_address: tokenAddress,\n      min_timestamp: fromTimestamp ? fromTimestamp + 1000 : undefined,\n      max_timestamp: toTimestamp ? toTimestamp - 1000 : undefined,\n      limit,\n    });\n    return rawTransactions.map((rawTx) => parseRawTrc20Transaction(address, rawTx));\n  }\n}\n\nexport async function getAllTransactionSlice(\n  accountId: string,\n  toTimestamp: number,\n  limit: number,\n  tokenSlugs: string[],\n) {\n  const chunks = (await Promise.all([\n    getTokenTransactionSlice(accountId, TRX.slug, toTimestamp, undefined, limit),\n    ...tokenSlugs.map((slug) => getTokenTransactionSlice(\n      accountId, slug, toTimestamp, undefined, limit,\n    )),\n  ])).filter((chunk) => chunk.length);\n\n  if (!chunks.length) {\n    return [];\n  }\n\n  // TODO Нужно, чтобы чанки всегда именли \"все транзакции\", так как это всё работает только при корректной работе лимита.\n  // А только потом должна быть очистка от ненужных транзакций.\n  const mainChunk = chunks.reduce((prevChunk, chunk) => {\n    if (prevChunk.length > chunk.length) return prevChunk;\n    if (prevChunk.length < chunk.length) return chunk;\n    if (prevChunk[prevChunk.length - 1].timestamp < chunk[chunk.length - 1].timestamp) return chunk;\n    return prevChunk;\n  }, [] as ApiTransactionActivity[]);\n\n  const fromTimestamp = mainChunk[mainChunk.length - 1].timestamp;\n\n  const [trxChunk, ...tokenChunks] = chunks;\n\n  return mergeActivities(trxChunk, ...tokenChunks)\n    .filter(({ timestamp }) => timestamp >= fromTimestamp);\n}\n\nasync function getTrxTransactions(\n  network: ApiNetwork,\n  address: string,\n  queryParams: {\n    only_confirmed?: boolean;\n    only_unconfirmed?: boolean;\n    only_to?: boolean;\n    only_from?: boolean;\n    limit?: number;\n    fingerprint?: string;\n    order_by?: 'block_timestamp,asc' | 'block_timestamp,desc';\n    min_timestamp?: number;\n    max_timestamp?: number;\n    search_internal?: boolean;\n  } = {},\n): Promise<any[]> {\n  const baseUrl = getChainConfig('tron')[network].apiUrl;\n  const url = new URL(`${baseUrl}/v1/accounts/${address}/transactions`);\n\n  const result = await fetchJson(url.toString(), queryParams);\n\n  return result.data;\n}\n\nfunction parseRawTrxTransaction(address: string, rawTx: any): ApiTransactionActivity | undefined {\n  const {\n    raw_data: rawData,\n    txID: txId,\n    energy_fee: energyFee,\n    net_fee: netFee,\n    block_timestamp: timestamp,\n  } = rawTx;\n\n  const parameters = rawData.contract[0].parameter.value;\n  const amount = BigInt(parameters.amount ?? 0);\n  const fromAddress = TronWeb.address.fromHex(parameters.owner_address);\n  const toAddress = TronWeb.address.fromHex(\n    parameters.to_address || parameters.receiver_address || parameters.contract_address,\n  );\n\n  const slug = TRX.slug;\n  const isIncoming = toAddress === address;\n  const normalizedAddress = isIncoming ? fromAddress : toAddress;\n  const fee = BigInt(energyFee + netFee);\n  const type = rawData.contract[0].type === 'TriggerSmartContract' ? 'callContract' : undefined;\n  const shouldHide = rawData.contract[0].type === 'TransferAssetContract';\n\n  return {\n    id: txId,\n    kind: 'transaction',\n    txId,\n    timestamp,\n    fromAddress,\n    toAddress,\n    amount: isIncoming ? amount : -amount,\n    slug,\n    isIncoming,\n    normalizedAddress,\n    fee,\n    type,\n    shouldHide,\n  };\n}\n\nasync function getTrc20Transactions(\n  network: ApiNetwork,\n  address: string,\n  queryParams: {\n    only_confirmed?: boolean;\n    only_unconfirmed?: boolean;\n    limit?: number;\n    fingerprint?: string;\n    order_by?: 'block_timestamp,asc' | 'block_timestamp,desc';\n    min_timestamp?: number;\n    max_timestamp?: number;\n    contract_address?: string;\n    only_to?: boolean;\n    only_from?: boolean;\n  } = {},\n): Promise<any[]> {\n  const baseUrl = getChainConfig('tron')[network].apiUrl;\n  const url = new URL(`${baseUrl}/v1/accounts/${address}/transactions/trc20`);\n\n  const result = await fetchJson(url.toString(), queryParams);\n\n  return result.data;\n}\n\nfunction parseRawTrc20Transaction(address: string, rawTx: any): ApiTransactionActivity {\n  const {\n    transaction_id: txId,\n    block_timestamp: timestamp,\n    from: fromAddress,\n    to: toAddress,\n    value,\n    token_info: tokenInfo,\n  } = rawTx;\n\n  const amount = BigInt(value);\n  const slug = buildTokenSlug(TRX.chain, tokenInfo.address);\n  const isIncoming = toAddress === address;\n  const normalizedAddress = isIncoming ? fromAddress : toAddress;\n  const fee = 0n;\n\n  return {\n    id: txId,\n    kind: 'transaction',\n    txId,\n    timestamp,\n    fromAddress,\n    toAddress,\n    amount: isIncoming ? amount : -amount,\n    slug,\n    isIncoming,\n    normalizedAddress,\n    fee,\n  };\n}\n\nexport function mergeActivities(trxTxs: ApiActivity[], ...tokenTxs: ApiActivity[][]): ApiActivity[] {\n  const result: ApiActivity[] = [];\n  const uniqueTxIds = new Set<string>();\n  const trxTxById = buildCollectionByKey(trxTxs, 'id');\n\n  for (const tokenTxList of tokenTxs) {\n    for (const tokenTx of tokenTxList) {\n      // Different tokens have the same transaction id if they share the same backend swap.\n      // The duplicates need to removed.\n      if (uniqueTxIds.has(tokenTx.id)) {\n        continue;\n      }\n\n      uniqueTxIds.add(tokenTx.id);\n      result.push(tokenTx);\n\n      const trxTx = trxTxById[tokenTx.id];\n      if (tokenTx.kind === 'transaction' && trxTx?.kind === 'transaction') {\n        tokenTx.fee = trxTx.fee;\n      }\n    }\n  }\n\n  for (const trxTx of trxTxs) {\n    if (uniqueTxIds.has(trxTx.id)) {\n      continue;\n    }\n\n    if (trxTx.kind !== 'transaction' || trxTx.toAddress) {\n      uniqueTxIds.add(trxTx.id);\n      result.push(trxTx);\n    }\n  }\n\n  return result.sort(compareActivities);\n}\n","import type { TronWeb } from 'tronweb';\n\nimport type { ApiNetwork } from '../../types';\n\nimport { logDebugError } from '../../../util/logs';\nimport { getTronClient } from './util/tronweb';\n\n/*\n* We display unconfirmed balance and transactions to user.\n* /wallet/* - endpoints with unconfirmed data\n* /walletsolidity/* - endpoints with confirmed data\n*/\n\nexport async function getWalletBalance(network: ApiNetwork, address: string) {\n  const tronWeb = getTronClient(network);\n  return BigInt(await tronWeb.trx.getUnconfirmedBalance(address));\n}\n\nexport async function getTrc20Balance(network: ApiNetwork, tokenAddress: string, address: string) {\n  const result = await callContract(getTronClient(network), tokenAddress, 'balanceOf(address)', [\n    { type: 'address', value: address },\n  ], address);\n\n  if (!result.length) {\n    return 0n;\n  }\n\n  return BigInt(`0x${result[0]}`);\n}\n\nexport async function callContract(\n  tronWeb: TronWeb,\n  address: string,\n  functions: string,\n  parameters: any[] = [],\n  issuerAddress: string,\n) {\n  try {\n    const result = await tronWeb.transactionBuilder.triggerSmartContract(\n      address,\n      functions,\n      { _isConstant: true },\n      parameters,\n      issuerAddress,\n    );\n    return result && result.result ? result.constant_result : [];\n  } catch (err: any) {\n    logDebugError('callContract', err);\n    return [];\n  }\n}\n","import type {\n  ApiAccountAny,\n  ApiActivity,\n  ApiActivityTimestamps,\n  ApiBalanceBySlug,\n  ApiUpdatingStatus,\n  OnApiUpdate,\n} from '../../types';\n\nimport { TRX } from '../../../config';\nimport { parseAccountId } from '../../../util/account';\nimport { areDeepEqual } from '../../../util/areDeepEqual';\nimport { getChainConfig } from '../../../util/chain';\nimport isEmptyObject from '../../../util/isEmptyObject';\nimport { logDebugError } from '../../../util/logs';\nimport { createTaskQueue } from '../../../util/schedulers';\nimport { enrichActivities } from '../../common/activities';\nimport { activeWalletTiming, inactiveWalletTiming } from '../../common/polling/utils';\nimport { WalletPolling } from '../../common/polling/walletPolling';\nimport { buildTokenSlug } from '../../common/tokens';\nimport { txCallbacks } from '../../common/txCallbacks';\nimport { FIRST_TRANSACTIONS_LIMIT } from '../../constants';\nimport { getTokenTransactionSlice, mergeActivities } from './transactions';\nimport { getTrc20Balance, getWalletBalance } from './wallet';\n\ntype OnUpdatingStatusChange = (kind: ApiUpdatingStatus['kind'], isUpdating: boolean) => void;\n\nconst inactiveUpdateConcurrencyLimiter = createTaskQueue();\n\nexport function setupActivePolling(\n  accountId: string,\n  account: ApiAccountAny,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange: OnUpdatingStatusChange,\n  newestActivityTimestamps: ApiActivityTimestamps,\n): NoneToVoidFunction {\n  if (!('tron' in account) || !account.tron) {\n    return () => {};\n  }\n\n  const { address } = account.tron;\n\n  const balancePolling = setupBalancePolling(\n    accountId,\n    address,\n    onUpdate,\n    onUpdatingStatusChange.bind(undefined, 'balance'),\n  );\n  const activityPolling = setupActivityPolling(\n    accountId,\n    newestActivityTimestamps,\n    onUpdate,\n    onUpdatingStatusChange.bind(undefined, 'activities'),\n  );\n\n  let isFirstUpdate = true;\n\n  async function handleUpdate(isConfident: boolean) {\n    if (isConfident || isFirstUpdate) {\n      await Promise.all([\n        balancePolling.update(),\n        activityPolling.update(),\n      ]);\n    } else {\n      // Legacy (timer) polling mode.\n      // The balance is checked before the activities, because the backend throttling for balance is much looser.\n      const hasBalanceChanged = await balancePolling.update();\n      if (hasBalanceChanged) {\n        await activityPolling.update();\n      }\n    }\n\n    isFirstUpdate = false;\n  }\n\n  const walletPolling = new WalletPolling({\n    ...activeWalletTiming,\n    chain: 'tron',\n    network: parseAccountId(accountId).network,\n    address,\n    onUpdate: handleUpdate,\n  });\n\n  return () => {\n    walletPolling.destroy();\n  };\n}\n\nfunction setupBalancePolling(\n  accountId: string,\n  address: string,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange?: (isUpdating: boolean) => void,\n) {\n  const { network } = parseAccountId(accountId);\n  const { usdtAddress } = getChainConfig('tron')[network];\n  const usdtSlug = buildTokenSlug('tron', usdtAddress);\n\n  let balances: ApiBalanceBySlug | undefined;\n\n  /** Returns `true` if the balances have changed since the last update */\n  async function update() {\n    onUpdatingStatusChange?.(true);\n\n    try {\n      const [trxBalance, usdtBalance] = await Promise.all([\n        getWalletBalance(network, address),\n        getTrc20Balance(network, usdtAddress, address),\n      ]);\n      const newBalances = {\n        [TRX.slug]: trxBalance,\n        [usdtSlug]: usdtBalance,\n      };\n      const hasChanged = !areDeepEqual(balances, newBalances);\n      balances = newBalances;\n\n      if (hasChanged) {\n        onUpdate({\n          type: 'updateBalances',\n          accountId,\n          chain: 'tron',\n          balances,\n        });\n      }\n\n      return hasChanged;\n    } catch (err) {\n      logDebugError('setupBalancePolling update', err);\n    } finally {\n      onUpdatingStatusChange?.(false);\n    }\n\n    return false;\n  }\n\n  return { update };\n}\n\nfunction setupActivityPolling(\n  accountId: string,\n  newestActivityTimestamps: ApiActivityTimestamps,\n  onUpdate: OnApiUpdate,\n  onUpdatingStatusChange: (isUpdating: boolean) => void,\n) {\n  const { network } = parseAccountId(accountId);\n  const { usdtAddress } = getChainConfig('tron')[network];\n  const usdtSlug = buildTokenSlug('tron', usdtAddress);\n  const slugs = [TRX.slug, usdtSlug];\n\n  async function update() {\n    onUpdatingStatusChange(true);\n\n    try {\n      if (isEmptyObject(newestActivityTimestamps)) {\n        newestActivityTimestamps = await loadInitialActivities(accountId, slugs, onUpdate);\n      } else {\n        newestActivityTimestamps = await loadNewActivities(accountId, newestActivityTimestamps, slugs, onUpdate);\n      }\n    } catch (err) {\n      logDebugError('setupActivityPolling update', err);\n    } finally {\n      onUpdatingStatusChange(false);\n    }\n  }\n\n  return { update };\n}\n\nexport function setupInactivePolling(\n  accountId: string,\n  account: ApiAccountAny,\n  onUpdate: OnApiUpdate,\n): NoneToVoidFunction {\n  if (!('tron' in account) || !account.tron) {\n    return () => {};\n  }\n\n  const { address } = account.tron;\n\n  const balancePolling = setupBalancePolling(accountId, address, onUpdate);\n\n  const walletPolling = new WalletPolling({\n    ...inactiveWalletTiming,\n    chain: 'tron',\n    network: parseAccountId(accountId).network,\n    address,\n    onUpdate: inactiveUpdateConcurrencyLimiter.wrap(async () => {\n      await balancePolling.update();\n    }),\n  });\n\n  return () => {\n    walletPolling.destroy();\n  };\n}\n\nasync function loadInitialActivities(\n  accountId: string,\n  tokenSlugs: string[],\n  onUpdate: OnApiUpdate,\n) {\n  const result: ApiActivityTimestamps = {};\n  const bySlug: Record<string, ApiActivity[]> = {};\n\n  const chunks = await Promise.all(tokenSlugs.map(async (slug) => {\n    let activities: ApiActivity[] = await getTokenTransactionSlice(\n      accountId, slug, undefined, undefined, FIRST_TRANSACTIONS_LIMIT,\n    );\n\n    activities = await enrichActivities(accountId, activities, slug, true);\n\n    result[slug] = activities[0]?.timestamp;\n    bySlug[slug] = activities;\n\n    return activities;\n  }));\n\n  const [trxChunk, ...tokenChunks] = chunks;\n  const mainActivities = mergeActivities(trxChunk, ...tokenChunks);\n\n  mainActivities.slice().reverse().forEach((transaction) => {\n    txCallbacks.runCallbacks(transaction);\n  });\n\n  onUpdate({\n    type: 'initialActivities',\n    chain: 'tron',\n    accountId,\n    mainActivities,\n    bySlug,\n  });\n\n  return result;\n}\n\nasync function loadNewActivities(\n  accountId: string,\n  newestActivityTimestamps: ApiActivityTimestamps,\n  tokenSlugs: string[],\n  onUpdate: OnApiUpdate,\n) {\n  const result: ApiActivityTimestamps = {};\n\n  const chunks = await Promise.all(tokenSlugs.map(async (slug) => {\n    let newestActivityTimestamp = newestActivityTimestamps[slug];\n    const activities: ApiActivity[] = await getTokenTransactionSlice(\n      accountId, slug, undefined, newestActivityTimestamp, FIRST_TRANSACTIONS_LIMIT,\n    );\n\n    newestActivityTimestamp = activities[0]?.timestamp ?? newestActivityTimestamp;\n    result[slug] = newestActivityTimestamp;\n    return activities;\n  }));\n\n  const [trxChunk, ...tokenChunks] = chunks;\n  let activities = mergeActivities(trxChunk, ...tokenChunks);\n\n  activities = await enrichActivities(accountId, activities, undefined, true);\n\n  activities.slice().reverse().forEach((activity) => {\n    txCallbacks.runCallbacks(activity);\n  });\n\n  if (activities.length > 0) {\n    onUpdate({\n      type: 'newActivities',\n      chain: 'tron',\n      activities,\n      pendingActivities: [],\n      accountId,\n    });\n  }\n\n  return result;\n}\n","export const TRON_GAS = {\n  transferTrc20Estimated: 28_214_970n,\n};\n\nexport const ONE_TRX = 1_000_000n;\n","// Importing from `tronweb/lib/commonjs/types` breaks eslint (eslint doesn't like any of import placement options)\n// eslint-disable-next-line simple-import-sort/imports\nimport type { TronWeb } from 'tronweb';\n\nimport type { ApiSubmitTransferOptions, CheckTransactionDraftOptions } from '../../methods/types';\nimport type { ApiCheckTransactionDraftResult } from '../ton/types';\nimport { ApiTransactionDraftError, ApiTransactionError } from '../../types';\nimport type { ApiAccountWithMnemonic, ApiBip39Account, ApiNetwork } from '../../types';\n\nimport { parseAccountId } from '../../../util/account';\nimport { logDebugError } from '../../../util/logs';\nimport { getChainParameters, getTronClient } from './util/tronweb';\nimport { fetchStoredAccount, fetchStoredTronWallet } from '../../common/accounts';\nimport { getMnemonic } from '../../common/mnemonic';\nimport { handleServerError } from '../../errors';\nimport { getTrc20Balance, getWalletBalance } from './wallet';\nimport type { ApiSubmitTransferTronResult } from './types';\nimport { hexToString } from '../../../util/stringFormat';\nimport { ONE_TRX, TRON_GAS } from './constants';\n\nconst SIGNATURE_SIZE = 65;\n\nexport async function checkTransactionDraft(\n  options: CheckTransactionDraftOptions,\n): Promise<ApiCheckTransactionDraftResult> {\n  const {\n    accountId, amount, toAddress, tokenAddress,\n  } = options;\n  const { network } = parseAccountId(accountId);\n\n  const tronWeb = getTronClient(network);\n  const result: ApiCheckTransactionDraftResult = {};\n\n  try {\n    if (!tronWeb.isAddress(toAddress)) {\n      return { error: ApiTransactionDraftError.InvalidToAddress };\n    }\n\n    result.resolvedAddress = toAddress;\n\n    const { address } = await fetchStoredTronWallet(accountId);\n    const [trxBalance, bandwidth, { energyUnitFee, bandwidthUnitFee }] = await Promise.all([\n      getWalletBalance(network, address),\n      tronWeb.trx.getBandwidth(address),\n      getChainParameters(network),\n    ]);\n\n    let fee: bigint;\n\n    if (tokenAddress) {\n      fee = await estimateTrc20TransferFee(tronWeb, {\n        network,\n        toAddress,\n        tokenAddress,\n        amount,\n        energyUnitFee,\n        fromAddress: address,\n      });\n    } else {\n      // This call throws \"Error: Invalid amount provided\" when the amount is 0.\n      // It doesn't throw when the amount is > than the balance.\n      const [transaction, account] = await Promise.all([\n        tronWeb.transactionBuilder.sendTrx(toAddress, Number(amount ?? 1), address),\n        tronWeb.trx.getAccount(toAddress),\n      ]);\n\n      const size = 9 + 60 + Buffer.from(transaction.raw_data_hex, 'hex').byteLength + SIGNATURE_SIZE;\n      fee = bandwidth > size ? 0n : BigInt(size) * BigInt(bandwidthUnitFee);\n\n      // If the account is not activated, we pay an extra 1 TRX for activation\n      if (account.balance === undefined) {\n        fee += ONE_TRX;\n      }\n    }\n\n    result.fee = fee;\n    result.realFee = fee;\n\n    const trxAmount = tokenAddress ? fee : (amount ?? 0n) + fee;\n    const isEnoughTrx = trxBalance >= trxAmount;\n\n    if (!isEnoughTrx) {\n      result.error = ApiTransactionDraftError.InsufficientBalance;\n    }\n\n    // todo: Check that the amount ≤ the token balance (in case of a token transfer)\n\n    return result;\n  } catch (err) {\n    logDebugError('tron:checkTransactionDraft', err);\n    return {\n      ...handleServerError(err),\n      ...result,\n    };\n  }\n}\n\nexport async function submitTransfer(options: ApiSubmitTransferOptions): Promise<ApiSubmitTransferTronResult> {\n  const {\n    accountId, password, toAddress, amount, fee = 0n, tokenAddress,\n  } = options;\n\n  const { network } = parseAccountId(accountId);\n\n  try {\n    const tronWeb = getTronClient(network);\n\n    const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n    const { address } = (account as ApiBip39Account).tron;\n    const trxBalance = await getWalletBalance(network, address);\n\n    const trxAmount = tokenAddress ? fee : fee + amount;\n    const isEnoughTrx = trxBalance >= trxAmount;\n\n    if (!isEnoughTrx) {\n      return { error: ApiTransactionError.InsufficientBalance };\n    }\n\n    // todo: Check that the amount ≤ the token balance (in case of a token transfer)\n\n    const mnemonic = await getMnemonic(accountId, password, account);\n    const privateKey = tronWeb.fromMnemonic(mnemonic!.join(' ')).privateKey.slice(2);\n\n    if (tokenAddress) {\n      const { transaction } = await buildTrc20Transfer(tronWeb, {\n        toAddress, tokenAddress, amount, feeLimit: fee, fromAddress: address,\n      });\n\n      const signedTx = await tronWeb.trx.sign(transaction, privateKey);\n      const result = await tronWeb.trx.sendRawTransaction(signedTx);\n\n      return { amount, toAddress, txId: result.transaction.txID };\n    } else {\n      const result = await tronWeb.trx.sendTransaction(toAddress, Number(amount), {\n        privateKey,\n      });\n\n      if ('code' in result && !('result' in result && result.result)) {\n        const error = 'message' in result && result.message\n          ? hexToString(result.message)\n          : result.code.toString();\n\n        logDebugError('submitTransfer', { error, result });\n\n        return { error };\n      }\n\n      return { amount, toAddress, txId: result.transaction.txID };\n    }\n  } catch (err: any) {\n    logDebugError('submitTransfer', err);\n    return { error: ApiTransactionError.UnsuccesfulTransfer };\n  }\n}\n\nasync function estimateTrc20TransferFee(tronWeb: TronWeb, options: {\n  network: ApiNetwork;\n  tokenAddress: string;\n  toAddress: string;\n  amount?: bigint;\n  energyUnitFee: number;\n  fromAddress: string;\n}) {\n  const {\n    network, tokenAddress, toAddress, energyUnitFee, fromAddress,\n  } = options;\n\n  let { amount } = options;\n  const tokenBalance = await getTrc20Balance(network, tokenAddress, fromAddress);\n\n  if (!tokenBalance) {\n    return TRON_GAS.transferTrc20Estimated;\n  }\n\n  if (amount === undefined || amount > tokenBalance) {\n    amount = 1n;\n  }\n\n  // This call throws \"Error: REVERT opcode executed\" when the given amount is more than the token balance.\n  // It doesn't throw when the amount is 0.\n  const { energy_required: energyRequired } = await tronWeb.transactionBuilder.estimateEnergy(\n    tokenAddress,\n    'transfer(address,uint256)',\n    {},\n    [\n      { type: 'address', value: toAddress },\n      { type: 'uint256', value: Number(amount) },\n    ],\n    fromAddress,\n  );\n\n  return BigInt(energyUnitFee * energyRequired);\n}\n\nasync function buildTrc20Transfer(tronWeb: TronWeb, options: {\n  tokenAddress: string;\n  toAddress: string;\n  amount: bigint;\n  feeLimit: bigint;\n  fromAddress: string;\n}) {\n  const {\n    amount, tokenAddress, toAddress, feeLimit, fromAddress,\n  } = options;\n\n  const { transaction } = await tronWeb.transactionBuilder.triggerSmartContract(\n    tokenAddress,\n    'transfer(address,uint256)',\n    { feeLimit: Number(feeLimit) },\n    [\n      { type: 'address', value: toAddress },\n      { type: 'uint256', value: Number(amount) },\n    ],\n    fromAddress,\n  );\n\n  return { transaction };\n}\n","export function isAscii(str: string) {\n  for (let i = 0; i < str.length; i++) {\n    if (str.charCodeAt(i) > 127) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function insertSubstring(str: string, start: number, newSubStr: string) {\n  if (start < 0) {\n    start = str.length - start;\n  }\n  return str.slice(0, start) + newSubStr + str.slice(start);\n}\n\nexport function hexToString(hex: string): string {\n  let result = '';\n  for (let i = 0; i < hex.length; i += 2) {\n    result += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));\n  }\n\n  return result;\n}\n","import type { ApiNetwork, ApiTronWallet } from '../../types';\n\nimport { getTronClient } from './util/tronweb';\n\nexport { setupActivePolling, setupInactivePolling } from './polling';\nexport { checkTransactionDraft, submitTransfer } from './transfer';\nexport { getWalletBalance } from './wallet';\nexport { getAllTransactionSlice, getTokenTransactionSlice } from './transactions';\n\nexport function getWalletFromBip39Mnemonic(network: ApiNetwork, mnemonic: string[]): ApiTronWallet {\n  const { address, publicKey } = getTronClient(network).fromMnemonic(mnemonic.join(' '));\n  return {\n    type: 'tron',\n    address,\n    publicKey,\n    index: 0,\n  };\n}\n\nexport function checkApiAvailability(network: ApiNetwork) {\n  const isConnected = getTronClient(network).isConnected();\n  return Boolean(isConnected);\n}\n","import * as ton from './ton';\nimport * as tron from './tron';\n\nexport default {\n  ton,\n  tron,\n};\n","import { logDebugError } from '../util/logs';\n\ninterface Hooks {\n  onFirstLogin: AnyFunction;\n  onFullLogout: AnyFunction;\n  onWindowNeeded: AnyFunction;\n  onDappDisconnected: (accountId: string, url: string) => any;\n  onDappsChanged: AnyFunction;\n  onSwapCreated: (accountId: string, fromTimestamp: number) => any;\n}\n\nconst hooks: Partial<{\n  [K in keyof Hooks]: Hooks[K][];\n}> = {};\n\nexport function addHooks(partial: Partial<Hooks>) {\n  for (const [name, hook] of Object.entries(partial) as Entries<Hooks>) {\n    hooks[name] = (hooks[name] ?? []).concat([hook]);\n  }\n}\n\nexport async function callHook<T extends keyof Hooks>(name: T, ...args: Parameters<Hooks[T]>) {\n  for (const hook of hooks[name] ?? []) {\n    try {\n      // @ts-ignore\n      await hook(...args);\n    } catch (err) {\n      logDebugError(`callHooks:${name}`, err);\n    }\n  }\n}\n","import type { ApiBaseCurrency } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY } from '../../config';\nimport { storage } from '../storages';\n\nexport async function getBaseCurrency() {\n  return (await storage.getItem('baseCurrency')) ?? DEFAULT_PRICE_CURRENCY;\n}\n\nexport function setBaseCurrency(currency: ApiBaseCurrency) {\n  return storage.setItem('baseCurrency', currency);\n}\n","let resolvePromise: NoneToVoidFunction;\nconst preloadPromise = new Promise<void>((resolve) => {\n  resolvePromise = resolve;\n});\n\nexport function resolveDataPreloadPromise() {\n  resolvePromise();\n}\n\nexport async function waitDataPreload() {\n  await preloadPromise;\n}\n","import type { ApiNetwork } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport chains from '../chains';\nimport { getTokenByAddress } from '../common/tokens';\n\nconst { ton } = chains;\n\nexport { getTokenBySlug, buildTokenSlug } from '../common/tokens';\n\nexport function fetchToken(accountId: string, address: string) {\n  const { network } = parseAccountId(accountId);\n  return ton.fetchToken(network, address);\n}\n\nexport function resolveTokenWalletAddress(network: ApiNetwork, address: string, tokenAddress: string) {\n  const chain = chains.ton;\n\n  return chain.resolveTokenWalletAddress(network, address, tokenAddress);\n}\n\nexport function resolveTokenAddress(network: ApiNetwork, tokenWalletAddress: string) {\n  const chain = chains.ton;\n\n  return chain.resolveTokenAddress(network, tokenWalletAddress);\n}\n\nexport function getAmountForTokenTransfer(tokenAddress: string, willClaimMintless: boolean) {\n  const chain = chains.ton;\n  const token = getTokenByAddress(tokenAddress);\n\n  return chain.getToncoinAmountForTransfer(token, willClaimMintless);\n}\n","import { Cell } from '@ton/core';\n\nimport type { ApiSubmitTransferWithDieselResult } from '../chains/ton/types';\nimport type {\n  ApiActivity,\n  ApiChain,\n  ApiLocalTransactionParams,\n  ApiSignedTransfer,\n  ApiTransactionActivity,\n  OnApiUpdate,\n} from '../types';\nimport type { ApiSubmitTransferOptions, ApiSubmitTransferResult, CheckTransactionDraftOptions } from './types';\n\nimport { parseAccountId } from '../../util/account';\nimport { buildLocalTxId, mergeActivitiesToMaxTime } from '../../util/activities';\nimport { getChainConfig } from '../../util/chain';\nimport { logDebugError } from '../../util/logs';\nimport chains from '../chains';\nimport { fetchStoredAccount, fetchStoredAddress, fetchStoredTonWallet } from '../common/accounts';\nimport { enrichActivities } from '../common/activities';\nimport { buildLocalTransaction } from '../common/helpers';\nimport { getPendingTransfer, waitAndCreatePendingTransfer } from '../common/pendingTransfers';\nimport { FAKE_TX_ID } from '../constants';\nimport { handleServerError } from '../errors';\nimport { buildTokenSlug } from './tokens';\n\nlet onUpdate: OnApiUpdate;\n\nconst { ton, tron } = chains;\n\nexport function initTransactions(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function fetchActivitySlice(\n  accountId: string,\n  chain: ApiChain,\n  slug: string,\n  fromTimestamp?: number,\n  limit?: number,\n): Promise<ApiActivity[] | { error: string }> {\n  let activities: ApiActivity[];\n\n  try {\n    if (chain === 'ton') {\n      activities = await chains[chain].fetchActivitySlice(\n        accountId, slug, fromTimestamp, undefined, limit,\n      );\n    } else {\n      activities = await chains[chain].getTokenTransactionSlice(\n        accountId, slug, fromTimestamp, undefined, limit,\n      );\n    }\n\n    activities = await enrichActivities(accountId, activities, slug);\n\n    return activities;\n  } catch (err) {\n    logDebugError('fetchActivitySlice', err);\n    return handleServerError(err);\n  }\n}\n\nexport async function fetchAllActivitySlice(\n  accountId: string,\n  limit: number,\n  toTimestamp: number,\n  tronTokenSlugs: string[],\n): Promise<ApiActivity[] | { error: string }> {\n  try {\n    const account = await fetchStoredAccount(accountId);\n\n    const [tonActivities, tronActivities] = await Promise.all([\n      'ton' in account ? ton.fetchActivitySlice(accountId, undefined, toTimestamp, undefined, limit) : [],\n      'tron' in account ? tron.getAllTransactionSlice(accountId, toTimestamp, limit, tronTokenSlugs) : [],\n    ]);\n\n    const activities = mergeActivitiesToMaxTime(tonActivities, tronActivities);\n\n    return await enrichActivities(accountId, activities);\n  } catch (err) {\n    logDebugError('fetchAllActivitySlice', err);\n    return handleServerError(err);\n  }\n}\n\nexport function checkTransactionDraft(chain: ApiChain, options: CheckTransactionDraftOptions) {\n  return chains[chain].checkTransactionDraft(options);\n}\n\nexport async function submitTransfer(\n  chain: ApiChain,\n  options: ApiSubmitTransferOptions,\n  shouldCreateLocalActivity = true,\n): Promise<(ApiSubmitTransferResult | ApiSubmitTransferWithDieselResult) & { txId?: string }> {\n  const {\n    accountId,\n    password,\n    toAddress,\n    amount,\n    tokenAddress,\n    comment,\n    fee,\n    realFee,\n    shouldEncrypt,\n    isBase64Data,\n    withDiesel,\n    dieselAmount,\n    isGaslessWithStars,\n  } = options;\n  const stateInit = typeof options.stateInit === 'string' ? Cell.fromBase64(options.stateInit) : options.stateInit;\n\n  const fromAddress = await fetchStoredAddress(accountId, chain);\n\n  let result: ApiSubmitTransferResult | ApiSubmitTransferWithDieselResult;\n\n  if (withDiesel && chain === 'ton') {\n    result = await ton.submitTransferWithDiesel({\n      accountId,\n      password,\n      toAddress,\n      amount,\n      tokenAddress: tokenAddress!,\n      data: comment,\n      shouldEncrypt,\n      dieselAmount: dieselAmount!,\n      isGaslessWithStars,\n    });\n  } else {\n    result = await chains[chain].submitTransfer({\n      accountId,\n      password,\n      toAddress,\n      amount,\n      tokenAddress,\n      data: comment,\n      shouldEncrypt,\n      isBase64Data,\n      stateInit,\n      fee,\n    });\n  }\n\n  if ('error' in result) {\n    return result;\n  }\n\n  if (!shouldCreateLocalActivity) {\n    return result;\n  }\n\n  const slug = tokenAddress\n    ? buildTokenSlug(chain, tokenAddress)\n    : getChainConfig(chain).nativeToken.slug;\n\n  let localActivity: ApiTransactionActivity;\n\n  if ('msgHash' in result) {\n    const { encryptedComment, msgHashNormalized } = result;\n    [localActivity] = createLocalTransactions(accountId, chain, [{\n      txId: msgHashNormalized,\n      amount,\n      fromAddress,\n      toAddress,\n      comment: shouldEncrypt ? undefined : comment,\n      encryptedComment,\n      fee: realFee ?? 0n,\n      slug,\n      externalMsgHashNorm: msgHashNormalized,\n      extra: {\n        ...('withW5Gasless' in result && { withW5Gasless: result.withW5Gasless }),\n      },\n    }]);\n    if ('paymentLink' in result && result.paymentLink) {\n      onUpdate({ type: 'openUrl', url: result.paymentLink, isExternal: true });\n    }\n  } else {\n    const { txId } = result;\n    [localActivity] = createLocalTransactions(accountId, chain, [{\n      txId,\n      amount,\n      fromAddress,\n      toAddress,\n      comment,\n      fee: realFee ?? 0n,\n      slug,\n    }]);\n  }\n\n  return {\n    ...result,\n    txId: localActivity.txId,\n  };\n}\n\nexport async function waitAndCreateTonPendingTransfer(accountId: string) {\n  const { network } = parseAccountId(accountId);\n  const { address } = await fetchStoredTonWallet(accountId);\n\n  return (await waitAndCreatePendingTransfer(network, address)).id;\n}\n\nexport async function sendSignedTransferMessage(\n  accountId: string,\n  message: ApiSignedTransfer,\n  pendingTransferId: string,\n) {\n  const { msgHashNormalized } = await ton.sendSignedMessage(accountId, message, pendingTransferId);\n\n  const [localActivity] = createLocalTransactions(accountId, 'ton', [{\n    ...message.localActivity,\n    txId: msgHashNormalized,\n    externalMsgHashNorm: msgHashNormalized,\n  }]);\n\n  return localActivity.txId;\n}\n\nexport function cancelPendingTransfer(id: string) {\n  getPendingTransfer(id)?.resolve();\n}\n\nexport function decryptComment(accountId: string, encryptedComment: string, fromAddress: string, password: string) {\n  const chain = chains.ton;\n\n  return chain.decryptComment(accountId, encryptedComment, fromAddress, password);\n}\n\nexport function createLocalTransactions(\n  accountId: string,\n  chain: ApiChain,\n  params: ApiLocalTransactionParams[],\n) {\n  const { network } = parseAccountId(accountId);\n\n  const localTransactions = params.map((subParams, index) => {\n    const { toAddress } = subParams;\n\n    let normalizedAddress: string;\n    if (subParams.normalizedAddress) {\n      normalizedAddress = subParams.normalizedAddress;\n    } else if (chain === 'ton') {\n      normalizedAddress = ton.normalizeAddress(toAddress, network);\n    } else {\n      normalizedAddress = toAddress;\n    }\n\n    return buildLocalTransaction(subParams, normalizedAddress, index);\n  });\n\n  if (localTransactions.length) {\n    onUpdate({\n      type: 'newLocalActivities',\n      activities: localTransactions,\n      accountId,\n    });\n  }\n\n  return localTransactions;\n}\n\nexport function fetchEstimateDiesel(accountId: string, tokenAddress: string) {\n  const chain = chains.ton;\n\n  return chain.fetchEstimateDiesel(accountId, tokenAddress);\n}\n\nexport async function fetchTonActivityDetails(accountId: string, activity: ApiActivity) {\n  const result = await chains.ton.fetchActivityDetails(accountId, activity);\n  return result?.activity ?? activity;\n}\n\n/**\n * Creates local activities from emulation results instead of basic transaction parameters.\n * This provides richer, parsed transaction details like \"liquidity withdrawal\" instead of \"send TON\".\n */\nexport function createLocalActivitiesFromEmulation(\n  accountId: string,\n  chain: ApiChain,\n  msgHashNormalized: string,\n  emulationActivities: ApiActivity[],\n): ApiActivity[] {\n  const localActivities: ApiActivity[] = [];\n  let localActivityIndex = 0;\n\n  emulationActivities.forEach((activity) => {\n    if (activity.shouldHide || activity.id === FAKE_TX_ID) {\n      return;\n    }\n\n    const localActivity = convertEmulationActivityToLocal(\n      activity,\n      msgHashNormalized,\n      localActivityIndex,\n      chain,\n      accountId,\n    );\n\n    localActivities.push(localActivity);\n\n    localActivityIndex++; // Increment only for visible activities\n  });\n\n  if (localActivities.length) {\n    onUpdate({\n      type: 'newLocalActivities',\n      activities: localActivities,\n      accountId,\n    });\n  }\n\n  return localActivities;\n}\n\n/**\n * Converts an emulation activity to a local activity with proper ID and timestamp\n */\nfunction convertEmulationActivityToLocal(\n  activity: ApiActivity,\n  msgHashNormalized: string,\n  index: number,\n  chain: ApiChain,\n  accountId?: string,\n): ApiActivity {\n  const localTxId = buildLocalTxId(msgHashNormalized, index);\n\n  if (activity.kind === 'transaction') {\n    let normalizedAddress = activity.normalizedAddress;\n    if (!normalizedAddress && chain === 'ton' && accountId) {\n      const { network } = parseAccountId(accountId);\n      normalizedAddress = chains.ton.normalizeAddress(activity.toAddress, network);\n    }\n\n    return {\n      ...activity,\n      id: localTxId,\n      txId: localTxId,\n      timestamp: Date.now(),\n      externalMsgHashNorm: msgHashNormalized,\n      normalizedAddress: normalizedAddress || activity.normalizedAddress,\n      isPending: true,\n    };\n  } else {\n    return {\n      ...activity,\n      id: localTxId,\n      timestamp: Date.now(),\n      externalMsgHashNorm: msgHashNormalized,\n      status: 'pending',\n    };\n  }\n}\n","import { Address } from '@ton/core';\n\nimport type { ApiSubmitTransferTonResult } from '../chains/ton/types';\nimport type {\n  ApiEthenaStakingState,\n  ApiJettonStakingState,\n  ApiStakingCommonData,\n  ApiStakingCommonResponse,\n  ApiStakingHistory,\n  ApiStakingState,\n  ApiTransactionActivity,\n} from '../types';\n\nimport { TONCOIN } from '../../config';\nimport { fromDecimal } from '../../util/decimals';\nimport { logDebugError } from '../../util/logs';\nimport chains from '../chains';\nimport { getTonClient } from '../chains/ton/util/tonCore';\nimport { fetchStoredAccount, fetchStoredTonWallet } from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { setStakingCommonCache } from '../common/cache';\nimport { createLocalTransactions } from './transactions';\n\nimport { StakingPool } from '../chains/ton/contracts/JettonStaking/StakingPool';\n\nconst { ton } = chains;\n\nexport function initStaking() {\n}\n\nexport function checkStakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  return ton.checkStakeDraft(accountId, amount, state);\n}\n\nexport function checkUnstakeDraft(accountId: string, amount: bigint, state: ApiStakingState) {\n  return ton.checkUnstakeDraft(accountId, amount, state);\n}\n\nexport async function submitStake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n  realFee?: bigint,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitStake(\n    accountId, password, amount, state,\n  );\n\n  if ('error' in result) {\n    return false;\n  }\n\n  let localActivity: ApiTransactionActivity;\n\n  if (state.tokenSlug === TONCOIN.slug) {\n    [localActivity] = createLocalTransactions(accountId, 'ton', [{\n      txId: result.msgHashNormalized,\n      amount,\n      fromAddress,\n      toAddress: result.toAddress,\n      fee: realFee ?? 0n,\n      type: 'stake',\n      slug: state.tokenSlug,\n      externalMsgHashNorm: result.msgHashNormalized,\n    }]);\n  } else {\n    [localActivity] = createLocalTransactions(accountId, 'ton', [{\n      txId: result.msgHashNormalized,\n      amount,\n      fromAddress,\n      toAddress: result.toAddress,\n      fee: realFee ?? 0n,\n      type: 'stake',\n      slug: state.tokenSlug,\n      externalMsgHashNorm: result.msgHashNormalized,\n    }]);\n  }\n\n  return {\n    ...result,\n    txId: localActivity.txId,\n  };\n}\n\nexport async function submitUnstake(\n  accountId: string,\n  password: string,\n  amount: bigint,\n  state: ApiStakingState,\n  realFee?: bigint,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitUnstake(accountId, password, amount, state);\n  if ('error' in result) {\n    return false;\n  }\n\n  const [localActivity] = createLocalTransactions(accountId, 'ton', [{\n    txId: result.msgHashNormalized,\n    amount: result.toncoinAmount,\n    fromAddress,\n    toAddress: result.toAddress,\n    fee: realFee ?? 0n,\n    type: 'unstakeRequest',\n    slug: TONCOIN.slug,\n    externalMsgHashNorm: result.msgHashNormalized,\n    ...result.localActivityParams,\n  }]);\n\n  return {\n    ...result,\n    txId: localActivity.txId,\n  };\n}\n\nexport async function getStakingHistory(accountId: string): Promise<ApiStakingHistory> {\n  const { ton: tonWallet } = await fetchStoredAccount(accountId);\n  if (!tonWallet) return [];\n  return callBackendGet(`/staking/profits/${tonWallet.address}`);\n}\n\nexport async function tryUpdateStakingCommonData() {\n  try {\n    const tonClient = getTonClient('mainnet');\n    const response = await callBackendGet<ApiStakingCommonResponse>('/staking/common');\n\n    const data: ApiStakingCommonData = {\n      ...response,\n      liquid: {\n        ...response.liquid,\n        available: fromDecimal(response.liquid.available),\n      },\n      jettonPools: await Promise.all(response.jettonPools.map(async (pool) => {\n        const poolContract = tonClient.open(StakingPool.createFromAddress(Address.parse(pool.pool)));\n        const poolConfig = await poolContract.getStorageData();\n        return {\n          ...pool,\n          poolConfig,\n        };\n      })),\n    };\n    data.round.start *= 1000;\n    data.round.end *= 1000;\n    data.round.unlock *= 1000;\n    data.prevRound.start *= 1000;\n    data.prevRound.end *= 1000;\n    data.prevRound.unlock *= 1000;\n\n    setStakingCommonCache(data);\n  } catch (err) {\n    logDebugError('tryUpdateLiquidStakingState', err);\n  }\n}\n\nexport async function submitStakingClaimOrUnlock(\n  accountId: string,\n  password: string,\n  state: ApiJettonStakingState | ApiEthenaStakingState,\n  realFee?: bigint,\n) {\n  const { address: walletAddress } = await fetchStoredTonWallet(accountId);\n\n  let result: ApiSubmitTransferTonResult;\n\n  switch (state.type) {\n    case 'jetton': {\n      result = await ton.submitTokenStakingClaim(accountId, password, state);\n      break;\n    }\n    case 'ethena': {\n      result = await ton.submitUnstakeEthenaLocked(accountId, password, state);\n      break;\n    }\n  }\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const [localActivity] = createLocalTransactions(accountId, 'ton', [{\n    txId: result.msgHashNormalized,\n    amount: result.amount,\n    fromAddress: walletAddress,\n    toAddress: result.toAddress,\n    fee: realFee ?? 0n,\n    slug: TONCOIN.slug,\n    externalMsgHashNorm: result.msgHashNormalized,\n    ...result.localActivityParams,\n  }]);\n\n  return {\n    ...result,\n    txId: localActivity.txId,\n  };\n}\n","import nacl from 'tweetnacl';\n\nimport type { Theme } from '../../global/types';\nimport type { AccountCache } from '../common/cache';\nimport type { StorageKey } from '../storages/types';\nimport type { ApiChain, ApiNetwork } from '../types';\n\nimport { setIsAppFocused } from '../../util/focusAwareDelay';\nimport { getLogs, logDebugError } from '../../util/logs';\nimport chains from '../chains';\nimport { fetchStoredAccounts, fetchStoredTonWallet, updateStoredAccount } from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { updateAccountCache } from '../common/cache';\nimport { handleServerError } from '../errors';\nimport { storage } from '../storages';\n\nconst SIGN_MESSAGE = Buffer.from('MyTonWallet_AuthToken_n6i0k4w8pb');\n\nexport function checkApiAvailability(chain: ApiChain, network: ApiNetwork) {\n  return chains[chain].checkApiAvailability(network);\n}\n\nexport async function getBackendAuthToken(accountId: string, password: string) {\n  const accountWallet = await fetchStoredTonWallet(accountId);\n  let { authToken } = accountWallet;\n  const { publicKey, isInitialized } = accountWallet;\n\n  if (!authToken) {\n    const privateKey = await chains.ton.fetchPrivateKey(accountId, password);\n    const signature = nacl.sign.detached(SIGN_MESSAGE, privateKey!);\n    authToken = Buffer.from(signature).toString('base64');\n\n    await updateStoredAccount(accountId, {\n      ton: {\n        ...accountWallet,\n        authToken,\n      },\n    });\n  }\n\n  if (!isInitialized) {\n    authToken += `:${publicKey}`;\n  }\n\n  return authToken;\n}\n\nexport async function fetchAccountConfigForDebugPurposesOnly() {\n  try {\n    const [accounts, stateVersion, mnemonicsEncrypted] = await Promise.all([\n      fetchStoredAccounts(),\n      storage.getItem('stateVersion'),\n      storage.getItem('mnemonicsEncrypted' as StorageKey),\n    ]);\n\n    return JSON.stringify({ accounts, stateVersion, mnemonicsEncrypted });\n  } catch (err) {\n    logDebugError('fetchAccountConfigForDebugPurposesOnly', err);\n\n    return undefined;\n  }\n}\n\nexport function ping() {\n  return true;\n}\n\nexport function updateAccountMemoryCache(accountId: string, address: string, partial: Partial<AccountCache>) {\n  updateAccountCache(accountId, address, partial);\n}\n\nexport { setIsAppFocused, getLogs };\n\nexport async function getMoonpayOnrampUrl(chain: ApiChain, address: string, theme: Theme) {\n  try {\n    return await callBackendGet<{ url: string }>('/onramp-url', {\n      chain,\n      address,\n      theme,\n    });\n  } catch (err) {\n    logDebugError('getMoonpayOnrampUrl', err);\n\n    return handleServerError(err);\n  }\n}\n","import type { TonTransferParams } from '../chains/ton/types';\nimport type {\n  ApiChain,\n  ApiSwapActivity,\n  ApiSwapAsset,\n  ApiSwapBuildRequest,\n  ApiSwapBuildResponse,\n  ApiSwapCexCreateTransactionRequest,\n  ApiSwapCexCreateTransactionResponse,\n  ApiSwapCexEstimateRequest,\n  ApiSwapCexEstimateResponse,\n  ApiSwapEstimateRequest,\n  ApiSwapEstimateResponse,\n  ApiSwapHistoryItem,\n  ApiSwapPairAsset,\n  ApiSwapTonAsset,\n  ApiSwapTransfer,\n  OnApiUpdate,\n} from '../types';\nimport type { ApiSubmitTransferOptions } from './types';\n\nimport { SWAP_API_VERSION, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { buildLocalTxId } from '../../util/activities';\nimport { omitUndefined } from '../../util/iteratees';\nimport chains from '../chains';\nimport { fetchStoredTonWallet } from '../common/accounts';\nimport { callBackendGet, callBackendPost } from '../common/backend';\nimport {\n  getSwapItemSlug, patchSwapItem, swapGetHistoryItem, swapItemToActivity,\n} from '../common/swap';\nimport { ApiServerError } from '../errors';\nimport { callHook } from '../hooks';\nimport { getBackendAuthToken } from './other';\nimport { submitTransfer } from './transactions';\n\nconst ton = chains.ton;\n\nlet onUpdate: OnApiUpdate;\n\nexport function initSwap(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function swapBuildTransfer(\n  accountId: string,\n  password: string,\n  request: ApiSwapBuildRequest,\n) {\n  const { network } = parseAccountId(accountId);\n  const authToken = await getBackendAuthToken(accountId, password);\n\n  const { address, version } = await fetchStoredTonWallet(accountId);\n  request.walletVersion = version;\n\n  const { id, transfers } = await swapBuild(authToken, request);\n\n  const transferList = transfers.map((transfer) => ({\n    ...transfer,\n    amount: BigInt(transfer.amount),\n    isBase64Payload: true,\n  }));\n\n  try {\n    await ton.validateDexSwapTransfers(network, address, request, transferList);\n\n    const result = await ton.checkMultiTransactionDraft(accountId, transferList, request.shouldTryDiesel);\n\n    if ('error' in result) {\n      await patchSwapItem({\n        address, swapId: id, authToken, error: result.error,\n      });\n      return result;\n    }\n\n    return { ...result, id, transfers };\n  } catch (err: any) {\n    await patchSwapItem({\n      address, swapId: id, authToken, error: errorToString(err),\n    });\n    throw err;\n  }\n}\n\nexport async function swapSubmit(\n  accountId: string,\n  password: string,\n  transfers: ApiSwapTransfer[],\n  historyItem: ApiSwapHistoryItem,\n  isGasless?: boolean,\n) {\n  const swapId = historyItem.id;\n  const tonWallet = await fetchStoredTonWallet(accountId);\n\n  const { address } = tonWallet;\n  const authToken = tonWallet.authToken ?? await getBackendAuthToken(accountId, password);\n\n  try {\n    const transferList: TonTransferParams[] = transfers.map((transfer) => ({\n      ...transfer,\n      amount: BigInt(transfer.amount),\n      isBase64Payload: true,\n    }));\n\n    if (historyItem.from !== TONCOIN.symbol) {\n      transferList[0] = await ton.insertMintlessPayload('mainnet', address, historyItem.from, transferList[0]);\n    }\n\n    const result = await ton.submitMultiTransfer({\n      accountId,\n      password,\n      messages: transferList,\n      isGasless,\n    });\n\n    if ('error' in result) {\n      await patchSwapItem({\n        address, swapId, authToken, error: result.error,\n      });\n      return result;\n    }\n\n    delete result.messages[0].stateInit;\n\n    const from = getSwapItemSlug(historyItem, historyItem.from);\n    const to = getSwapItemSlug(historyItem, historyItem.to);\n\n    const swap: ApiSwapActivity = {\n      ...historyItem,\n      id: buildLocalTxId(result.msgHashNormalized),\n      from,\n      to,\n      kind: 'swap',\n      externalMsgHashNorm: result.msgHashNormalized,\n      extra: omitUndefined({\n        withW5Gasless: result.withW5Gasless,\n      }),\n    };\n\n    onUpdate({\n      type: 'newLocalActivities',\n      accountId,\n      activities: [swap],\n    });\n\n    await patchSwapItem({\n      address, swapId, authToken, msgHash: result.msgHash,\n    });\n\n    void callHook('onSwapCreated', accountId, swap.timestamp - 1);\n\n    return { activityId: swap.id };\n  } catch (err: any) {\n    await patchSwapItem({\n      address, swapId, authToken, error: errorToString(err),\n    });\n    throw err;\n  }\n}\n\nfunction errorToString(err: Error | string) {\n  return typeof err === 'string' ? err : err.stack;\n}\n\nexport async function fetchSwaps(accountId: string, ids: string[]) {\n  const { address } = await fetchStoredTonWallet(accountId);\n  const results = await Promise.allSettled(\n    ids.map((id) => swapGetHistoryItem(address, id.replace('swap:', ''))),\n  );\n\n  const nonExistentIds: string[] = [];\n\n  const swaps = results\n    .map((result, i) => {\n      if (result.status === 'rejected') {\n        if (result.reason instanceof ApiServerError && result.reason.statusCode === 404) {\n          nonExistentIds.push(ids[i]);\n        }\n        return undefined;\n      }\n\n      return swapItemToActivity(result.value);\n    })\n    .filter(Boolean);\n\n  return { nonExistentIds, swaps };\n}\n\nexport async function swapEstimate(\n  accountId: string,\n  request: ApiSwapEstimateRequest,\n): Promise<ApiSwapEstimateResponse | { error: string }> {\n  const walletVersion = (await fetchStoredTonWallet(accountId)).version;\n\n  return callBackendPost('/swap/ton/estimate', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n    walletVersion,\n  }, {\n    isAllowBadRequest: true,\n  });\n}\n\nexport function swapBuild(authToken: string, request: ApiSwapBuildRequest): Promise<ApiSwapBuildResponse> {\n  return callBackendPost('/swap/ton/build', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n    isMsgHashMode: true,\n  }, {\n    authToken,\n  });\n}\n\nexport function swapGetAssets(): Promise<ApiSwapAsset[]> {\n  return callBackendGet('/swap/assets');\n}\n\nexport function swapGetTonCurrencies(): Promise<ApiSwapTonAsset[]> {\n  return callBackendGet('/swap/ton/tokens');\n}\n\nexport function swapGetPairs(symbolOrTokenAddress: string): Promise<ApiSwapPairAsset[]> {\n  return callBackendGet('/swap/pairs', { asset: symbolOrTokenAddress });\n}\n\nexport function swapCexEstimate(\n  request: ApiSwapCexEstimateRequest,\n): Promise<ApiSwapCexEstimateResponse | { error: string }> {\n  return callBackendPost<ApiSwapCexEstimateResponse | { error: string }>(\n    '/swap/cex/estimate',\n    request,\n    { isAllowBadRequest: true },\n  );\n}\n\nexport function swapCexValidateAddress(params: { slug: string; address: string }): Promise<{\n  result: boolean;\n  message?: string;\n}> {\n  return callBackendGet('/swap/cex/validate-address', params);\n}\n\nexport async function swapCexCreateTransaction(\n  accountId: string,\n  password: string,\n  request: ApiSwapCexCreateTransactionRequest,\n): Promise<{\n    swap: ApiSwapHistoryItem;\n    activity: ApiSwapActivity;\n  }> {\n  const authToken = await getBackendAuthToken(accountId, password);\n\n  const { swap } = await callBackendPost<ApiSwapCexCreateTransactionResponse>('/swap/cex/createTransaction', {\n    ...request,\n    swapVersion: SWAP_API_VERSION,\n  }, {\n    authToken,\n  });\n\n  const activity = swapItemToActivity(swap);\n\n  onUpdate({\n    type: 'newActivities',\n    accountId,\n    activities: [activity],\n  });\n\n  void callHook('onSwapCreated', accountId, swap.timestamp - 1);\n\n  return { swap, activity };\n}\n\nexport async function swapCexSubmit(chain: ApiChain, transferOptions: ApiSubmitTransferOptions, swapId: string) {\n  const result = await submitTransfer(chain, transferOptions, false);\n\n  if (chain === 'ton' && 'msgHash' in result) {\n    const { accountId, password } = transferOptions;\n    const { address } = await fetchStoredTonWallet(accountId);\n    const authToken = await getBackendAuthToken(accountId, password);\n    await patchSwapItem({ address, authToken, msgHash: result.msgHash, swapId });\n  }\n\n  return result;\n}\n","import type {\n  ApiAccountAny,\n  ApiAccountConfig,\n  ApiAccountWithMnemonic,\n  ApiActivityTimestamps,\n  ApiBackendConfig,\n  ApiChain,\n  ApiNetwork,\n  ApiSwapAsset,\n  ApiTokenDetails,\n  ApiTokenWithPrice,\n  ApiUpdatingStatus,\n  OnApiUpdate,\n} from '../types';\n\nimport { IS_AIR_APP, IS_CORE_WALLET, IS_STAKING_DISABLED, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { getChainConfig } from '../../util/chain';\nimport { omit } from '../../util/iteratees';\nimport { logDebugError } from '../../util/logs';\nimport { OrGate } from '../../util/orGate';\nimport { forbidConcurrency } from '../../util/schedulers';\nimport chains from '../chains';\nimport { fetchMaybeStoredAccount, fetchStoredAccount, fetchStoredAccounts } from '../common/accounts';\nimport { tryUpdateKnownAddresses } from '../common/addresses';\nimport { callBackendGet, callBackendPost } from '../common/backend';\nimport { setBackendConfigCache } from '../common/cache';\nimport { pollingLoop } from '../common/polling/utils';\nimport { getBaseCurrency } from '../common/prices';\nimport { getTokensCache, loadTokensCache, tokensPreload, updateTokens } from '../common/tokens';\nimport { MINUTE, SEC } from '../constants';\nimport { resolveDataPreloadPromise } from './preload';\nimport { tryUpdateStakingCommonData } from './staking';\nimport { swapGetAssets } from './swap';\n\nconst BACKEND_INTERVAL = 30 * SEC;\nconst LONG_BACKEND_INTERVAL = MINUTE;\nconst INCORRECT_TIME_DIFF = 30 * SEC;\n\nconst ACCOUNT_CONFIG_INTERVAL = { focused: MINUTE, notFocused: 10 * MINUTE };\n\nconst MAX_POST_TOKENS = 1000;\n\nlet onUpdate: OnApiUpdate;\nlet stopCommonBackendPolling: NoneToVoidFunction | undefined;\nlet stopActiveAccountPolling: NoneToVoidFunction | undefined;\nconst inactiveAccountPolling = IS_AIR_APP ? createInactiveAccountsPollingManager() : undefined;\nconst setUpdatingStatus = createUpdatingStatusManager();\n\nexport function initPolling(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n\n  void loadTokensCache();\n\n  void Promise.allSettled([\n    tryUpdateKnownAddresses(),\n    tryUpdateTokens(),\n    !IS_STAKING_DISABLED && tryUpdateSwapTokens(),\n    tryUpdateStakingCommonData(),\n  ]).then(() => resolveDataPreloadPromise());\n\n  void tryUpdateConfig();\n\n  stopCommonBackendPolling?.();\n  stopCommonBackendPolling = setupCommonBackendPolling();\n}\n\nexport async function destroyPolling() {\n  stopCommonBackendPolling?.();\n  stopCommonBackendPolling = undefined;\n  removeAllPollingAccounts();\n  await setActivePollingAccount(undefined, {});\n}\n\nfunction setupCommonBackendPolling() {\n  const stopFns = [\n    pollingLoop({\n      period: BACKEND_INTERVAL,\n      skipInitialPoll: true,\n      poll: tryUpdateTokens,\n    }).stop,\n    pollingLoop({\n      period: LONG_BACKEND_INTERVAL,\n      skipInitialPoll: true,\n      async poll() {\n        await Promise.all([\n          tryUpdateKnownAddresses(),\n          !IS_STAKING_DISABLED && tryUpdateStakingCommonData(),\n          tryUpdateConfig(),\n          tryUpdateSwapTokens(),\n        ]);\n      },\n    }).stop,\n  ];\n\n  return () => {\n    for (const stopFn of stopFns) {\n      stopFn();\n    }\n  };\n}\n\nexport async function tryUpdateTokens() {\n  try {\n    const baseCurrency = await getBaseCurrency();\n\n    const tokens = await callBackendGet<ApiTokenWithPrice[]>('/assets', { base: baseCurrency });\n    for (const token of tokens) {\n      token.isFromBackend = true;\n    }\n\n    await tokensPreload.promise;\n    const tokensCache = getTokensCache();\n\n    const nonBackendTokenAddresses = Object.values(tokensCache.bySlug).reduce((result, token) => {\n      if (!token.isFromBackend && token.tokenAddress) {\n        result.push(token.tokenAddress);\n      }\n      return result;\n    }, [] as string[]);\n\n    // POST is used to retrieve data due to the potentially large number of addresses\n    const nonBackendTokenDetails = nonBackendTokenAddresses.length\n      ? await callBackendPost<ApiTokenDetails[]>(`/assets?base=${baseCurrency}`, {\n        assets: nonBackendTokenAddresses.slice(0, MAX_POST_TOKENS),\n      }) : undefined;\n\n    await updateTokens(tokens, onUpdate, nonBackendTokenDetails, baseCurrency, true);\n  } catch (err) {\n    logDebugError('tryUpdateTokens', err);\n  }\n}\n\nexport async function tryUpdateSwapTokens() {\n  try {\n    const assets = await swapGetAssets();\n\n    await tokensPreload.promise;\n    const tokensCache = getTokensCache();\n\n    const tokens = assets.reduce((acc: Record<string, ApiSwapAsset>, asset) => {\n      acc[asset.slug] = {\n        // Fix legacy variable names\n        ...omit(asset as any, ['blockchain']) as ApiSwapAsset,\n        chain: 'blockchain' in asset ? asset.blockchain as string : asset.chain,\n        tokenAddress: 'contract' in asset && asset.contract !== TONCOIN.symbol\n          ? asset.contract as string\n          : asset.tokenAddress,\n        price: tokensCache.bySlug[asset.slug]?.price ?? 0,\n      };\n      return acc;\n    }, {});\n\n    onUpdate({\n      type: 'updateSwapTokens',\n      tokens,\n    });\n  } catch (err) {\n    logDebugError('tryUpdateSwapTokens', err);\n  }\n}\n\nexport async function tryUpdateConfig() {\n  try {\n    const config = await callBackendGet<ApiBackendConfig>('/utils/get-config');\n    setBackendConfigCache(config);\n\n    const {\n      isLimited,\n      isCopyStorageEnabled = false,\n      supportAccountsCount = 1,\n      now: serverUtc,\n      country: countryCode,\n      isUpdateRequired: isAppUpdateRequired,\n    } = config;\n\n    onUpdate({\n      type: 'updateConfig',\n      isLimited,\n      isCopyStorageEnabled,\n      supportAccountsCount,\n      countryCode,\n      isAppUpdateRequired,\n    });\n\n    const localUtc = (new Date()).getTime();\n    if (Math.abs(serverUtc - localUtc) > INCORRECT_TIME_DIFF) {\n      onUpdate({\n        type: 'incorrectTime',\n      });\n    }\n  } catch (err) {\n    logDebugError('tryUpdateRegion', err);\n  }\n}\n\n/** Call it every time the active account changes */\nexport async function setActivePollingAccount(\n  accountId: string | undefined,\n  newestActivityTimestamps: ApiActivityTimestamps,\n) {\n  stopActiveAccountPolling?.();\n  stopActiveAccountPolling = undefined;\n\n  inactiveAccountPolling?.setActiveAccount(accountId);\n\n  if (accountId) {\n    const account = await fetchStoredAccount(accountId);\n\n    const stopPollingFns = [\n      !IS_CORE_WALLET && setupAccountConfigPolling(accountId, account).stop,\n\n      ...(Object.keys(chains) as (keyof typeof chains)[]).map((chain) => (\n        chains[chain].setupActivePolling(\n          accountId,\n          account,\n          onUpdate,\n          setUpdatingStatus.bind(undefined, accountId, chain),\n          pickChainTimestamps(newestActivityTimestamps, chain),\n        )\n      )),\n    ];\n\n    stopActiveAccountPolling = () => {\n      for (const stopFn of stopPollingFns) {\n        if (stopFn) {\n          stopFn();\n        }\n      }\n    };\n  }\n}\n\n/** Call it every time a new account is created */\nexport function addPollingAccount(accountId: string, account: ApiAccountAny) {\n  inactiveAccountPolling?.addAccount(accountId, account);\n}\n\n/** Call it every time an account is removed (except for cases in the other remove...account functions) */\nexport function removePollingAccount(accountId: string) {\n  inactiveAccountPolling?.removeAccount(accountId);\n}\n\n/** Call it every time all accounts of a network are removed */\nexport function removeNetworkPollingAccounts(network: ApiNetwork) {\n  inactiveAccountPolling?.removeNetworkAccounts(network);\n}\n\n/** Call it every time all accounts are removed */\nexport function removeAllPollingAccounts() {\n  inactiveAccountPolling?.removeAllAccounts();\n}\n\nfunction setupAccountConfigPolling(accountId: string, account: ApiAccountAny) {\n  let lastResult: ApiAccountConfig | undefined;\n\n  const partialAccount = omit(account as ApiAccountWithMnemonic, ['mnemonicEncrypted']);\n\n  return pollingLoop({\n    period: ACCOUNT_CONFIG_INTERVAL,\n    async poll() {\n      try {\n        const accountConfig = await callBackendPost<ApiAccountConfig>('/account-config', partialAccount);\n\n        if (!areDeepEqual(accountConfig, lastResult)) {\n          lastResult = accountConfig;\n          onUpdate({\n            type: 'updateAccountConfig',\n            accountId,\n            accountConfig,\n          });\n        }\n      } catch (err) {\n        logDebugError('setupBackendAccountPolling', err);\n      }\n    },\n  });\n}\n\n/**\n * Returns a stateful function that receives updating statuses from multiple chains and merges them together into a\n * single set of consistent 'updatingStatus' events for the UI.\n */\nfunction createUpdatingStatusManager() {\n  const updatingStatuses = new Map<string, OrGate<ApiChain>>();\n\n  return (accountId: string, chain: ApiChain, kind: ApiUpdatingStatus['kind'], isUpdating: boolean) => {\n    const key = `${accountId} ${kind}`;\n    let chainsBeingUpdated = updatingStatuses.get(key);\n    if (!chainsBeingUpdated) {\n      chainsBeingUpdated = new OrGate<ApiChain>((isUpdating) => {\n        onUpdate({ type: 'updatingStatus', kind, accountId, isUpdating });\n      });\n      updatingStatuses.set(key, chainsBeingUpdated);\n    }\n\n    chainsBeingUpdated.toggle(chain, isUpdating);\n  };\n}\n\n/**\n * Manages polling for the inactive accounts.\n * The goal is polling the accounts from the network of the current active account, but not the active account itself.\n *\n * @todo: Deduplicate polling the same addresses, if multiple accounts have it\n */\nfunction createInactiveAccountsPollingManager() {\n  const stopByAccount: Record<string, NoneToVoidFunction> = {};\n  let activeAccountId: string | undefined;\n\n  async function setActiveAccount(accountId: string | undefined) {\n    if (accountId === activeAccountId) {\n      return;\n    }\n\n    if (accountId === undefined) {\n      stopAllPollings();\n      return;\n    }\n\n    if (!activeAccountId || parseAccountId(accountId).network !== parseAccountId(activeAccountId).network) {\n      await switchNetwork(accountId);\n      return;\n    }\n\n    const previousActiveAccountId = activeAccountId;\n    activeAccountId = accountId;\n\n    // Stop polling the now active account\n    stopByAccount[activeAccountId]?.();\n    delete stopByAccount[activeAccountId];\n\n    // Start polling the previous active account\n    const previousActiveAccount = await fetchMaybeStoredAccount(previousActiveAccountId);\n    if (previousActiveAccount) { // The previously active account may get removed at this moment\n      startAccountPolling(previousActiveAccountId, previousActiveAccount);\n    }\n  }\n\n  function addAccount(accountId: string, account: ApiAccountAny) {\n    const isActiveAccount = accountId === activeAccountId;\n    const isCurrentNetwork = activeAccountId\n      && parseAccountId(accountId).network === parseAccountId(activeAccountId).network;\n\n    if (!isActiveAccount && isCurrentNetwork) {\n      startAccountPolling(accountId, account);\n    }\n  }\n\n  function removeAccount(accountId: string) {\n    stopByAccount[accountId]?.();\n    delete stopByAccount[accountId];\n  }\n\n  function removeNetworkAccounts(network: ApiNetwork) {\n    if (activeAccountId && parseAccountId(activeAccountId).network === network) {\n      // Inactive account polling must poll only the network of the active account, so removing the network means removing all account\n      stopAllPollings();\n    }\n  }\n\n  function removeAllAccounts() {\n    stopAllPollings();\n  }\n\n  async function switchNetwork(newActiveAccountId: string) {\n    stopAllPollings();\n    activeAccountId = newActiveAccountId;\n    const { network } = parseAccountId(activeAccountId);\n    const accounts = await fetchStoredAccounts();\n    const otherAccountIds = Object.keys(accounts).filter((accountId) => (\n      accountId !== activeAccountId\n      && parseAccountId(accountId).network === network\n    ));\n    otherAccountIds.map((accountId) => startAccountPolling(accountId, accounts[accountId]));\n  }\n\n  function startAccountPolling(accountId: string, account: ApiAccountAny) {\n    if (stopByAccount[accountId]) return;\n\n    const stopFns = Object.values(chains).map((chain) => chain.setupInactivePolling(accountId, account, onUpdate));\n    stopByAccount[accountId] = () => {\n      for (const stopChain of stopFns) {\n        stopChain();\n      }\n    };\n  }\n\n  function stopAllPollings() {\n    for (const [accountId, stopAccountPolling] of Object.entries(stopByAccount)) {\n      stopAccountPolling();\n      delete stopByAccount[accountId];\n    }\n  }\n\n  const preventRaceCondition = forbidConcurrency as\n    <Args extends unknown[]>(task: (...args: Args) => unknown) => (...args: Args) => void;\n\n  return {\n    setActiveAccount: preventRaceCondition(setActiveAccount),\n    addAccount: preventRaceCondition(addAccount),\n    removeAccount: preventRaceCondition(removeAccount),\n    removeNetworkAccounts: preventRaceCondition(removeNetworkAccounts),\n    removeAllAccounts: preventRaceCondition(removeAllAccounts),\n  };\n}\n\nfunction pickChainTimestamps(bySlug: ApiActivityTimestamps, chain: ApiChain) {\n  const { slug: nativeSlug } = getChainConfig(chain).nativeToken;\n  return Object.entries(bySlug).reduce((newBySlug, [slug, timestamp]) => {\n    if (slug === nativeSlug || slug.startsWith(`${chain}-`)) {\n      newBySlug[slug] = timestamp;\n    }\n    return newBySlug;\n  }, {} as ApiActivityTimestamps);\n}\n","import type { ApiActivityTimestamps, ApiLedgerAccount, ApiTonWallet, OnApiUpdate } from '../types';\n\nimport { IS_EXTENSION } from '../../config';\nimport { fetchStoredAccount, fetchStoredTonWallet, getCurrentAccountId, loginResolve } from '../common/accounts';\nimport { waitStorageMigration } from '../common/helpers';\nimport { sendUpdateTokens } from '../common/tokens';\nimport { callHook } from '../hooks';\nimport { storage } from '../storages';\nimport { setActivePollingAccount } from './polling';\n\nlet onUpdate: OnApiUpdate;\n\nexport function initAccounts(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function activateAccount(accountId: string, newestActivityTimestamps: ApiActivityTimestamps = {}) {\n  await waitStorageMigration();\n\n  const prevAccountId = await getCurrentAccountId();\n  const isFirstLogin = !prevAccountId;\n\n  await storage.setItem('currentAccountId', accountId);\n  loginResolve();\n\n  if (IS_EXTENSION) {\n    void callHook('onFirstLogin');\n  }\n\n  if (isFirstLogin) {\n    sendUpdateTokens(onUpdate);\n  }\n\n  void setActivePollingAccount(accountId, newestActivityTimestamps);\n}\n\nexport async function deactivateAllAccounts() {\n  void setActivePollingAccount(undefined, {});\n  await storage.removeItem('currentAccountId');\n\n  if (IS_EXTENSION) {\n    void callHook('onFullLogout');\n  }\n}\n\nexport function fetchTonWallet(accountId: string): Promise<ApiTonWallet> {\n  return fetchStoredTonWallet(accountId);\n}\n\nexport function fetchLedgerAccount(accountId: string) {\n  return fetchStoredAccount<ApiLedgerAccount>(accountId);\n}\n","import type {\n  ApiDapp, ApiDappsByUrl, ApiDappsState, ApiNetwork, ApiSite, ApiSiteCategory, OnApiUpdate,\n} from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport isEmptyObject from '../../util/isEmptyObject';\nimport {\n  getAccountValue,\n  removeAccountValue,\n  removeNetworkAccountsValue,\n  setAccountValue,\n} from '../common/accounts';\nimport { callBackendGet } from '../common/backend';\nimport { isUpdaterAlive } from '../common/helpers';\nimport { callHook } from '../hooks';\nimport { storage } from '../storages';\n\nlet onUpdate: OnApiUpdate;\n\nexport function initDapps(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function updateDapp(\n  accountId: string,\n  url: string,\n  uniqueId: string,\n  update: Partial<ApiDapp>,\n) {\n  const dapp = await getDapp(accountId, url, uniqueId);\n  if (!dapp) return;\n  await addDapp(accountId, { ...dapp, ...update }, uniqueId);\n}\n\nexport async function getDapp(\n  accountId: string,\n  url: string,\n  uniqueId: string,\n): Promise<ApiDapp | undefined> {\n  const byUrl = (\n    await getAccountValue(accountId, 'dapps') as ApiDappsByUrl | undefined\n  )?.[url];\n  if (!byUrl) return undefined;\n\n  return byUrl[uniqueId];\n}\n\nexport async function addDapp(accountId: string, dapp: ApiDapp, uniqueId: string) {\n  const dapps = await getDappsByUrl(accountId);\n\n  if (!dapps[dapp.url]) {\n    dapps[dapp.url] = {};\n  }\n\n  dapps[dapp.url][uniqueId] = dapp;\n  await setAccountValue(accountId, 'dapps', dapps);\n}\n\nexport async function deleteDapp(\n  accountId: string,\n  url: string,\n  uniqueId: string,\n  dontNotifyDapp?: boolean,\n) {\n  const dapps = await getDappsByUrl(accountId);\n  if (!(url in dapps)) {\n    return false;\n  }\n\n  delete dapps[url][uniqueId];\n  if (isEmptyObject(dapps[url])) {\n    delete dapps[url];\n  }\n\n  await setAccountValue(accountId, 'dapps', dapps);\n\n  if (onUpdate && isUpdaterAlive(onUpdate)) {\n    onUpdate({\n      type: 'dappDisconnect',\n      accountId,\n      url,\n    });\n  }\n\n  if (!dontNotifyDapp) {\n    await callHook('onDappDisconnected', accountId, url);\n  }\n\n  await callHook('onDappsChanged');\n\n  return true;\n}\n\nexport async function deleteAllDapps(accountId: string) {\n  const urls = Object.keys(await getDappsByUrl(accountId));\n  await setAccountValue(accountId, 'dapps', {});\n\n  urls.forEach((url) => {\n    onUpdate({\n      type: 'dappDisconnect',\n      accountId,\n      url,\n    });\n    void callHook('onDappDisconnected', accountId, url);\n  });\n\n  await callHook('onDappsChanged');\n}\n\nexport async function getDapps(accountId: string): Promise<ApiDapp[]> {\n  const byUrl = await getDappsByUrl(accountId);\n  return Object.values(byUrl).flatMap((byId) => Object.values(byId));\n}\n\nexport async function getDappsByUrl(accountId: string): Promise<ApiDappsByUrl> {\n  return (await getAccountValue(accountId, 'dapps')) || {};\n}\n\nexport async function findLastConnectedAccount(network: ApiNetwork, url: string) {\n  const dapps = await getDappsState() || {};\n\n  let connectedAt = 0;\n  let lastConnectedAccountId: string | undefined;\n\n  Object.entries(dapps).forEach(([accountId, byUrl]) => {\n    const connections = byUrl[url];\n    if (!connections) return;\n    if (parseAccountId(accountId).network !== network) return;\n\n    Object.values(connections).forEach((conn) => {\n      if (conn.connectedAt > connectedAt) {\n        connectedAt = conn.connectedAt;\n        lastConnectedAccountId = accountId;\n      }\n    });\n  });\n\n  return lastConnectedAccountId;\n}\n\nexport function getDappsState(): Promise<ApiDappsState | undefined> {\n  return storage.getItem('dapps');\n}\n\nexport async function removeAccountDapps(accountId: string) {\n  await removeAccountValue(accountId, 'dapps');\n\n  void callHook('onDappsChanged');\n}\n\nexport async function removeAllDapps() {\n  await storage.removeItem('dapps');\n\n  await callHook('onDappsChanged');\n}\n\nexport function removeNetworkDapps(network: ApiNetwork) {\n  return removeNetworkAccountsValue(network, 'dapps');\n}\n\nexport function getSseLastEventId(): Promise<string | undefined> {\n  return storage.getItem('sseLastEventId');\n}\n\nexport function setSseLastEventId(lastEventId: string) {\n  return storage.setItem('sseLastEventId', lastEventId);\n}\n\nexport function loadExploreSites(\n  { isLandscape }: { isLandscape: boolean },\n): Promise<{ categories: ApiSiteCategory[]; sites: ApiSite[] }> {\n  return callBackendGet('/v2/dapp/catalog', { isLandscape });\n}\n","import type { GlobalState } from '../../global/types';\nimport type { LedgerWalletInfo } from '../../util/ledger/types';\nimport type { ApiTonWalletVersion } from '../chains/ton/types';\nimport type {\n  ApiAccountAny,\n  ApiAccountWithMnemonic,\n  ApiActivityTimestamps,\n  ApiImportAddressByChain,\n  ApiLedgerDriver,\n  ApiNetwork,\n  ApiTonAccount,\n  ApiTonWallet,\n  ApiViewAccount,\n} from '../types';\nimport { ApiCommonError } from '../types';\n\nimport { DEFAULT_WALLET_VERSION, IS_BIP39_MNEMONIC_ENABLED, IS_CORE_WALLET } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport isMnemonicPrivateKey from '../../util/isMnemonicPrivateKey';\nimport { createTaskQueue } from '../../util/schedulers';\nimport chains from '../chains';\nimport { toBase64Address } from '../chains/ton/util/tonCore';\nimport {\n  fetchStoredAccounts,\n  fetchStoredTonAccount,\n  getAddressesFromAccount,\n  getNewAccountId,\n  removeAccountValue,\n  removeNetworkAccountsValue,\n  setAccountValue,\n  updateStoredAccount,\n} from '../common/accounts';\nimport {\n  decryptMnemonic,\n  encryptMnemonic,\n  generateBip39Mnemonic,\n  validateBip39Mnemonic,\n} from '../common/mnemonic';\nimport { tokenRepository } from '../db';\nimport { getEnvironment } from '../environment';\nimport { handleServerError } from '../errors';\nimport { storage } from '../storages';\nimport { activateAccount, deactivateAllAccounts } from './accounts';\nimport { removeAccountDapps, removeAllDapps, removeNetworkDapps } from './dapps';\nimport {\n  addPollingAccount,\n  removeAllPollingAccounts,\n  removeNetworkPollingAccounts,\n  removePollingAccount,\n} from './polling';\n\nconst { ton, tron } = chains;\n\nexport function generateMnemonic(isBip39: boolean) {\n  if (isBip39) return generateBip39Mnemonic();\n  return ton.generateMnemonic();\n}\n\nexport function createWallet(\n  network: ApiNetwork,\n  mnemonic: string[],\n  password: string,\n  version?: ApiTonWalletVersion,\n) {\n  if (!version) version = DEFAULT_WALLET_VERSION;\n\n  return importMnemonic(network, mnemonic, password, version);\n}\n\nexport function validateMnemonic(mnemonic: string[]) {\n  return (validateBip39Mnemonic(mnemonic) && IS_BIP39_MNEMONIC_ENABLED) || chains.ton.validateMnemonic(mnemonic);\n}\n\nexport async function importMnemonic(\n  network: ApiNetwork,\n  mnemonic: string[],\n  password: string,\n  version?: ApiTonWalletVersion,\n) {\n  const isPrivateKey = isMnemonicPrivateKey(mnemonic);\n  let isBip39Mnemonic = validateBip39Mnemonic(mnemonic);\n  const isTonMnemonic = await ton.validateMnemonic(mnemonic);\n\n  if (!isPrivateKey && !isTonMnemonic && (!isBip39Mnemonic || !IS_BIP39_MNEMONIC_ENABLED)) {\n    throw new Error('Invalid mnemonic');\n  }\n\n  const mnemonicEncrypted = await encryptMnemonic(mnemonic, password);\n\n  // This is a defensive approach against potential corrupted encryption reported by some users\n  const decryptedMnemonic = await decryptMnemonic(mnemonicEncrypted, password)\n    .catch(() => undefined);\n\n  if (!password || !decryptedMnemonic) {\n    return { error: ApiCommonError.DebugError };\n  }\n\n  let account: ApiAccountAny;\n  let tonWallet: ApiTonWallet & { lastTxId?: string } | undefined;\n\n  try {\n    if (isBip39Mnemonic && isTonMnemonic) {\n      tonWallet = await ton.getWalletFromMnemonic(mnemonic, network, version);\n      if (tonWallet.lastTxId) {\n        isBip39Mnemonic = false;\n      }\n    }\n\n    if (isBip39Mnemonic) {\n      const tronWallet = tron.getWalletFromBip39Mnemonic(network, mnemonic);\n      tonWallet = await ton.getWalletFromBip39Mnemonic(network, mnemonic);\n\n      account = {\n        type: 'bip39',\n        mnemonicEncrypted,\n        tron: tronWallet,\n        ton: tonWallet,\n      };\n    } else {\n      if (!tonWallet) {\n        tonWallet = isPrivateKey\n          ? await ton.getWalletFromPrivateKey(mnemonic[0], network, version)\n          : await ton.getWalletFromMnemonic(mnemonic, network, version);\n      }\n      account = {\n        type: 'ton',\n        mnemonicEncrypted,\n        ton: tonWallet,\n      };\n    }\n\n    const accountId = await addAccount(network, account);\n    const secondNetworkAccount = IS_CORE_WALLET ? await createAccountWithSecondNetwork({\n      accountId, network, mnemonic, mnemonicEncrypted, version,\n    }) : undefined;\n    void activateAccount(accountId);\n\n    return {\n      accountId,\n      addressByChain: getAddressesFromAccount(account),\n      secondNetworkAccount,\n    };\n  } catch (err) {\n    return handleServerError(err);\n  }\n}\n\nexport async function createAccountWithSecondNetwork(options: {\n  accountId: string;\n  network: ApiNetwork;\n  mnemonic: string[];\n  mnemonicEncrypted: string;\n  version?: ApiTonWalletVersion;\n}): Promise<GlobalState['auth']['secondNetworkAccount']> {\n  const {\n    mnemonic, version, mnemonicEncrypted,\n  } = options;\n  const { network, accountId } = options;\n  const tonWallet = await ton.getWalletFromMnemonic(mnemonic, network, version);\n\n  const secondNetwork = network === 'testnet' ? 'mainnet' : 'testnet';\n  tonWallet.address = toBase64Address(tonWallet.address, false, secondNetwork);\n  const account: ApiTonAccount = {\n    type: 'ton',\n    mnemonicEncrypted,\n    ton: tonWallet,\n  };\n  const secondAccountId = await addAccount(secondNetwork, account, parseAccountId(accountId).id);\n\n  return {\n    accountId: secondAccountId,\n    addressByChain: { ton: tonWallet.address },\n    network: secondNetwork,\n  };\n}\n\nexport async function importLedgerWallet(network: ApiNetwork, walletInfo: LedgerWalletInfo) {\n  const {\n    publicKey, address, index, driver, deviceId, deviceName, version,\n  } = walletInfo;\n\n  const accountId = await addAccount(network, {\n    type: 'ledger',\n    ton: {\n      type: 'ton',\n      address,\n      publicKey,\n      version,\n      index,\n    },\n    driver,\n    deviceId,\n    deviceName,\n  });\n\n  return { accountId, address, walletInfo };\n}\n\n// When multiple Ledger accounts are imported, they all are created simultaneously. This causes a race condition causing\n// multiple accounts having the same id. `createTaskQueue(1)` forces the accounts to be imported sequentially.\nconst addAccountMutex = createTaskQueue(1);\n\nasync function addAccount(network: ApiNetwork, account: ApiAccountAny, preferredId?: number) {\n  const accountId = await addAccountMutex.run(async () => {\n    const accountId = await getNewAccountId(network, preferredId);\n    await setAccountValue(accountId, 'accounts', account);\n    return accountId;\n  });\n\n  addPollingAccount(accountId, account);\n\n  return accountId;\n}\n\nexport async function removeNetworkAccounts(network: ApiNetwork) {\n  removeNetworkPollingAccounts(network);\n\n  await Promise.all([\n    deactivateAllAccounts(),\n    removeNetworkAccountsValue(network, 'accounts'),\n    getEnvironment().isDappSupported && removeNetworkDapps(network),\n  ]);\n}\n\nexport async function resetAccounts() {\n  removeAllPollingAccounts();\n\n  await Promise.all([\n    deactivateAllAccounts(),\n    storage.removeItem('accounts'),\n    getEnvironment().isDappSupported && removeAllDapps(),\n    tokenRepository.clear(),\n  ]);\n}\n\nexport async function removeAccount(\n  accountId: string,\n  nextAccountId: string,\n  newestActivityTimestamps?: ApiActivityTimestamps,\n) {\n  removePollingAccount(accountId);\n\n  await Promise.all([\n    removeAccountValue(accountId, 'accounts'),\n    getEnvironment().isDappSupported && removeAccountDapps(accountId),\n  ]);\n\n  await activateAccount(nextAccountId, newestActivityTimestamps);\n}\n\nexport async function changePassword(oldPassword: string, password: string) {\n  for (const [accountId, account] of Object.entries(await fetchStoredAccounts())) {\n    if (!('mnemonicEncrypted' in account)) continue;\n\n    const mnemonic = await decryptMnemonic(account.mnemonicEncrypted, oldPassword);\n    const encryptedMnemonic = await encryptMnemonic(mnemonic, password);\n\n    await updateStoredAccount<ApiAccountWithMnemonic>(accountId, {\n      mnemonicEncrypted: encryptedMnemonic,\n    });\n  }\n}\n\nexport async function importViewAccount(network: ApiNetwork, addressByChain: ApiImportAddressByChain) {\n  try {\n    const account: ApiViewAccount = {\n      type: 'view',\n    };\n    let title: string | undefined;\n\n    if (addressByChain.ton) {\n      const wallet = await ton.getWalletFromAddress(network, addressByChain.ton);\n      if ('error' in wallet) return { ...wallet, chain: 'ton' };\n      account.ton = wallet.wallet;\n      title = wallet.title;\n    }\n\n    if (addressByChain.tron) {\n      account.tron = {\n        type: 'tron',\n        address: addressByChain.tron,\n        index: 0,\n      };\n    }\n\n    const accountId = await addAccount(network, account);\n    void activateAccount(accountId);\n\n    return {\n      accountId,\n      title,\n      resolvedAddresses: getAddressesFromAccount(account),\n    };\n  } catch (err) {\n    return handleServerError(err);\n  }\n}\n\nexport async function importNewWalletVersion(accountId: string, version: ApiTonWalletVersion): Promise<{\n  isNew: true;\n  accountId: string;\n  address: string;\n  ledger?: { index: number; driver: ApiLedgerDriver };\n} | {\n  isNew: false;\n  accountId: string;\n}> {\n  const { network } = parseAccountId(accountId);\n  const account = await fetchStoredTonAccount(accountId);\n  const newAccount = {\n    ...account,\n    ton: ton.getOtherVersionWallet(network, account.ton, version),\n  };\n\n  const accounts = await fetchStoredAccounts();\n  const existingAccount = Object.entries(accounts).find(([, account]) => {\n    return account.ton?.address === newAccount.ton.address && account.type === newAccount.type;\n  });\n\n  if (existingAccount) {\n    return {\n      isNew: false,\n      accountId: existingAccount[0],\n    };\n  }\n\n  const ledger = account.type === 'ledger'\n    ? { index: account.ton.index, driver: account.driver }\n    : undefined;\n\n  const newAccountId = await addAccount(network, newAccount);\n\n  return {\n    isNew: true,\n    accountId: newAccountId,\n    address: newAccount.ton.address,\n    ledger,\n  };\n}\n","import generateUniqueId from '../../util/generateUniqueId';\nimport { ApiUserRejectsError } from '../errors';\n\nconst deferreds = new Map<string, Deferred>();\n\nclass Deferred<T = any> {\n  resolve!: AnyToVoidFunction;\n\n  reject!: AnyToVoidFunction;\n\n  promise = new Promise<T>((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n}\n\nexport function createDappPromise(promiseId = generateUniqueId()) {\n  const deferred = new Deferred();\n\n  deferreds.set(promiseId, deferred);\n\n  const { promise } = deferred;\n\n  return { promiseId, promise };\n}\n\nexport function resolveDappPromise(promiseId: string, value?: any) {\n  const deferred = deferreds.get(promiseId);\n  if (!deferred) {\n    return;\n  }\n\n  deferred.resolve(value);\n  deferreds.delete(promiseId);\n}\n\nexport function rejectDappPromise(promiseId: string, reason: string = 'Unknown rejection reason') {\n  const deferred = deferreds.get(promiseId);\n  if (!deferred) {\n    return;\n  }\n\n  deferred.reject(new ApiUserRejectsError(reason));\n  deferreds.delete(promiseId);\n}\n\nexport function rejectAllDappPromises(message: string) {\n  Array.from(deferreds.keys()).forEach((id) => {\n    rejectDappPromise(id, message);\n  });\n}\n","import * as tonWebMnemonic from 'tonweb-mnemonic';\n\nimport type { ApiAccountWithMnemonic, ApiChain, ApiNetwork } from '../types';\n\nimport { parseAccountId } from '../../util/account';\nimport chains from '../chains';\nimport { fetchPrivateKey as fetchTonPrivateKey } from '../chains/ton';\nimport { checkToAddress } from '../chains/ton/transfer';\nimport {\n  fetchStoredAccount,\n  fetchStoredAccounts,\n  fetchStoredAddress,\n  fetchStoredTonWallet,\n  getAccountWithMnemonic,\n} from '../common/accounts';\nimport * as dappPromises from '../common/dappPromises';\nimport { getMnemonic } from '../common/mnemonic';\nimport { handleServerError } from '../errors';\n\nconst ton = chains.ton;\n\nexport async function fetchPrivateKey(accountId: string, password: string) {\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  const privateKey = await fetchTonPrivateKey(accountId, password, account);\n\n  return Buffer.from(privateKey!).toString('hex');\n}\n\nexport async function fetchMnemonic(accountId: string, password: string) {\n  const account = await fetchStoredAccount<ApiAccountWithMnemonic>(accountId);\n  return getMnemonic(accountId, password, account);\n}\n\nexport function getMnemonicWordList() {\n  return tonWebMnemonic.wordlists.default;\n}\n\nexport async function checkWorkerStorageIntegrity(): Promise<boolean> {\n  /*\n    This method is intended to check if the worker storage is corrupted due to known\n    behavior of browsers (at least Chromium-based ones).\n    Several users reported that their storage was corrupted on Android too.\n  */\n  try {\n    const accounts = await fetchStoredAccounts();\n    return !!accounts && typeof accounts === 'object' && Object.keys(accounts).length > 0;\n  } catch {\n    return false;\n  }\n}\n\nexport async function verifyPassword(password: string): Promise<boolean> {\n  try {\n    const [accountId, account] = (await getAccountWithMnemonic()) ?? [];\n    if (!accountId || !account) {\n      return false;\n    }\n\n    const mnemonic = await getMnemonic(accountId, password, account);\n    return Boolean(mnemonic);\n  } catch {\n    return false;\n  }\n}\n\nexport function confirmDappRequest(promiseId: string, data: any) {\n  dappPromises.resolveDappPromise(promiseId, data);\n}\n\nexport function confirmDappRequestConnect(promiseId: string, data: {\n  password?: string;\n  accountId?: string;\n  signature?: string;\n}) {\n  dappPromises.resolveDappPromise(promiseId, data);\n}\n\nexport function cancelDappRequest(promiseId: string, reason?: string) {\n  dappPromises.rejectDappPromise(promiseId, reason);\n}\n\nexport async function getWalletSeqno(accountId: string, address?: string) {\n  const { network } = parseAccountId(accountId);\n  if (!address) {\n    ({ address } = await fetchStoredTonWallet(accountId));\n  }\n  return ton.getWalletSeqno(network, address);\n}\n\nexport function fetchAddress(accountId: string, chain: ApiChain) {\n  return fetchStoredAddress(accountId, chain);\n}\n\nexport function isWalletInitialized(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.isAddressInitialized(network, address);\n}\n\nexport function getWalletBalance(chain: ApiChain, network: ApiNetwork, address: string) {\n  return chains[chain].getWalletBalance(network, address);\n}\n\nexport function getContractInfo(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.getContractInfo(network, address);\n}\n\nexport function getWalletInfo(network: ApiNetwork, address: string) {\n  const chain = chains.ton;\n\n  return chain.getWalletInfo(network, address);\n}\n\nexport async function getAddressInfo(network: ApiNetwork, toAddress: string): Promise<{\n  addressName?: string;\n  isScam?: boolean;\n  resolvedAddress?: string;\n  isToAddressNew?: boolean;\n  isBounceable?: boolean;\n  isMemoRequired?: boolean;\n} | { error: string }> {\n  try {\n    return await checkToAddress(network, toAddress);\n  } catch (err: any) {\n    return handleServerError(err);\n  }\n}\n","import type { ApiNft } from '../types';\n\nimport { TONCOIN } from '../../config';\nimport { bigintDivideToNumber } from '../../util/bigint';\nimport chains from '../chains';\nimport { fetchStoredAccount, fetchStoredTonWallet } from '../common/accounts';\nimport { createLocalTransactions } from './transactions';\n\nconst { ton } = chains;\n\nexport async function fetchNfts(accountId: string) {\n  const account = await fetchStoredAccount(accountId);\n  return 'ton' in account ? ton.getAccountNfts(accountId) : [];\n}\n\nexport function checkNftTransferDraft(options: {\n  accountId: string;\n  nfts: ApiNft[];\n  toAddress: string;\n  comment?: string;\n}) {\n  return ton.checkNftTransferDraft(options);\n}\n\nexport async function submitNftTransfers(\n  accountId: string,\n  password: string,\n  nfts: ApiNft[],\n  toAddress: string,\n  comment?: string,\n  totalRealFee = 0n,\n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const result = await ton.submitNftTransfers({\n    accountId, password, nfts, toAddress, comment,\n  });\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const realFeePerNft = bigintDivideToNumber(totalRealFee, Object.keys(result.messages).length);\n\n  createLocalTransactions(accountId, 'ton', result.messages.map((message, index) => ({\n    txId: result.msgHashNormalized,\n    amount: 0n, // Regular NFT transfers should have no amount in the activity list\n    fromAddress,\n    toAddress,\n    comment,\n    fee: realFeePerNft,\n    normalizedAddress: message.toAddress,\n    slug: TONCOIN.slug,\n    externalMsgHashNorm: result.msgHashNormalized,\n    nft: nfts?.[index],\n  })));\n\n  return result;\n}\n\nexport async function checkNftOwnership(accountId: string, nftAddress: string) {\n  const account = await fetchStoredAccount(accountId);\n  return 'ton' in account && ton.checkNftOwnership(accountId, nftAddress);\n}\n","import type { ApiNft } from '../types';\n\nimport { TONCOIN } from '../../config';\nimport { buildCollectionByKey, extractKey } from '../../util/iteratees';\nimport chains from '../chains';\nimport { fetchStoredTonWallet } from '../common/accounts';\nimport { createLocalTransactions } from './transactions';\n\nconst { ton } = chains;\n\nexport function checkDnsRenewalDraft(accountId: string, nfts: ApiNft[]) {\n  const nftAddresses = extractKey(nfts, 'address');\n  return ton.checkDnsRenewalDraft(accountId, nftAddresses);\n}\n\nexport async function submitDnsRenewal(accountId: string, password: string, nfts: ApiNft[], realFee = 0n) {\n  const { address: fromAddress } = await fetchStoredTonWallet(accountId);\n\n  const nftByAddress = buildCollectionByKey(nfts, 'address');\n  const results: ({ activityIds: string[] } | { error: string })[] = [];\n\n  for await (const { addresses, result } of ton.submitDnsRenewal(accountId, password, Object.keys(nftByAddress))) {\n    if ('error' in result) {\n      results.push(result);\n      continue;\n    }\n\n    const localActivities = createLocalTransactions(accountId, 'ton', addresses.map((address) => {\n      const nft = nftByAddress[address];\n      return {\n        txId: result.msgHashNormalized,\n        amount: 0n,\n        fromAddress,\n        toAddress: nft.address,\n        fee: realFee / BigInt(nfts.length),\n        normalizedAddress: nft.address,\n        slug: TONCOIN.slug,\n        externalMsgHashNorm: result.msgHashNormalized,\n        nft,\n        type: 'dnsRenew',\n      };\n    }));\n\n    results.push({\n      activityIds: extractKey(localActivities, 'id'),\n    });\n  }\n\n  return results;\n}\n\nexport function checkDnsChangeWalletDraft(accountId: string, nft: ApiNft, address: string) {\n  return ton.checkDnsChangeWalletDraft(accountId, nft.address, address);\n}\n\nexport async function submitDnsChangeWallet(\n  accountId: string,\n  password: string,\n  nft: ApiNft,\n  address: string,\n  realFee = 0n,\n) {\n  const { address: walletAddress } = await fetchStoredTonWallet(accountId);\n  const result = await ton.submitDnsChangeWallet(accountId, password, nft.address, address);\n\n  if ('error' in result) {\n    return result;\n  }\n\n  const [activity] = createLocalTransactions(accountId, 'ton', [{\n    txId: result.msgHashNormalized,\n    amount: 0n,\n    fromAddress: walletAddress,\n    toAddress: nft.address,\n    fee: realFee,\n    normalizedAddress: nft.address,\n    slug: TONCOIN.slug,\n    externalMsgHashNorm: result.msgHashNormalized,\n    nft,\n    type: 'dnsChangeAddress',\n  }]);\n\n  return { activityId: activity.id };\n}\n","import type { ConnectEventError, ConnectEventSuccess } from '@tonconnect/protocol';\n\nexport interface TransactionPayload {\n  valid_until?: number;\n  network?: CHAIN;\n  from?: string; // https://github.com/ton-blockchain/ton-connect/blob/main/wallet-guidelines.md#multi-accounts\n  messages: TransactionPayloadMessage[];\n}\n\nexport interface TransactionPayloadMessage {\n  address: string;\n  amount: string;\n  payload?: string;\n  stateInit?: string;\n}\n\n// This and the other enums can be imported from @tonconnect/protocol. We copy the enums instead of importing because\n// importing that module increases the compiled code size significantly.\n\nexport enum CONNECT_EVENT_ERROR_CODES {\n  UNKNOWN_ERROR = 0,\n  BAD_REQUEST_ERROR = 1,\n  MANIFEST_NOT_FOUND_ERROR = 2,\n  MANIFEST_CONTENT_ERROR = 3,\n  UNKNOWN_APP_ERROR = 100,\n  USER_REJECTS_ERROR = 300,\n  METHOD_NOT_SUPPORTED = 400,\n}\n\nexport enum SEND_TRANSACTION_ERROR_CODES {\n  UNKNOWN_ERROR = 0,\n  BAD_REQUEST_ERROR = 1,\n  UNKNOWN_APP_ERROR = 100,\n  USER_REJECTS_ERROR = 300,\n  METHOD_NOT_SUPPORTED = 400,\n}\n\nexport type AllErrorCodes = CONNECT_EVENT_ERROR_CODES | SEND_TRANSACTION_ERROR_CODES;\nexport type ConnectEvent = ConnectEventSuccess | ConnectEventError;\n\nexport interface ApiTonConnectProof {\n  timestamp: number;\n  domain: string;\n  payload: string;\n}\n\nexport enum CHAIN {\n  MAINNET = '-239',\n  TESTNET = '-3',\n}\n","import type { DeviceInfo, Feature } from '@tonconnect/protocol';\n\nimport type { ApiAccountWithTon } from '../api/types';\n\nimport {\n  APP_NAME, IS_EXTENSION, IS_TELEGRAM_APP, TONCONNECT_PROTOCOL_VERSION,\n} from '../config';\nimport packageJson from '../../package.json';\nimport { DEFAULT_MAX_MESSAGES, W5_MAX_MESSAGES } from '../api/chains/ton/constants';\nimport { getMaxMessagesInTransaction } from './ton/transfer';\n\ntype DevicePlatform = DeviceInfo['platform'];\n\n/*\n This function is called in TonConnect `connect` method (where we know the wallet version)\n and in JS Bridge (where no account is selected, so we show maximum number of messages).\n*/\nexport function tonConnectGetDeviceInfo(account?: ApiAccountWithTon): DeviceInfo {\n  const features: Feature[] = [\n    'SendTransaction', // TODO DEPRECATED\n    {\n      name: 'SendTransaction',\n      maxMessages: account ? getTonConnectMaxMessages(account) : W5_MAX_MESSAGES,\n    },\n  ];\n\n  if (!account || account.type !== 'ledger') {\n    features.push({\n      name: 'SignData',\n      types: ['text', 'binary', 'cell'],\n    });\n  }\n\n  return {\n    platform: getPlatform(),\n    appName: APP_NAME,\n    appVersion: packageJson.version,\n    maxProtocolVersion: TONCONNECT_PROTOCOL_VERSION,\n    features,\n  };\n}\n\n/** How many messages can be sent in a single TON Connect transaction sending */\nexport function getTonConnectMaxMessages(account: ApiAccountWithTon) {\n  const { type } = account;\n\n  if (type === 'ledger') {\n    return DEFAULT_MAX_MESSAGES; // TODO Remove after DEXs support the 1 message limit\n  } else {\n    return getMaxMessagesInTransaction(account);\n  }\n}\n\nfunction getPlatform(): DevicePlatform {\n  const { userAgent } = navigator;\n  const platform = navigator.platform || navigator?.userAgentData?.platform || '';\n\n  const macosPlatforms = ['macOS', 'Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];\n  const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];\n  const iphonePlatforms = ['iPhone'];\n  const ipadPlatforms = ['iPad', 'iPod'];\n\n  let devicePlatform: DevicePlatform | undefined;\n\n  if (IS_EXTENSION || IS_TELEGRAM_APP) {\n    devicePlatform = 'browser';\n  } else if (/Android/.test(userAgent)) {\n    devicePlatform = 'android';\n  } else if (iphonePlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'iphone';\n  } else if (ipadPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'ipad';\n  } else if (macosPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'mac';\n  } else if (windowsPlatforms.indexOf(platform) !== -1) {\n    devicePlatform = 'windows';\n  } else if (/Linux/.test(platform)) {\n    devicePlatform = 'linux';\n  } else {\n    devicePlatform = 'browser';\n  }\n\n  return devicePlatform;\n}\n","import type { ApiAnyDisplayError } from '../types';\nimport type { AllErrorCodes } from './types';\nimport { ApiTransactionError } from '../types';\nimport { CONNECT_EVENT_ERROR_CODES, SEND_TRANSACTION_ERROR_CODES } from './types';\n\nimport { ApiBaseError } from '../errors';\n\nexport class TonConnectError extends ApiBaseError {\n  code: number;\n\n  constructor(message: string, code: AllErrorCodes = 0, displayError?: ApiAnyDisplayError) {\n    super(message);\n    this.code = code;\n    this.displayError = displayError;\n  }\n}\n\nexport class ManifestContentError extends TonConnectError {\n  constructor(message = 'Manifest content error') {\n    super(message, CONNECT_EVENT_ERROR_CODES.MANIFEST_CONTENT_ERROR);\n  }\n}\n\nexport class UnknownError extends TonConnectError {\n  constructor(message = 'Unknown error.') {\n    super(message, SEND_TRANSACTION_ERROR_CODES.UNKNOWN_ERROR);\n  }\n}\n\nexport class BadRequestError extends TonConnectError {\n  constructor(message = 'Bad request', displayError?: ApiAnyDisplayError) {\n    super(message, SEND_TRANSACTION_ERROR_CODES.BAD_REQUEST_ERROR, displayError);\n  }\n}\n\nexport class UnknownAppError extends TonConnectError {\n  constructor(message = 'Unknown app error') {\n    super(message, SEND_TRANSACTION_ERROR_CODES.UNKNOWN_APP_ERROR);\n  }\n}\n\nexport class UserRejectsError extends TonConnectError {\n  constructor(message = 'The user rejected the action') {\n    super(message, SEND_TRANSACTION_ERROR_CODES.USER_REJECTS_ERROR);\n  }\n}\n\nexport class MethodNotSupportedError extends TonConnectError {\n  constructor(message = 'The method is not supported') {\n    super(message, SEND_TRANSACTION_ERROR_CODES.METHOD_NOT_SUPPORTED);\n  }\n}\n\nexport class InsufficientBalance extends BadRequestError {\n  constructor(message = 'Insufficient balance') {\n    super(message, ApiTransactionError.InsufficientBalance);\n  }\n}\n","export function crc32(data: string): number {\n  return crc32FromBytes(Buffer.from(data));\n}\n\nexport function crc32FromBytes(bytes: Uint8Array): number {\n  // The implementation is based on https://stackoverflow.com/a/18639999/1118709\n  const crc32Table = makeCrc32Table();\n  let crc = 0 ^ -1;\n\n  for (let i = 0; i < bytes.length; i++) {\n    crc = (crc >>> 8) ^ crc32Table[(crc ^ bytes[i]) & 0xFF];\n  }\n\n  return (crc ^ -1) >>> 0;\n}\n\nlet crc32Table: Uint32Array;\n\nfunction makeCrc32Table() {\n  if (!crc32Table) {\n    let c: number;\n    crc32Table = new Uint32Array(256);\n    for (let n = 0; n < 256; n++) {\n      c = n;\n      for (let k = 0; k < 8; k++) {\n        c = c & 1 ? 0xEDB88320 ^ (c >>> 1) : c >>> 1;\n      }\n      crc32Table[n] = c;\n    }\n  }\n\n  return crc32Table;\n}\n","import { Address, beginCell, Cell } from '@ton/core';\nimport type { SignDataPayload, SignDataPayloadCell } from '@tonconnect/protocol';\nimport nacl from 'tweetnacl';\n\nimport type { ApiTonConnectProof } from './types';\n\nimport { crc32 } from '../../util/crcHash';\nimport { encodeDomain } from '../chains/ton/util/dns';\nimport { sha256 } from '../common/utils';\n\nexport async function signTonProofWithPrivateKey(\n  walletAddress: string | Address,\n  privateKey: Uint8Array,\n  proof: ApiTonConnectProof,\n): Promise<Uint8Array> {\n  const { timestamp, domain, payload } = proof;\n  const address = walletAddress instanceof Address ? walletAddress : Address.parse(walletAddress);\n\n  const messageBuffer = Buffer.concat([\n    Buffer.from('ton-proof-item-v2/'),\n    makeAddressBuffer(address),\n    makeBytesWithLengthBuffer(Buffer.from(domain), false),\n    makeTimestampBuffer(timestamp, false),\n    Buffer.from(payload),\n  ]);\n\n  const bufferToSign = Buffer.concat([\n    Buffer.from([0xff, 0xff]),\n    Buffer.from('ton-connect'),\n    Buffer.from(await sha256(messageBuffer)),\n  ]);\n\n  return nacl.sign.detached(\n    new Uint8Array(await sha256(bufferToSign)),\n    privateKey,\n  );\n}\n\n/**\n * See https://docs.tonconsole.com/academy/sign-data#how-the-signature-is-built for more details\n */\nexport async function signDataWithPrivateKey(\n  walletAddress: string | Address,\n  timestamp: number, // Unix seconds, should be the current time\n  domain: string,\n  payload: SignDataPayload,\n  privateKey: Uint8Array,\n): Promise<Uint8Array> {\n  const address = walletAddress instanceof Address ? walletAddress : Address.parse(walletAddress);\n\n  const hash = await (payload.type === 'cell'\n    ? createCellDataHash(address, timestamp, domain, payload)\n    : createTextDataHash(address, timestamp, domain, payload));\n\n  return nacl.sign.detached(hash, privateKey);\n}\n\n// https://docs.tonconsole.com/academy/sign-data#for-cell\nfunction createCellDataHash(\n  walletAddress: Address,\n  timestamp: number,\n  domain: string,\n  payload: SignDataPayloadCell,\n) {\n  const message = beginCell()\n    .storeUint(0x75569022, 32)\n    .storeUint(crc32(payload.schema), 32)\n    .storeUint(timestamp, 64)\n    .storeAddress(walletAddress)\n    .storeStringRefTail(encodeDomain(domain))\n    .storeRef(Cell.fromBase64(payload.cell))\n    .endCell();\n\n  const hashBuffer = message.hash();\n  return new Uint8Array(hashBuffer.buffer, hashBuffer.byteOffset, hashBuffer.byteLength);\n}\n\n// https://docs.tonconsole.com/academy/sign-data#for-text-and-binary\nasync function createTextDataHash(\n  walletAddress: Address,\n  timestamp: number,\n  domain: string,\n  payload: Exclude<SignDataPayload, SignDataPayloadCell>,\n) {\n  const message = Buffer.concat([\n    Buffer.from([0xff, 0xff]),\n    Buffer.from('ton-connect/sign-data/'),\n    makeAddressBuffer(walletAddress),\n    makeBytesWithLengthBuffer(Buffer.from(domain), true),\n    makeTimestampBuffer(timestamp, true),\n    Buffer.from(payload.type === 'text' ? 'txt' : 'bin'),\n    makeBytesWithLengthBuffer(\n      payload.type === 'text'\n        ? Buffer.from(payload.text, 'utf8')\n        : Buffer.from(payload.bytes, 'base64'),\n      true,\n    ),\n  ]);\n\n  return new Uint8Array(await sha256(message));\n}\n\nfunction makeAddressBuffer(address: Address) {\n  const workChainLength = 4;\n  const addressBuffer = Buffer.allocUnsafe(workChainLength + address.hash.length);\n  addressBuffer.writeInt32BE(address.workChain);\n  address.hash.copy(addressBuffer, workChainLength);\n  return addressBuffer;\n}\n\nfunction makeBytesWithLengthBuffer(bytes: Buffer, isBigEndian: boolean) {\n  const lengthLength = 4;\n  const buffer = Buffer.allocUnsafe(lengthLength + bytes.length);\n  if (isBigEndian) {\n    buffer.writeInt32BE(bytes.length);\n  } else {\n    buffer.writeInt32LE(bytes.length);\n  }\n  bytes.copy(buffer, lengthLength);\n  return buffer;\n}\n\nfunction makeTimestampBuffer(unixSeconds: number, isBigEndian: boolean) {\n  const timestampBuffer = Buffer.allocUnsafe(8);\n  const timestamp = BigInt(unixSeconds);\n  if (isBigEndian) {\n    timestampBuffer.writeBigInt64BE(timestamp);\n  } else {\n    timestampBuffer.writeBigInt64LE(timestamp);\n  }\n  return timestampBuffer;\n}\n","import type { ApiParsedPayload } from '../types';\n\nimport { isNftTransferPayload, isTokenTransferPayload } from '../../util/ton/transfer';\n\n// https://stackoverflow.com/a/417184\nconst URL_MAX_LENGTH = 2000;\n\nexport function isValidString(value: any, maxLength = 100) {\n  return typeof value === 'string' && value.length <= maxLength;\n}\n\nexport function isValidUrl(url: string) {\n  const isString = isValidString(url, URL_MAX_LENGTH);\n  if (!isString) return false;\n\n  try {\n    new URL(url);\n    return true;\n  } catch (err) {\n    return false;\n  }\n}\n\nexport function getTransferActualToAddress(toAddress: string, payload: ApiParsedPayload | undefined) {\n  // This function implementation is not complete. That is, other transfer types may have another actual \"to\" address.\n  if (isNftTransferPayload(payload)) {\n    return payload.newOwner;\n  }\n  if (isTokenTransferPayload(payload)) {\n    return payload.destination;\n  }\n  return toAddress;\n}\n\nexport function isTransferPayloadDangerous(payload: ApiParsedPayload | undefined) {\n  return payload?.type === 'unknown';\n}\n","/* TonConnect specification https://github.com/ton-blockchain/ton-connect */\n\nimport { Cell } from '@ton/core';\nimport type {\n  ConnectEventError,\n  ConnectItemReply,\n  ConnectRequest,\n  DisconnectRpcRequest,\n  DisconnectRpcResponse,\n  SendTransactionRpcRequest,\n  SendTransactionRpcResponse,\n  SignDataPayload,\n  SignDataRpcRequest,\n  SignDataRpcResponse,\n  SignDataRpcResponseSuccess,\n  TonProofItem,\n  TonProofItemReplySuccess,\n  WalletResponseTemplateError,\n} from '@tonconnect/protocol';\n\nimport type {\n  ApiCheckMultiTransactionDraftResult,\n  ApiEmulationWithFallbackResult,\n  TonTransferParams,\n} from '../chains/ton/types';\nimport type {\n  ApiAccountWithMnemonic,\n  ApiAnyDisplayError,\n  ApiDapp,\n  ApiDappConnectionType,\n  ApiDappMetadata,\n  ApiDappRequest,\n  ApiDappTransfer,\n  ApiNetwork,\n  ApiParsedPayload,\n  ApiSignedTransfer,\n  ApiTonWallet,\n  OnApiUpdate,\n} from '../types';\nimport type { ApiTonConnectProof, ConnectEvent, TransactionPayload, TransactionPayloadMessage } from './types';\nimport { ApiCommonError, ApiTransactionDraftError, ApiTransactionError } from '../types';\nimport { CHAIN, CONNECT_EVENT_ERROR_CODES, SEND_TRANSACTION_ERROR_CODES } from './types';\n\nimport { IS_EXTENSION, TONCOIN } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { bigintDivideToNumber } from '../../util/bigint';\nimport { fetchJsonWithProxy } from '../../util/fetch';\nimport { getDappConnectionUniqueId } from '../../util/getDappConnectionUniqueId';\nimport { pick } from '../../util/iteratees';\nimport { logDebugError } from '../../util/logs';\nimport safeExec from '../../util/safeExec';\nimport { getTonConnectMaxMessages, tonConnectGetDeviceInfo } from '../../util/tonConnectEnvironment';\nimport chains from '../chains';\nimport { getContractInfo, parsePayloadBase64 } from '../chains/ton';\nimport { fetchKeyPair } from '../chains/ton/auth';\nimport { getIsRawAddress, getWalletPublicKey, toBase64Address, toRawAddress } from '../chains/ton/util/tonCore';\nimport { fetchStoredTonAccount, getCurrentAccountId, getCurrentAccountIdOrFail } from '../common/accounts';\nimport { getKnownAddressInfo } from '../common/addresses';\nimport { createDappPromise } from '../common/dappPromises';\nimport { isUpdaterAlive } from '../common/helpers';\nimport { bytesToBase64, hexToBytes } from '../common/utils';\nimport * as apiErrors from '../errors';\nimport { ApiServerError } from '../errors';\nimport { callHook } from '../hooks';\nimport {\n  addDapp,\n  deleteDapp,\n  findLastConnectedAccount,\n  getDapp,\n  updateDapp,\n} from '../methods/dapps';\nimport { createLocalActivitiesFromEmulation, createLocalTransactions } from '../methods/transactions';\nimport * as errors from './errors';\nimport { UnknownAppError } from './errors';\nimport { signDataWithPrivateKey, signTonProofWithPrivateKey } from './signing';\nimport { getTransferActualToAddress, isTransferPayloadDangerous, isValidString, isValidUrl } from './utils';\n\nconst BLANK_GIF_DATA_URL = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\n\nconst ton = chains.ton;\n\nlet resolveInit: AnyFunction;\nconst initPromise = new Promise((resolve) => {\n  resolveInit = resolve;\n});\n\nlet onUpdate: OnApiUpdate;\n\nexport function initTonConnect(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n  resolveInit();\n}\n\nexport async function connect(request: ApiDappRequest, message: ConnectRequest, id: number): Promise<ConnectEvent> {\n  try {\n    await openExtensionPopup(true);\n\n    onUpdate({\n      type: 'dappLoading',\n      connectionType: 'connect',\n      isSse: request && 'sseOptions' in request,\n    });\n\n    const dappMetadata = await fetchDappMetadata(message.manifestUrl);\n    const url = request.url || dappMetadata.url;\n    const addressItem = message.items.find(({ name }) => name === 'ton_addr');\n    const proofItem = message.items.find(({ name }) => name === 'ton_proof') as TonProofItem | undefined;\n    const proof = proofItem ? {\n      timestamp: Math.round(Date.now() / 1000),\n      domain: new URL(url).host,\n      payload: proofItem.payload,\n    } : undefined;\n\n    if (!addressItem) {\n      throw new errors.BadRequestError('Missing \\'ton_addr\\'');\n    }\n\n    if (proof && !proof.domain.includes('.')) {\n      throw new errors.BadRequestError('Invalid domain');\n    }\n\n    let accountId = await getCurrentAccountOrFail();\n\n    const { promiseId, promise } = createDappPromise();\n\n    const dapp: ApiDapp = {\n      ...dappMetadata,\n      url,\n      connectedAt: Date.now(),\n      ...(request.isUrlEnsured && { isUrlEnsured: true }),\n      ...('sseOptions' in request && {\n        sse: request.sseOptions,\n      }),\n    };\n\n    const uniqueId = getDappConnectionUniqueId(request);\n\n    onUpdate({\n      type: 'dappConnect',\n      identifier: 'identifier' in request ? request.identifier : undefined,\n      promiseId,\n      accountId,\n      dapp,\n      permissions: {\n        address: true,\n        proof: !!proof,\n      },\n      proof,\n    });\n\n    const promiseResult: {\n      accountId?: string;\n      password?: string;\n      signature?: string;\n    } | undefined = await promise;\n\n    accountId = promiseResult!.accountId!;\n    request.accountId = accountId;\n    await addDapp(accountId, dapp, uniqueId);\n\n    const account = await fetchStoredTonAccount(accountId);\n    const { address } = account.ton;\n\n    const deviceInfo = tonConnectGetDeviceInfo(account);\n    const items: ConnectItemReply[] = [\n      await buildTonAddressReplyItem(accountId, account.ton),\n    ];\n\n    if (proof) {\n      const { password, signature } = promiseResult!;\n\n      let proofReplyItem: TonProofItemReplySuccess;\n      if (password) {\n        proofReplyItem = await signTonProof(accountId, account as ApiAccountWithMnemonic, password, address, proof);\n      } else {\n        proofReplyItem = buildTonProofReplyItem(proof, signature!);\n      }\n\n      items.push(proofReplyItem);\n    }\n\n    onUpdate({ type: 'updateDapps' });\n    onUpdate({ type: 'dappConnectComplete' });\n\n    return {\n      event: 'connect',\n      id,\n      payload: {\n        items,\n        device: deviceInfo,\n      },\n    };\n  } catch (err) {\n    logDebugError('tonConnect:connect', err);\n\n    safeExec(() => {\n      onUpdate({\n        type: 'dappCloseLoading',\n        connectionType: 'connect',\n      });\n    });\n\n    return formatConnectError(id, err as Error);\n  }\n}\n\nexport async function reconnect(request: ApiDappRequest, id: number): Promise<ConnectEvent> {\n  try {\n    const { url, accountId } = await ensureRequestParams(request);\n\n    const uniqueId = getDappConnectionUniqueId(request);\n    const currentDapp = await getDapp(accountId, url, uniqueId);\n    if (!currentDapp) {\n      throw new UnknownAppError();\n    }\n\n    await updateDapp(accountId, url, uniqueId, { connectedAt: Date.now() });\n\n    const account = await fetchStoredTonAccount(accountId);\n\n    const deviceInfo = tonConnectGetDeviceInfo(account);\n    const items: ConnectItemReply[] = [\n      await buildTonAddressReplyItem(accountId, account.ton),\n    ];\n\n    return {\n      event: 'connect',\n      id,\n      payload: {\n        items,\n        device: deviceInfo,\n      },\n    };\n  } catch (e) {\n    logDebugError('tonConnect:reconnect', e);\n    return formatConnectError(id, e as Error);\n  }\n}\n\nexport async function disconnect(\n  request: ApiDappRequest,\n  message: DisconnectRpcRequest,\n): Promise<DisconnectRpcResponse> {\n  try {\n    const { url, accountId } = await ensureRequestParams(request);\n\n    const uniqueId = getDappConnectionUniqueId(request);\n    await deleteDapp(accountId, url, uniqueId, true);\n    onUpdate({ type: 'updateDapps' });\n  } catch (err) {\n    logDebugError('tonConnect:disconnect', err);\n  }\n  return {\n    id: message.id,\n    result: {},\n  };\n}\n\nexport async function sendTransaction(\n  request: ApiDappRequest,\n  message: SendTransactionRpcRequest,\n): Promise<SendTransactionRpcResponse> {\n  try {\n    const { url, accountId } = await ensureRequestParams(request);\n    const { network } = parseAccountId(accountId);\n\n    const txPayload = JSON.parse(message.params[0]) as TransactionPayload;\n    const { messages, network: dappNetworkRaw } = txPayload;\n\n    const account = await fetchStoredTonAccount(accountId);\n    const {\n      type, ton: {\n        address,\n        publicKey: publicKeyHex,\n      },\n    } = account;\n\n    const maxMessages = getTonConnectMaxMessages(account);\n\n    if (messages.length > maxMessages) {\n      throw new errors.BadRequestError(`Payload contains more than ${maxMessages} messages, which exceeds limit`);\n    }\n\n    const dappNetwork = dappNetworkRaw\n      ? (dappNetworkRaw === CHAIN.MAINNET ? 'mainnet' : 'testnet')\n      : undefined;\n    let validUntil = txPayload.valid_until;\n    if (validUntil && validUntil > 10 ** 10) {\n      // If milliseconds were passed instead of seconds\n      validUntil = Math.round(validUntil / 1000);\n    }\n\n    const isLedger = type === 'ledger';\n\n    let vestingAddress: string | undefined;\n\n    if (txPayload.from && toBase64Address(txPayload.from) !== toBase64Address(address)) {\n      const publicKey = hexToBytes(publicKeyHex!);\n      if (isLedger && await checkIsHisVestingWallet(network, publicKey, txPayload.from)) {\n        vestingAddress = txPayload.from;\n      } else {\n        throw new errors.BadRequestError(undefined, ApiTransactionError.WrongAddress);\n      }\n    }\n\n    if (dappNetwork && network !== dappNetwork) {\n      throw new errors.BadRequestError(undefined, ApiTransactionError.WrongNetwork);\n    }\n\n    await openExtensionPopup(true);\n\n    onUpdate({\n      type: 'dappLoading',\n      connectionType: 'sendTransaction',\n      accountId,\n      isSse: Boolean('sseOptions' in request && request.sseOptions),\n    });\n\n    const {\n      preparedMessages,\n      checkResult,\n    } = await checkTransactionMessages(accountId, messages, network);\n\n    if ('error' in checkResult) {\n      throw new errors.BadRequestError(checkResult.error, checkResult.error);\n    }\n\n    const uniqueId = getDappConnectionUniqueId(request);\n    const dapp = (await getDapp(accountId, url, uniqueId))!;\n    const transactionsForRequest = await prepareTransactionForRequest(\n      network,\n      messages,\n      checkResult.emulation,\n      checkResult.parsedPayloads,\n    );\n\n    const { promiseId, promise } = createDappPromise();\n\n    onUpdate({\n      type: 'dappSendTransactions',\n      promiseId,\n      accountId,\n      dapp,\n      transactions: transactionsForRequest,\n      emulation: checkResult.emulation.isFallback ? undefined : pick(checkResult.emulation, ['activities', 'realFee']),\n      vestingAddress,\n    });\n\n    const response: string | ApiSignedTransfer[] = await promise;\n\n    if (validUntil && validUntil < (Date.now() / 1000)) {\n      throw new errors.BadRequestError('The confirmation timeout has expired');\n    }\n\n    let boc: string | undefined;\n    let error: string | undefined;\n    let msgHashNormalized: string | undefined;\n\n    if (isLedger) {\n      const signedTransfers = response as ApiSignedTransfer[];\n      const submitResult = await ton.sendSignedMessages(accountId, signedTransfers);\n      boc = submitResult.firstBoc;\n      msgHashNormalized = submitResult.msgHashesNormalized[0];\n\n      if (submitResult.successNumber > 0) {\n        if (submitResult.successNumber < messages.length) {\n          onUpdate({\n            type: 'showError',\n            error: ApiTransactionError.PartialTransactionFailure,\n          });\n        }\n      } else {\n        error = 'Failed transfers';\n      }\n    } else {\n      const password = response as string;\n      const submitResult = await ton.submitMultiTransfer({\n        accountId, password, messages: preparedMessages, expireAt: validUntil,\n      });\n      if ('error' in submitResult) {\n        error = submitResult.error;\n      } else {\n        ({ boc, msgHashNormalized } = submitResult);\n      }\n    }\n\n    if (error) {\n      throw new errors.UnknownError(error);\n    }\n\n    if (!checkResult.emulation.isFallback && checkResult.emulation.activities?.length > 0) {\n      // Use rich emulation activities for optimistic UI\n      createLocalActivitiesFromEmulation(\n        accountId,\n        'ton',\n        msgHashNormalized!,\n        checkResult.emulation.activities,\n      );\n    } else {\n      // Fallback to basic local transactions when emulation is not available\n      createLocalTransactions(accountId, 'ton', transactionsForRequest.map((transaction) => {\n        const { amount, normalizedAddress, payload, networkFee } = transaction;\n        const comment = payload?.type === 'comment' ? payload.comment : undefined;\n        return {\n          txId: msgHashNormalized!,\n          amount,\n          fromAddress: address,\n          toAddress: normalizedAddress,\n          comment,\n          fee: networkFee,\n          slug: TONCOIN.slug,\n          externalMsgHashNorm: msgHashNormalized,\n        };\n      }));\n    }\n\n    // Notify that dapp transfer is complete after successful blockchain submission\n    onUpdate({\n      type: 'dappTransferComplete',\n      accountId,\n    });\n\n    return {\n      result: boc!,\n      id: message.id,\n    };\n  } catch (err) {\n    logDebugError('tonConnect:sendTransaction', err);\n    return handleMethodError(err, message.id, 'sendTransaction');\n  }\n}\n\nfunction handleMethodError(\n  err: unknown,\n  messageId: string,\n  connectionType: ApiDappConnectionType,\n): WalletResponseTemplateError {\n  safeExec(() => {\n    onUpdate({\n      type: 'dappCloseLoading',\n      connectionType,\n    });\n  });\n\n  let code = SEND_TRANSACTION_ERROR_CODES.UNKNOWN_ERROR;\n  let errorMessage = 'Unhandled error';\n  let displayError: ApiAnyDisplayError | undefined;\n\n  if (err instanceof apiErrors.ApiUserRejectsError) {\n    code = SEND_TRANSACTION_ERROR_CODES.USER_REJECTS_ERROR;\n    errorMessage = err.message;\n  } else if (err instanceof errors.TonConnectError) {\n    code = err.code;\n    errorMessage = err.message;\n    displayError = err.displayError;\n  } else if (err instanceof ApiServerError) {\n    displayError = err.displayError;\n  } else {\n    displayError = ApiCommonError.Unexpected;\n  }\n\n  if (onUpdate && isUpdaterAlive(onUpdate) && displayError) {\n    onUpdate({\n      type: 'showError',\n      error: displayError,\n    });\n  }\n  return {\n    error: {\n      code,\n      message: errorMessage,\n    },\n    id: messageId,\n  };\n}\n\nasync function checkIsHisVestingWallet(network: ApiNetwork, ownerPublicKey: Uint8Array, address: string) {\n  const [info, publicKey] = await Promise.all([\n    getContractInfo(network, address),\n    getWalletPublicKey(network, address),\n  ]);\n\n  return info.contractInfo?.name === 'vesting' && areDeepEqual(ownerPublicKey, publicKey);\n}\n\n/**\n * See https://docs.tonconsole.com/academy/sign-data for more details\n */\nexport async function signData(\n  request: ApiDappRequest,\n  message: SignDataRpcRequest,\n): Promise<SignDataRpcResponse> {\n  try {\n    const { url, accountId } = await ensureRequestParams(request);\n    const account = await fetchStoredTonAccount(accountId);\n\n    if (account.type === 'view') throw new errors.MethodNotSupportedError('Not supported by view-only accounts');\n    if (account.type === 'ledger') throw new errors.MethodNotSupportedError('Not supported by Ledger');\n\n    await openExtensionPopup(true);\n\n    onUpdate({\n      type: 'dappLoading',\n      connectionType: 'signData',\n      accountId,\n      isSse: Boolean('sseOptions' in request && request.sseOptions),\n    });\n\n    const { promiseId, promise } = createDappPromise();\n    const uniqueId = getDappConnectionUniqueId(request);\n    const dapp = (await getDapp(accountId, url, uniqueId))!;\n    const payloadToSign = JSON.parse(message.params[0]) as SignDataPayload;\n\n    onUpdate({\n      type: 'dappSignData',\n      promiseId,\n      accountId,\n      dapp,\n      payloadToSign,\n    });\n\n    const password: string = await promise;\n\n    const result = await performSignData(\n      accountId,\n      account,\n      dapp,\n      payloadToSign,\n      password,\n    );\n\n    onUpdate({\n      type: 'dappSignDataComplete',\n      accountId,\n    });\n\n    return {\n      result,\n      id: message.id,\n    };\n  } catch (err) {\n    logDebugError('tonConnect:signData', err);\n    return handleMethodError(err, message.id, 'signData');\n  }\n}\n\nasync function checkTransactionMessages(\n  accountId: string,\n  messages: TransactionPayloadMessage[],\n  network: ApiNetwork,\n) {\n  const preparedMessages: TonTransferParams[] = messages.map((msg) => {\n    const {\n      address: toAddress,\n      amount,\n      payload,\n      stateInit,\n    } = msg;\n\n    return {\n      toAddress: getIsRawAddress(toAddress)\n        ? toBase64Address(toAddress, true, network)\n        : toAddress,\n      amount: BigInt(amount),\n      payload: payload ? Cell.fromBase64(payload) : undefined,\n      stateInit: stateInit ? Cell.fromBase64(stateInit) : undefined,\n    };\n  });\n\n  const checkResult = await ton.checkMultiTransactionDraft(accountId, preparedMessages);\n\n  // Handle insufficient balance error specifically for TON Connect by converting to fallback emulation\n  if ('error' in checkResult\n    && checkResult.error === ApiTransactionDraftError.InsufficientBalance\n    && checkResult.emulation) {\n    const fallbackCheckResult: ApiCheckMultiTransactionDraftResult = {\n      emulation: {\n        isFallback: true,\n        networkFee: checkResult.emulation.networkFee,\n      },\n      parsedPayloads: checkResult.parsedPayloads,\n    };\n    return {\n      preparedMessages,\n      checkResult: fallbackCheckResult,\n    };\n  }\n\n  return {\n    preparedMessages,\n    checkResult,\n  };\n}\n\nfunction prepareTransactionForRequest(\n  network: ApiNetwork,\n  messages: TransactionPayloadMessage[],\n  emulation: ApiEmulationWithFallbackResult,\n  parsedPayloads?: (ApiParsedPayload | undefined)[],\n) {\n  return Promise.all(messages.map(\n    async ({\n      address,\n      amount: rawAmount,\n      payload: rawPayload,\n      stateInit,\n    }, index): Promise<ApiDappTransfer> => {\n      const amount = BigInt(rawAmount);\n      const toAddress = getIsRawAddress(address) ? toBase64Address(address, true, network) : address;\n      // Fix address format for `waitTxComplete` to work properly\n      const normalizedAddress = toBase64Address(address, undefined, network);\n      const payload = parsedPayloads?.[index]\n        ?? (rawPayload ? await parsePayloadBase64(network, toAddress, rawPayload) : undefined);\n      const { isScam } = getKnownAddressInfo(normalizedAddress) || {};\n      const transferEmulation = emulation.isFallback ? undefined : emulation.byTransactionIndex[index];\n\n      return {\n        toAddress,\n        amount,\n        rawPayload,\n        payload,\n        stateInit,\n        normalizedAddress,\n        isScam,\n        isDangerous: isTransferPayloadDangerous(payload),\n        displayedToAddress: getTransferActualToAddress(toAddress, payload),\n        networkFee: transferEmulation?.networkFee ?? bigintDivideToNumber(emulation.networkFee, messages.length),\n      };\n    },\n  ));\n}\n\nfunction formatConnectError(id: number, error: Error): ConnectEventError {\n  let code = CONNECT_EVENT_ERROR_CODES.UNKNOWN_ERROR;\n  let message = 'Unhandled error';\n\n  if (error instanceof apiErrors.ApiUserRejectsError) {\n    code = CONNECT_EVENT_ERROR_CODES.USER_REJECTS_ERROR;\n    message = error.message;\n  } else if (error instanceof errors.TonConnectError) {\n    code = error.code;\n    message = error.message;\n  }\n\n  return {\n    id,\n    event: 'connect_error',\n    payload: {\n      code,\n      message,\n    },\n  };\n}\n\nasync function buildTonAddressReplyItem(accountId: string, wallet: ApiTonWallet): Promise<ConnectItemReply> {\n  const { network } = parseAccountId(accountId);\n  const { publicKey, address } = wallet;\n\n  const stateInit = await ton.getWalletStateInit(accountId, wallet);\n\n  return {\n    name: 'ton_addr',\n    address: toRawAddress(address),\n    network: network === 'mainnet' ? CHAIN.MAINNET : CHAIN.TESTNET,\n    publicKey: publicKey!,\n    walletStateInit: stateInit\n      .toBoc({ idx: true, crc32: true })\n      .toString('base64'),\n  };\n}\n\nasync function signTonProof(\n  accountId: string,\n  account: ApiAccountWithMnemonic,\n  password: string,\n  walletAddress: string,\n  proof: ApiTonConnectProof,\n): Promise<TonProofItemReplySuccess> {\n  const keyPair = await fetchKeyPair(accountId, password, account);\n  const signature = await signTonProofWithPrivateKey(walletAddress, keyPair!.secretKey, proof);\n  return buildTonProofReplyItem(proof, bytesToBase64(signature));\n}\n\nfunction buildTonProofReplyItem(proof: ApiTonConnectProof, signature: string): TonProofItemReplySuccess {\n  const { timestamp, domain, payload } = proof;\n  const domainBuffer = Buffer.from(domain);\n\n  return {\n    name: 'ton_proof',\n    proof: {\n      timestamp,\n      domain: {\n        lengthBytes: domainBuffer.byteLength,\n        value: domainBuffer.toString('utf8'),\n      },\n      signature,\n      payload,\n    },\n  };\n}\n\nasync function performSignData(\n  accountId: string,\n  account: ApiAccountWithMnemonic,\n  dapp: ApiDapp,\n  payloadToSign: SignDataPayload,\n  password: string,\n): Promise<SignDataRpcResponseSuccess['result']> {\n  const { address } = account.ton;\n  const timestamp = Math.floor(Date.now() / 1000);\n  const domain = new URL(dapp.url).host;\n  const keyPair = (await fetchKeyPair(accountId, password, account))!;\n  const signature = await signDataWithPrivateKey(\n    address,\n    timestamp,\n    domain,\n    payloadToSign,\n    keyPair.secretKey,\n  );\n\n  return {\n    signature: bytesToBase64(signature),\n    address,\n    timestamp,\n    domain,\n    payload: payloadToSign,\n  };\n}\n\nexport async function fetchDappMetadata(manifestUrl: string): Promise<ApiDappMetadata> {\n  try {\n    const { url, name, iconUrl } = await fetchJsonWithProxy(manifestUrl);\n    const safeIconUrl = (iconUrl.startsWith('data:') || iconUrl === '') ? BLANK_GIF_DATA_URL : iconUrl;\n    if (!isValidUrl(url) || !isValidString(name) || !isValidUrl(safeIconUrl)) {\n      throw new Error('Invalid data');\n    }\n\n    return {\n      url,\n      name,\n      iconUrl: safeIconUrl,\n      manifestUrl,\n    };\n  } catch (err) {\n    logDebugError('fetchDapp', err);\n    throw new errors.ManifestContentError();\n  }\n}\n\nasync function ensureRequestParams(\n  request: ApiDappRequest,\n): Promise<ApiDappRequest & { url: string; accountId: string }> {\n  if (!request.url) {\n    throw new errors.BadRequestError('Missing `url` in request');\n  }\n\n  if (request.accountId) {\n    return request as ApiDappRequest & { url: string; accountId: string };\n  }\n\n  const { network } = parseAccountId(await getCurrentAccountIdOrFail());\n  const lastAccountId = await findLastConnectedAccount(network, request.url);\n  if (!lastAccountId) {\n    throw new errors.BadRequestError('The connection is outdated, try relogin');\n  }\n\n  return {\n    ...request,\n    accountId: lastAccountId,\n  } as ApiDappRequest & { url: string; accountId: string };\n}\n\nasync function openExtensionPopup(force?: boolean) {\n  if (!IS_EXTENSION || (!force && onUpdate && isUpdaterAlive(onUpdate))) {\n    return false;\n  }\n\n  await callHook('onWindowNeeded');\n  await initPromise;\n\n  return true;\n}\n\nasync function getCurrentAccountOrFail() {\n  const accountId = await getCurrentAccountId();\n  if (!accountId) {\n    throw new errors.BadRequestError('The user is not authorized in the wallet');\n  }\n  return accountId;\n}\n","import type {\n  AppRequest,\n  ConnectRequest,\n  DisconnectEvent,\n  RpcRequests,\n} from '@tonconnect/protocol';\nimport nacl, { randomBytes } from 'tweetnacl';\n\nimport type { ApiDappRequest, ApiSseOptions, OnApiUpdate } from '../types';\nimport { CONNECT_EVENT_ERROR_CODES } from './types';\n\nimport { SSE_BRIDGE_URL } from '../../config';\nimport { parseAccountId } from '../../util/account';\nimport { handleFetchErrors } from '../../util/fetch';\nimport { extractKey } from '../../util/iteratees';\nimport { logDebug, logDebugError } from '../../util/logs';\nimport safeExec from '../../util/safeExec';\nimport { getCurrentNetwork, waitLogin } from '../common/accounts';\nimport { bytesToHex } from '../common/utils';\nimport { getDappsState, getSseLastEventId, setSseLastEventId } from '../methods/dapps';\nimport * as tonConnect from './index';\n\ntype SseDapp = {\n  accountId: string;\n  url: string;\n} & ApiSseOptions;\n\ntype ReturnStrategy = 'back' | 'none' | (string & {});\n\nconst TTL_SEC = 300;\nconst NONCE_SIZE = 24;\nconst MAX_CONFIRM_DURATION = 60 * 1000;\n\nlet sseEventSource: EventSource | undefined;\nlet sseDapps: SseDapp[] = [];\nlet delayedReturnParams: {\n  validUntil: number;\n  url: string;\n  isFromInAppBrowser?: boolean;\n} | undefined;\n\nlet onUpdate: OnApiUpdate;\n\nexport function initSse(_onUpdate: OnApiUpdate) {\n  onUpdate = _onUpdate;\n}\n\nexport async function startSseConnection({\n  url, isFromInAppBrowser, identifier,\n}: {\n  url: string;\n  isFromInAppBrowser?: boolean;\n  identifier?: string;\n}): Promise<ReturnStrategy | undefined> {\n  const { searchParams: params, origin: connectionOrigin } = new URL(url);\n\n  const ret: ReturnStrategy = params.get('ret') || 'back';\n  const version = Number(params.get('v') as string);\n  const appClientId = params.get('id') as string;\n  // `back` strategy cannot be implemented\n  const shouldOpenUrl = ret !== 'back' && ret !== 'none';\n  const r = params.get('r');\n\n  if (!r) {\n    if (shouldOpenUrl) {\n      delayedReturnParams = {\n        validUntil: Date.now() + MAX_CONFIRM_DURATION,\n        url: ret,\n        isFromInAppBrowser,\n      };\n    }\n    return undefined;\n  }\n\n  const connectRequest: ConnectRequest | null = safeExec(() => JSON.parse(r)) || JSON.parse(decodeURIComponent(r));\n\n  logDebug('SSE Start connection:', {\n    version, appClientId, connectRequest, ret, connectionOrigin, identifier,\n  });\n\n  const { secretKey: secretKeyArray, publicKey: publicKeyArray } = nacl.box.keyPair();\n  const secretKey = bytesToHex(secretKeyArray);\n  const clientId = bytesToHex(publicKeyArray);\n\n  const lastOutputId = 0;\n  const request: ApiDappRequest = {\n    url: undefined,\n    identifier,\n    sseOptions: {\n      clientId,\n      appClientId,\n      secretKey,\n      lastOutputId,\n    },\n  };\n\n  await waitLogin();\n\n  if (!connectRequest) {\n    onUpdate({\n      type: 'showError',\n      error: 'Invalid TON Connect link',\n    });\n\n    return undefined;\n  }\n\n  const result = await tonConnect.connect(request, connectRequest, lastOutputId);\n\n  if (result.event === 'connect_error') {\n    const { code } = result.payload;\n\n    if ([\n      CONNECT_EVENT_ERROR_CODES.MANIFEST_CONTENT_ERROR,\n      CONNECT_EVENT_ERROR_CODES.MANIFEST_NOT_FOUND_ERROR,\n      CONNECT_EVENT_ERROR_CODES.BAD_REQUEST_ERROR,\n      CONNECT_EVENT_ERROR_CODES.UNKNOWN_APP_ERROR,\n      CONNECT_EVENT_ERROR_CODES.METHOD_NOT_SUPPORTED,\n    ].includes(code)) {\n      onUpdate({\n        type: 'showError',\n        error: result.payload.message,\n      });\n    }\n  }\n\n  await sendMessage(result, secretKey, clientId, appClientId);\n\n  if (result.event !== 'connect_error') {\n    await resetupSseConnection();\n  }\n\n  if (!shouldOpenUrl) {\n    return undefined;\n  }\n\n  return ret;\n}\n\nexport async function resetupSseConnection() {\n  const [lastEventId, dappsState, network] = await Promise.all([\n    getSseLastEventId(),\n    getDappsState(),\n    getCurrentNetwork(),\n  ]);\n\n  if (!dappsState || !network) {\n    return;\n  }\n\n  sseDapps = Object.entries(dappsState).reduce((result, [accountId, dappsByUrl]) => {\n    if (parseAccountId(accountId).network !== network) {\n      return result;\n    }\n\n    for (const byUniqueId of Object.values(dappsByUrl)) {\n      for (const dapp of Object.values(byUniqueId)) {\n        if (dapp.sse?.clientId) {\n          result.push({\n            ...dapp.sse,\n            accountId,\n            url: dapp.url,\n          });\n        }\n      }\n    }\n\n    return result;\n  }, [] as SseDapp[]);\n\n  const clientIds = extractKey(sseDapps, 'clientId').filter(Boolean);\n  if (!clientIds.length) {\n    return;\n  }\n\n  closeEventSource();\n  sseEventSource = openEventSource(clientIds, lastEventId);\n\n  sseEventSource.onopen = () => {\n    logDebug('EventSource opened');\n  };\n\n  sseEventSource.onerror = (e) => {\n    logDebugError('EventSource', e.type);\n  };\n\n  sseEventSource.onmessage = async (event) => {\n    const { from, message: encryptedMessage } = JSON.parse(event.data);\n\n    const sseDapp = sseDapps.find(({ appClientId }) => appClientId === from);\n    if (!sseDapp) {\n      logDebug(`Dapp with clientId ${from} not found`);\n      return;\n    }\n\n    const {\n      accountId, clientId, appClientId, secretKey, url, lastOutputId,\n    } = sseDapp;\n    const message = decryptMessage(encryptedMessage, appClientId, secretKey) as AppRequest<keyof RpcRequests>;\n\n    logDebug('SSE Event:', message);\n\n    await setSseLastEventId(event.lastEventId);\n    const sseOptions = {\n      clientId,\n      appClientId,\n      secretKey,\n      lastOutputId,\n    };\n\n    // @ts-ignore\n    const result = await tonConnect[message.method]({ url, accountId, sseOptions }, message);\n\n    await sendMessage(result, secretKey, clientId, appClientId);\n\n    if (delayedReturnParams) {\n      const { validUntil, url, isFromInAppBrowser } = delayedReturnParams;\n      if (validUntil > Date.now()) {\n        onUpdate({ type: 'openUrl', url, isExternal: !isFromInAppBrowser });\n      }\n      delayedReturnParams = undefined;\n    }\n  };\n}\n\nexport async function sendSseDisconnect(accountId: string, url: string) {\n  const sseDapp = sseDapps.find((d) => d.url === url && d.accountId === accountId);\n  if (!sseDapp) return;\n\n  const { secretKey, clientId, appClientId } = sseDapp;\n  const lastOutputId = sseDapp.lastOutputId + 1;\n\n  const response: DisconnectEvent = {\n    event: 'disconnect',\n    id: lastOutputId,\n    payload: {},\n  };\n\n  await sendMessage(response, secretKey, clientId, appClientId);\n}\n\nfunction sendMessage(\n  message: AnyLiteral, secretKey: string, clientId: string, toId: string, topic?: 'signTransaction' | 'signData',\n) {\n  const buffer = Buffer.from(JSON.stringify(message));\n  const encryptedMessage = encryptMessage(buffer, toId, secretKey);\n  return sendRawMessage(encryptedMessage, clientId, toId, topic);\n}\n\nasync function sendRawMessage(body: string, clientId: string, toId: string, topic?: 'signTransaction' | 'signData') {\n  const url = new URL(`${SSE_BRIDGE_URL}message`);\n  url.searchParams.set('client_id', clientId);\n  url.searchParams.set('to', toId);\n  url.searchParams.set('ttl', TTL_SEC.toString());\n  if (topic) {\n    url.searchParams.set('topic', topic);\n  }\n\n  const response = await fetch(url, { method: 'POST', body });\n  await handleFetchErrors(response);\n}\n\nfunction closeEventSource() {\n  if (!sseEventSource) return;\n\n  safeExec(() => {\n    sseEventSource!.close();\n  });\n  sseEventSource = undefined;\n}\n\nfunction openEventSource(clientIds: string[], lastEventId?: string) {\n  const url = new URL(`${SSE_BRIDGE_URL}events`);\n  url.searchParams.set('client_id', clientIds.join(','));\n  if (lastEventId) {\n    url.searchParams.set('last_event_id', lastEventId);\n  }\n  return new EventSource(url);\n}\n\nfunction encryptMessage(message: Uint8Array, publicKey: string, secretKey: string) {\n  const nonce = randomBytes(NONCE_SIZE);\n  const encrypted = nacl.box(\n    message, nonce, Buffer.from(publicKey, 'hex'), Buffer.from(secretKey, 'hex'),\n  );\n  return Buffer.concat([nonce, encrypted]).toString('base64');\n}\n\nfunction decryptMessage(message: string, publicKey: string, secretKey: string) {\n  const fullBuffer = Buffer.from(message, 'base64');\n  const nonce = fullBuffer.subarray(0, NONCE_SIZE);\n  const encrypted = fullBuffer.subarray(NONCE_SIZE);\n  const decrypted = nacl.box.open(\n    encrypted,\n    nonce,\n    Buffer.from(publicKey, 'hex'),\n    Buffer.from(secretKey, 'hex'),\n  );\n  const jsonText = new TextDecoder('utf-8').decode(decrypted!);\n  return JSON.parse(jsonText);\n}\n","import type { ApiBaseCurrency, ApiHistoryList, ApiPriceHistoryPeriod } from '../types';\n\nimport { DEFAULT_PRICE_CURRENCY, TONCOIN } from '../../config';\nimport { callBackendGet } from '../common/backend';\nimport { tokensPreload } from '../common/tokens';\nimport { getTokenBySlug } from './tokens';\n\nexport { setBaseCurrency, getBaseCurrency } from '../common/prices';\n\nexport async function fetchPriceHistory(\n  slug: string,\n  period: ApiPriceHistoryPeriod,\n  baseCurrency: ApiBaseCurrency = DEFAULT_PRICE_CURRENCY,\n): Promise<ApiHistoryList | undefined> {\n  await tokensPreload.promise;\n  const token = getTokenBySlug(slug);\n\n  if (!token) {\n    return [];\n  }\n\n  const assetId = token.chain === TONCOIN.chain && token.tokenAddress ? token.tokenAddress : token.symbol;\n\n  return callBackendGet(`/prices/chart/${assetId}`, {\n    base: baseCurrency,\n    period,\n  });\n}\n","import type {\n  ApiSubscribeNotificationsProps, ApiSubscribeNotificationsResult, ApiUnsubscribeNotificationsProps,\n} from '../types';\n\nimport { logDebugError } from '../../util/logs';\nimport { callBackendPost } from '../common/backend';\nimport { handleServerError } from '../errors';\n\nexport async function subscribeNotifications(props: ApiSubscribeNotificationsProps) {\n  try {\n    return await callBackendPost<ApiSubscribeNotificationsResult>(\n      '/notifications/subscribe', props, { shouldRetry: true },\n    );\n  } catch (err) {\n    logDebugError('subscribeNotifications', err);\n    return handleServerError(err);\n  }\n}\n\nexport async function unsubscribeNotifications(props: ApiUnsubscribeNotificationsProps) {\n  try {\n    return await callBackendPost<{ ok: true }>(\n      '/notifications/unsubscribe', props, { shouldRetry: true },\n    );\n  } catch (err) {\n    logDebugError('unsubscribeNotifications', err);\n    return handleServerError(err);\n  }\n}\n","import type { ApiInitArgs, OnApiUpdate } from '../types';\n\nimport { initWindowConnector } from '../../util/windowProvider/connector';\nimport chains from '../chains';\nimport { callBackendGet } from '../common/backend';\nimport { connectUpdater, disconnectUpdater, startStorageMigration } from '../common/helpers';\nimport { setEnvironment } from '../environment';\nimport { addHooks } from '../hooks';\nimport { storage } from '../storages';\nimport * as tonConnect from '../tonConnect';\nimport * as tonConnectSse from '../tonConnect/sse';\nimport { destroyPolling } from './polling';\nimport * as methods from '.';\n\naddHooks({\n  onDappDisconnected: tonConnectSse.sendSseDisconnect,\n  onDappsChanged: tonConnectSse.resetupSseConnection,\n});\n\nexport default async function init(onUpdate: OnApiUpdate, args: ApiInitArgs) {\n  connectUpdater(onUpdate);\n  const environment = setEnvironment(args);\n\n  initWindowConnector();\n\n  methods.initAccounts(onUpdate);\n  methods.initPolling(onUpdate);\n  methods.initTransactions(onUpdate);\n  methods.initStaking();\n  methods.initSwap(onUpdate);\n\n  if (environment.isDappSupported) {\n    methods.initDapps(onUpdate);\n    tonConnect.initTonConnect(onUpdate);\n  }\n\n  if (environment.isSseSupported) {\n    tonConnectSse.initSse(onUpdate);\n  }\n\n  await startStorageMigration(onUpdate, chains.ton, args.accountIds);\n\n  if (environment.isSseSupported) {\n    void tonConnectSse.resetupSseConnection();\n  }\n\n  void saveReferrer(args);\n}\n\nexport function destroy() {\n  void destroyPolling();\n  disconnectUpdater();\n}\n\nasync function saveReferrer(args: ApiInitArgs) {\n  let referrer = await storage.getItem('referrer');\n\n  if (referrer !== undefined) return;\n\n  if (args.referrer) {\n    referrer = args.referrer;\n  } else {\n    ({ referrer } = await callBackendGet<{ referrer?: string }>('/referrer/get'));\n  }\n\n  // An empty string means no referrer\n  await storage.setItem('referrer', referrer ?? '');\n}\n","import type { StorageKey } from '../storages/types';\n\nimport { storage } from '../storages';\n\ntype OldAccount = {\n  address: string;\n  publicKey: string;\n  version: string;\n  ledger?: {\n    index: number;\n    driver: string;\n    deviceId?: string;\n    deviceName?: string;\n  };\n  authToken?: string;\n  isInitialized?: boolean;\n};\n\nexport async function start() {\n  const oldAccountById: Record<string, OldAccount> | undefined = await storage.getItem('accounts');\n\n  if (!oldAccountById) return;\n\n  const mnemonicById: Record<string, string> = await storage.getItem('mnemonicsEncrypted' as StorageKey);\n  const newAccountById: Record<string, any> = {};\n\n  for (const [accountId, oldAccount] of Object.entries(oldAccountById)) {\n    const {\n      address, version, publicKey, authToken, ledger, isInitialized,\n    } = oldAccount;\n\n    const tonWallet = {\n      type: 'ton',\n      address,\n      version,\n      publicKey,\n      authToken,\n      isInitialized,\n      index: ledger?.index ?? 0,\n    };\n\n    newAccountById[accountId] = ledger ? {\n      type: 'ledger',\n      ton: tonWallet,\n      driver: ledger.driver,\n      deviceId: ledger.deviceId,\n      deviceName: ledger.deviceName,\n    } : {\n      type: 'ton',\n      mnemonicEncrypted: mnemonicById[accountId],\n      ton: tonWallet,\n    };\n  }\n\n  await storage.setItem('accounts', newAccountById);\n}\n","import type { ApiDapp } from '../types';\n\nimport { getDappConnectionUniqueId } from '../../util/getDappConnectionUniqueId';\nimport { storage } from '../storages';\n\nexport async function start() {\n  // Previous schema: Record<accountId, Record<url, ApiDapp>>\n  // New schema:     Record<accountId, Record<url, Record<uniqueId, ApiDapp>>>\n  const oldState: Record<string, Record<string, ApiDapp>> | undefined = await storage.getItem('dapps');\n\n  if (!oldState) return;\n\n  const newState: Record<string, Record<string, Record<string, ApiDapp>>> = {};\n\n  for (const [accountId, byUrl] of Object.entries(oldState)) {\n    newState[accountId] = {};\n\n    for (const [url, dapp] of Object.entries(byUrl)) {\n      const uniqueId = getDappConnectionUniqueId(dapp);\n      newState[accountId][url] = { [uniqueId]: dapp };\n    }\n  }\n\n  await storage.setItem('dapps', newState);\n}\n","import { pick } from '../../util/iteratees';\nimport { storage } from '../storages';\n\nexport async function start(activeAccountIds?: string[]) {\n  if (!activeAccountIds || activeAccountIds.length === 0) {\n    return;\n  }\n\n  const accounts: Record<string, any> | undefined = await storage.getItem('accounts');\n\n  if (!accounts) {\n    return;\n  }\n\n  await storage.setItem('accounts', pick(accounts, activeAccountIds));\n}\n","import type {\n  MethodArgs, Methods,\n} from '../../methods/types';\nimport type { TonConnectMethodArgs, TonConnectMethods } from '../../tonConnect/types/misc';\nimport type {\n  ApiInitArgs, OnApiUpdate,\n} from '../../types';\n\nimport { createPostMessageInterface } from '../../../util/createPostMessageInterface';\nimport * as methods from '../../methods';\nimport init from '../../methods/init';\nimport * as tonConnectApi from '../../tonConnect';\n\ncreatePostMessageInterface((name: string, origin?: string, ...args: any[]) => {\n  if (name === 'init') {\n    return init(args[0] as OnApiUpdate, args[1] as ApiInitArgs);\n  } else {\n    if (name.startsWith('tonConnect_')) {\n      name = name.replace('tonConnect_', '');\n      const method = tonConnectApi[name as keyof TonConnectMethods];\n      // @ts-ignore\n      return method(...args as TonConnectMethodArgs<keyof TonConnectMethods>);\n    }\n\n    const method = methods[name as keyof Methods];\n\n    // @ts-ignore\n    return method(...args as MethodArgs<keyof Methods>);\n  }\n});\n","const cache = new WeakMap<AnyFunction, Map<string, any>>();\n\nexport default function withCache<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    let fnCache = cache.get(fn);\n    const cacheKey = args.map(String).join('_');\n\n    if (fnCache) {\n      const cached = fnCache.get(cacheKey);\n      if (cached) {\n        return cached;\n      }\n    } else {\n      fnCache = new Map();\n      cache.set(fn, fnCache);\n    }\n\n    const newValue = fn(...args);\n\n    fnCache.set(cacheKey, newValue);\n\n    return newValue;\n  };\n}\n","import type { ApiTonWalletVersion } from './api/chains/ton/types';\nimport type {\n  ApiBaseCurrency,\n  ApiLiquidStakingState,\n  ApiNftMarketplace,\n  ApiNominatorsStakingState,\n  ApiSwapAsset,\n  ApiSwapDexLabel,\n  ApiTokenWithPrice,\n} from './api/types';\nimport type { AutolockValueType, LangCode, LangItem, TokenPeriod } from './global/types';\n\nexport const APP_ENV = process.env.APP_ENV;\n\nexport const IS_CORE_WALLET = process.env.IS_CORE_WALLET === '1';\nexport const APP_NAME = process.env.APP_NAME || (IS_CORE_WALLET ? 'TON Wallet' : 'MyTonWallet');\nexport const APP_VERSION = process.env.APP_VERSION!;\nexport const APP_COMMIT_HASH = process.env.APP_COMMIT_HASH!;\nexport const APP_ENV_MARKER = APP_ENV === 'staging' ? 'Beta' : APP_ENV === 'development' ? 'Dev' : undefined;\nexport const EXTENSION_NAME = IS_CORE_WALLET ? 'TON Wallet' : 'MyTonWallet · My TON Wallet';\nexport const EXTENSION_DESCRIPTION = IS_CORE_WALLET\n  ? 'Set up your own TON Wallet on The Open Network'\n  // eslint-disable-next-line @stylistic/max-len\n  : 'The most feature-rich TON+TRON wallet: multi-accounts, multi-send, Telegram Gifts and other collectibles, TON DNS+Proxy, and more.';\n\nexport const DEBUG = APP_ENV !== 'production' && APP_ENV !== 'perf' && APP_ENV !== 'test';\nexport const DEBUG_MORE = false;\nexport const DEBUG_API = false;\nexport const DEBUG_VIEW_ACCOUNTS = false;\n\nexport const IS_PRODUCTION = APP_ENV === 'production';\nexport const IS_TEST = APP_ENV === 'test';\nexport const IS_PERF = APP_ENV === 'perf';\nexport const IS_EXTENSION = process.env.IS_EXTENSION === '1';\nexport const IS_FIREFOX_EXTENSION = process.env.IS_FIREFOX_EXTENSION === '1';\nexport const IS_OPERA_EXTENSION = process.env.IS_OPERA_EXTENSION === '1';\nexport const IS_PACKAGED_ELECTRON = process.env.IS_PACKAGED_ELECTRON === '1';\nexport const IS_CAPACITOR = process.env.IS_CAPACITOR === '1';\nexport const IS_ANDROID_DIRECT = process.env.IS_ANDROID_DIRECT === '1';\nexport const IS_AIR_APP = process.env.IS_AIR_APP === '1';\nexport const IS_TELEGRAM_APP = process.env.IS_TELEGRAM_APP === '1';\n\nexport const ELECTRON_HOST_URL = 'https://dumb-host';\nexport const INACTIVE_MARKER = '[Inactive]';\nexport const PRODUCTION_URL = IS_CORE_WALLET ? 'https://wallet.ton.org' : 'https://mytonwallet.app';\nexport const BETA_URL = IS_CORE_WALLET ? 'https://beta.wallet.ton.org' : 'https://beta.mytonwallet.app';\nexport const APP_INSTALL_URL = 'https://get.mytonwallet.io/';\nexport const APP_REPO_URL = 'https://github.com/mytonwallet-org/mytonwallet';\nexport const BASE_URL = process.env.BASE_URL;\n\nexport const BOT_USERNAME = process.env.BOT_USERNAME || 'MyTonWalletBot';\n\nexport const SWAP_FEE_ADDRESS = process.env.SWAP_FEE_ADDRESS || 'UQDUkQbpTVIgt7v66-JTFR-3-eXRFz_4V66F-Ufn6vOg0GOp';\nexport const DIESEL_ADDRESS = process.env.DIESEL_ADDRESS || 'UQC9lQOaEHC6YASiJJ2NrKEOlITMMQmc8j0_iZEHy-4sl3tG';\n\nexport const STRICTERDOM_ENABLED = DEBUG && !IS_PACKAGED_ELECTRON;\n\nexport const DEBUG_ALERT_MSG = 'Shoot!\\nSomething went wrong, please see the error details in Dev Tools Console.';\n\nexport const PIN_LENGTH = 4;\nexport const NATIVE_BIOMETRICS_USERNAME = IS_CORE_WALLET ? 'TonWallet' : 'MyTonWallet';\nexport const NATIVE_BIOMETRICS_SERVER = IS_CORE_WALLET ? 'https://wallet.ton.org' : 'https://mytonwallet.app';\n\nexport const IS_BIP39_MNEMONIC_ENABLED = !IS_CORE_WALLET;\nexport const MNEMONIC_COUNT = 24;\nexport const MNEMONIC_COUNTS = IS_BIP39_MNEMONIC_ENABLED ? [12, 24] : [24];\n\nexport const PRIVATE_KEY_HEX_LENGTH = 64;\nexport const MNEMONIC_CHECK_COUNT = 3;\n\nexport const MOBILE_SCREEN_MAX_WIDTH = 700; // px\n\nexport const ANIMATION_END_DELAY = 50;\n\nexport const ANIMATED_STICKER_TINY_ICON_PX = 16;\nexport const ANIMATED_STICKER_ICON_PX = 30;\nexport const ANIMATED_STICKER_TINY_SIZE_PX = 70;\nexport const ANIMATED_STICKER_SMALL_SIZE_PX = 110;\nexport const ANIMATED_STICKER_MIDDLE_SIZE_PX = 120;\nexport const ANIMATED_STICKER_DEFAULT_PX = 150;\nexport const ANIMATED_STICKER_BIG_SIZE_PX = 156;\nexport const ANIMATED_STICKER_HUGE_SIZE_PX = 192;\n\nexport const DEFAULT_PORTRAIT_WINDOW_SIZE = { width: 368, height: 770 };\nexport const DEFAULT_LANDSCAPE_WINDOW_SIZE = { width: 980, height: 788 };\nexport const DEFAULT_LANDSCAPE_ACTION_TAB_ID = 0;\nexport const TRANSACTION_ADDRESS_SHIFT = 4;\n\nexport const WHOLE_PART_DELIMITER = ' '; // https://www.compart.com/en/unicode/U+202F\n\nexport const DEFAULT_SLIPPAGE_VALUE = 5;\n\nexport const GLOBAL_STATE_CACHE_DISABLED = false;\nexport const GLOBAL_STATE_CACHE_KEY = IS_CORE_WALLET ? 'tonwallet-global-state' : 'mytonwallet-global-state';\n\nexport const ANIMATION_LEVEL_MIN = 0;\nexport const ANIMATION_LEVEL_MED = 1;\nexport const ANIMATION_LEVEL_MAX = 2;\nexport const ANIMATION_LEVEL_DEFAULT = ANIMATION_LEVEL_MAX;\nexport const THEME_DEFAULT = 'system';\n\nexport const MAIN_ACCOUNT_ID = '0-ton-mainnet';\n\nexport const TONCENTER_MAINNET_URL = process.env.TONCENTER_MAINNET_URL || 'https://toncenter.mytonwallet.org';\nexport const TONCENTER_MAINNET_KEY = process.env.TONCENTER_MAINNET_KEY;\nexport const ELECTRON_TONCENTER_MAINNET_KEY = process.env.ELECTRON_TONCENTER_MAINNET_KEY;\nexport const TONAPIIO_MAINNET_URL = process.env.TONAPIIO_MAINNET_URL || 'https://tonapiio.mytonwallet.org';\n\nexport const TONCENTER_TESTNET_URL = process.env.TONCENTER_TESTNET_URL || 'https://toncenter-testnet.mytonwallet.org';\nexport const TONCENTER_TESTNET_KEY = process.env.TONCENTER_TESTNET_KEY;\nexport const ELECTRON_TONCENTER_TESTNET_KEY = process.env.ELECTRON_TONCENTER_TESTNET_KEY;\nexport const TONAPIIO_TESTNET_URL = process.env.TONAPIIO_TESTNET_URL || 'https://tonapiio-testnet.mytonwallet.org';\n\nexport const BRILLIANT_API_BASE_URL = process.env.BRILLIANT_API_BASE_URL || 'https://api.mytonwallet.org';\nexport const PROXY_API_BASE_URL = process.env.PROXY_API_BASE_URL || 'https://api.mytonwallet.org/proxy';\nexport const IPFS_GATEWAY_BASE_URL = 'https://ipfs.io/ipfs/';\nexport const SSE_BRIDGE_URL = 'https://tonconnectbridge.mytonwallet.org/bridge/';\n\nexport const TRON_MAINNET_API_URL = process.env.TRON_MAINNET_API_URL || 'https://tronapi.mytonwallet.org';\nexport const TRON_TESTNET_API_URL = process.env.TRON_TESTNET_API_URL || 'https://api.shasta.trongrid.io';\n\nexport const FRACTION_DIGITS = 9;\nexport const SHORT_FRACTION_DIGITS = 2;\n\nexport const MAX_PUSH_NOTIFICATIONS_ACCOUNT_COUNT = 3;\n\nexport const SUPPORT_USERNAME = 'mysupport';\nexport const MTW_TIPS_CHANNEL_NAME: Partial<Record<LangCode, string>> = {\n  en: 'MyTonWalletTips',\n  ru: 'MyTonWalletTipsRu',\n};\nexport const NFT_MARKETPLACE_TITLES: Record<ApiNftMarketplace, string> = {\n  getgems: 'Getgems',\n  fragment: 'Fragment',\n};\nexport const MTW_STATIC_BASE_URL = 'https://static.mytonwallet.org';\nexport const MTW_CARDS_BASE_URL = `${MTW_STATIC_BASE_URL}/cards/`;\nexport const MTW_CARDS_MINT_BASE_URL = `${MTW_STATIC_BASE_URL}/mint-cards/`;\nexport const MYTONWALLET_PROMO_URL = 'https://mytonwallet.io/';\nexport const MYTONWALLET_MULTISEND_DAPP_URL = 'https://multisend.mytonwallet.io/';\nexport const TELEGRAM_WEB_URL = 'https://web.telegram.org/a/';\nexport const NFT_MARKETPLACE_URL = 'https://getgems.io/';\nexport const NFT_MARKETPLACE_TITLE = NFT_MARKETPLACE_TITLES.getgems;\nexport const GETGEMS_BASE_MAINNET_URL = 'https://getgems.io/';\nexport const GETGEMS_BASE_TESTNET_URL = 'https://testnet.getgems.io/';\nexport const HELPCENTER_URL = { en: 'https://help.mytonwallet.io/', ru: 'https://help.mytonwallet.io/ru' };\nexport const EMPTY_HASH_VALUE = 'NOHASH';\n\nexport const IFRAME_WHITELIST = [\n  'http://localhost:*', 'https://tonscan.org',\n];\nexport const SUBPROJECT_URL_MASK = 'https://*.mytonwallet.io';\n\nexport const CHANGELLY_SUPPORT_EMAIL = 'support@changelly.com';\nexport const CHANGELLY_LIVE_CHAT_URL = 'https://changelly.com/';\nexport const CHANGELLY_SECURITY_EMAIL = 'security@changelly.com';\nexport const CHANGELLY_TERMS_OF_USE = 'https://changelly.com/terms-of-use';\nexport const CHANGELLY_PRIVACY_POLICY = 'https://changelly.com/privacy-policy';\nexport const CHANGELLY_AML_KYC = 'https://changelly.com/aml-kyc';\nexport const CHANGELLY_WAITING_DEADLINE = 3 * 60 * 60 * 1000; // 3 hours\n\nexport const PROXY_HOSTS = process.env.PROXY_HOSTS;\n\nexport const TINY_TRANSFER_MAX_COST = 0.01;\n\nexport const IMAGE_CACHE_NAME = 'mtw-image';\nexport const LANG_CACHE_NAME = 'mtw-lang-222';\n\nexport const LANG_LIST: LangItem[] = [{\n  langCode: 'en',\n  name: 'English',\n  nativeName: 'English',\n  rtl: false,\n}, {\n  langCode: 'es',\n  name: 'Spanish',\n  nativeName: 'Español',\n  rtl: false,\n}, {\n  langCode: 'ru',\n  name: 'Russian',\n  nativeName: 'Русский',\n  rtl: false,\n}, {\n  langCode: 'zh-Hans',\n  name: 'Chinese (Simplified)',\n  nativeName: '简体',\n  rtl: false,\n}, {\n  langCode: 'zh-Hant',\n  name: 'Chinese (Traditional)',\n  nativeName: '繁體',\n  rtl: false,\n}, {\n  langCode: 'tr',\n  name: 'Turkish',\n  nativeName: 'Türkçe',\n  rtl: false,\n}, {\n  langCode: 'de',\n  name: 'German',\n  nativeName: 'Deutsch',\n  rtl: false,\n}, {\n  langCode: 'th',\n  name: 'Thai',\n  nativeName: 'ไทย',\n  rtl: false,\n}, {\n  langCode: 'uk',\n  name: 'Ukrainian',\n  nativeName: 'Українська',\n  rtl: false,\n}, {\n  langCode: 'pl',\n  name: 'Polish',\n  nativeName: 'Polski',\n  rtl: false,\n}];\n\nexport const IS_STAKING_DISABLED = IS_CORE_WALLET;\nexport const VALIDATION_PERIOD_MS = 65_536_000; // 18.2 h.\nexport const ONE_TON = 1_000_000_000n;\nexport const DEFAULT_FEE = 15_000_000n; // 0.015 TON\nexport const UNSTAKE_TON_GRACE_PERIOD = 20 * 60 * 1000; // 20 m.\n\nexport const STAKING_POOLS = process.env.STAKING_POOLS ? process.env.STAKING_POOLS.split(' ') : [];\nexport const LIQUID_POOL = process.env.LIQUID_POOL || 'EQD2_4d91M4TVbEBVyBF8J1UwpMJc361LKVCz6bBlffMW05o';\nexport const LIQUID_JETTON = process.env.LIQUID_JETTON || 'EQCqC6EhRJ_tpWngKxL6dV0k6DSnRUrs9GSVkLbfdCqsj6TE';\nexport const STAKING_MIN_AMOUNT = ONE_TON;\nexport const NOMINATORS_STAKING_MIN_AMOUNT = 10_000n * ONE_TON;\nexport const MIN_ACTIVE_STAKING_REWARDS = 100_000_000n; // 0.1 MY\n\nexport const TONCONNECT_PROTOCOL_VERSION = 2;\nexport const TONCONNECT_WALLET_JSBRIDGE_KEY = IS_CORE_WALLET ? 'tonwallet' : 'mytonwallet';\nexport const EMBEDDED_DAPP_BRIDGE_CHANNEL = 'embedded-dapp-bridge';\n\nexport const NFT_FRAGMENT_COLLECTIONS = [\n  '0:0e41dc1dc3c9067ed24248580e12b3359818d83dee0304fabcf80845eafafdb2', // Anonymous Telegram Numbers\n  '0:80d78a35f955a14b679faa887ff4cd5bfc0f43b4a4eea2a7e6927f3701b273c2', // Telegram Usernames\n];\nexport const NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX = /^https?:\\/\\/nft\\.(fragment\\.com\\/gift\\/[\\w-]+-\\d+)\\.\\w+$/i;\nexport const TELEGRAM_GIFTS_SUPER_COLLECTION = 'super:telegram-gifts';\n\nexport const MTW_CARDS_WEBSITE = 'https://cards.mytonwallet.io';\nexport const MTW_CARDS_COLLECTION = 'EQCQE2L9hfwx1V8sgmF9keraHx1rNK9VmgR1ctVvINBGykyM';\nexport const TON_DNS_COLLECTION = 'EQC3dNlesgVD8YbAazcauIrXBPfiVhMMr5YYk2in0Mtsz0Bz';\nexport const TON_DNS_RENEWAL_WARNING_DAYS = 14;\nexport const TON_DNS_RENEWAL_NFT_WARNING_DAYS = 30;\n\nexport const TONCOIN = {\n  name: 'Toncoin',\n  symbol: 'TON',\n  slug: 'toncoin',\n  decimals: 9,\n  chain: 'ton',\n  cmcSlug: 'toncoin',\n} as const;\n\nexport const TRX = {\n  name: 'TRON',\n  symbol: 'TRX',\n  slug: 'trx',\n  decimals: 6,\n  chain: 'tron',\n  cmcSlug: 'tron',\n} as const;\n\nexport const MYCOIN = {\n  name: 'MyTonWallet Coin',\n  symbol: 'MY',\n  slug: 'ton-eqcfvnlrbn',\n  decimals: 9,\n  chain: 'ton',\n  minterAddress: 'EQCFVNlRb-NHHDQfv3Q9xvDXBLJlay855_xREsq5ZDX6KN-w',\n} as const;\n\nexport const MYCOIN_TESTNET = {\n  ...MYCOIN,\n  slug: 'ton-kqawlxpebw',\n  minterAddress: 'kQAWlxpEbwhCDFX9gp824ee2xVBhAh5VRSGWfbNFDddAbQoQ',\n} as const;\n\nexport const CHAIN_CONFIG = {\n  ton: {\n    isMemoSupported: true,\n    isDnsSupported: true,\n    addressRegex: /^([-\\w_]{48}|0:[\\da-h]{64})$/i,\n    addressPrefixRegex: /^([-\\w_]{1,48}|0:[\\da-h]{0,64})$/i,\n    nativeToken: TONCOIN,\n  },\n  tron: {\n    isMemoSupported: false,\n    isDnsSupported: false,\n    addressRegex: /^T[1-9A-HJ-NP-Za-km-z]{33}$/,\n    addressPrefixRegex: /^T[1-9A-HJ-NP-Za-km-z]{0,33}$/,\n    nativeToken: TRX,\n    mainnet: {\n      apiUrl: TRON_MAINNET_API_URL,\n      usdtAddress: 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t',\n    },\n    testnet: {\n      apiUrl: TRON_TESTNET_API_URL,\n      usdtAddress: 'TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs',\n    },\n  },\n} as const;\n\nexport const TRC20_USDT_MAINNET_SLUG = 'tron-tr7nhqjekq';\nexport const TRC20_USDT_TESTNET_SLUG = 'tron-tg3xxyexbk';\nexport const TON_USDT_SLUG = 'ton-eqcxe6mutq';\nexport const STAKED_TON_SLUG = 'ton-eqcqc6ehrj';\nexport const STAKED_MYCOIN_SLUG = 'ton-eqcbzvsfwq';\nexport const TRX_SWAP_COUNT_FEE_ADDRESS = 'TW2LXSebZ7Br1zHaiA2W1zRojDkDwjGmpw';\nexport const MYCOIN_STAKING_POOL = 'EQC3roTiRRsoLzfYVK7yVVoIZjTEqAjQU3ju7aQ7HWTVL5o5';\n\nexport const ETHENA_STAKING_VAULT = 'EQChGuD1u0e7KUWHH5FaYh_ygcLXhsdG2nSHPXHW8qqnpZXW';\nexport const ETHENA_STAKING_MIN_AMOUNT = 1_000_000; // 1 USDe\n// eslint-disable-next-line @stylistic/max-len\nexport const ETHENA_ELIGIBILITY_CHECK_URL = 'https://t.me/id_app/start?startapp=cQeewNnc3pVphUcwY63WruKMQDpgePd1E7eMVoqphMZAdGoU9jwS4qRqrM1kSeaqrAiiDiC3EYAJPwZDGWqxZpw5vtGxmHma59XEt';\n\n// In cross-chain swaps, only a few TON/TRON tokens are available.\n// It’s not optimal to request swap history for all the others.\nexport const SWAP_CROSSCHAIN_SLUGS = new Set([\n  TONCOIN.slug,\n  TON_USDT_SLUG,\n  TRX.slug,\n  TRC20_USDT_MAINNET_SLUG,\n]);\n\nexport const STON_PTON_ADDRESS = 'EQCM3B12QK1e4yZSf8GtBRT0aLMNyEsBc_DhVfRRtOEffLez';\nexport const STON_PTON_SLUG = 'ton-eqcm3b12qk';\n\nexport const DNS_IMAGE_GEN_URL = 'https://dns-image.mytonwallet.org/img?d=';\n\nconst TRC20_USDT = {\n  name: 'Tether USD',\n  symbol: 'USDT',\n  decimals: 6,\n  chain: 'tron',\n} as const;\n\nconst TON_USDT = {\n  name: 'Tether USD',\n  symbol: 'USD₮',\n  chain: 'ton',\n  slug: TON_USDT_SLUG,\n  decimals: 6,\n  tokenAddress: 'EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs',\n} as const;\n\nexport const TON_USDE = {\n  name: 'Ethena USDe',\n  symbol: 'USDe',\n  chain: 'ton',\n  tokenAddress: 'EQAIb6KmdfdDR7CN1GBqVJuP25iCnLKCvBlJ07Evuu2dzP5f',\n  slug: 'ton-eqaib6kmdf',\n  decimals: 6,\n  // eslint-disable-next-line @stylistic/max-len\n  image: 'https://imgproxy.toncenter.com/binMwUmcnFtjvgjp4wSEbsECXwfXUwbPkhVvsvpubNw/pr:small/aHR0cHM6Ly9tZXRhZGF0YS5sYXllcnplcm8tYXBpLmNvbS9hc3NldHMvVVNEZS5wbmc',\n} as const;\n\nexport const TON_TSUSDE = {\n  name: 'Ethena tsUSDe',\n  symbol: 'tsUSDe',\n  chain: 'ton',\n  tokenAddress: 'EQDQ5UUyPHrLcQJlPAczd_fjxn8SLrlNQwolBznxCdSlfQwr',\n  slug: 'ton-eqdq5uuyph',\n  decimals: 6,\n  // eslint-disable-next-line @stylistic/max-len\n  image: 'https://cache.tonapi.io/imgproxy/vGZJ7erwsWPo7DpVG_V7ygNn7VGs0szZXcNLHB_l0ms/rs:fill:200:200:1/g:no/aHR0cHM6Ly9tZXRhZGF0YS5sYXllcnplcm8tYXBpLmNvbS9hc3NldHMvdHNVU0RlLnBuZw.webp',\n} as const;\n\nexport const ALL_STAKING_POOLS = [\n  LIQUID_POOL,\n  MYCOIN_STAKING_POOL,\n  ETHENA_STAKING_VAULT,\n  TON_TSUSDE.tokenAddress,\n];\n\nexport const DEFAULT_ENABLED_TOKEN_SLUGS = [\n  TONCOIN.slug, TON_USDT_SLUG, TRX.slug, TRC20_USDT_TESTNET_SLUG, TRC20_USDT_MAINNET_SLUG,\n] as string[];\n\n// Toncoin, USDT TON, TRX, USDT TRC20\nexport const DEFAULT_ENABLED_TOKEN_COUNT = 4;\n\nexport const PRIORITY_TOKEN_SLUGS = [\n  TONCOIN.slug, TON_USDT_SLUG, TRX.slug,\n] as string[];\n\nconst COMMON_TOKEN = {\n  isFromBackend: true,\n  price: 0,\n  priceUsd: 0,\n  percentChange24h: 0,\n};\n\nexport const TOKEN_INFO: Record<string, ApiTokenWithPrice> = {\n  toncoin: {\n    ...TONCOIN,\n    isFromBackend: true,\n    price: 3.1,\n    priceUsd: 3.1,\n    percentChange24h: 0,\n  },\n  trx: {\n    ...TRX,\n    ...COMMON_TOKEN,\n  },\n  [TRC20_USDT_MAINNET_SLUG]: { // mainnet\n    ...TRC20_USDT,\n    slug: TRC20_USDT_MAINNET_SLUG,\n    tokenAddress: 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t',\n    ...COMMON_TOKEN,\n  },\n  [TRC20_USDT_TESTNET_SLUG]: { // testnet\n    ...TRC20_USDT,\n    slug: TRC20_USDT_TESTNET_SLUG,\n    tokenAddress: 'TG3XXyExBkPp9nzdajDZsozEu4BkaSJozs',\n    ...COMMON_TOKEN,\n  },\n  [TON_USDT_SLUG]: {\n    ...TON_USDT,\n    // eslint-disable-next-line @stylistic/max-len\n    image: 'https://cache.tonapi.io/imgproxy/T3PB4s7oprNVaJkwqbGg54nexKE0zzKhcrPv8jcWYzU/rs:fill:200:200:1/g:no/aHR0cHM6Ly90ZXRoZXIudG8vaW1hZ2VzL2xvZ29DaXJjbGUucG5n.webp',\n    slug: TON_USDT_SLUG,\n    ...COMMON_TOKEN,\n  },\n  [MYCOIN.slug]: {\n    ...MYCOIN,\n    // eslint-disable-next-line @stylistic/max-len\n    image: 'https://cache.tonapi.io/imgproxy/Qy038wCBKISofJ0hYMlj6COWma330cx3Ju1ZSPM2LRU/rs:fill:200:200:1/g:no/aHR0cHM6Ly9teXRvbndhbGxldC5pby9sb2dvLTI1Ni1ibHVlLnBuZw.webp',\n    ...COMMON_TOKEN,\n  },\n  [TON_USDE.slug]: {\n    ...TON_USDE,\n    ...COMMON_TOKEN,\n  },\n  [TON_TSUSDE.slug]: {\n    ...TON_TSUSDE,\n    ...COMMON_TOKEN,\n  },\n};\n\nexport const TOKEN_WITH_LABEL: Record<string, string> = {\n  [TRC20_USDT_MAINNET_SLUG]: 'TRC-20',\n  [TRC20_USDT_TESTNET_SLUG]: 'TRC-20',\n  [TON_USDT_SLUG]: 'TON',\n};\n\nexport const INIT_SWAP_ASSETS: Record<string, ApiSwapAsset> = {\n  toncoin: {\n    name: 'Toncoin',\n    symbol: TONCOIN.symbol,\n    chain: TONCOIN.chain,\n    slug: TONCOIN.slug,\n    decimals: TONCOIN.decimals,\n    price: 0,\n    priceUsd: 0,\n    isPopular: true,\n  },\n  [TON_USDT_SLUG]: {\n    name: 'Tether USD',\n    symbol: 'USD₮',\n    chain: 'ton',\n    slug: TON_USDT_SLUG,\n    decimals: 9,\n    // eslint-disable-next-line @stylistic/max-len\n    image: 'https://cache.tonapi.io/imgproxy/T3PB4s7oprNVaJkwqbGg54nexKE0zzKhcrPv8jcWYzU/rs:fill:200:200:1/g:no/aHR0cHM6Ly90ZXRoZXIudG8vaW1hZ2VzL2xvZ29DaXJjbGUucG5n.webp',\n    tokenAddress: 'EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs',\n    price: 0,\n    priceUsd: 0,\n    isPopular: true,\n  },\n};\n\nexport const DEFAULT_TRX_SWAP_FIRST_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_SWAP_FIRST_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_SWAP_SECOND_TOKEN_SLUG = TON_USDT_SLUG;\nexport const DEFAULT_TRANSFER_TOKEN_SLUG = TONCOIN.slug;\nexport const DEFAULT_CEX_SWAP_SECOND_TOKEN_SLUG = TRC20_USDT_MAINNET_SLUG;\nexport const SWAP_DEX_LABELS: Record<ApiSwapDexLabel, string> = {\n  dedust: 'DeDust',\n  ston: 'STON.fi',\n};\n\nexport const MULTITAB_DATA_CHANNEL_NAME = IS_CORE_WALLET ? 'tw-multitab' : 'mtw-multitab';\nexport const ACTIVE_TAB_STORAGE_KEY = IS_CORE_WALLET ? 'tw-active-tab' : 'mtw-active-tab';\n\nexport const INDEXED_DB_NAME = 'keyval-store';\nexport const INDEXED_DB_STORE_NAME = 'keyval';\n\nexport const WINDOW_PROVIDER_CHANNEL = 'windowProvider';\nexport const WINDOW_PROVIDER_PORT = `${IS_CORE_WALLET ? 'TonWallet' : 'MyTonWallet'}_popup_reversed`;\n\nexport const SHOULD_SHOW_ALL_ASSETS_AND_ACTIVITY = IS_CORE_WALLET;\nexport const PORTRAIT_MIN_ASSETS_TAB_VIEW = 4;\nexport const LANDSCAPE_MIN_ASSETS_TAB_VIEW = 6;\n\nexport const DEFAULT_PRICE_CURRENCY = 'USD';\nexport const CURRENCIES: Record<ApiBaseCurrency, { name: string; decimals: number; shortSymbol?: string }> = {\n  USD: { name: 'US Dollar', decimals: 2, shortSymbol: '$' },\n  EUR: { name: 'Euro', decimals: 2, shortSymbol: '€' },\n  RUB: { name: 'Ruble', decimals: 2, shortSymbol: '₽' },\n  CNY: { name: 'Yuan', decimals: 2, shortSymbol: '¥' },\n  BTC: { name: 'Bitcoin', decimals: 9 },\n  [TONCOIN.symbol]: { name: 'Toncoin', decimals: 9 },\n};\n\nexport const BURN_ADDRESS = 'UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJKZ';\n\nexport const DEFAULT_WALLET_VERSION: ApiTonWalletVersion = 'W5';\nexport const POPULAR_WALLET_VERSIONS: ApiTonWalletVersion[] = ['v3R1', 'v3R2', 'v4R2', 'W5'];\nexport const LEDGER_WALLET_VERSIONS: ApiTonWalletVersion[] = ['v3R2', 'v4R2'];\n\nexport const DEFAULT_TIMEOUT = 10000;\nexport const DEFAULT_RETRIES = 3;\nexport const DEFAULT_ERROR_PAUSE = 500;\n\nexport const HISTORY_PERIODS: TokenPeriod[] = ['1D', '7D', '1M', '3M', '1Y', 'ALL'];\n\nexport const BROWSER_HISTORY_LIMIT = 10;\n\nexport const NFT_BATCH_SIZE = 4;\nexport const NOTCOIN_VOUCHERS_ADDRESS = 'EQDmkj65Ab_m0aZaW8IpKw4kYqIgITw_HRstYEkVQ6NIYCyW';\nexport const BURN_CHUNK_DURATION_APPROX_SEC = 30;\nexport const NOTCOIN_FORWARD_TON_AMOUNT = 30000000n; // 0.03 TON\nexport const NOTCOIN_EXCHANGERS = [\n  'EQAPZauWVPUcm2hUJT9n36pxznEhl46rEn1bzBXN0RY_yiy2',\n  'EQASgm0Qv3h2H2mF0W06ikPqYq2ctT3dyXMJH_svbEKKB3iZ',\n  'EQArlmP-RhVIG2yAFGZyPZfM3m0YccxmpvoRi6sgRzWnAA0s',\n  'EQA6pL-spYqZp1Ck6o3rpY45Cl-bvLMW_j3qdVejOkUWpLnm',\n  'EQBJ_ehYjumQKbXfWUue1KHKXdTm1GuYJB0Fj2ST_DwORvpd',\n  'EQBRmYSjxh9xlZpUqEmGjF5UjukI9v_Cm2kCTu4CoBn3XkOD',\n  'EQBkiqncd7AFT5_23H-RoA2Vynk-Nzq_dLoeMVRthAU9RF0p',\n  'EQB_OzTHXbztABe0QHgr4PtAV8T64LR6aDunXgaAoihOdxwO',\n  'EQCL-x5kLg6tKVNGryItTuj6tG3FH5mhUEu0xRqQc-kbEmbe',\n  'EQCZh2yJ46RaQH3AYmjEA8SMMXi77Oein4-3lvqkHseIAhD-',\n  'EQChKo5IK3iNqUHUGDB9gtzjCjMTPtmsFqekuCA2MdreVEyu',\n  'EQC6DNCBv076TIliRMfOt20RpbS7rNKDfSky3WrFEapFt8AH',\n  'EQDE_XFZOYae_rl3ZMsgBCtRSmYhl8B4y2BZEP7oiGBDhlgy',\n  'EQDddqpGA2ePXQF47A2DSL3GF6ZzIVmimfM2d16cdymy2noT',\n  'EQDv0hNNAamhYltCh3pTJrq3oRB9RW2ZhEYkTP6fhj5BtZNu',\n  'EQD2mP7zgO7-imUJhqYry3i07aJ_SR53DaokMupfAAobt0Xw',\n] as const;\n\nexport const CLAIM_ADDRESS = 'EQB3zOTvPi1PmwdcTpqSfFKZnhi1GNKEVJM-LdoAirdLtash';\nexport const CLAIM_AMOUNT = 30000000n; // 0.03 TON\nexport const CLAIM_COMMENT = 'claim';\n\nexport const MINT_CARD_ADDRESS = 'EQBpst3ZWJ9Dqq5gE2YH-yPsFK_BqMOmgi7Z_qK6v7WbrPWv';\nexport const MINT_CARD_COMMENT = 'Mint card';\nexport const MINT_CARD_REFUND_COMMENT = 'Refund';\n\n// eslint-disable-next-line @stylistic/max-len\nexport const RE_LINK_TEMPLATE = /((ftp|https?):\\/\\/)?(?<host>(www\\\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z][-a-zA-Z0-9]{1,62})\\b([-a-zA-Z0-9()@:%_+.,~#?&/=]*)/g;\n// eslint-disable-next-line @stylistic/max-len\nexport const RE_TG_BOT_MENTION = /telegram[:\\s-]*((@[a-z0-9_]+)|(https:\\/\\/)?(t\\.me|telegram\\.me|telegram\\.dog)\\/[a-z0-9_]+)/mig;\n\nexport const STARS_SYMBOL = '⭐️';\n\nexport const GIVEAWAY_CHECKIN_URL = process.env.GIVEAWAY_CHECKIN_URL || 'https://giveaway.mytonwallet.io';\n\nexport const AUTOLOCK_OPTIONS_LIST = [\n  {\n    value: 'never',\n    name: 'Disabled',\n    selectedName: 'Disabled',\n    period: 0,\n  },\n  {\n    value: '1',\n    name: '30 seconds',\n    selectedName: 'If away for 30 sec',\n    period: 30_000,\n  },\n  {\n    value: '2',\n    name: '3 minutes',\n    selectedName: 'If away for 3 min',\n    period: 60_000 * 3,\n  },\n  {\n    value: '3',\n    name: '10 minutes',\n    selectedName: 'If away for 10 min',\n    period: 60_000 * 10,\n  },\n] as const;\n\nexport const AUTO_CONFIRM_DURATION_MINUTES = 5;\n\nexport const PRICELESS_TOKEN_HASHES = new Set([\n  '173e31eee054cb0c76f77edc7956bed766bf48a1f63bd062d87040dcd3df700f', // FIVA SY tsTON EQAxGi9Al7hamLAORroxGkvfap6knGyzI50ThkP3CLPLTtOZ\n  '5226dd4e6db9af26b24d5ca822bc4053b7e08152f923932abf25030c7e38bb42', // FIVA PT tsTON EQAkxIRGXgs2vD2zjt334MBjD3mXg2GsyEZHfzuYX_trQkFL\n  'fea2c08a704e5192b7f37434927170440d445b87aab865c3ea2a68abe7168204', // FIVA YT tsTON EQAcy60qg22RCq87A_qgYK8hooEgjCZ44yxhdnKYdlWIfKXL\n  'e691cf9081a8aeb22ed4d94829f6626c9d822752e035800b5543c43f83d134b5', // FIVA LP tsTON EQD3BjCjxuf8mu5kvxajVbe-Ila1ScZZlAi03oS7lMmAJjM3\n  '301ce25925830d713b326824e552e962925c4ff45b1e3ea21fc363a459a49b43', // FIVA SY eUSDT EQDi9blCcyT-k8iMpFMYY0t7mHVyiCB50ZsRgyUECJDuGvIl\n  '02250f83fbb8624d859c2c045ac70ee2b3b959688c3d843aec773be9b36dbfc3', // FIVA PT eUSDT EQBzVrYkYPHx8D_HPfQacm1xONa4XSRxl826vHkx_laP2HOe\n  'dba3adb2c917db80fd71a6a68c1fc9e12976491a8309d5910f9722efc084ce4d', // FIVA YT eUSDT EQCwUSc2qrY5rn9BfFBG9ARAHePTUvITDl97UD0zOreWzLru\n  '7da9223b90984d6a144e71611a8d7c65a6298cad734faed79438dc0f7a8e53d1', // FIVA LP eUSDT EQBNlIZxIbQGQ78cXgG3VRcyl8A0kLn_6BM9kabiHHhWC4qY\n  'ddf80de336d580ab3c11d194f189c362e2ca1225cae224ea921deeaba7eca818', // tsUSDe EQDQ5UUyPHrLcQJlPAczd_fjxn8SLrlNQwolBznxCdSlfQwr\n]);\n\nexport const STAKED_TOKEN_SLUGS = new Set([\n  STAKED_TON_SLUG,\n  STAKED_MYCOIN_SLUG,\n  TON_TSUSDE.slug,\n]);\n\nexport const DEFAULT_OUR_SWAP_FEE = 0.875;\n\nexport const DEFAULT_STAKING_STATE: ApiLiquidStakingState = {\n  type: 'liquid',\n  id: 'liquid',\n  tokenSlug: TONCOIN.slug,\n  annualYield: 3.9,\n  yieldType: 'APY',\n  balance: 0n,\n  pool: LIQUID_POOL,\n  tokenBalance: 0n,\n  unstakeRequestAmount: 0n,\n  instantAvailable: 0n,\n  start: 0,\n  end: 0,\n};\n\nexport const DEFAULT_NOMINATORS_STAKING_STATE: ApiNominatorsStakingState = {\n  type: 'nominators',\n  id: 'nominators',\n  tokenSlug: TONCOIN.slug,\n  annualYield: 3.9,\n  yieldType: 'APY',\n  balance: 0n,\n  pool: 'Ef8dgIOIRyCLU0NEvF8TD6Me3wrbrkS1z3Gpjk3ppd8m8-s_',\n  start: 0,\n  end: 0,\n  pendingDepositAmount: 0n,\n};\n\nexport const SWAP_API_VERSION = 2;\nexport const TONCENTER_ACTIONS_VERSION = 'v1';\n\nexport const JVAULT_URL = 'https://jvault.xyz';\n\nexport const HELP_CENTER_SEED_SCAM_URL = {\n  en: 'https://help.mytonwallet.io/intro/scams/leaked-seed-phrases',\n  ru: 'https://help.mytonwallet.io/ru/baza-znanii/moshennichestvo-i-skamy/slitye-sid-frazy',\n};\n\nexport const HELP_CENTER_ETHENA_URL = {\n  en: 'https://help.mytonwallet.io/intro/staking/what-is-usde-how-does-usde-staking-work',\n  ru: 'https://help.mytonwallet.io/ru/baza-znanii/steiking/chto-takoe-usde-kak-rabotaet-steiking-usde',\n};\n\nconst ALL_TON_DNS_ZONES = [\n  {\n    suffixes: ['ton'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[-\\da-z]{4,126}$/i,\n    resolver: 'EQC3dNlesgVD8YbAazcauIrXBPfiVhMMr5YYk2in0Mtsz0Bz',\n    collectionName: 'TON DNS Domains',\n  },\n  {\n    suffixes: ['t.me'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[-_\\da-z]{4,32}$/i,\n    resolver: 'EQCA14o1-VWhS2efqoh_9M1b_A9DtKTuoqfmkn83AbJzwnPi',\n    isTelemint: true,\n    collectionName: 'Telegram Usernames',\n  },\n  {\n    suffixes: ['vip', 'ton.vip', 'vip.ton'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}?[\\da-z]{1,24}$/i,\n    resolver: 'EQBWG4EBbPDv4Xj7xlPwzxd7hSyHMzwwLB5O6rY-0BBeaixS',\n    collectionName: 'VIP DNS Domains',\n    isUnofficial: true,\n  },\n  {\n    suffixes: ['gram'],\n    baseFormat: /^([-\\da-z]+\\.){0,2}[\\da-z]{1,127}$/i,\n    resolver: 'EQAic3zPce496ukFDhbco28FVsKKl2WUX_iJwaL87CBxSiLQ',\n    collectionName: 'GRAM DNS Domains',\n    isUnofficial: true,\n  },\n];\n\nexport const TON_DNS_ZONES = IS_CORE_WALLET\n  ? ALL_TON_DNS_ZONES.filter(({ isUnofficial }) => !isUnofficial)\n  : ALL_TON_DNS_ZONES;\n\nexport const DEFAULT_AUTOLOCK_OPTION: AutolockValueType = '3';\nexport const WRONG_ATTEMPTS_BEFORE_LOG_OUT_SUGGESTION = 2;\n","import Deferred from './Deferred';\n\nexport type Scheduler = typeof requestAnimationFrame | typeof onTickEnd;\n\nexport const pause = (ms: number) => new Promise<void>((resolve) => {\n  setTimeout(() => resolve(), ms);\n});\n\nexport function debounce<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n  shouldRunLast = true,\n) {\n  let waitingTimeout: number | undefined;\n\n  return (...args: Parameters<F>) => {\n    if (waitingTimeout) {\n      clearTimeout(waitingTimeout);\n      waitingTimeout = undefined;\n    } else if (shouldRunFirst) {\n      fn(...args);\n    }\n\n    waitingTimeout = self.setTimeout(() => {\n      if (shouldRunLast) {\n        fn(...args);\n      }\n\n      waitingTimeout = undefined;\n    }, ms);\n  };\n}\n\n/**\n * An important feature of this throttle implementation is that it waits for `fn` to finish before scheduling the new\n * execution. That is, `fn` never gets executed in parallel with itself.\n */\nexport function throttle<F extends AnyFunction>(\n  fn: F,\n  ms: number | (() => Promise<void>),\n  shouldRunFirst = true,\n) {\n  let args: Parameters<F> | undefined;\n  let isRunning = false;\n\n  async function scheduleFn() {\n    await (typeof ms === 'function' ? ms() : pause(ms));\n    void runFn();\n  }\n\n  async function runFn() {\n    if (!args) {\n      isRunning = false;\n      return;\n    }\n\n    try {\n      const localArgs = args;\n      args = undefined;\n      await fn(...localArgs);\n    } finally {\n      // Voiding the promise to let the error produced by `fn` be thrown immediately\n      void scheduleFn();\n    }\n  }\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!isRunning) {\n      isRunning = true;\n\n      if (shouldRunFirst) {\n        void runFn();\n      } else {\n        void scheduleFn();\n      }\n    }\n  };\n}\n\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onTickEnd, fn);\n}\n\nexport function throttleWith<F extends AnyToVoidFunction>(schedulerFn: Scheduler, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        fn(...args);\n      });\n    }\n  };\n}\n\nexport function rafPromise() {\n  return new Promise<void>((resolve) => {\n    fastRaf(resolve);\n  });\n}\n\nconst FAST_RAF_TIMEOUT_FALLBACK_MS = 35; // < 30 FPS\n\nlet fastRafCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackTimeout: number | undefined;\n\n// May result in an immediate execution if called from another RAF callback which was scheduled\n// (and therefore is executed) earlier than RAF callback scheduled by `fastRaf`\nexport function fastRaf(callback: NoneToVoidFunction, withTimeoutFallback = false) {\n  if (!fastRafCallbacks) {\n    fastRafCallbacks = new Set([callback]);\n\n    requestAnimationFrame(() => {\n      const currentCallbacks = fastRafCallbacks!;\n\n      fastRafCallbacks = undefined;\n      fastRafFallbackCallbacks = undefined;\n\n      if (fastRafFallbackTimeout) {\n        clearTimeout(fastRafFallbackTimeout);\n        fastRafFallbackTimeout = undefined;\n      }\n\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    fastRafCallbacks.add(callback);\n  }\n\n  if (withTimeoutFallback) {\n    if (!fastRafFallbackCallbacks) {\n      fastRafFallbackCallbacks = new Set([callback]);\n    } else {\n      fastRafFallbackCallbacks.add(callback);\n    }\n\n    if (!fastRafFallbackTimeout) {\n      fastRafFallbackTimeout = window.setTimeout(() => {\n        const currentTimeoutCallbacks = fastRafFallbackCallbacks!;\n\n        if (fastRafCallbacks) {\n          currentTimeoutCallbacks.forEach(fastRafCallbacks.delete, fastRafCallbacks);\n        }\n        fastRafFallbackCallbacks = undefined;\n\n        if (fastRafFallbackTimeout) {\n          clearTimeout(fastRafFallbackTimeout);\n          fastRafFallbackTimeout = undefined;\n        }\n\n        currentTimeoutCallbacks.forEach((cb) => cb());\n      }, FAST_RAF_TIMEOUT_FALLBACK_MS);\n    }\n  }\n}\n\nlet onTickEndCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onTickEnd(callback: NoneToVoidFunction) {\n  if (!onTickEndCallbacks) {\n    onTickEndCallbacks = [callback];\n\n    void Promise.resolve().then(() => {\n      const currentCallbacks = onTickEndCallbacks!;\n      onTickEndCallbacks = undefined;\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    onTickEndCallbacks.push(callback);\n  }\n}\n\nconst IDLE_TIMEOUT = 500;\n\nlet onIdleCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onIdle(callback: NoneToVoidFunction) {\n  if (!self.requestIdleCallback) {\n    onTickEnd(callback);\n    return;\n  }\n\n  if (!onIdleCallbacks) {\n    onIdleCallbacks = [callback];\n\n    requestIdleCallback((deadline) => {\n      const currentCallbacks = onIdleCallbacks!;\n      onIdleCallbacks = undefined;\n\n      while (currentCallbacks.length) {\n        const cb = currentCallbacks.shift()!;\n        cb();\n\n        if (!deadline.timeRemaining()) break;\n      }\n\n      if (currentCallbacks.length) {\n        if (onIdleCallbacks) {\n          // Prepend the remaining callbacks if the next pass is already planned\n          onIdleCallbacks = currentCallbacks.concat(onIdleCallbacks);\n        } else {\n          currentCallbacks.forEach(onIdle);\n        }\n      }\n    }, { timeout: IDLE_TIMEOUT });\n  } else {\n    onIdleCallbacks.push(callback);\n  }\n}\n\nlet beforeUnloadCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onBeforeUnload(callback: NoneToVoidFunction, isLast = false) {\n  if (!beforeUnloadCallbacks) {\n    beforeUnloadCallbacks = [];\n\n    self.addEventListener('beforeunload', () => {\n      beforeUnloadCallbacks!.forEach((cb) => cb());\n    });\n  }\n\n  if (isLast) {\n    beforeUnloadCallbacks.push(callback);\n  } else {\n    beforeUnloadCallbacks.unshift(callback);\n  }\n\n  return () => {\n    beforeUnloadCallbacks = beforeUnloadCallbacks!.filter((cb) => cb !== callback);\n  };\n}\n\nexport async function waitFor(cb: () => boolean, interval: number, attempts: number) {\n  let i = 0;\n  let result = cb();\n\n  while (!result && i < attempts) {\n    await pause(interval);\n\n    i++;\n    result = cb();\n  }\n\n  return result;\n}\n\nexport function setCancellableTimeout(ms: number, cb: NoneToVoidFunction) {\n  const timeoutId = setTimeout(cb, ms);\n  return () => clearTimeout(timeoutId);\n}\n\n/**\n * Returns a function that executes every given functions (tasks) with limited concurrency (not more than\n * `maxConcurrency` at a time). The tasks are executed in the same order that they are given. Unlike throttle, executes\n * every given task.\n */\nexport function createTaskQueue(maxConcurrency = 1) {\n  const queue: AnyAsyncFunction[] = [];\n  let concurrency = 0;\n\n  const runTasks = async () => {\n    concurrency++;\n    while (queue.length) {\n      const task = queue.shift()!;\n      await task(); // Expected never to throw, because the errors are caught below\n    }\n    concurrency--;\n  };\n\n  /** Schedules execution of the given function right now. The returned promise settles with the task result. */\n  const run = <T>(task: () => MaybePromise<T>): Promise<T> => {\n    const deferred = new Deferred<T>();\n    queue.push(async () => {\n      try {\n        deferred.resolve(await task());\n      } catch (err) {\n        deferred.reject(err);\n      }\n    });\n\n    if (concurrency < maxConcurrency) {\n      void runTasks();\n    }\n\n    return deferred.promise;\n  };\n\n  /** Returns the same task function, but with limited concurrency */\n  const wrap = <Args extends unknown[], Return>(\n    task: (...args: Args) => MaybePromise<Return>,\n  ): (...args: Args) => Promise<Return> => {\n    return (...args: Args) => run(() => task(...args));\n  };\n\n  return { run, wrap };\n}\n\n/**\n * Returns a function that prevents `actions` from running in parallel with itself. If the `action` is already running,\n * queues, the next call will be queued. Unlike `throttle`, never skips the calls.\n */\nexport function forbidConcurrency<Args extends unknown[], Return>(\n  action: (...args: Args) => MaybePromise<Return>,\n): (...args: Args) => Promise<Return> {\n  return createTaskQueue(1).wrap(action);\n}\n","import type { ApiAnyDisplayError } from './types';\nimport { ApiCommonError, ApiTransactionError } from './types';\n\nexport class ApiBaseError extends Error {\n  constructor(message?: string, public displayError?: ApiAnyDisplayError) {\n    super(message);\n    this.name = this.constructor.name;\n  }\n}\n\nexport class ApiUserRejectsError extends ApiBaseError {\n  constructor(message: string = 'Canceled by the user') {\n    super(message);\n  }\n}\n\nexport class ApiServerError extends ApiBaseError {\n  constructor(message: string, public statusCode?: number) {\n    super(message, ApiCommonError.ServerError);\n  }\n}\n\nexport class ApiUnsupportedVersionError extends ApiBaseError {\n  constructor(message: string) {\n    super(message, ApiCommonError.UnsupportedVersion);\n  }\n}\n\nexport class ApiHardwareBlindSigningNotEnabled extends ApiBaseError {\n  constructor(message: string = 'Blind signing not enabled') {\n    super(message, ApiTransactionError.HardwareBlindSigningNotEnabled);\n  }\n}\n\nexport class AbortOperationError extends ApiBaseError {\n  constructor(message: string = 'Abort operation') {\n    super(message);\n  }\n}\n\nexport class NotImplemented extends ApiBaseError {\n  constructor(message: string = 'Not implemented') {\n    super(message);\n  }\n}\n\nexport function maybeApiErrors(fn: AnyAsyncFunction) {\n  return async (...args: any) => {\n    try {\n      return await fn(...args);\n    } catch (err) {\n      return handleServerError(err);\n    }\n  };\n}\n\nexport function handleServerError(err: any) {\n  if (err instanceof ApiServerError) {\n    return { error: err.displayError! };\n  }\n  throw err;\n}\n","import {\n  DEFAULT_ERROR_PAUSE,\n  DEFAULT_RETRIES,\n  DEFAULT_TIMEOUT,\n  IPFS_GATEWAY_BASE_URL,\n  PROXY_API_BASE_URL,\n} from '../config';\nimport { ApiServerError } from '../api/errors';\nimport { logDebug } from './logs';\nimport { pause } from './schedulers';\n\ntype QueryParams = Record<string, string | number | boolean | string[]>;\n\nconst MAX_TIMEOUT = 30000; // 30 sec\n\nexport function fetchJsonWithProxy(url: string | URL, data?: QueryParams, init?: RequestInit) {\n  return fetchJson(getProxiedJsonUrl(url.toString()), data, init);\n}\n\nexport async function fetchJson(url: string | URL, data?: QueryParams, init?: RequestInit) {\n  const urlObject = new URL(url);\n  if (data) {\n    Object.entries(data).forEach(([key, value]) => {\n      if (value === undefined) {\n        return;\n      }\n\n      if (Array.isArray(value)) {\n        value.forEach((item) => {\n          urlObject.searchParams.append(key, item.toString());\n        });\n      } else {\n        urlObject.searchParams.set(key, value.toString());\n      }\n    });\n  }\n\n  const response = await fetchWithRetry(urlObject, init);\n\n  return response.json();\n}\n\nexport async function fetchWithRetry(url: string | URL, init?: RequestInit, options?: {\n  retries?: number;\n  timeouts?: number | number[];\n  shouldSkipRetryFn?: (message?: string, statusCode?: number) => boolean;\n}) {\n  const {\n    retries = DEFAULT_RETRIES,\n    timeouts = DEFAULT_TIMEOUT,\n    shouldSkipRetryFn = isNotTemporaryError,\n  } = options ?? {};\n\n  let message = 'Unknown error.';\n  let statusCode: number | undefined;\n\n  for (let i = 1; i <= retries; i++) {\n    try {\n      if (i > 1) {\n        logDebug(`Retry request #${i}:`, url.toString(), statusCode);\n      }\n\n      const timeout = Array.isArray(timeouts)\n        ? timeouts[i - 1] ?? timeouts[timeouts.length - 1]\n        : Math.min(timeouts * i, MAX_TIMEOUT);\n      const response = await fetchWithTimeout(url, init, timeout);\n      statusCode = response.status;\n\n      if (statusCode >= 400) {\n        const { error } = await response.json().catch(() => {});\n        throw new Error(error ?? `HTTP Error ${statusCode}`);\n      }\n\n      return response;\n    } catch (err: any) {\n      message = typeof err === 'string' ? err : err.message ?? message;\n\n      const shouldSkipRetry = shouldSkipRetryFn(message, statusCode);\n\n      if (shouldSkipRetry) {\n        throw new ApiServerError(message, statusCode);\n      }\n\n      if (i < retries) {\n        await pause(DEFAULT_ERROR_PAUSE * i);\n      }\n    }\n  }\n\n  throw new ApiServerError(message);\n}\n\nexport async function fetchWithTimeout(url: string | URL, init?: RequestInit, timeout = DEFAULT_TIMEOUT) {\n  const controller = new AbortController();\n  const id = setTimeout(() => {\n    controller.abort();\n  }, timeout);\n\n  try {\n    return await fetch(url, {\n      ...init,\n      signal: controller.signal,\n    });\n  } finally {\n    clearTimeout(id);\n  }\n}\n\nexport async function handleFetchErrors(response: Response, ignoreHttpCodes?: number[]) {\n  if (!response.ok && (!ignoreHttpCodes?.includes(response.status))) {\n    // eslint-disable-next-line prefer-const\n    let { error, errors } = await response.json().catch(() => undefined);\n    if (!error && errors && errors.length) {\n      error = errors[0]?.msg;\n    }\n\n    throw new ApiServerError(error ?? `HTTP Error ${response.status}`, response.status);\n  }\n  return response;\n}\n\nfunction isNotTemporaryError(message?: string, statusCode?: number) {\n  return statusCode && [400, 404].includes(statusCode);\n}\n\nexport function getProxiedJsonUrl(url: string) {\n  return `${PROXY_API_BASE_URL}/download-json?url=${encodeURIComponent(url)}`;\n}\n\nexport function getProxiedLottieUrl(url: string) {\n  return `${PROXY_API_BASE_URL}/download-lottie?url=${encodeURIComponent(url)}`;\n}\n\nexport function fixIpfsUrl(url: string) {\n  return url.replace('ipfs://', IPFS_GATEWAY_BASE_URL);\n}\n","import { DEBUG_MORE } from '../config';\nimport { handleError } from './handleError';\n\nconst SAFE_EXEC_ENABLED = !DEBUG_MORE;\n\ntype SafeExecOptions = {\n  rescue?: (err: Error) => void;\n  always?: NoneToVoidFunction;\n  shouldIgnoreError?: boolean;\n};\n\nexport async function safeExecAsync<T extends AnyAsyncFunction>(\n  cb: T,\n  options?: SafeExecOptions,\n): Promise<ReturnType<T> | undefined> {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  const { rescue, always, shouldIgnoreError } = options ?? {};\n\n  try {\n    return await cb();\n  } catch (err: any) {\n    rescue?.(err);\n    if (!shouldIgnoreError) {\n      handleError(err);\n    }\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n\nexport default function safeExec<T extends AnyFunction>(cb: T, options?: SafeExecOptions): ReturnType<T> | undefined {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  const { rescue, always, shouldIgnoreError } = options ?? {};\n\n  try {\n    return cb();\n  } catch (err: any) {\n    rescue?.(err);\n    if (!shouldIgnoreError) {\n      handleError(err);\n    }\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n","// Version 1.7.3\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n      (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.nobleEd25519 = {}));\n})(this, (function (exports) { 'use strict';\n\n  const _nodeResolve_empty = {};\n\n  const nodeCrypto = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    'default': _nodeResolve_empty\n  });\n\n  /*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */\n  const _0n = BigInt(0);\n  const _1n = BigInt(1);\n  const _2n = BigInt(2);\n  const _8n = BigInt(8);\n  const CU_O = BigInt('7237005577332262213973186563042994240857116359379907606001950938285454250989');\n  const CURVE = Object.freeze({\n    a: BigInt(-1),\n    d: BigInt('37095705934669439343138083508754565189542113879843219016388785533085940283555'),\n    P: BigInt('57896044618658097711785492504343953926634992332820282019728792003956564819949'),\n    l: CU_O,\n    n: CU_O,\n    h: BigInt(8),\n    Gx: BigInt('15112221349535400772501151409588531511454012693041857206046113283949847762202'),\n    Gy: BigInt('46316835694926478169428394003475163141307993866256225615783033603165251855960'),\n  });\n  const POW_2_256 = BigInt('0x10000000000000000000000000000000000000000000000000000000000000000');\n  const SQRT_M1 = BigInt('19681161376707505956807079304988542015446066515923890162744021073123829784752');\n  BigInt('6853475219497561581579357271197624642482790079785650197046958215289687604742');\n  const SQRT_AD_MINUS_ONE = BigInt('25063068953384623474111414158702152701244531502492656460079210482610430750235');\n  const INVSQRT_A_MINUS_D = BigInt('54469307008909316920995813868745141605393597292927456921205312896311721017578');\n  const ONE_MINUS_D_SQ = BigInt('1159843021668779879193775521855586647937357759715417654439879720876111806838');\n  const D_MINUS_ONE_SQ = BigInt('40440834346308536858101042469323190826248399146238708352240133220865137265952');\n  class ExtendedPoint {\n    constructor(x, y, z, t) {\n      this.x = x;\n      this.y = y;\n      this.z = z;\n      this.t = t;\n    }\n    static fromAffine(p) {\n      if (!(p instanceof Point)) {\n        throw new TypeError('ExtendedPoint#fromAffine: expected Point');\n      }\n      if (p.equals(Point.ZERO))\n        return ExtendedPoint.ZERO;\n      return new ExtendedPoint(p.x, p.y, _1n, mod(p.x * p.y));\n    }\n    static toAffineBatch(points) {\n      const toInv = invertBatch(points.map((p) => p.z));\n      return points.map((p, i) => p.toAffine(toInv[i]));\n    }\n    static normalizeZ(points) {\n      return this.toAffineBatch(points).map(this.fromAffine);\n    }\n    equals(other) {\n      assertExtPoint(other);\n      const { x: X1, y: Y1, z: Z1 } = this;\n      const { x: X2, y: Y2, z: Z2 } = other;\n      const X1Z2 = mod(X1 * Z2);\n      const X2Z1 = mod(X2 * Z1);\n      const Y1Z2 = mod(Y1 * Z2);\n      const Y2Z1 = mod(Y2 * Z1);\n      return X1Z2 === X2Z1 && Y1Z2 === Y2Z1;\n    }\n    negate() {\n      return new ExtendedPoint(mod(-this.x), this.y, this.z, mod(-this.t));\n    }\n    double() {\n      const { x: X1, y: Y1, z: Z1 } = this;\n      const { a } = CURVE;\n      const A = mod(X1 * X1);\n      const B = mod(Y1 * Y1);\n      const C = mod(_2n * mod(Z1 * Z1));\n      const D = mod(a * A);\n      const x1y1 = X1 + Y1;\n      const E = mod(mod(x1y1 * x1y1) - A - B);\n      const G = D + B;\n      const F = G - C;\n      const H = D - B;\n      const X3 = mod(E * F);\n      const Y3 = mod(G * H);\n      const T3 = mod(E * H);\n      const Z3 = mod(F * G);\n      return new ExtendedPoint(X3, Y3, Z3, T3);\n    }\n    add(other) {\n      assertExtPoint(other);\n      const { x: X1, y: Y1, z: Z1, t: T1 } = this;\n      const { x: X2, y: Y2, z: Z2, t: T2 } = other;\n      const A = mod((Y1 - X1) * (Y2 + X2));\n      const B = mod((Y1 + X1) * (Y2 - X2));\n      const F = mod(B - A);\n      if (F === _0n)\n        return this.double();\n      const C = mod(Z1 * _2n * T2);\n      const D = mod(T1 * _2n * Z2);\n      const E = D + C;\n      const G = B + A;\n      const H = D - C;\n      const X3 = mod(E * F);\n      const Y3 = mod(G * H);\n      const T3 = mod(E * H);\n      const Z3 = mod(F * G);\n      return new ExtendedPoint(X3, Y3, Z3, T3);\n    }\n    subtract(other) {\n      return this.add(other.negate());\n    }\n    precomputeWindow(W) {\n      const windows = 1 + 256 / W;\n      const points = [];\n      let p = this;\n      let base = p;\n      for (let window = 0; window < windows; window++) {\n        base = p;\n        points.push(base);\n        for (let i = 1; i < 2 ** (W - 1); i++) {\n          base = base.add(p);\n          points.push(base);\n        }\n        p = base.double();\n      }\n      return points;\n    }\n    wNAF(n, affinePoint) {\n      if (!affinePoint && this.equals(ExtendedPoint.BASE))\n        affinePoint = Point.BASE;\n      const W = (affinePoint && affinePoint._WINDOW_SIZE) || 1;\n      if (256 % W) {\n        throw new Error('Point#wNAF: Invalid precomputation window, must be power of 2');\n      }\n      let precomputes = affinePoint && pointPrecomputes.get(affinePoint);\n      if (!precomputes) {\n        precomputes = this.precomputeWindow(W);\n        if (affinePoint && W !== 1) {\n          precomputes = ExtendedPoint.normalizeZ(precomputes);\n          pointPrecomputes.set(affinePoint, precomputes);\n        }\n      }\n      let p = ExtendedPoint.ZERO;\n      let f = ExtendedPoint.BASE;\n      const windows = 1 + 256 / W;\n      const windowSize = 2 ** (W - 1);\n      const mask = BigInt(2 ** W - 1);\n      const maxNumber = 2 ** W;\n      const shiftBy = BigInt(W);\n      for (let window = 0; window < windows; window++) {\n        const offset = window * windowSize;\n        let wbits = Number(n & mask);\n        n >>= shiftBy;\n        if (wbits > windowSize) {\n          wbits -= maxNumber;\n          n += _1n;\n        }\n        const offset1 = offset;\n        const offset2 = offset + Math.abs(wbits) - 1;\n        const cond1 = window % 2 !== 0;\n        const cond2 = wbits < 0;\n        if (wbits === 0) {\n          f = f.add(constTimeNegate(cond1, precomputes[offset1]));\n        }\n        else {\n          p = p.add(constTimeNegate(cond2, precomputes[offset2]));\n        }\n      }\n      return ExtendedPoint.normalizeZ([p, f])[0];\n    }\n    multiply(scalar, affinePoint) {\n      return this.wNAF(normalizeScalar(scalar, CURVE.l), affinePoint);\n    }\n    multiplyUnsafe(scalar) {\n      let n = normalizeScalar(scalar, CURVE.l, false);\n      const G = ExtendedPoint.BASE;\n      const P0 = ExtendedPoint.ZERO;\n      if (n === _0n)\n        return P0;\n      if (this.equals(P0) || n === _1n)\n        return this;\n      if (this.equals(G))\n        return this.wNAF(n);\n      let p = P0;\n      let d = this;\n      while (n > _0n) {\n        if (n & _1n)\n          p = p.add(d);\n        d = d.double();\n        n >>= _1n;\n      }\n      return p;\n    }\n    isSmallOrder() {\n      return this.multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO);\n    }\n    isTorsionFree() {\n      let p = this.multiplyUnsafe(CURVE.l / _2n).double();\n      if (CURVE.l % _2n)\n        p = p.add(this);\n      return p.equals(ExtendedPoint.ZERO);\n    }\n    toAffine(invZ) {\n      const { x, y, z } = this;\n      const is0 = this.equals(ExtendedPoint.ZERO);\n      if (invZ == null)\n        invZ = is0 ? _8n : invert(z);\n      const ax = mod(x * invZ);\n      const ay = mod(y * invZ);\n      const zz = mod(z * invZ);\n      if (is0)\n        return Point.ZERO;\n      if (zz !== _1n)\n        throw new Error('invZ was invalid');\n      return new Point(ax, ay);\n    }\n    fromRistrettoBytes() {\n      legacyRist();\n    }\n    toRistrettoBytes() {\n      legacyRist();\n    }\n    fromRistrettoHash() {\n      legacyRist();\n    }\n  }\n  ExtendedPoint.BASE = new ExtendedPoint(CURVE.Gx, CURVE.Gy, _1n, mod(CURVE.Gx * CURVE.Gy));\n  ExtendedPoint.ZERO = new ExtendedPoint(_0n, _1n, _1n, _0n);\n  function constTimeNegate(condition, item) {\n    const neg = item.negate();\n    return condition ? neg : item;\n  }\n  function assertExtPoint(other) {\n    if (!(other instanceof ExtendedPoint))\n      throw new TypeError('ExtendedPoint expected');\n  }\n  function assertRstPoint(other) {\n    if (!(other instanceof RistrettoPoint))\n      throw new TypeError('RistrettoPoint expected');\n  }\n  function legacyRist() {\n    throw new Error('Legacy method: switch to RistrettoPoint');\n  }\n  class RistrettoPoint {\n    constructor(ep) {\n      this.ep = ep;\n    }\n    static calcElligatorRistrettoMap(r0) {\n      const { d } = CURVE;\n      const r = mod(SQRT_M1 * r0 * r0);\n      const Ns = mod((r + _1n) * ONE_MINUS_D_SQ);\n      let c = BigInt(-1);\n      const D = mod((c - d * r) * mod(r + d));\n      let { isValid: Ns_D_is_sq, value: s } = uvRatio(Ns, D);\n      let s_ = mod(s * r0);\n      if (!edIsNegative(s_))\n        s_ = mod(-s_);\n      if (!Ns_D_is_sq)\n        s = s_;\n      if (!Ns_D_is_sq)\n        c = r;\n      const Nt = mod(c * (r - _1n) * D_MINUS_ONE_SQ - D);\n      const s2 = s * s;\n      const W0 = mod((s + s) * D);\n      const W1 = mod(Nt * SQRT_AD_MINUS_ONE);\n      const W2 = mod(_1n - s2);\n      const W3 = mod(_1n + s2);\n      return new ExtendedPoint(mod(W0 * W3), mod(W2 * W1), mod(W1 * W3), mod(W0 * W2));\n    }\n    static hashToCurve(hex) {\n      hex = ensureBytes(hex, 64);\n      const r1 = bytes255ToNumberLE(hex.slice(0, 32));\n      const R1 = this.calcElligatorRistrettoMap(r1);\n      const r2 = bytes255ToNumberLE(hex.slice(32, 64));\n      const R2 = this.calcElligatorRistrettoMap(r2);\n      return new RistrettoPoint(R1.add(R2));\n    }\n    static fromHex(hex) {\n      hex = ensureBytes(hex, 32);\n      const { a, d } = CURVE;\n      const emsg = 'RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint';\n      const s = bytes255ToNumberLE(hex);\n      if (!equalBytes(numberTo32BytesLE(s), hex) || edIsNegative(s))\n        throw new Error(emsg);\n      const s2 = mod(s * s);\n      const u1 = mod(_1n + a * s2);\n      const u2 = mod(_1n - a * s2);\n      const u1_2 = mod(u1 * u1);\n      const u2_2 = mod(u2 * u2);\n      const v = mod(a * d * u1_2 - u2_2);\n      const { isValid, value: I } = invertSqrt(mod(v * u2_2));\n      const Dx = mod(I * u2);\n      const Dy = mod(I * Dx * v);\n      let x = mod((s + s) * Dx);\n      if (edIsNegative(x))\n        x = mod(-x);\n      const y = mod(u1 * Dy);\n      const t = mod(x * y);\n      if (!isValid || edIsNegative(t) || y === _0n)\n        throw new Error(emsg);\n      return new RistrettoPoint(new ExtendedPoint(x, y, _1n, t));\n    }\n    toRawBytes() {\n      let { x, y, z, t } = this.ep;\n      const u1 = mod(mod(z + y) * mod(z - y));\n      const u2 = mod(x * y);\n      const u2sq = mod(u2 * u2);\n      const { value: invsqrt } = invertSqrt(mod(u1 * u2sq));\n      const D1 = mod(invsqrt * u1);\n      const D2 = mod(invsqrt * u2);\n      const zInv = mod(D1 * D2 * t);\n      let D;\n      if (edIsNegative(t * zInv)) {\n        let _x = mod(y * SQRT_M1);\n        let _y = mod(x * SQRT_M1);\n        x = _x;\n        y = _y;\n        D = mod(D1 * INVSQRT_A_MINUS_D);\n      }\n      else {\n        D = D2;\n      }\n      if (edIsNegative(x * zInv))\n        y = mod(-y);\n      let s = mod((z - y) * D);\n      if (edIsNegative(s))\n        s = mod(-s);\n      return numberTo32BytesLE(s);\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n    toString() {\n      return this.toHex();\n    }\n    equals(other) {\n      assertRstPoint(other);\n      const a = this.ep;\n      const b = other.ep;\n      const one = mod(a.x * b.y) === mod(a.y * b.x);\n      const two = mod(a.y * b.y) === mod(a.x * b.x);\n      return one || two;\n    }\n    add(other) {\n      assertRstPoint(other);\n      return new RistrettoPoint(this.ep.add(other.ep));\n    }\n    subtract(other) {\n      assertRstPoint(other);\n      return new RistrettoPoint(this.ep.subtract(other.ep));\n    }\n    multiply(scalar) {\n      return new RistrettoPoint(this.ep.multiply(scalar));\n    }\n    multiplyUnsafe(scalar) {\n      return new RistrettoPoint(this.ep.multiplyUnsafe(scalar));\n    }\n  }\n  RistrettoPoint.BASE = new RistrettoPoint(ExtendedPoint.BASE);\n  RistrettoPoint.ZERO = new RistrettoPoint(ExtendedPoint.ZERO);\n  const pointPrecomputes = new WeakMap();\n  class Point {\n    constructor(x, y) {\n      this.x = x;\n      this.y = y;\n    }\n    _setWindowSize(windowSize) {\n      this._WINDOW_SIZE = windowSize;\n      pointPrecomputes.delete(this);\n    }\n    static fromHex(hex, strict = true) {\n      const { d, P } = CURVE;\n      hex = ensureBytes(hex, 32);\n      const normed = hex.slice();\n      normed[31] = hex[31] & ~0x80;\n      const y = bytesToNumberLE(normed);\n      if (strict && y >= P)\n        throw new Error('Expected 0 < hex < P');\n      if (!strict && y >= POW_2_256)\n        throw new Error('Expected 0 < hex < 2**256');\n      const y2 = mod(y * y);\n      const u = mod(y2 - _1n);\n      const v = mod(d * y2 + _1n);\n      let { isValid, value: x } = uvRatio(u, v);\n      if (!isValid)\n        throw new Error('Point.fromHex: invalid y coordinate');\n      const isXOdd = (x & _1n) === _1n;\n      const isLastByteOdd = (hex[31] & 0x80) !== 0;\n      if (isLastByteOdd !== isXOdd) {\n        x = mod(-x);\n      }\n      return new Point(x, y);\n    }\n    static async fromPrivateKey(privateKey) {\n      return (await getExtendedPublicKey(privateKey)).point;\n    }\n    toRawBytes() {\n      const bytes = numberTo32BytesLE(this.y);\n      bytes[31] |= this.x & _1n ? 0x80 : 0;\n      return bytes;\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n    toX25519() {\n      const { y } = this;\n      const u = mod((_1n + y) * invert(_1n - y));\n      return numberTo32BytesLE(u);\n    }\n    isTorsionFree() {\n      return ExtendedPoint.fromAffine(this).isTorsionFree();\n    }\n    equals(other) {\n      return this.x === other.x && this.y === other.y;\n    }\n    negate() {\n      return new Point(mod(-this.x), this.y);\n    }\n    add(other) {\n      return ExtendedPoint.fromAffine(this).add(ExtendedPoint.fromAffine(other)).toAffine();\n    }\n    subtract(other) {\n      return this.add(other.negate());\n    }\n    multiply(scalar) {\n      return ExtendedPoint.fromAffine(this).multiply(scalar, this).toAffine();\n    }\n  }\n  Point.BASE = new Point(CURVE.Gx, CURVE.Gy);\n  Point.ZERO = new Point(_0n, _1n);\n  class Signature {\n    constructor(r, s) {\n      this.r = r;\n      this.s = s;\n      this.assertValidity();\n    }\n    static fromHex(hex) {\n      const bytes = ensureBytes(hex, 64);\n      const r = Point.fromHex(bytes.slice(0, 32), false);\n      const s = bytesToNumberLE(bytes.slice(32, 64));\n      return new Signature(r, s);\n    }\n    assertValidity() {\n      const { r, s } = this;\n      if (!(r instanceof Point))\n        throw new Error('Expected Point instance');\n      normalizeScalar(s, CURVE.l, false);\n      return this;\n    }\n    toRawBytes() {\n      const u8 = new Uint8Array(64);\n      u8.set(this.r.toRawBytes());\n      u8.set(numberTo32BytesLE(this.s), 32);\n      return u8;\n    }\n    toHex() {\n      return bytesToHex(this.toRawBytes());\n    }\n  }\n  function concatBytes(...arrays) {\n    if (!arrays.every((a) => a instanceof Uint8Array))\n      throw new Error('Expected Uint8Array list');\n    if (arrays.length === 1)\n      return arrays[0];\n    const length = arrays.reduce((a, arr) => a + arr.length, 0);\n    const result = new Uint8Array(length);\n    for (let i = 0, pad = 0; i < arrays.length; i++) {\n      const arr = arrays[i];\n      result.set(arr, pad);\n      pad += arr.length;\n    }\n    return result;\n  }\n  const hexes = Array.from({ length: 256 }, (v, i) => i.toString(16).padStart(2, '0'));\n  function bytesToHex(uint8a) {\n    if (!(uint8a instanceof Uint8Array))\n      throw new Error('Uint8Array expected');\n    let hex = '';\n    for (let i = 0; i < uint8a.length; i++) {\n      hex += hexes[uint8a[i]];\n    }\n    return hex;\n  }\n  function hexToBytes(hex) {\n    if (typeof hex !== 'string') {\n      throw new TypeError('hexToBytes: expected string, got ' + typeof hex);\n    }\n    if (hex.length % 2)\n      throw new Error('hexToBytes: received invalid unpadded hex');\n    const array = new Uint8Array(hex.length / 2);\n    for (let i = 0; i < array.length; i++) {\n      const j = i * 2;\n      const hexByte = hex.slice(j, j + 2);\n      const byte = Number.parseInt(hexByte, 16);\n      if (Number.isNaN(byte) || byte < 0)\n        throw new Error('Invalid byte sequence');\n      array[i] = byte;\n    }\n    return array;\n  }\n  function numberTo32BytesBE(num) {\n    const length = 32;\n    const hex = num.toString(16).padStart(length * 2, '0');\n    return hexToBytes(hex);\n  }\n  function numberTo32BytesLE(num) {\n    return numberTo32BytesBE(num).reverse();\n  }\n  function edIsNegative(num) {\n    return (mod(num) & _1n) === _1n;\n  }\n  function bytesToNumberLE(uint8a) {\n    if (!(uint8a instanceof Uint8Array))\n      throw new Error('Expected Uint8Array');\n    return BigInt('0x' + bytesToHex(Uint8Array.from(uint8a).reverse()));\n  }\n  const MAX_255B = BigInt('0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff');\n  function bytes255ToNumberLE(bytes) {\n    return mod(bytesToNumberLE(bytes) & MAX_255B);\n  }\n  function mod(a, b = CURVE.P) {\n    const res = a % b;\n    return res >= _0n ? res : b + res;\n  }\n  function invert(number, modulo = CURVE.P) {\n    if (number === _0n || modulo <= _0n) {\n      throw new Error(`invert: expected positive integers, got n=${number} mod=${modulo}`);\n    }\n    let a = mod(number, modulo);\n    let b = modulo;\n    let x = _0n, u = _1n;\n    while (a !== _0n) {\n      const q = b / a;\n      const r = b % a;\n      const m = x - u * q;\n      b = a, a = r, x = u, u = m;\n    }\n    const gcd = b;\n    if (gcd !== _1n)\n      throw new Error('invert: does not exist');\n    return mod(x, modulo);\n  }\n  function invertBatch(nums, p = CURVE.P) {\n    const tmp = new Array(nums.length);\n    const lastMultiplied = nums.reduce((acc, num, i) => {\n      if (num === _0n)\n        return acc;\n      tmp[i] = acc;\n      return mod(acc * num, p);\n    }, _1n);\n    const inverted = invert(lastMultiplied, p);\n    nums.reduceRight((acc, num, i) => {\n      if (num === _0n)\n        return acc;\n      tmp[i] = mod(acc * tmp[i], p);\n      return mod(acc * num, p);\n    }, inverted);\n    return tmp;\n  }\n  function pow2(x, power) {\n    const { P } = CURVE;\n    let res = x;\n    while (power-- > _0n) {\n      res *= res;\n      res %= P;\n    }\n    return res;\n  }\n  function pow_2_252_3(x) {\n    const { P } = CURVE;\n    const _5n = BigInt(5);\n    const _10n = BigInt(10);\n    const _20n = BigInt(20);\n    const _40n = BigInt(40);\n    const _80n = BigInt(80);\n    const x2 = (x * x) % P;\n    const b2 = (x2 * x) % P;\n    const b4 = (pow2(b2, _2n) * b2) % P;\n    const b5 = (pow2(b4, _1n) * x) % P;\n    const b10 = (pow2(b5, _5n) * b5) % P;\n    const b20 = (pow2(b10, _10n) * b10) % P;\n    const b40 = (pow2(b20, _20n) * b20) % P;\n    const b80 = (pow2(b40, _40n) * b40) % P;\n    const b160 = (pow2(b80, _80n) * b80) % P;\n    const b240 = (pow2(b160, _80n) * b80) % P;\n    const b250 = (pow2(b240, _10n) * b10) % P;\n    const pow_p_5_8 = (pow2(b250, _2n) * x) % P;\n    return { pow_p_5_8, b2 };\n  }\n  function uvRatio(u, v) {\n    const v3 = mod(v * v * v);\n    const v7 = mod(v3 * v3 * v);\n    const pow = pow_2_252_3(u * v7).pow_p_5_8;\n    let x = mod(u * v3 * pow);\n    const vx2 = mod(v * x * x);\n    const root1 = x;\n    const root2 = mod(x * SQRT_M1);\n    const useRoot1 = vx2 === u;\n    const useRoot2 = vx2 === mod(-u);\n    const noRoot = vx2 === mod(-u * SQRT_M1);\n    if (useRoot1)\n      x = root1;\n    if (useRoot2 || noRoot)\n      x = root2;\n    if (edIsNegative(x))\n      x = mod(-x);\n    return { isValid: useRoot1 || useRoot2, value: x };\n  }\n  function invertSqrt(number) {\n    return uvRatio(_1n, number);\n  }\n  function modlLE(hash) {\n    return mod(bytesToNumberLE(hash), CURVE.l);\n  }\n  function equalBytes(b1, b2) {\n    if (b1.length !== b2.length) {\n      return false;\n    }\n    for (let i = 0; i < b1.length; i++) {\n      if (b1[i] !== b2[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n  function ensureBytes(hex, expectedLength) {\n    const bytes = hex instanceof Uint8Array ? Uint8Array.from(hex) : hexToBytes(hex);\n    if (typeof expectedLength === 'number' && bytes.length !== expectedLength)\n      throw new Error(`Expected ${expectedLength} bytes`);\n    return bytes;\n  }\n  function normalizeScalar(num, max, strict = true) {\n    if (!max)\n      throw new TypeError('Specify max value');\n    if (typeof num === 'number' && Number.isSafeInteger(num))\n      num = BigInt(num);\n    if (typeof num === 'bigint' && num < max) {\n      if (strict) {\n        if (_0n < num)\n          return num;\n      }\n      else {\n        if (_0n <= num)\n          return num;\n      }\n    }\n    throw new TypeError('Expected valid scalar: 0 < scalar < max');\n  }\n  function adjustBytes25519(bytes) {\n    bytes[0] &= 248;\n    bytes[31] &= 127;\n    bytes[31] |= 64;\n    return bytes;\n  }\n  function decodeScalar25519(n) {\n    return bytesToNumberLE(adjustBytes25519(ensureBytes(n, 32)));\n  }\n  function checkPrivateKey(key) {\n    key =\n      typeof key === 'bigint' || typeof key === 'number'\n        ? numberTo32BytesBE(normalizeScalar(key, POW_2_256))\n        : ensureBytes(key);\n    if (key.length !== 32)\n      throw new Error(`Expected 32 bytes`);\n    return key;\n  }\n  function getKeyFromHash(hashed) {\n    const head = adjustBytes25519(hashed.slice(0, 32));\n    const prefix = hashed.slice(32, 64);\n    const scalar = modlLE(head);\n    const point = Point.BASE.multiply(scalar);\n    const pointBytes = point.toRawBytes();\n    return { head, prefix, scalar, point, pointBytes };\n  }\n  let _sha512Sync;\n  function sha512s(...m) {\n    if (typeof _sha512Sync !== 'function')\n      throw new Error('utils.sha512Sync must be set to use sync methods');\n    return _sha512Sync(...m);\n  }\n  async function getExtendedPublicKey(key) {\n    return getKeyFromHash(await utils.sha512(checkPrivateKey(key)));\n  }\n  function getExtendedPublicKeySync(key) {\n    return getKeyFromHash(sha512s(checkPrivateKey(key)));\n  }\n  async function getPublicKey(privateKey) {\n    return (await getExtendedPublicKey(privateKey)).pointBytes;\n  }\n  function getPublicKeySync(privateKey) {\n    return getExtendedPublicKeySync(privateKey).pointBytes;\n  }\n  async function sign(message, privateKey) {\n    message = ensureBytes(message);\n    const { prefix, scalar, pointBytes } = await getExtendedPublicKey(privateKey);\n    const r = modlLE(await utils.sha512(prefix, message));\n    const R = Point.BASE.multiply(r);\n    const k = modlLE(await utils.sha512(R.toRawBytes(), pointBytes, message));\n    const s = mod(r + k * scalar, CURVE.l);\n    return new Signature(R, s).toRawBytes();\n  }\n  function signSync(message, privateKey) {\n    message = ensureBytes(message);\n    const { prefix, scalar, pointBytes } = getExtendedPublicKeySync(privateKey);\n    const r = modlLE(sha512s(prefix, message));\n    const R = Point.BASE.multiply(r);\n    const k = modlLE(sha512s(R.toRawBytes(), pointBytes, message));\n    const s = mod(r + k * scalar, CURVE.l);\n    return new Signature(R, s).toRawBytes();\n  }\n  function prepareVerification(sig, message, publicKey) {\n    message = ensureBytes(message);\n    if (!(publicKey instanceof Point))\n      publicKey = Point.fromHex(publicKey, false);\n    const { r, s } = sig instanceof Signature ? sig.assertValidity() : Signature.fromHex(sig);\n    const SB = ExtendedPoint.BASE.multiplyUnsafe(s);\n    return { r, s, SB, pub: publicKey, msg: message };\n  }\n  function finishVerification(publicKey, r, SB, hashed) {\n    const k = modlLE(hashed);\n    const kA = ExtendedPoint.fromAffine(publicKey).multiplyUnsafe(k);\n    const RkA = ExtendedPoint.fromAffine(r).add(kA);\n    return RkA.subtract(SB).multiplyUnsafe(CURVE.h).equals(ExtendedPoint.ZERO);\n  }\n  async function verify(sig, message, publicKey) {\n    const { r, SB, msg, pub } = prepareVerification(sig, message, publicKey);\n    const hashed = await utils.sha512(r.toRawBytes(), pub.toRawBytes(), msg);\n    return finishVerification(pub, r, SB, hashed);\n  }\n  function verifySync(sig, message, publicKey) {\n    const { r, SB, msg, pub } = prepareVerification(sig, message, publicKey);\n    const hashed = sha512s(r.toRawBytes(), pub.toRawBytes(), msg);\n    return finishVerification(pub, r, SB, hashed);\n  }\n  const sync = {\n    getExtendedPublicKey: getExtendedPublicKeySync,\n    getPublicKey: getPublicKeySync,\n    sign: signSync,\n    verify: verifySync,\n  };\n  async function getSharedSecret(privateKey, publicKey) {\n    const { head } = await getExtendedPublicKey(privateKey);\n    const u = Point.fromHex(publicKey).toX25519();\n    return curve25519.scalarMult(head, u);\n  }\n  Point.BASE._setWindowSize(8);\n  function cswap(swap, x_2, x_3) {\n    const dummy = mod(swap * (x_2 - x_3));\n    x_2 = mod(x_2 - dummy);\n    x_3 = mod(x_3 + dummy);\n    return [x_2, x_3];\n  }\n  function montgomeryLadder(pointU, scalar) {\n    const { P } = CURVE;\n    const u = normalizeScalar(pointU, P);\n    const k = normalizeScalar(scalar, P);\n    const a24 = BigInt(121665);\n    const x_1 = u;\n    let x_2 = _1n;\n    let z_2 = _0n;\n    let x_3 = u;\n    let z_3 = _1n;\n    let swap = _0n;\n    let sw;\n    for (let t = BigInt(255 - 1); t >= _0n; t--) {\n      const k_t = (k >> t) & _1n;\n      swap ^= k_t;\n      sw = cswap(swap, x_2, x_3);\n      x_2 = sw[0];\n      x_3 = sw[1];\n      sw = cswap(swap, z_2, z_3);\n      z_2 = sw[0];\n      z_3 = sw[1];\n      swap = k_t;\n      const A = x_2 + z_2;\n      const AA = mod(A * A);\n      const B = x_2 - z_2;\n      const BB = mod(B * B);\n      const E = AA - BB;\n      const C = x_3 + z_3;\n      const D = x_3 - z_3;\n      const DA = mod(D * A);\n      const CB = mod(C * B);\n      const dacb = DA + CB;\n      const da_cb = DA - CB;\n      x_3 = mod(dacb * dacb);\n      z_3 = mod(x_1 * mod(da_cb * da_cb));\n      x_2 = mod(AA * BB);\n      z_2 = mod(E * (AA + mod(a24 * E)));\n    }\n    sw = cswap(swap, x_2, x_3);\n    x_2 = sw[0];\n    x_3 = sw[1];\n    sw = cswap(swap, z_2, z_3);\n    z_2 = sw[0];\n    z_3 = sw[1];\n    const { pow_p_5_8, b2 } = pow_2_252_3(z_2);\n    const xp2 = mod(pow2(pow_p_5_8, BigInt(3)) * b2);\n    return mod(x_2 * xp2);\n  }\n  function encodeUCoordinate(u) {\n    return numberTo32BytesLE(mod(u, CURVE.P));\n  }\n  function decodeUCoordinate(uEnc) {\n    const u = ensureBytes(uEnc, 32);\n    u[31] &= 127;\n    return bytesToNumberLE(u);\n  }\n  const curve25519 = {\n    BASE_POINT_U: '0900000000000000000000000000000000000000000000000000000000000000',\n    scalarMult(privateKey, publicKey) {\n      const u = decodeUCoordinate(publicKey);\n      const p = decodeScalar25519(privateKey);\n      const pu = montgomeryLadder(u, p);\n      if (pu === _0n)\n        throw new Error('Invalid private or public key received');\n      return encodeUCoordinate(pu);\n    },\n    scalarMultBase(privateKey) {\n      return curve25519.scalarMult(privateKey, curve25519.BASE_POINT_U);\n    },\n  };\n  const crypto = {\n    node: nodeCrypto,\n    web: typeof self === 'object' && 'crypto' in self ? self.crypto : undefined,\n  };\n  const utils = {\n    bytesToHex,\n    hexToBytes,\n    concatBytes,\n    getExtendedPublicKey,\n    mod,\n    invert,\n    TORSION_SUBGROUP: [\n      '0100000000000000000000000000000000000000000000000000000000000000',\n      'c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a',\n      '0000000000000000000000000000000000000000000000000000000000000080',\n      '26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05',\n      'ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f',\n      '26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85',\n      '0000000000000000000000000000000000000000000000000000000000000000',\n      'c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa',\n    ],\n    hashToPrivateScalar: (hash) => {\n      hash = ensureBytes(hash);\n      if (hash.length < 40 || hash.length > 1024)\n        throw new Error('Expected 40-1024 bytes of private key as per FIPS 186');\n      return mod(bytesToNumberLE(hash), CURVE.l - _1n) + _1n;\n    },\n    randomBytes: (bytesLength = 32) => {\n      if (crypto.web) {\n        return crypto.web.getRandomValues(new Uint8Array(bytesLength));\n      }\n      else if (crypto.node) {\n        const { randomBytes } = crypto.node;\n        return new Uint8Array(randomBytes(bytesLength).buffer);\n      }\n      else {\n        throw new Error(\"The environment doesn't have randomBytes function\");\n      }\n    },\n    randomPrivateKey: () => {\n      return utils.randomBytes(32);\n    },\n    sha512: async (...messages) => {\n      const message = concatBytes(...messages);\n      if (crypto.web) {\n        const buffer = await crypto.web.subtle.digest('SHA-512', message.buffer);\n        return new Uint8Array(buffer);\n      }\n      else if (crypto.node) {\n        return Uint8Array.from(crypto.node.createHash('sha512').update(message).digest());\n      }\n      else {\n        throw new Error(\"The environment doesn't have sha512 function\");\n      }\n    },\n    precompute(windowSize = 8, point = Point.BASE) {\n      const cached = point.equals(Point.BASE) ? point : new Point(point.x, point.y);\n      cached._setWindowSize(windowSize);\n      cached.multiply(_2n);\n      return cached;\n    },\n    sha512Sync: undefined,\n  };\n  Object.defineProperties(utils, {\n    sha512Sync: {\n      configurable: false,\n      get() {\n        return _sha512Sync;\n      },\n      set(val) {\n        if (!_sha512Sync)\n          _sha512Sync = val;\n      },\n    },\n  });\n\n  exports.CURVE = CURVE;\n  exports.ExtendedPoint = ExtendedPoint;\n  exports.Point = Point;\n  exports.RistrettoPoint = RistrettoPoint;\n  exports.Signature = Signature;\n  exports.curve25519 = curve25519;\n  exports.getPublicKey = getPublicKey;\n  exports.getSharedSecret = getSharedSecret;\n  exports.sign = sign;\n  exports.sync = sync;\n  exports.utils = utils;\n  exports.verify = verify;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","import { DEBUG, DEBUG_API } from '../config';\nimport { AssertionError } from './assert';\n\nexport interface Log {\n  message: string;\n  args: any[];\n  time: number; // Passing data from the worker to the application as a date object is not supported\n  level: 'debug' | 'debugError';\n}\n\nconst MAX_LOG_LENGTH = 999;\nconst logs: Log[] = [];\n\nexport function errorReplacer(_: string, value: any) {\n  if (value instanceof Error) {\n    return {\n      name: value.name,\n      message: value.message,\n      stack: value.stack,\n      metadata: value instanceof AssertionError ? value.metadata : undefined,\n    };\n  }\n  return value;\n}\n\nexport function addLog(log: Omit<Log, 'time'>) {\n  if (logs.length > MAX_LOG_LENGTH) {\n    logs.shift();\n  }\n\n  logs.push({\n    ...log,\n    args: log.args.map((arg) => JSON.stringify(arg, errorReplacer)),\n    time: Date.now(),\n  });\n}\n\nexport function getLogs() {\n  return logs;\n}\n\nexport function logDebugError(message: string, ...args: any[]) {\n  addLog({ message, level: 'debugError', args });\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.error(`[DEBUG][${message}]`, ...args);\n  }\n}\n\nexport function logDebug(message: any, ...args: any[]) {\n  addLog({ message, level: 'debug', args });\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log(`[DEBUG] ${message}`, ...args);\n  }\n}\n\nexport function logDebugApi(message: any, obj1: any, obj2?: any) {\n  if (DEBUG_API) {\n    // eslint-disable-next-line no-console\n    console.debug(`[DEBUG] ${message}`);\n    // eslint-disable-next-line no-console\n    if (obj1) console.dir(obj1);\n    // eslint-disable-next-line no-console\n    if (obj2) console.dir(obj2);\n  }\n}\n\nexport function logSelfXssWarnings() {\n  const selfXssWarnings: AnyLiteral = {\n    en: 'WARNING! This console can be a way for bad people to take over your crypto wallet through something called '\n      + 'a Self-XSS attack. So, don\\'t put in or paste code you don\\'t understand. Stay safe!',\n    ru: 'ВНИМАНИЕ! Через эту консоль злоумышленники могут захватить ваш криптовалютный кошелёк с помощью так '\n      + 'называемой атаки Self-XSS. Поэтому не вводите и не вставляйте код, который вы не понимаете. Берегите себя!',\n    es: '¡ADVERTENCIA! Esta consola puede ser una forma en que las personas malintencionadas se apoderen de su '\n      + 'billetera de criptomonedas mediante un ataque llamado Self-XSS. Por lo tanto, '\n      + 'no introduzca ni pegue código que no comprenda. ¡Cuídese!',\n    zh: '警告！这个控制台可能成为坏人通过所谓的Self-XSS攻击来接管你的加密货币钱包的方式。因此，请不要输入或粘贴您不理解的代码。请保护自己！',\n  };\n\n  const langCode = navigator.language.split('-')[0];\n  const text = selfXssWarnings[langCode] || selfXssWarnings.en;\n\n  // eslint-disable-next-line no-console\n  console.log('%c%s', 'color: red; background: yellow; font-size: 18px;', text);\n}\n","export enum ApiCommonError {\n  Unexpected = 'Unexpected',\n  ServerError = 'ServerError',\n  DebugError = 'DebugError',\n  UnsupportedVersion = 'UnsupportedVersion',\n}\n\nexport enum ApiAuthError {\n  InvalidMnemonic = 'InvalidMnemonic',\n  InvalidAddress = 'InvalidAddress',\n  DomainNotResolved = 'DomainNotResolved',\n}\n\nexport enum ApiTransactionDraftError {\n  InvalidAmount = 'InvalidAmount',\n  InvalidToAddress = 'InvalidToAddress',\n  InsufficientBalance = 'InsufficientBalance',\n  InvalidStateInit = 'InvalidStateInit',\n  StateInitWithoutBin = 'StateInitWithoutBin',\n  DomainNotResolved = 'DomainNotResolved',\n  WalletNotInitialized = 'WalletNotInitialized',\n  InvalidAddressFormat = 'InvalidAddressFormat',\n  InactiveContract = 'InactiveContract',\n}\n\nexport enum ApiTransactionError {\n  PartialTransactionFailure = 'PartialTransactionFailure',\n  IncorrectDeviceTime = 'IncorrectDeviceTime',\n  InsufficientBalance = 'InsufficientBalance',\n  UnsuccesfulTransfer = 'UnsuccesfulTransfer',\n  NotSupportedHardwareOperation = 'NotSupportedHardwareOperation',\n  HardwareBlindSigningNotEnabled = 'HardwareBlindSigningNotEnabled',\n  WrongAddress = 'WrongAddress',\n  WrongNetwork = 'WrongNetwork',\n}\n\nexport type ApiAnyDisplayError = ApiCommonError | ApiAuthError | ApiTransactionDraftError | ApiTransactionError;\n","export class AssertionError extends Error {\n  constructor(\n    message: string,\n    // Any additional information for the error to help debug it. Don't put sensitive information here.\n    public metadata?: unknown,\n  ) {\n    super(message);\n  }\n}\n\nexport function assert(condition: boolean, message: string, metadata?: unknown) {\n  if (!condition) {\n    throw new AssertionError(message, metadata);\n  }\n}\n","import type { Address, Dictionary } from '@ton/core';\n\nexport type AddrList = Dictionary<Address, boolean>;\n\nexport const JettonStakingOpCodes = {\n  GET_STATIC_DATA: 0X2FCB26A2,\n  REPORT_STATIC_DATA: 0X8B771735,\n  GET_STORAGE_DATA: 0X5B88E5CC,\n  REPORT_STORAGE_DATA: 0XAAB4A8EF,\n  EXCESSES: 0XD53276DB,\n\n  // Jettons,\n  TRANSFER_JETTON: 0X0F8A7EA5,\n  INTERNAL_TRANSFER: 0X178D4519,\n  TRANSFER_NOTIFICATION: 0X7362D09C,\n  PROVIDE_WALLET_ADDRESS: 0X2C76B973,\n  TAKE_WALLET_ADDRESS: 0XD1735400,\n  BURN_JETTON: 0X595F07BC,\n\n  // Staking pool,\n  STAKE_JETTONS: 0XE3A06989,\n  ADD_REWARDS: 0XDB16AC95,\n  SEND_CLAIMED_REWARDS: 0X44BC1FE3,\n  SEND_UNSTAKED_JETTONS: 0XFB232BC3,\n  APPROVE_STAKE: 0X919DE781,\n  CANCEL_STAKE: 0X9EADA1D9,\n  ADD_REWARD_JETTONS: 0X10676AE7,\n  CLAIM_COMMISSIONS: 0XBCA8F067,\n  REQUEST_UPDATE_REWARDS: 0XF5C5BAA3,\n\n  // Staked jetton wallet,\n  CLAIM_REWARDS: 0X78D9F109,\n  RECEIVE_JETTONS: 0XD68A4AC1,\n  UNSTAKE_JETTONS: 0X499A9262,\n  UNSTAKE_REQUEST: 0X0168D4B7,\n  CANCEL_UNSTAKE_REQUEST: 0XA4910F1A,\n  UPDATE_REWARDS: 0XAE9307CE,\n  CONFIRM_TRANSFER: 0XBC85EB11,\n\n  // Pools admin,\n  DEPLOY_NEW_POOL: 0XDA861F17,\n  SEND_COMMISSIONS: 0XB96ADAEA,\n  SET_CODE: 0xe2d2d211,\n  CHANGE_CREATION_FEE: 0x66D5528B,\n  CHANGE_CONTENT: 0x0ec29200,\n  UPDATE_CODES: 0x85c923cf,\n};\n\nexport const JettonStakingGas = {\n  MIN_RESERVE: 20_000_000n,\n  DEPLOY_POOL: 340_000_000n,\n  NOTIFICATION: 340_000_000n,\n  JETTON_TRANSFER: 55_000_000n,\n  BURN_JETTONS: 340_000_000n,\n  STAKE_JETTONS: 300_000_000n, // It was 340000000n\n  UNSTAKE_JETTONS: 340_000_000n,\n  CANCEL_UNSTAKE: 340_000_000n,\n  SEND_COMMISSIONS: 340_000_000n,\n  SIMPLE_UPDATE_REQUEST: 340_000_000n,\n  ADD_REWARDS: 340_000_000n,\n  APPROVE_TRANSFER: 340_000_000n,\n  SAVE_UPDATED_REWARDS: 340_000_000n,\n  MIN_EXCESS: 10_000_000n,\n  SEND_STAKED_JETTONS: 630_000_000n,\n};\n\nexport const Dividers = {\n  COMMISSION_DIVIDER: 10000n,\n  REWARDS_DIVIDER: 1000,\n  DISTRIBUTION_SPEED_DIVIDER: BigInt(24 * 60 * 60),\n  DISTRIBUTED_REWARDS_DIVIDER: 100000000000000000000000000000000000000n,\n};\n","// Version 3.1.2\n/*! MIT License. Copyright 2015-2018 Richard Moore <me@ricmoo.com>. See LICENSE.txt. */\n(function(root) {\n  \"use strict\";\n\n  function checkInt(value) {\n    return (parseInt(value) === value);\n  }\n\n  function checkInts(arrayish) {\n    if (!checkInt(arrayish.length)) { return false; }\n\n    for (var i = 0; i < arrayish.length; i++) {\n      if (!checkInt(arrayish[i]) || arrayish[i] < 0 || arrayish[i] > 255) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  function coerceArray(arg, copy) {\n\n    // ArrayBuffer view\n    if (arg.buffer && arg.name === 'Uint8Array') {\n\n      if (copy) {\n        if (arg.slice) {\n          arg = arg.slice();\n        } else {\n          arg = Array.prototype.slice.call(arg);\n        }\n      }\n\n      return arg;\n    }\n\n    // It's an array; check it is a valid representation of a byte\n    if (Array.isArray(arg)) {\n      if (!checkInts(arg)) {\n        throw new Error('Array contains invalid value: ' + arg);\n      }\n\n      return new Uint8Array(arg);\n    }\n\n    // Something else, but behaves like an array (maybe a Buffer? Arguments?)\n    if (checkInt(arg.length) && checkInts(arg)) {\n      return new Uint8Array(arg);\n    }\n\n    throw new Error('unsupported array-like object');\n  }\n\n  function createArray(length) {\n    return new Uint8Array(length);\n  }\n\n  function copyArray(sourceArray, targetArray, targetStart, sourceStart, sourceEnd) {\n    if (sourceStart != null || sourceEnd != null) {\n      if (sourceArray.slice) {\n        sourceArray = sourceArray.slice(sourceStart, sourceEnd);\n      } else {\n        sourceArray = Array.prototype.slice.call(sourceArray, sourceStart, sourceEnd);\n      }\n    }\n    targetArray.set(sourceArray, targetStart);\n  }\n\n\n\n  var convertUtf8 = (function() {\n    function toBytes(text) {\n      var result = [], i = 0;\n      text = encodeURI(text);\n      while (i < text.length) {\n        var c = text.charCodeAt(i++);\n\n        // if it is a % sign, encode the following 2 bytes as a hex value\n        if (c === 37) {\n          result.push(parseInt(text.substr(i, 2), 16))\n          i += 2;\n\n          // otherwise, just the actual byte\n        } else {\n          result.push(c)\n        }\n      }\n\n      return coerceArray(result);\n    }\n\n    function fromBytes(bytes) {\n      var result = [], i = 0;\n\n      while (i < bytes.length) {\n        var c = bytes[i];\n\n        if (c < 128) {\n          result.push(String.fromCharCode(c));\n          i++;\n        } else if (c > 191 && c < 224) {\n          result.push(String.fromCharCode(((c & 0x1f) << 6) | (bytes[i + 1] & 0x3f)));\n          i += 2;\n        } else {\n          result.push(String.fromCharCode(((c & 0x0f) << 12) | ((bytes[i + 1] & 0x3f) << 6) | (bytes[i + 2] & 0x3f)));\n          i += 3;\n        }\n      }\n\n      return result.join('');\n    }\n\n    return {\n      toBytes: toBytes,\n      fromBytes: fromBytes,\n    }\n  })();\n\n  var convertHex = (function() {\n    function toBytes(text) {\n      var result = [];\n      for (var i = 0; i < text.length; i += 2) {\n        result.push(parseInt(text.substr(i, 2), 16));\n      }\n\n      return result;\n    }\n\n    // http://ixti.net/development/javascript/2011/11/11/base64-encodedecode-of-utf8-in-browser-with-js.html\n    var Hex = '0123456789abcdef';\n\n    function fromBytes(bytes) {\n      var result = [];\n      for (var i = 0; i < bytes.length; i++) {\n        var v = bytes[i];\n        result.push(Hex[(v & 0xf0) >> 4] + Hex[v & 0x0f]);\n      }\n      return result.join('');\n    }\n\n    return {\n      toBytes: toBytes,\n      fromBytes: fromBytes,\n    }\n  })();\n\n\n  // Number of rounds by keysize\n  var numberOfRounds = {16: 10, 24: 12, 32: 14}\n\n  // Round constant words\n  var rcon = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d, 0x9a, 0x2f, 0x5e, 0xbc, 0x63, 0xc6, 0x97, 0x35, 0x6a, 0xd4, 0xb3, 0x7d, 0xfa, 0xef, 0xc5, 0x91];\n\n  // S-box and Inverse S-box (S is for Substitution)\n  var S = [0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, 0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, 0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, 0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, 0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, 0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, 0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16];\n  var Si =[0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, 0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, 0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, 0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, 0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, 0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, 0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, 0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, 0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, 0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, 0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, 0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, 0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, 0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, 0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d];\n\n  // Transformations for encryption\n  var T1 = [0xc66363a5, 0xf87c7c84, 0xee777799, 0xf67b7b8d, 0xfff2f20d, 0xd66b6bbd, 0xde6f6fb1, 0x91c5c554, 0x60303050, 0x02010103, 0xce6767a9, 0x562b2b7d, 0xe7fefe19, 0xb5d7d762, 0x4dababe6, 0xec76769a, 0x8fcaca45, 0x1f82829d, 0x89c9c940, 0xfa7d7d87, 0xeffafa15, 0xb25959eb, 0x8e4747c9, 0xfbf0f00b, 0x41adadec, 0xb3d4d467, 0x5fa2a2fd, 0x45afafea, 0x239c9cbf, 0x53a4a4f7, 0xe4727296, 0x9bc0c05b, 0x75b7b7c2, 0xe1fdfd1c, 0x3d9393ae, 0x4c26266a, 0x6c36365a, 0x7e3f3f41, 0xf5f7f702, 0x83cccc4f, 0x6834345c, 0x51a5a5f4, 0xd1e5e534, 0xf9f1f108, 0xe2717193, 0xabd8d873, 0x62313153, 0x2a15153f, 0x0804040c, 0x95c7c752, 0x46232365, 0x9dc3c35e, 0x30181828, 0x379696a1, 0x0a05050f, 0x2f9a9ab5, 0x0e070709, 0x24121236, 0x1b80809b, 0xdfe2e23d, 0xcdebeb26, 0x4e272769, 0x7fb2b2cd, 0xea75759f, 0x1209091b, 0x1d83839e, 0x582c2c74, 0x341a1a2e, 0x361b1b2d, 0xdc6e6eb2, 0xb45a5aee, 0x5ba0a0fb, 0xa45252f6, 0x763b3b4d, 0xb7d6d661, 0x7db3b3ce, 0x5229297b, 0xdde3e33e, 0x5e2f2f71, 0x13848497, 0xa65353f5, 0xb9d1d168, 0x00000000, 0xc1eded2c, 0x40202060, 0xe3fcfc1f, 0x79b1b1c8, 0xb65b5bed, 0xd46a6abe, 0x8dcbcb46, 0x67bebed9, 0x7239394b, 0x944a4ade, 0x984c4cd4, 0xb05858e8, 0x85cfcf4a, 0xbbd0d06b, 0xc5efef2a, 0x4faaaae5, 0xedfbfb16, 0x864343c5, 0x9a4d4dd7, 0x66333355, 0x11858594, 0x8a4545cf, 0xe9f9f910, 0x04020206, 0xfe7f7f81, 0xa05050f0, 0x783c3c44, 0x259f9fba, 0x4ba8a8e3, 0xa25151f3, 0x5da3a3fe, 0x804040c0, 0x058f8f8a, 0x3f9292ad, 0x219d9dbc, 0x70383848, 0xf1f5f504, 0x63bcbcdf, 0x77b6b6c1, 0xafdada75, 0x42212163, 0x20101030, 0xe5ffff1a, 0xfdf3f30e, 0xbfd2d26d, 0x81cdcd4c, 0x180c0c14, 0x26131335, 0xc3ecec2f, 0xbe5f5fe1, 0x359797a2, 0x884444cc, 0x2e171739, 0x93c4c457, 0x55a7a7f2, 0xfc7e7e82, 0x7a3d3d47, 0xc86464ac, 0xba5d5de7, 0x3219192b, 0xe6737395, 0xc06060a0, 0x19818198, 0x9e4f4fd1, 0xa3dcdc7f, 0x44222266, 0x542a2a7e, 0x3b9090ab, 0x0b888883, 0x8c4646ca, 0xc7eeee29, 0x6bb8b8d3, 0x2814143c, 0xa7dede79, 0xbc5e5ee2, 0x160b0b1d, 0xaddbdb76, 0xdbe0e03b, 0x64323256, 0x743a3a4e, 0x140a0a1e, 0x924949db, 0x0c06060a, 0x4824246c, 0xb85c5ce4, 0x9fc2c25d, 0xbdd3d36e, 0x43acacef, 0xc46262a6, 0x399191a8, 0x319595a4, 0xd3e4e437, 0xf279798b, 0xd5e7e732, 0x8bc8c843, 0x6e373759, 0xda6d6db7, 0x018d8d8c, 0xb1d5d564, 0x9c4e4ed2, 0x49a9a9e0, 0xd86c6cb4, 0xac5656fa, 0xf3f4f407, 0xcfeaea25, 0xca6565af, 0xf47a7a8e, 0x47aeaee9, 0x10080818, 0x6fbabad5, 0xf0787888, 0x4a25256f, 0x5c2e2e72, 0x381c1c24, 0x57a6a6f1, 0x73b4b4c7, 0x97c6c651, 0xcbe8e823, 0xa1dddd7c, 0xe874749c, 0x3e1f1f21, 0x964b4bdd, 0x61bdbddc, 0x0d8b8b86, 0x0f8a8a85, 0xe0707090, 0x7c3e3e42, 0x71b5b5c4, 0xcc6666aa, 0x904848d8, 0x06030305, 0xf7f6f601, 0x1c0e0e12, 0xc26161a3, 0x6a35355f, 0xae5757f9, 0x69b9b9d0, 0x17868691, 0x99c1c158, 0x3a1d1d27, 0x279e9eb9, 0xd9e1e138, 0xebf8f813, 0x2b9898b3, 0x22111133, 0xd26969bb, 0xa9d9d970, 0x078e8e89, 0x339494a7, 0x2d9b9bb6, 0x3c1e1e22, 0x15878792, 0xc9e9e920, 0x87cece49, 0xaa5555ff, 0x50282878, 0xa5dfdf7a, 0x038c8c8f, 0x59a1a1f8, 0x09898980, 0x1a0d0d17, 0x65bfbfda, 0xd7e6e631, 0x844242c6, 0xd06868b8, 0x824141c3, 0x299999b0, 0x5a2d2d77, 0x1e0f0f11, 0x7bb0b0cb, 0xa85454fc, 0x6dbbbbd6, 0x2c16163a];\n  var T2 = [0xa5c66363, 0x84f87c7c, 0x99ee7777, 0x8df67b7b, 0x0dfff2f2, 0xbdd66b6b, 0xb1de6f6f, 0x5491c5c5, 0x50603030, 0x03020101, 0xa9ce6767, 0x7d562b2b, 0x19e7fefe, 0x62b5d7d7, 0xe64dabab, 0x9aec7676, 0x458fcaca, 0x9d1f8282, 0x4089c9c9, 0x87fa7d7d, 0x15effafa, 0xebb25959, 0xc98e4747, 0x0bfbf0f0, 0xec41adad, 0x67b3d4d4, 0xfd5fa2a2, 0xea45afaf, 0xbf239c9c, 0xf753a4a4, 0x96e47272, 0x5b9bc0c0, 0xc275b7b7, 0x1ce1fdfd, 0xae3d9393, 0x6a4c2626, 0x5a6c3636, 0x417e3f3f, 0x02f5f7f7, 0x4f83cccc, 0x5c683434, 0xf451a5a5, 0x34d1e5e5, 0x08f9f1f1, 0x93e27171, 0x73abd8d8, 0x53623131, 0x3f2a1515, 0x0c080404, 0x5295c7c7, 0x65462323, 0x5e9dc3c3, 0x28301818, 0xa1379696, 0x0f0a0505, 0xb52f9a9a, 0x090e0707, 0x36241212, 0x9b1b8080, 0x3ddfe2e2, 0x26cdebeb, 0x694e2727, 0xcd7fb2b2, 0x9fea7575, 0x1b120909, 0x9e1d8383, 0x74582c2c, 0x2e341a1a, 0x2d361b1b, 0xb2dc6e6e, 0xeeb45a5a, 0xfb5ba0a0, 0xf6a45252, 0x4d763b3b, 0x61b7d6d6, 0xce7db3b3, 0x7b522929, 0x3edde3e3, 0x715e2f2f, 0x97138484, 0xf5a65353, 0x68b9d1d1, 0x00000000, 0x2cc1eded, 0x60402020, 0x1fe3fcfc, 0xc879b1b1, 0xedb65b5b, 0xbed46a6a, 0x468dcbcb, 0xd967bebe, 0x4b723939, 0xde944a4a, 0xd4984c4c, 0xe8b05858, 0x4a85cfcf, 0x6bbbd0d0, 0x2ac5efef, 0xe54faaaa, 0x16edfbfb, 0xc5864343, 0xd79a4d4d, 0x55663333, 0x94118585, 0xcf8a4545, 0x10e9f9f9, 0x06040202, 0x81fe7f7f, 0xf0a05050, 0x44783c3c, 0xba259f9f, 0xe34ba8a8, 0xf3a25151, 0xfe5da3a3, 0xc0804040, 0x8a058f8f, 0xad3f9292, 0xbc219d9d, 0x48703838, 0x04f1f5f5, 0xdf63bcbc, 0xc177b6b6, 0x75afdada, 0x63422121, 0x30201010, 0x1ae5ffff, 0x0efdf3f3, 0x6dbfd2d2, 0x4c81cdcd, 0x14180c0c, 0x35261313, 0x2fc3ecec, 0xe1be5f5f, 0xa2359797, 0xcc884444, 0x392e1717, 0x5793c4c4, 0xf255a7a7, 0x82fc7e7e, 0x477a3d3d, 0xacc86464, 0xe7ba5d5d, 0x2b321919, 0x95e67373, 0xa0c06060, 0x98198181, 0xd19e4f4f, 0x7fa3dcdc, 0x66442222, 0x7e542a2a, 0xab3b9090, 0x830b8888, 0xca8c4646, 0x29c7eeee, 0xd36bb8b8, 0x3c281414, 0x79a7dede, 0xe2bc5e5e, 0x1d160b0b, 0x76addbdb, 0x3bdbe0e0, 0x56643232, 0x4e743a3a, 0x1e140a0a, 0xdb924949, 0x0a0c0606, 0x6c482424, 0xe4b85c5c, 0x5d9fc2c2, 0x6ebdd3d3, 0xef43acac, 0xa6c46262, 0xa8399191, 0xa4319595, 0x37d3e4e4, 0x8bf27979, 0x32d5e7e7, 0x438bc8c8, 0x596e3737, 0xb7da6d6d, 0x8c018d8d, 0x64b1d5d5, 0xd29c4e4e, 0xe049a9a9, 0xb4d86c6c, 0xfaac5656, 0x07f3f4f4, 0x25cfeaea, 0xafca6565, 0x8ef47a7a, 0xe947aeae, 0x18100808, 0xd56fbaba, 0x88f07878, 0x6f4a2525, 0x725c2e2e, 0x24381c1c, 0xf157a6a6, 0xc773b4b4, 0x5197c6c6, 0x23cbe8e8, 0x7ca1dddd, 0x9ce87474, 0x213e1f1f, 0xdd964b4b, 0xdc61bdbd, 0x860d8b8b, 0x850f8a8a, 0x90e07070, 0x427c3e3e, 0xc471b5b5, 0xaacc6666, 0xd8904848, 0x05060303, 0x01f7f6f6, 0x121c0e0e, 0xa3c26161, 0x5f6a3535, 0xf9ae5757, 0xd069b9b9, 0x91178686, 0x5899c1c1, 0x273a1d1d, 0xb9279e9e, 0x38d9e1e1, 0x13ebf8f8, 0xb32b9898, 0x33221111, 0xbbd26969, 0x70a9d9d9, 0x89078e8e, 0xa7339494, 0xb62d9b9b, 0x223c1e1e, 0x92158787, 0x20c9e9e9, 0x4987cece, 0xffaa5555, 0x78502828, 0x7aa5dfdf, 0x8f038c8c, 0xf859a1a1, 0x80098989, 0x171a0d0d, 0xda65bfbf, 0x31d7e6e6, 0xc6844242, 0xb8d06868, 0xc3824141, 0xb0299999, 0x775a2d2d, 0x111e0f0f, 0xcb7bb0b0, 0xfca85454, 0xd66dbbbb, 0x3a2c1616];\n  var T3 = [0x63a5c663, 0x7c84f87c, 0x7799ee77, 0x7b8df67b, 0xf20dfff2, 0x6bbdd66b, 0x6fb1de6f, 0xc55491c5, 0x30506030, 0x01030201, 0x67a9ce67, 0x2b7d562b, 0xfe19e7fe, 0xd762b5d7, 0xabe64dab, 0x769aec76, 0xca458fca, 0x829d1f82, 0xc94089c9, 0x7d87fa7d, 0xfa15effa, 0x59ebb259, 0x47c98e47, 0xf00bfbf0, 0xadec41ad, 0xd467b3d4, 0xa2fd5fa2, 0xafea45af, 0x9cbf239c, 0xa4f753a4, 0x7296e472, 0xc05b9bc0, 0xb7c275b7, 0xfd1ce1fd, 0x93ae3d93, 0x266a4c26, 0x365a6c36, 0x3f417e3f, 0xf702f5f7, 0xcc4f83cc, 0x345c6834, 0xa5f451a5, 0xe534d1e5, 0xf108f9f1, 0x7193e271, 0xd873abd8, 0x31536231, 0x153f2a15, 0x040c0804, 0xc75295c7, 0x23654623, 0xc35e9dc3, 0x18283018, 0x96a13796, 0x050f0a05, 0x9ab52f9a, 0x07090e07, 0x12362412, 0x809b1b80, 0xe23ddfe2, 0xeb26cdeb, 0x27694e27, 0xb2cd7fb2, 0x759fea75, 0x091b1209, 0x839e1d83, 0x2c74582c, 0x1a2e341a, 0x1b2d361b, 0x6eb2dc6e, 0x5aeeb45a, 0xa0fb5ba0, 0x52f6a452, 0x3b4d763b, 0xd661b7d6, 0xb3ce7db3, 0x297b5229, 0xe33edde3, 0x2f715e2f, 0x84971384, 0x53f5a653, 0xd168b9d1, 0x00000000, 0xed2cc1ed, 0x20604020, 0xfc1fe3fc, 0xb1c879b1, 0x5bedb65b, 0x6abed46a, 0xcb468dcb, 0xbed967be, 0x394b7239, 0x4ade944a, 0x4cd4984c, 0x58e8b058, 0xcf4a85cf, 0xd06bbbd0, 0xef2ac5ef, 0xaae54faa, 0xfb16edfb, 0x43c58643, 0x4dd79a4d, 0x33556633, 0x85941185, 0x45cf8a45, 0xf910e9f9, 0x02060402, 0x7f81fe7f, 0x50f0a050, 0x3c44783c, 0x9fba259f, 0xa8e34ba8, 0x51f3a251, 0xa3fe5da3, 0x40c08040, 0x8f8a058f, 0x92ad3f92, 0x9dbc219d, 0x38487038, 0xf504f1f5, 0xbcdf63bc, 0xb6c177b6, 0xda75afda, 0x21634221, 0x10302010, 0xff1ae5ff, 0xf30efdf3, 0xd26dbfd2, 0xcd4c81cd, 0x0c14180c, 0x13352613, 0xec2fc3ec, 0x5fe1be5f, 0x97a23597, 0x44cc8844, 0x17392e17, 0xc45793c4, 0xa7f255a7, 0x7e82fc7e, 0x3d477a3d, 0x64acc864, 0x5de7ba5d, 0x192b3219, 0x7395e673, 0x60a0c060, 0x81981981, 0x4fd19e4f, 0xdc7fa3dc, 0x22664422, 0x2a7e542a, 0x90ab3b90, 0x88830b88, 0x46ca8c46, 0xee29c7ee, 0xb8d36bb8, 0x143c2814, 0xde79a7de, 0x5ee2bc5e, 0x0b1d160b, 0xdb76addb, 0xe03bdbe0, 0x32566432, 0x3a4e743a, 0x0a1e140a, 0x49db9249, 0x060a0c06, 0x246c4824, 0x5ce4b85c, 0xc25d9fc2, 0xd36ebdd3, 0xacef43ac, 0x62a6c462, 0x91a83991, 0x95a43195, 0xe437d3e4, 0x798bf279, 0xe732d5e7, 0xc8438bc8, 0x37596e37, 0x6db7da6d, 0x8d8c018d, 0xd564b1d5, 0x4ed29c4e, 0xa9e049a9, 0x6cb4d86c, 0x56faac56, 0xf407f3f4, 0xea25cfea, 0x65afca65, 0x7a8ef47a, 0xaee947ae, 0x08181008, 0xbad56fba, 0x7888f078, 0x256f4a25, 0x2e725c2e, 0x1c24381c, 0xa6f157a6, 0xb4c773b4, 0xc65197c6, 0xe823cbe8, 0xdd7ca1dd, 0x749ce874, 0x1f213e1f, 0x4bdd964b, 0xbddc61bd, 0x8b860d8b, 0x8a850f8a, 0x7090e070, 0x3e427c3e, 0xb5c471b5, 0x66aacc66, 0x48d89048, 0x03050603, 0xf601f7f6, 0x0e121c0e, 0x61a3c261, 0x355f6a35, 0x57f9ae57, 0xb9d069b9, 0x86911786, 0xc15899c1, 0x1d273a1d, 0x9eb9279e, 0xe138d9e1, 0xf813ebf8, 0x98b32b98, 0x11332211, 0x69bbd269, 0xd970a9d9, 0x8e89078e, 0x94a73394, 0x9bb62d9b, 0x1e223c1e, 0x87921587, 0xe920c9e9, 0xce4987ce, 0x55ffaa55, 0x28785028, 0xdf7aa5df, 0x8c8f038c, 0xa1f859a1, 0x89800989, 0x0d171a0d, 0xbfda65bf, 0xe631d7e6, 0x42c68442, 0x68b8d068, 0x41c38241, 0x99b02999, 0x2d775a2d, 0x0f111e0f, 0xb0cb7bb0, 0x54fca854, 0xbbd66dbb, 0x163a2c16];\n  var T4 = [0x6363a5c6, 0x7c7c84f8, 0x777799ee, 0x7b7b8df6, 0xf2f20dff, 0x6b6bbdd6, 0x6f6fb1de, 0xc5c55491, 0x30305060, 0x01010302, 0x6767a9ce, 0x2b2b7d56, 0xfefe19e7, 0xd7d762b5, 0xababe64d, 0x76769aec, 0xcaca458f, 0x82829d1f, 0xc9c94089, 0x7d7d87fa, 0xfafa15ef, 0x5959ebb2, 0x4747c98e, 0xf0f00bfb, 0xadadec41, 0xd4d467b3, 0xa2a2fd5f, 0xafafea45, 0x9c9cbf23, 0xa4a4f753, 0x727296e4, 0xc0c05b9b, 0xb7b7c275, 0xfdfd1ce1, 0x9393ae3d, 0x26266a4c, 0x36365a6c, 0x3f3f417e, 0xf7f702f5, 0xcccc4f83, 0x34345c68, 0xa5a5f451, 0xe5e534d1, 0xf1f108f9, 0x717193e2, 0xd8d873ab, 0x31315362, 0x15153f2a, 0x04040c08, 0xc7c75295, 0x23236546, 0xc3c35e9d, 0x18182830, 0x9696a137, 0x05050f0a, 0x9a9ab52f, 0x0707090e, 0x12123624, 0x80809b1b, 0xe2e23ddf, 0xebeb26cd, 0x2727694e, 0xb2b2cd7f, 0x75759fea, 0x09091b12, 0x83839e1d, 0x2c2c7458, 0x1a1a2e34, 0x1b1b2d36, 0x6e6eb2dc, 0x5a5aeeb4, 0xa0a0fb5b, 0x5252f6a4, 0x3b3b4d76, 0xd6d661b7, 0xb3b3ce7d, 0x29297b52, 0xe3e33edd, 0x2f2f715e, 0x84849713, 0x5353f5a6, 0xd1d168b9, 0x00000000, 0xeded2cc1, 0x20206040, 0xfcfc1fe3, 0xb1b1c879, 0x5b5bedb6, 0x6a6abed4, 0xcbcb468d, 0xbebed967, 0x39394b72, 0x4a4ade94, 0x4c4cd498, 0x5858e8b0, 0xcfcf4a85, 0xd0d06bbb, 0xefef2ac5, 0xaaaae54f, 0xfbfb16ed, 0x4343c586, 0x4d4dd79a, 0x33335566, 0x85859411, 0x4545cf8a, 0xf9f910e9, 0x02020604, 0x7f7f81fe, 0x5050f0a0, 0x3c3c4478, 0x9f9fba25, 0xa8a8e34b, 0x5151f3a2, 0xa3a3fe5d, 0x4040c080, 0x8f8f8a05, 0x9292ad3f, 0x9d9dbc21, 0x38384870, 0xf5f504f1, 0xbcbcdf63, 0xb6b6c177, 0xdada75af, 0x21216342, 0x10103020, 0xffff1ae5, 0xf3f30efd, 0xd2d26dbf, 0xcdcd4c81, 0x0c0c1418, 0x13133526, 0xecec2fc3, 0x5f5fe1be, 0x9797a235, 0x4444cc88, 0x1717392e, 0xc4c45793, 0xa7a7f255, 0x7e7e82fc, 0x3d3d477a, 0x6464acc8, 0x5d5de7ba, 0x19192b32, 0x737395e6, 0x6060a0c0, 0x81819819, 0x4f4fd19e, 0xdcdc7fa3, 0x22226644, 0x2a2a7e54, 0x9090ab3b, 0x8888830b, 0x4646ca8c, 0xeeee29c7, 0xb8b8d36b, 0x14143c28, 0xdede79a7, 0x5e5ee2bc, 0x0b0b1d16, 0xdbdb76ad, 0xe0e03bdb, 0x32325664, 0x3a3a4e74, 0x0a0a1e14, 0x4949db92, 0x06060a0c, 0x24246c48, 0x5c5ce4b8, 0xc2c25d9f, 0xd3d36ebd, 0xacacef43, 0x6262a6c4, 0x9191a839, 0x9595a431, 0xe4e437d3, 0x79798bf2, 0xe7e732d5, 0xc8c8438b, 0x3737596e, 0x6d6db7da, 0x8d8d8c01, 0xd5d564b1, 0x4e4ed29c, 0xa9a9e049, 0x6c6cb4d8, 0x5656faac, 0xf4f407f3, 0xeaea25cf, 0x6565afca, 0x7a7a8ef4, 0xaeaee947, 0x08081810, 0xbabad56f, 0x787888f0, 0x25256f4a, 0x2e2e725c, 0x1c1c2438, 0xa6a6f157, 0xb4b4c773, 0xc6c65197, 0xe8e823cb, 0xdddd7ca1, 0x74749ce8, 0x1f1f213e, 0x4b4bdd96, 0xbdbddc61, 0x8b8b860d, 0x8a8a850f, 0x707090e0, 0x3e3e427c, 0xb5b5c471, 0x6666aacc, 0x4848d890, 0x03030506, 0xf6f601f7, 0x0e0e121c, 0x6161a3c2, 0x35355f6a, 0x5757f9ae, 0xb9b9d069, 0x86869117, 0xc1c15899, 0x1d1d273a, 0x9e9eb927, 0xe1e138d9, 0xf8f813eb, 0x9898b32b, 0x11113322, 0x6969bbd2, 0xd9d970a9, 0x8e8e8907, 0x9494a733, 0x9b9bb62d, 0x1e1e223c, 0x87879215, 0xe9e920c9, 0xcece4987, 0x5555ffaa, 0x28287850, 0xdfdf7aa5, 0x8c8c8f03, 0xa1a1f859, 0x89898009, 0x0d0d171a, 0xbfbfda65, 0xe6e631d7, 0x4242c684, 0x6868b8d0, 0x4141c382, 0x9999b029, 0x2d2d775a, 0x0f0f111e, 0xb0b0cb7b, 0x5454fca8, 0xbbbbd66d, 0x16163a2c];\n\n  // Transformations for decryption\n  var T5 = [0x51f4a750, 0x7e416553, 0x1a17a4c3, 0x3a275e96, 0x3bab6bcb, 0x1f9d45f1, 0xacfa58ab, 0x4be30393, 0x2030fa55, 0xad766df6, 0x88cc7691, 0xf5024c25, 0x4fe5d7fc, 0xc52acbd7, 0x26354480, 0xb562a38f, 0xdeb15a49, 0x25ba1b67, 0x45ea0e98, 0x5dfec0e1, 0xc32f7502, 0x814cf012, 0x8d4697a3, 0x6bd3f9c6, 0x038f5fe7, 0x15929c95, 0xbf6d7aeb, 0x955259da, 0xd4be832d, 0x587421d3, 0x49e06929, 0x8ec9c844, 0x75c2896a, 0xf48e7978, 0x99583e6b, 0x27b971dd, 0xbee14fb6, 0xf088ad17, 0xc920ac66, 0x7dce3ab4, 0x63df4a18, 0xe51a3182, 0x97513360, 0x62537f45, 0xb16477e0, 0xbb6bae84, 0xfe81a01c, 0xf9082b94, 0x70486858, 0x8f45fd19, 0x94de6c87, 0x527bf8b7, 0xab73d323, 0x724b02e2, 0xe31f8f57, 0x6655ab2a, 0xb2eb2807, 0x2fb5c203, 0x86c57b9a, 0xd33708a5, 0x302887f2, 0x23bfa5b2, 0x02036aba, 0xed16825c, 0x8acf1c2b, 0xa779b492, 0xf307f2f0, 0x4e69e2a1, 0x65daf4cd, 0x0605bed5, 0xd134621f, 0xc4a6fe8a, 0x342e539d, 0xa2f355a0, 0x058ae132, 0xa4f6eb75, 0x0b83ec39, 0x4060efaa, 0x5e719f06, 0xbd6e1051, 0x3e218af9, 0x96dd063d, 0xdd3e05ae, 0x4de6bd46, 0x91548db5, 0x71c45d05, 0x0406d46f, 0x605015ff, 0x1998fb24, 0xd6bde997, 0x894043cc, 0x67d99e77, 0xb0e842bd, 0x07898b88, 0xe7195b38, 0x79c8eedb, 0xa17c0a47, 0x7c420fe9, 0xf8841ec9, 0x00000000, 0x09808683, 0x322bed48, 0x1e1170ac, 0x6c5a724e, 0xfd0efffb, 0x0f853856, 0x3daed51e, 0x362d3927, 0x0a0fd964, 0x685ca621, 0x9b5b54d1, 0x24362e3a, 0x0c0a67b1, 0x9357e70f, 0xb4ee96d2, 0x1b9b919e, 0x80c0c54f, 0x61dc20a2, 0x5a774b69, 0x1c121a16, 0xe293ba0a, 0xc0a02ae5, 0x3c22e043, 0x121b171d, 0x0e090d0b, 0xf28bc7ad, 0x2db6a8b9, 0x141ea9c8, 0x57f11985, 0xaf75074c, 0xee99ddbb, 0xa37f60fd, 0xf701269f, 0x5c72f5bc, 0x44663bc5, 0x5bfb7e34, 0x8b432976, 0xcb23c6dc, 0xb6edfc68, 0xb8e4f163, 0xd731dcca, 0x42638510, 0x13972240, 0x84c61120, 0x854a247d, 0xd2bb3df8, 0xaef93211, 0xc729a16d, 0x1d9e2f4b, 0xdcb230f3, 0x0d8652ec, 0x77c1e3d0, 0x2bb3166c, 0xa970b999, 0x119448fa, 0x47e96422, 0xa8fc8cc4, 0xa0f03f1a, 0x567d2cd8, 0x223390ef, 0x87494ec7, 0xd938d1c1, 0x8ccaa2fe, 0x98d40b36, 0xa6f581cf, 0xa57ade28, 0xdab78e26, 0x3fadbfa4, 0x2c3a9de4, 0x5078920d, 0x6a5fcc9b, 0x547e4662, 0xf68d13c2, 0x90d8b8e8, 0x2e39f75e, 0x82c3aff5, 0x9f5d80be, 0x69d0937c, 0x6fd52da9, 0xcf2512b3, 0xc8ac993b, 0x10187da7, 0xe89c636e, 0xdb3bbb7b, 0xcd267809, 0x6e5918f4, 0xec9ab701, 0x834f9aa8, 0xe6956e65, 0xaaffe67e, 0x21bccf08, 0xef15e8e6, 0xbae79bd9, 0x4a6f36ce, 0xea9f09d4, 0x29b07cd6, 0x31a4b2af, 0x2a3f2331, 0xc6a59430, 0x35a266c0, 0x744ebc37, 0xfc82caa6, 0xe090d0b0, 0x33a7d815, 0xf104984a, 0x41ecdaf7, 0x7fcd500e, 0x1791f62f, 0x764dd68d, 0x43efb04d, 0xccaa4d54, 0xe49604df, 0x9ed1b5e3, 0x4c6a881b, 0xc12c1fb8, 0x4665517f, 0x9d5eea04, 0x018c355d, 0xfa877473, 0xfb0b412e, 0xb3671d5a, 0x92dbd252, 0xe9105633, 0x6dd64713, 0x9ad7618c, 0x37a10c7a, 0x59f8148e, 0xeb133c89, 0xcea927ee, 0xb761c935, 0xe11ce5ed, 0x7a47b13c, 0x9cd2df59, 0x55f2733f, 0x1814ce79, 0x73c737bf, 0x53f7cdea, 0x5ffdaa5b, 0xdf3d6f14, 0x7844db86, 0xcaaff381, 0xb968c43e, 0x3824342c, 0xc2a3405f, 0x161dc372, 0xbce2250c, 0x283c498b, 0xff0d9541, 0x39a80171, 0x080cb3de, 0xd8b4e49c, 0x6456c190, 0x7bcb8461, 0xd532b670, 0x486c5c74, 0xd0b85742];\n  var T6 = [0x5051f4a7, 0x537e4165, 0xc31a17a4, 0x963a275e, 0xcb3bab6b, 0xf11f9d45, 0xabacfa58, 0x934be303, 0x552030fa, 0xf6ad766d, 0x9188cc76, 0x25f5024c, 0xfc4fe5d7, 0xd7c52acb, 0x80263544, 0x8fb562a3, 0x49deb15a, 0x6725ba1b, 0x9845ea0e, 0xe15dfec0, 0x02c32f75, 0x12814cf0, 0xa38d4697, 0xc66bd3f9, 0xe7038f5f, 0x9515929c, 0xebbf6d7a, 0xda955259, 0x2dd4be83, 0xd3587421, 0x2949e069, 0x448ec9c8, 0x6a75c289, 0x78f48e79, 0x6b99583e, 0xdd27b971, 0xb6bee14f, 0x17f088ad, 0x66c920ac, 0xb47dce3a, 0x1863df4a, 0x82e51a31, 0x60975133, 0x4562537f, 0xe0b16477, 0x84bb6bae, 0x1cfe81a0, 0x94f9082b, 0x58704868, 0x198f45fd, 0x8794de6c, 0xb7527bf8, 0x23ab73d3, 0xe2724b02, 0x57e31f8f, 0x2a6655ab, 0x07b2eb28, 0x032fb5c2, 0x9a86c57b, 0xa5d33708, 0xf2302887, 0xb223bfa5, 0xba02036a, 0x5ced1682, 0x2b8acf1c, 0x92a779b4, 0xf0f307f2, 0xa14e69e2, 0xcd65daf4, 0xd50605be, 0x1fd13462, 0x8ac4a6fe, 0x9d342e53, 0xa0a2f355, 0x32058ae1, 0x75a4f6eb, 0x390b83ec, 0xaa4060ef, 0x065e719f, 0x51bd6e10, 0xf93e218a, 0x3d96dd06, 0xaedd3e05, 0x464de6bd, 0xb591548d, 0x0571c45d, 0x6f0406d4, 0xff605015, 0x241998fb, 0x97d6bde9, 0xcc894043, 0x7767d99e, 0xbdb0e842, 0x8807898b, 0x38e7195b, 0xdb79c8ee, 0x47a17c0a, 0xe97c420f, 0xc9f8841e, 0x00000000, 0x83098086, 0x48322bed, 0xac1e1170, 0x4e6c5a72, 0xfbfd0eff, 0x560f8538, 0x1e3daed5, 0x27362d39, 0x640a0fd9, 0x21685ca6, 0xd19b5b54, 0x3a24362e, 0xb10c0a67, 0x0f9357e7, 0xd2b4ee96, 0x9e1b9b91, 0x4f80c0c5, 0xa261dc20, 0x695a774b, 0x161c121a, 0x0ae293ba, 0xe5c0a02a, 0x433c22e0, 0x1d121b17, 0x0b0e090d, 0xadf28bc7, 0xb92db6a8, 0xc8141ea9, 0x8557f119, 0x4caf7507, 0xbbee99dd, 0xfda37f60, 0x9ff70126, 0xbc5c72f5, 0xc544663b, 0x345bfb7e, 0x768b4329, 0xdccb23c6, 0x68b6edfc, 0x63b8e4f1, 0xcad731dc, 0x10426385, 0x40139722, 0x2084c611, 0x7d854a24, 0xf8d2bb3d, 0x11aef932, 0x6dc729a1, 0x4b1d9e2f, 0xf3dcb230, 0xec0d8652, 0xd077c1e3, 0x6c2bb316, 0x99a970b9, 0xfa119448, 0x2247e964, 0xc4a8fc8c, 0x1aa0f03f, 0xd8567d2c, 0xef223390, 0xc787494e, 0xc1d938d1, 0xfe8ccaa2, 0x3698d40b, 0xcfa6f581, 0x28a57ade, 0x26dab78e, 0xa43fadbf, 0xe42c3a9d, 0x0d507892, 0x9b6a5fcc, 0x62547e46, 0xc2f68d13, 0xe890d8b8, 0x5e2e39f7, 0xf582c3af, 0xbe9f5d80, 0x7c69d093, 0xa96fd52d, 0xb3cf2512, 0x3bc8ac99, 0xa710187d, 0x6ee89c63, 0x7bdb3bbb, 0x09cd2678, 0xf46e5918, 0x01ec9ab7, 0xa8834f9a, 0x65e6956e, 0x7eaaffe6, 0x0821bccf, 0xe6ef15e8, 0xd9bae79b, 0xce4a6f36, 0xd4ea9f09, 0xd629b07c, 0xaf31a4b2, 0x312a3f23, 0x30c6a594, 0xc035a266, 0x37744ebc, 0xa6fc82ca, 0xb0e090d0, 0x1533a7d8, 0x4af10498, 0xf741ecda, 0x0e7fcd50, 0x2f1791f6, 0x8d764dd6, 0x4d43efb0, 0x54ccaa4d, 0xdfe49604, 0xe39ed1b5, 0x1b4c6a88, 0xb8c12c1f, 0x7f466551, 0x049d5eea, 0x5d018c35, 0x73fa8774, 0x2efb0b41, 0x5ab3671d, 0x5292dbd2, 0x33e91056, 0x136dd647, 0x8c9ad761, 0x7a37a10c, 0x8e59f814, 0x89eb133c, 0xeecea927, 0x35b761c9, 0xede11ce5, 0x3c7a47b1, 0x599cd2df, 0x3f55f273, 0x791814ce, 0xbf73c737, 0xea53f7cd, 0x5b5ffdaa, 0x14df3d6f, 0x867844db, 0x81caaff3, 0x3eb968c4, 0x2c382434, 0x5fc2a340, 0x72161dc3, 0x0cbce225, 0x8b283c49, 0x41ff0d95, 0x7139a801, 0xde080cb3, 0x9cd8b4e4, 0x906456c1, 0x617bcb84, 0x70d532b6, 0x74486c5c, 0x42d0b857];\n  var T7 = [0xa75051f4, 0x65537e41, 0xa4c31a17, 0x5e963a27, 0x6bcb3bab, 0x45f11f9d, 0x58abacfa, 0x03934be3, 0xfa552030, 0x6df6ad76, 0x769188cc, 0x4c25f502, 0xd7fc4fe5, 0xcbd7c52a, 0x44802635, 0xa38fb562, 0x5a49deb1, 0x1b6725ba, 0x0e9845ea, 0xc0e15dfe, 0x7502c32f, 0xf012814c, 0x97a38d46, 0xf9c66bd3, 0x5fe7038f, 0x9c951592, 0x7aebbf6d, 0x59da9552, 0x832dd4be, 0x21d35874, 0x692949e0, 0xc8448ec9, 0x896a75c2, 0x7978f48e, 0x3e6b9958, 0x71dd27b9, 0x4fb6bee1, 0xad17f088, 0xac66c920, 0x3ab47dce, 0x4a1863df, 0x3182e51a, 0x33609751, 0x7f456253, 0x77e0b164, 0xae84bb6b, 0xa01cfe81, 0x2b94f908, 0x68587048, 0xfd198f45, 0x6c8794de, 0xf8b7527b, 0xd323ab73, 0x02e2724b, 0x8f57e31f, 0xab2a6655, 0x2807b2eb, 0xc2032fb5, 0x7b9a86c5, 0x08a5d337, 0x87f23028, 0xa5b223bf, 0x6aba0203, 0x825ced16, 0x1c2b8acf, 0xb492a779, 0xf2f0f307, 0xe2a14e69, 0xf4cd65da, 0xbed50605, 0x621fd134, 0xfe8ac4a6, 0x539d342e, 0x55a0a2f3, 0xe132058a, 0xeb75a4f6, 0xec390b83, 0xefaa4060, 0x9f065e71, 0x1051bd6e, 0x8af93e21, 0x063d96dd, 0x05aedd3e, 0xbd464de6, 0x8db59154, 0x5d0571c4, 0xd46f0406, 0x15ff6050, 0xfb241998, 0xe997d6bd, 0x43cc8940, 0x9e7767d9, 0x42bdb0e8, 0x8b880789, 0x5b38e719, 0xeedb79c8, 0x0a47a17c, 0x0fe97c42, 0x1ec9f884, 0x00000000, 0x86830980, 0xed48322b, 0x70ac1e11, 0x724e6c5a, 0xfffbfd0e, 0x38560f85, 0xd51e3dae, 0x3927362d, 0xd9640a0f, 0xa621685c, 0x54d19b5b, 0x2e3a2436, 0x67b10c0a, 0xe70f9357, 0x96d2b4ee, 0x919e1b9b, 0xc54f80c0, 0x20a261dc, 0x4b695a77, 0x1a161c12, 0xba0ae293, 0x2ae5c0a0, 0xe0433c22, 0x171d121b, 0x0d0b0e09, 0xc7adf28b, 0xa8b92db6, 0xa9c8141e, 0x198557f1, 0x074caf75, 0xddbbee99, 0x60fda37f, 0x269ff701, 0xf5bc5c72, 0x3bc54466, 0x7e345bfb, 0x29768b43, 0xc6dccb23, 0xfc68b6ed, 0xf163b8e4, 0xdccad731, 0x85104263, 0x22401397, 0x112084c6, 0x247d854a, 0x3df8d2bb, 0x3211aef9, 0xa16dc729, 0x2f4b1d9e, 0x30f3dcb2, 0x52ec0d86, 0xe3d077c1, 0x166c2bb3, 0xb999a970, 0x48fa1194, 0x642247e9, 0x8cc4a8fc, 0x3f1aa0f0, 0x2cd8567d, 0x90ef2233, 0x4ec78749, 0xd1c1d938, 0xa2fe8cca, 0x0b3698d4, 0x81cfa6f5, 0xde28a57a, 0x8e26dab7, 0xbfa43fad, 0x9de42c3a, 0x920d5078, 0xcc9b6a5f, 0x4662547e, 0x13c2f68d, 0xb8e890d8, 0xf75e2e39, 0xaff582c3, 0x80be9f5d, 0x937c69d0, 0x2da96fd5, 0x12b3cf25, 0x993bc8ac, 0x7da71018, 0x636ee89c, 0xbb7bdb3b, 0x7809cd26, 0x18f46e59, 0xb701ec9a, 0x9aa8834f, 0x6e65e695, 0xe67eaaff, 0xcf0821bc, 0xe8e6ef15, 0x9bd9bae7, 0x36ce4a6f, 0x09d4ea9f, 0x7cd629b0, 0xb2af31a4, 0x23312a3f, 0x9430c6a5, 0x66c035a2, 0xbc37744e, 0xcaa6fc82, 0xd0b0e090, 0xd81533a7, 0x984af104, 0xdaf741ec, 0x500e7fcd, 0xf62f1791, 0xd68d764d, 0xb04d43ef, 0x4d54ccaa, 0x04dfe496, 0xb5e39ed1, 0x881b4c6a, 0x1fb8c12c, 0x517f4665, 0xea049d5e, 0x355d018c, 0x7473fa87, 0x412efb0b, 0x1d5ab367, 0xd25292db, 0x5633e910, 0x47136dd6, 0x618c9ad7, 0x0c7a37a1, 0x148e59f8, 0x3c89eb13, 0x27eecea9, 0xc935b761, 0xe5ede11c, 0xb13c7a47, 0xdf599cd2, 0x733f55f2, 0xce791814, 0x37bf73c7, 0xcdea53f7, 0xaa5b5ffd, 0x6f14df3d, 0xdb867844, 0xf381caaf, 0xc43eb968, 0x342c3824, 0x405fc2a3, 0xc372161d, 0x250cbce2, 0x498b283c, 0x9541ff0d, 0x017139a8, 0xb3de080c, 0xe49cd8b4, 0xc1906456, 0x84617bcb, 0xb670d532, 0x5c74486c, 0x5742d0b8];\n  var T8 = [0xf4a75051, 0x4165537e, 0x17a4c31a, 0x275e963a, 0xab6bcb3b, 0x9d45f11f, 0xfa58abac, 0xe303934b, 0x30fa5520, 0x766df6ad, 0xcc769188, 0x024c25f5, 0xe5d7fc4f, 0x2acbd7c5, 0x35448026, 0x62a38fb5, 0xb15a49de, 0xba1b6725, 0xea0e9845, 0xfec0e15d, 0x2f7502c3, 0x4cf01281, 0x4697a38d, 0xd3f9c66b, 0x8f5fe703, 0x929c9515, 0x6d7aebbf, 0x5259da95, 0xbe832dd4, 0x7421d358, 0xe0692949, 0xc9c8448e, 0xc2896a75, 0x8e7978f4, 0x583e6b99, 0xb971dd27, 0xe14fb6be, 0x88ad17f0, 0x20ac66c9, 0xce3ab47d, 0xdf4a1863, 0x1a3182e5, 0x51336097, 0x537f4562, 0x6477e0b1, 0x6bae84bb, 0x81a01cfe, 0x082b94f9, 0x48685870, 0x45fd198f, 0xde6c8794, 0x7bf8b752, 0x73d323ab, 0x4b02e272, 0x1f8f57e3, 0x55ab2a66, 0xeb2807b2, 0xb5c2032f, 0xc57b9a86, 0x3708a5d3, 0x2887f230, 0xbfa5b223, 0x036aba02, 0x16825ced, 0xcf1c2b8a, 0x79b492a7, 0x07f2f0f3, 0x69e2a14e, 0xdaf4cd65, 0x05bed506, 0x34621fd1, 0xa6fe8ac4, 0x2e539d34, 0xf355a0a2, 0x8ae13205, 0xf6eb75a4, 0x83ec390b, 0x60efaa40, 0x719f065e, 0x6e1051bd, 0x218af93e, 0xdd063d96, 0x3e05aedd, 0xe6bd464d, 0x548db591, 0xc45d0571, 0x06d46f04, 0x5015ff60, 0x98fb2419, 0xbde997d6, 0x4043cc89, 0xd99e7767, 0xe842bdb0, 0x898b8807, 0x195b38e7, 0xc8eedb79, 0x7c0a47a1, 0x420fe97c, 0x841ec9f8, 0x00000000, 0x80868309, 0x2bed4832, 0x1170ac1e, 0x5a724e6c, 0x0efffbfd, 0x8538560f, 0xaed51e3d, 0x2d392736, 0x0fd9640a, 0x5ca62168, 0x5b54d19b, 0x362e3a24, 0x0a67b10c, 0x57e70f93, 0xee96d2b4, 0x9b919e1b, 0xc0c54f80, 0xdc20a261, 0x774b695a, 0x121a161c, 0x93ba0ae2, 0xa02ae5c0, 0x22e0433c, 0x1b171d12, 0x090d0b0e, 0x8bc7adf2, 0xb6a8b92d, 0x1ea9c814, 0xf1198557, 0x75074caf, 0x99ddbbee, 0x7f60fda3, 0x01269ff7, 0x72f5bc5c, 0x663bc544, 0xfb7e345b, 0x4329768b, 0x23c6dccb, 0xedfc68b6, 0xe4f163b8, 0x31dccad7, 0x63851042, 0x97224013, 0xc6112084, 0x4a247d85, 0xbb3df8d2, 0xf93211ae, 0x29a16dc7, 0x9e2f4b1d, 0xb230f3dc, 0x8652ec0d, 0xc1e3d077, 0xb3166c2b, 0x70b999a9, 0x9448fa11, 0xe9642247, 0xfc8cc4a8, 0xf03f1aa0, 0x7d2cd856, 0x3390ef22, 0x494ec787, 0x38d1c1d9, 0xcaa2fe8c, 0xd40b3698, 0xf581cfa6, 0x7ade28a5, 0xb78e26da, 0xadbfa43f, 0x3a9de42c, 0x78920d50, 0x5fcc9b6a, 0x7e466254, 0x8d13c2f6, 0xd8b8e890, 0x39f75e2e, 0xc3aff582, 0x5d80be9f, 0xd0937c69, 0xd52da96f, 0x2512b3cf, 0xac993bc8, 0x187da710, 0x9c636ee8, 0x3bbb7bdb, 0x267809cd, 0x5918f46e, 0x9ab701ec, 0x4f9aa883, 0x956e65e6, 0xffe67eaa, 0xbccf0821, 0x15e8e6ef, 0xe79bd9ba, 0x6f36ce4a, 0x9f09d4ea, 0xb07cd629, 0xa4b2af31, 0x3f23312a, 0xa59430c6, 0xa266c035, 0x4ebc3774, 0x82caa6fc, 0x90d0b0e0, 0xa7d81533, 0x04984af1, 0xecdaf741, 0xcd500e7f, 0x91f62f17, 0x4dd68d76, 0xefb04d43, 0xaa4d54cc, 0x9604dfe4, 0xd1b5e39e, 0x6a881b4c, 0x2c1fb8c1, 0x65517f46, 0x5eea049d, 0x8c355d01, 0x877473fa, 0x0b412efb, 0x671d5ab3, 0xdbd25292, 0x105633e9, 0xd647136d, 0xd7618c9a, 0xa10c7a37, 0xf8148e59, 0x133c89eb, 0xa927eece, 0x61c935b7, 0x1ce5ede1, 0x47b13c7a, 0xd2df599c, 0xf2733f55, 0x14ce7918, 0xc737bf73, 0xf7cdea53, 0xfdaa5b5f, 0x3d6f14df, 0x44db8678, 0xaff381ca, 0x68c43eb9, 0x24342c38, 0xa3405fc2, 0x1dc37216, 0xe2250cbc, 0x3c498b28, 0x0d9541ff, 0xa8017139, 0x0cb3de08, 0xb4e49cd8, 0x56c19064, 0xcb84617b, 0x32b670d5, 0x6c5c7448, 0xb85742d0];\n\n  // Transformations for decryption key expansion\n  var U1 = [0x00000000, 0x0e090d0b, 0x1c121a16, 0x121b171d, 0x3824342c, 0x362d3927, 0x24362e3a, 0x2a3f2331, 0x70486858, 0x7e416553, 0x6c5a724e, 0x62537f45, 0x486c5c74, 0x4665517f, 0x547e4662, 0x5a774b69, 0xe090d0b0, 0xee99ddbb, 0xfc82caa6, 0xf28bc7ad, 0xd8b4e49c, 0xd6bde997, 0xc4a6fe8a, 0xcaaff381, 0x90d8b8e8, 0x9ed1b5e3, 0x8ccaa2fe, 0x82c3aff5, 0xa8fc8cc4, 0xa6f581cf, 0xb4ee96d2, 0xbae79bd9, 0xdb3bbb7b, 0xd532b670, 0xc729a16d, 0xc920ac66, 0xe31f8f57, 0xed16825c, 0xff0d9541, 0xf104984a, 0xab73d323, 0xa57ade28, 0xb761c935, 0xb968c43e, 0x9357e70f, 0x9d5eea04, 0x8f45fd19, 0x814cf012, 0x3bab6bcb, 0x35a266c0, 0x27b971dd, 0x29b07cd6, 0x038f5fe7, 0x0d8652ec, 0x1f9d45f1, 0x119448fa, 0x4be30393, 0x45ea0e98, 0x57f11985, 0x59f8148e, 0x73c737bf, 0x7dce3ab4, 0x6fd52da9, 0x61dc20a2, 0xad766df6, 0xa37f60fd, 0xb16477e0, 0xbf6d7aeb, 0x955259da, 0x9b5b54d1, 0x894043cc, 0x87494ec7, 0xdd3e05ae, 0xd33708a5, 0xc12c1fb8, 0xcf2512b3, 0xe51a3182, 0xeb133c89, 0xf9082b94, 0xf701269f, 0x4de6bd46, 0x43efb04d, 0x51f4a750, 0x5ffdaa5b, 0x75c2896a, 0x7bcb8461, 0x69d0937c, 0x67d99e77, 0x3daed51e, 0x33a7d815, 0x21bccf08, 0x2fb5c203, 0x058ae132, 0x0b83ec39, 0x1998fb24, 0x1791f62f, 0x764dd68d, 0x7844db86, 0x6a5fcc9b, 0x6456c190, 0x4e69e2a1, 0x4060efaa, 0x527bf8b7, 0x5c72f5bc, 0x0605bed5, 0x080cb3de, 0x1a17a4c3, 0x141ea9c8, 0x3e218af9, 0x302887f2, 0x223390ef, 0x2c3a9de4, 0x96dd063d, 0x98d40b36, 0x8acf1c2b, 0x84c61120, 0xaef93211, 0xa0f03f1a, 0xb2eb2807, 0xbce2250c, 0xe6956e65, 0xe89c636e, 0xfa877473, 0xf48e7978, 0xdeb15a49, 0xd0b85742, 0xc2a3405f, 0xccaa4d54, 0x41ecdaf7, 0x4fe5d7fc, 0x5dfec0e1, 0x53f7cdea, 0x79c8eedb, 0x77c1e3d0, 0x65daf4cd, 0x6bd3f9c6, 0x31a4b2af, 0x3fadbfa4, 0x2db6a8b9, 0x23bfa5b2, 0x09808683, 0x07898b88, 0x15929c95, 0x1b9b919e, 0xa17c0a47, 0xaf75074c, 0xbd6e1051, 0xb3671d5a, 0x99583e6b, 0x97513360, 0x854a247d, 0x8b432976, 0xd134621f, 0xdf3d6f14, 0xcd267809, 0xc32f7502, 0xe9105633, 0xe7195b38, 0xf5024c25, 0xfb0b412e, 0x9ad7618c, 0x94de6c87, 0x86c57b9a, 0x88cc7691, 0xa2f355a0, 0xacfa58ab, 0xbee14fb6, 0xb0e842bd, 0xea9f09d4, 0xe49604df, 0xf68d13c2, 0xf8841ec9, 0xd2bb3df8, 0xdcb230f3, 0xcea927ee, 0xc0a02ae5, 0x7a47b13c, 0x744ebc37, 0x6655ab2a, 0x685ca621, 0x42638510, 0x4c6a881b, 0x5e719f06, 0x5078920d, 0x0a0fd964, 0x0406d46f, 0x161dc372, 0x1814ce79, 0x322bed48, 0x3c22e043, 0x2e39f75e, 0x2030fa55, 0xec9ab701, 0xe293ba0a, 0xf088ad17, 0xfe81a01c, 0xd4be832d, 0xdab78e26, 0xc8ac993b, 0xc6a59430, 0x9cd2df59, 0x92dbd252, 0x80c0c54f, 0x8ec9c844, 0xa4f6eb75, 0xaaffe67e, 0xb8e4f163, 0xb6edfc68, 0x0c0a67b1, 0x02036aba, 0x10187da7, 0x1e1170ac, 0x342e539d, 0x3a275e96, 0x283c498b, 0x26354480, 0x7c420fe9, 0x724b02e2, 0x605015ff, 0x6e5918f4, 0x44663bc5, 0x4a6f36ce, 0x587421d3, 0x567d2cd8, 0x37a10c7a, 0x39a80171, 0x2bb3166c, 0x25ba1b67, 0x0f853856, 0x018c355d, 0x13972240, 0x1d9e2f4b, 0x47e96422, 0x49e06929, 0x5bfb7e34, 0x55f2733f, 0x7fcd500e, 0x71c45d05, 0x63df4a18, 0x6dd64713, 0xd731dcca, 0xd938d1c1, 0xcb23c6dc, 0xc52acbd7, 0xef15e8e6, 0xe11ce5ed, 0xf307f2f0, 0xfd0efffb, 0xa779b492, 0xa970b999, 0xbb6bae84, 0xb562a38f, 0x9f5d80be, 0x91548db5, 0x834f9aa8, 0x8d4697a3];\n  var U2 = [0x00000000, 0x0b0e090d, 0x161c121a, 0x1d121b17, 0x2c382434, 0x27362d39, 0x3a24362e, 0x312a3f23, 0x58704868, 0x537e4165, 0x4e6c5a72, 0x4562537f, 0x74486c5c, 0x7f466551, 0x62547e46, 0x695a774b, 0xb0e090d0, 0xbbee99dd, 0xa6fc82ca, 0xadf28bc7, 0x9cd8b4e4, 0x97d6bde9, 0x8ac4a6fe, 0x81caaff3, 0xe890d8b8, 0xe39ed1b5, 0xfe8ccaa2, 0xf582c3af, 0xc4a8fc8c, 0xcfa6f581, 0xd2b4ee96, 0xd9bae79b, 0x7bdb3bbb, 0x70d532b6, 0x6dc729a1, 0x66c920ac, 0x57e31f8f, 0x5ced1682, 0x41ff0d95, 0x4af10498, 0x23ab73d3, 0x28a57ade, 0x35b761c9, 0x3eb968c4, 0x0f9357e7, 0x049d5eea, 0x198f45fd, 0x12814cf0, 0xcb3bab6b, 0xc035a266, 0xdd27b971, 0xd629b07c, 0xe7038f5f, 0xec0d8652, 0xf11f9d45, 0xfa119448, 0x934be303, 0x9845ea0e, 0x8557f119, 0x8e59f814, 0xbf73c737, 0xb47dce3a, 0xa96fd52d, 0xa261dc20, 0xf6ad766d, 0xfda37f60, 0xe0b16477, 0xebbf6d7a, 0xda955259, 0xd19b5b54, 0xcc894043, 0xc787494e, 0xaedd3e05, 0xa5d33708, 0xb8c12c1f, 0xb3cf2512, 0x82e51a31, 0x89eb133c, 0x94f9082b, 0x9ff70126, 0x464de6bd, 0x4d43efb0, 0x5051f4a7, 0x5b5ffdaa, 0x6a75c289, 0x617bcb84, 0x7c69d093, 0x7767d99e, 0x1e3daed5, 0x1533a7d8, 0x0821bccf, 0x032fb5c2, 0x32058ae1, 0x390b83ec, 0x241998fb, 0x2f1791f6, 0x8d764dd6, 0x867844db, 0x9b6a5fcc, 0x906456c1, 0xa14e69e2, 0xaa4060ef, 0xb7527bf8, 0xbc5c72f5, 0xd50605be, 0xde080cb3, 0xc31a17a4, 0xc8141ea9, 0xf93e218a, 0xf2302887, 0xef223390, 0xe42c3a9d, 0x3d96dd06, 0x3698d40b, 0x2b8acf1c, 0x2084c611, 0x11aef932, 0x1aa0f03f, 0x07b2eb28, 0x0cbce225, 0x65e6956e, 0x6ee89c63, 0x73fa8774, 0x78f48e79, 0x49deb15a, 0x42d0b857, 0x5fc2a340, 0x54ccaa4d, 0xf741ecda, 0xfc4fe5d7, 0xe15dfec0, 0xea53f7cd, 0xdb79c8ee, 0xd077c1e3, 0xcd65daf4, 0xc66bd3f9, 0xaf31a4b2, 0xa43fadbf, 0xb92db6a8, 0xb223bfa5, 0x83098086, 0x8807898b, 0x9515929c, 0x9e1b9b91, 0x47a17c0a, 0x4caf7507, 0x51bd6e10, 0x5ab3671d, 0x6b99583e, 0x60975133, 0x7d854a24, 0x768b4329, 0x1fd13462, 0x14df3d6f, 0x09cd2678, 0x02c32f75, 0x33e91056, 0x38e7195b, 0x25f5024c, 0x2efb0b41, 0x8c9ad761, 0x8794de6c, 0x9a86c57b, 0x9188cc76, 0xa0a2f355, 0xabacfa58, 0xb6bee14f, 0xbdb0e842, 0xd4ea9f09, 0xdfe49604, 0xc2f68d13, 0xc9f8841e, 0xf8d2bb3d, 0xf3dcb230, 0xeecea927, 0xe5c0a02a, 0x3c7a47b1, 0x37744ebc, 0x2a6655ab, 0x21685ca6, 0x10426385, 0x1b4c6a88, 0x065e719f, 0x0d507892, 0x640a0fd9, 0x6f0406d4, 0x72161dc3, 0x791814ce, 0x48322bed, 0x433c22e0, 0x5e2e39f7, 0x552030fa, 0x01ec9ab7, 0x0ae293ba, 0x17f088ad, 0x1cfe81a0, 0x2dd4be83, 0x26dab78e, 0x3bc8ac99, 0x30c6a594, 0x599cd2df, 0x5292dbd2, 0x4f80c0c5, 0x448ec9c8, 0x75a4f6eb, 0x7eaaffe6, 0x63b8e4f1, 0x68b6edfc, 0xb10c0a67, 0xba02036a, 0xa710187d, 0xac1e1170, 0x9d342e53, 0x963a275e, 0x8b283c49, 0x80263544, 0xe97c420f, 0xe2724b02, 0xff605015, 0xf46e5918, 0xc544663b, 0xce4a6f36, 0xd3587421, 0xd8567d2c, 0x7a37a10c, 0x7139a801, 0x6c2bb316, 0x6725ba1b, 0x560f8538, 0x5d018c35, 0x40139722, 0x4b1d9e2f, 0x2247e964, 0x2949e069, 0x345bfb7e, 0x3f55f273, 0x0e7fcd50, 0x0571c45d, 0x1863df4a, 0x136dd647, 0xcad731dc, 0xc1d938d1, 0xdccb23c6, 0xd7c52acb, 0xe6ef15e8, 0xede11ce5, 0xf0f307f2, 0xfbfd0eff, 0x92a779b4, 0x99a970b9, 0x84bb6bae, 0x8fb562a3, 0xbe9f5d80, 0xb591548d, 0xa8834f9a, 0xa38d4697];\n  var U3 = [0x00000000, 0x0d0b0e09, 0x1a161c12, 0x171d121b, 0x342c3824, 0x3927362d, 0x2e3a2436, 0x23312a3f, 0x68587048, 0x65537e41, 0x724e6c5a, 0x7f456253, 0x5c74486c, 0x517f4665, 0x4662547e, 0x4b695a77, 0xd0b0e090, 0xddbbee99, 0xcaa6fc82, 0xc7adf28b, 0xe49cd8b4, 0xe997d6bd, 0xfe8ac4a6, 0xf381caaf, 0xb8e890d8, 0xb5e39ed1, 0xa2fe8cca, 0xaff582c3, 0x8cc4a8fc, 0x81cfa6f5, 0x96d2b4ee, 0x9bd9bae7, 0xbb7bdb3b, 0xb670d532, 0xa16dc729, 0xac66c920, 0x8f57e31f, 0x825ced16, 0x9541ff0d, 0x984af104, 0xd323ab73, 0xde28a57a, 0xc935b761, 0xc43eb968, 0xe70f9357, 0xea049d5e, 0xfd198f45, 0xf012814c, 0x6bcb3bab, 0x66c035a2, 0x71dd27b9, 0x7cd629b0, 0x5fe7038f, 0x52ec0d86, 0x45f11f9d, 0x48fa1194, 0x03934be3, 0x0e9845ea, 0x198557f1, 0x148e59f8, 0x37bf73c7, 0x3ab47dce, 0x2da96fd5, 0x20a261dc, 0x6df6ad76, 0x60fda37f, 0x77e0b164, 0x7aebbf6d, 0x59da9552, 0x54d19b5b, 0x43cc8940, 0x4ec78749, 0x05aedd3e, 0x08a5d337, 0x1fb8c12c, 0x12b3cf25, 0x3182e51a, 0x3c89eb13, 0x2b94f908, 0x269ff701, 0xbd464de6, 0xb04d43ef, 0xa75051f4, 0xaa5b5ffd, 0x896a75c2, 0x84617bcb, 0x937c69d0, 0x9e7767d9, 0xd51e3dae, 0xd81533a7, 0xcf0821bc, 0xc2032fb5, 0xe132058a, 0xec390b83, 0xfb241998, 0xf62f1791, 0xd68d764d, 0xdb867844, 0xcc9b6a5f, 0xc1906456, 0xe2a14e69, 0xefaa4060, 0xf8b7527b, 0xf5bc5c72, 0xbed50605, 0xb3de080c, 0xa4c31a17, 0xa9c8141e, 0x8af93e21, 0x87f23028, 0x90ef2233, 0x9de42c3a, 0x063d96dd, 0x0b3698d4, 0x1c2b8acf, 0x112084c6, 0x3211aef9, 0x3f1aa0f0, 0x2807b2eb, 0x250cbce2, 0x6e65e695, 0x636ee89c, 0x7473fa87, 0x7978f48e, 0x5a49deb1, 0x5742d0b8, 0x405fc2a3, 0x4d54ccaa, 0xdaf741ec, 0xd7fc4fe5, 0xc0e15dfe, 0xcdea53f7, 0xeedb79c8, 0xe3d077c1, 0xf4cd65da, 0xf9c66bd3, 0xb2af31a4, 0xbfa43fad, 0xa8b92db6, 0xa5b223bf, 0x86830980, 0x8b880789, 0x9c951592, 0x919e1b9b, 0x0a47a17c, 0x074caf75, 0x1051bd6e, 0x1d5ab367, 0x3e6b9958, 0x33609751, 0x247d854a, 0x29768b43, 0x621fd134, 0x6f14df3d, 0x7809cd26, 0x7502c32f, 0x5633e910, 0x5b38e719, 0x4c25f502, 0x412efb0b, 0x618c9ad7, 0x6c8794de, 0x7b9a86c5, 0x769188cc, 0x55a0a2f3, 0x58abacfa, 0x4fb6bee1, 0x42bdb0e8, 0x09d4ea9f, 0x04dfe496, 0x13c2f68d, 0x1ec9f884, 0x3df8d2bb, 0x30f3dcb2, 0x27eecea9, 0x2ae5c0a0, 0xb13c7a47, 0xbc37744e, 0xab2a6655, 0xa621685c, 0x85104263, 0x881b4c6a, 0x9f065e71, 0x920d5078, 0xd9640a0f, 0xd46f0406, 0xc372161d, 0xce791814, 0xed48322b, 0xe0433c22, 0xf75e2e39, 0xfa552030, 0xb701ec9a, 0xba0ae293, 0xad17f088, 0xa01cfe81, 0x832dd4be, 0x8e26dab7, 0x993bc8ac, 0x9430c6a5, 0xdf599cd2, 0xd25292db, 0xc54f80c0, 0xc8448ec9, 0xeb75a4f6, 0xe67eaaff, 0xf163b8e4, 0xfc68b6ed, 0x67b10c0a, 0x6aba0203, 0x7da71018, 0x70ac1e11, 0x539d342e, 0x5e963a27, 0x498b283c, 0x44802635, 0x0fe97c42, 0x02e2724b, 0x15ff6050, 0x18f46e59, 0x3bc54466, 0x36ce4a6f, 0x21d35874, 0x2cd8567d, 0x0c7a37a1, 0x017139a8, 0x166c2bb3, 0x1b6725ba, 0x38560f85, 0x355d018c, 0x22401397, 0x2f4b1d9e, 0x642247e9, 0x692949e0, 0x7e345bfb, 0x733f55f2, 0x500e7fcd, 0x5d0571c4, 0x4a1863df, 0x47136dd6, 0xdccad731, 0xd1c1d938, 0xc6dccb23, 0xcbd7c52a, 0xe8e6ef15, 0xe5ede11c, 0xf2f0f307, 0xfffbfd0e, 0xb492a779, 0xb999a970, 0xae84bb6b, 0xa38fb562, 0x80be9f5d, 0x8db59154, 0x9aa8834f, 0x97a38d46];\n  var U4 = [0x00000000, 0x090d0b0e, 0x121a161c, 0x1b171d12, 0x24342c38, 0x2d392736, 0x362e3a24, 0x3f23312a, 0x48685870, 0x4165537e, 0x5a724e6c, 0x537f4562, 0x6c5c7448, 0x65517f46, 0x7e466254, 0x774b695a, 0x90d0b0e0, 0x99ddbbee, 0x82caa6fc, 0x8bc7adf2, 0xb4e49cd8, 0xbde997d6, 0xa6fe8ac4, 0xaff381ca, 0xd8b8e890, 0xd1b5e39e, 0xcaa2fe8c, 0xc3aff582, 0xfc8cc4a8, 0xf581cfa6, 0xee96d2b4, 0xe79bd9ba, 0x3bbb7bdb, 0x32b670d5, 0x29a16dc7, 0x20ac66c9, 0x1f8f57e3, 0x16825ced, 0x0d9541ff, 0x04984af1, 0x73d323ab, 0x7ade28a5, 0x61c935b7, 0x68c43eb9, 0x57e70f93, 0x5eea049d, 0x45fd198f, 0x4cf01281, 0xab6bcb3b, 0xa266c035, 0xb971dd27, 0xb07cd629, 0x8f5fe703, 0x8652ec0d, 0x9d45f11f, 0x9448fa11, 0xe303934b, 0xea0e9845, 0xf1198557, 0xf8148e59, 0xc737bf73, 0xce3ab47d, 0xd52da96f, 0xdc20a261, 0x766df6ad, 0x7f60fda3, 0x6477e0b1, 0x6d7aebbf, 0x5259da95, 0x5b54d19b, 0x4043cc89, 0x494ec787, 0x3e05aedd, 0x3708a5d3, 0x2c1fb8c1, 0x2512b3cf, 0x1a3182e5, 0x133c89eb, 0x082b94f9, 0x01269ff7, 0xe6bd464d, 0xefb04d43, 0xf4a75051, 0xfdaa5b5f, 0xc2896a75, 0xcb84617b, 0xd0937c69, 0xd99e7767, 0xaed51e3d, 0xa7d81533, 0xbccf0821, 0xb5c2032f, 0x8ae13205, 0x83ec390b, 0x98fb2419, 0x91f62f17, 0x4dd68d76, 0x44db8678, 0x5fcc9b6a, 0x56c19064, 0x69e2a14e, 0x60efaa40, 0x7bf8b752, 0x72f5bc5c, 0x05bed506, 0x0cb3de08, 0x17a4c31a, 0x1ea9c814, 0x218af93e, 0x2887f230, 0x3390ef22, 0x3a9de42c, 0xdd063d96, 0xd40b3698, 0xcf1c2b8a, 0xc6112084, 0xf93211ae, 0xf03f1aa0, 0xeb2807b2, 0xe2250cbc, 0x956e65e6, 0x9c636ee8, 0x877473fa, 0x8e7978f4, 0xb15a49de, 0xb85742d0, 0xa3405fc2, 0xaa4d54cc, 0xecdaf741, 0xe5d7fc4f, 0xfec0e15d, 0xf7cdea53, 0xc8eedb79, 0xc1e3d077, 0xdaf4cd65, 0xd3f9c66b, 0xa4b2af31, 0xadbfa43f, 0xb6a8b92d, 0xbfa5b223, 0x80868309, 0x898b8807, 0x929c9515, 0x9b919e1b, 0x7c0a47a1, 0x75074caf, 0x6e1051bd, 0x671d5ab3, 0x583e6b99, 0x51336097, 0x4a247d85, 0x4329768b, 0x34621fd1, 0x3d6f14df, 0x267809cd, 0x2f7502c3, 0x105633e9, 0x195b38e7, 0x024c25f5, 0x0b412efb, 0xd7618c9a, 0xde6c8794, 0xc57b9a86, 0xcc769188, 0xf355a0a2, 0xfa58abac, 0xe14fb6be, 0xe842bdb0, 0x9f09d4ea, 0x9604dfe4, 0x8d13c2f6, 0x841ec9f8, 0xbb3df8d2, 0xb230f3dc, 0xa927eece, 0xa02ae5c0, 0x47b13c7a, 0x4ebc3774, 0x55ab2a66, 0x5ca62168, 0x63851042, 0x6a881b4c, 0x719f065e, 0x78920d50, 0x0fd9640a, 0x06d46f04, 0x1dc37216, 0x14ce7918, 0x2bed4832, 0x22e0433c, 0x39f75e2e, 0x30fa5520, 0x9ab701ec, 0x93ba0ae2, 0x88ad17f0, 0x81a01cfe, 0xbe832dd4, 0xb78e26da, 0xac993bc8, 0xa59430c6, 0xd2df599c, 0xdbd25292, 0xc0c54f80, 0xc9c8448e, 0xf6eb75a4, 0xffe67eaa, 0xe4f163b8, 0xedfc68b6, 0x0a67b10c, 0x036aba02, 0x187da710, 0x1170ac1e, 0x2e539d34, 0x275e963a, 0x3c498b28, 0x35448026, 0x420fe97c, 0x4b02e272, 0x5015ff60, 0x5918f46e, 0x663bc544, 0x6f36ce4a, 0x7421d358, 0x7d2cd856, 0xa10c7a37, 0xa8017139, 0xb3166c2b, 0xba1b6725, 0x8538560f, 0x8c355d01, 0x97224013, 0x9e2f4b1d, 0xe9642247, 0xe0692949, 0xfb7e345b, 0xf2733f55, 0xcd500e7f, 0xc45d0571, 0xdf4a1863, 0xd647136d, 0x31dccad7, 0x38d1c1d9, 0x23c6dccb, 0x2acbd7c5, 0x15e8e6ef, 0x1ce5ede1, 0x07f2f0f3, 0x0efffbfd, 0x79b492a7, 0x70b999a9, 0x6bae84bb, 0x62a38fb5, 0x5d80be9f, 0x548db591, 0x4f9aa883, 0x4697a38d];\n\n  function convertToInt32(bytes) {\n    var result = [];\n    for (var i = 0; i < bytes.length; i += 4) {\n      result.push(\n        (bytes[i    ] << 24) |\n        (bytes[i + 1] << 16) |\n        (bytes[i + 2] <<  8) |\n        bytes[i + 3]\n      );\n    }\n    return result;\n  }\n\n  var AES = function(key) {\n    if (!(this instanceof AES)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    Object.defineProperty(this, 'key', {\n      value: coerceArray(key, true)\n    });\n\n    this._prepare();\n  }\n\n\n  AES.prototype._prepare = function() {\n\n    var rounds = numberOfRounds[this.key.length];\n    if (rounds == null) {\n      throw new Error('invalid key size (must be 16, 24 or 32 bytes)');\n    }\n\n    // encryption round keys\n    this._Ke = [];\n\n    // decryption round keys\n    this._Kd = [];\n\n    for (var i = 0; i <= rounds; i++) {\n      this._Ke.push([0, 0, 0, 0]);\n      this._Kd.push([0, 0, 0, 0]);\n    }\n\n    var roundKeyCount = (rounds + 1) * 4;\n    var KC = this.key.length / 4;\n\n    // convert the key into ints\n    var tk = convertToInt32(this.key);\n\n    // copy values into round key arrays\n    var index;\n    for (var i = 0; i < KC; i++) {\n      index = i >> 2;\n      this._Ke[index][i % 4] = tk[i];\n      this._Kd[rounds - index][i % 4] = tk[i];\n    }\n\n    // key expansion (fips-197 section 5.2)\n    var rconpointer = 0;\n    var t = KC, tt;\n    while (t < roundKeyCount) {\n      tt = tk[KC - 1];\n      tk[0] ^= ((S[(tt >> 16) & 0xFF] << 24) ^\n        (S[(tt >>  8) & 0xFF] << 16) ^\n        (S[ tt        & 0xFF] <<  8) ^\n        S[(tt >> 24) & 0xFF]        ^\n        (rcon[rconpointer] << 24));\n      rconpointer += 1;\n\n      // key expansion (for non-256 bit)\n      if (KC != 8) {\n        for (var i = 1; i < KC; i++) {\n          tk[i] ^= tk[i - 1];\n        }\n\n        // key expansion for 256-bit keys is \"slightly different\" (fips-197)\n      } else {\n        for (var i = 1; i < (KC / 2); i++) {\n          tk[i] ^= tk[i - 1];\n        }\n        tt = tk[(KC / 2) - 1];\n\n        tk[KC / 2] ^= (S[ tt        & 0xFF]        ^\n          (S[(tt >>  8) & 0xFF] <<  8) ^\n          (S[(tt >> 16) & 0xFF] << 16) ^\n          (S[(tt >> 24) & 0xFF] << 24));\n\n        for (var i = (KC / 2) + 1; i < KC; i++) {\n          tk[i] ^= tk[i - 1];\n        }\n      }\n\n      // copy values into round key arrays\n      var i = 0, r, c;\n      while (i < KC && t < roundKeyCount) {\n        r = t >> 2;\n        c = t % 4;\n        this._Ke[r][c] = tk[i];\n        this._Kd[rounds - r][c] = tk[i++];\n        t++;\n      }\n    }\n\n    // inverse-cipher-ify the decryption round key (fips-197 section 5.3)\n    for (var r = 1; r < rounds; r++) {\n      for (var c = 0; c < 4; c++) {\n        tt = this._Kd[r][c];\n        this._Kd[r][c] = (U1[(tt >> 24) & 0xFF] ^\n          U2[(tt >> 16) & 0xFF] ^\n          U3[(tt >>  8) & 0xFF] ^\n          U4[ tt        & 0xFF]);\n      }\n    }\n  }\n\n  AES.prototype.encrypt = function(plaintext) {\n    if (plaintext.length != 16) {\n      throw new Error('invalid plaintext size (must be 16 bytes)');\n    }\n\n    var rounds = this._Ke.length - 1;\n    var a = [0, 0, 0, 0];\n\n    // convert plaintext to (ints ^ key)\n    var t = convertToInt32(plaintext);\n    for (var i = 0; i < 4; i++) {\n      t[i] ^= this._Ke[0][i];\n    }\n\n    // apply round transforms\n    for (var r = 1; r < rounds; r++) {\n      for (var i = 0; i < 4; i++) {\n        a[i] = (T1[(t[ i         ] >> 24) & 0xff] ^\n          T2[(t[(i + 1) % 4] >> 16) & 0xff] ^\n          T3[(t[(i + 2) % 4] >>  8) & 0xff] ^\n          T4[ t[(i + 3) % 4]        & 0xff] ^\n          this._Ke[r][i]);\n      }\n      t = a.slice();\n    }\n\n    // the last round is special\n    var result = createArray(16), tt;\n    for (var i = 0; i < 4; i++) {\n      tt = this._Ke[rounds][i];\n      result[4 * i    ] = (S[(t[ i         ] >> 24) & 0xff] ^ (tt >> 24)) & 0xff;\n      result[4 * i + 1] = (S[(t[(i + 1) % 4] >> 16) & 0xff] ^ (tt >> 16)) & 0xff;\n      result[4 * i + 2] = (S[(t[(i + 2) % 4] >>  8) & 0xff] ^ (tt >>  8)) & 0xff;\n      result[4 * i + 3] = (S[ t[(i + 3) % 4]        & 0xff] ^  tt       ) & 0xff;\n    }\n\n    return result;\n  }\n\n  AES.prototype.decrypt = function(ciphertext) {\n    if (ciphertext.length != 16) {\n      throw new Error('invalid ciphertext size (must be 16 bytes)');\n    }\n\n    var rounds = this._Kd.length - 1;\n    var a = [0, 0, 0, 0];\n\n    // convert plaintext to (ints ^ key)\n    var t = convertToInt32(ciphertext);\n    for (var i = 0; i < 4; i++) {\n      t[i] ^= this._Kd[0][i];\n    }\n\n    // apply round transforms\n    for (var r = 1; r < rounds; r++) {\n      for (var i = 0; i < 4; i++) {\n        a[i] = (T5[(t[ i          ] >> 24) & 0xff] ^\n          T6[(t[(i + 3) % 4] >> 16) & 0xff] ^\n          T7[(t[(i + 2) % 4] >>  8) & 0xff] ^\n          T8[ t[(i + 1) % 4]        & 0xff] ^\n          this._Kd[r][i]);\n      }\n      t = a.slice();\n    }\n\n    // the last round is special\n    var result = createArray(16), tt;\n    for (var i = 0; i < 4; i++) {\n      tt = this._Kd[rounds][i];\n      result[4 * i    ] = (Si[(t[ i         ] >> 24) & 0xff] ^ (tt >> 24)) & 0xff;\n      result[4 * i + 1] = (Si[(t[(i + 3) % 4] >> 16) & 0xff] ^ (tt >> 16)) & 0xff;\n      result[4 * i + 2] = (Si[(t[(i + 2) % 4] >>  8) & 0xff] ^ (tt >>  8)) & 0xff;\n      result[4 * i + 3] = (Si[ t[(i + 1) % 4]        & 0xff] ^  tt       ) & 0xff;\n    }\n\n    return result;\n  }\n\n\n  /**\n   *  Mode Of Operation - Electonic Codebook (ECB)\n   */\n  var ModeOfOperationECB = function(key) {\n    if (!(this instanceof ModeOfOperationECB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Electronic Code Block\";\n    this.name = \"ecb\";\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationECB.prototype.encrypt = function(plaintext) {\n    plaintext = coerceArray(plaintext);\n\n    if ((plaintext.length % 16) !== 0) {\n      throw new Error('invalid plaintext size (must be multiple of 16 bytes)');\n    }\n\n    var ciphertext = createArray(plaintext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < plaintext.length; i += 16) {\n      copyArray(plaintext, block, 0, i, i + 16);\n      block = this._aes.encrypt(block);\n      copyArray(block, ciphertext, i);\n    }\n\n    return ciphertext;\n  }\n\n  ModeOfOperationECB.prototype.decrypt = function(ciphertext) {\n    ciphertext = coerceArray(ciphertext);\n\n    if ((ciphertext.length % 16) !== 0) {\n      throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');\n    }\n\n    var plaintext = createArray(ciphertext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < ciphertext.length; i += 16) {\n      copyArray(ciphertext, block, 0, i, i + 16);\n      block = this._aes.decrypt(block);\n      copyArray(block, plaintext, i);\n    }\n\n    return plaintext;\n  }\n\n\n  /**\n   *  Mode Of Operation - Cipher Block Chaining (CBC)\n   */\n  var ModeOfOperationCBC = function(key, iv) {\n    if (!(this instanceof ModeOfOperationCBC)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Cipher Block Chaining\";\n    this.name = \"cbc\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 bytes)');\n    }\n\n    this._lastCipherblock = coerceArray(iv, true);\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCBC.prototype.encrypt = function(plaintext) {\n    plaintext = coerceArray(plaintext);\n\n    if ((plaintext.length % 16) !== 0) {\n      throw new Error('invalid plaintext size (must be multiple of 16 bytes)');\n    }\n\n    var ciphertext = createArray(plaintext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < plaintext.length; i += 16) {\n      copyArray(plaintext, block, 0, i, i + 16);\n\n      for (var j = 0; j < 16; j++) {\n        block[j] ^= this._lastCipherblock[j];\n      }\n\n      this._lastCipherblock = this._aes.encrypt(block);\n      copyArray(this._lastCipherblock, ciphertext, i);\n    }\n\n    return ciphertext;\n  }\n\n  ModeOfOperationCBC.prototype.decrypt = function(ciphertext) {\n    ciphertext = coerceArray(ciphertext);\n\n    if ((ciphertext.length % 16) !== 0) {\n      throw new Error('invalid ciphertext size (must be multiple of 16 bytes)');\n    }\n\n    var plaintext = createArray(ciphertext.length);\n    var block = createArray(16);\n\n    for (var i = 0; i < ciphertext.length; i += 16) {\n      copyArray(ciphertext, block, 0, i, i + 16);\n      block = this._aes.decrypt(block);\n\n      for (var j = 0; j < 16; j++) {\n        plaintext[i + j] = block[j] ^ this._lastCipherblock[j];\n      }\n\n      copyArray(ciphertext, this._lastCipherblock, 0, i, i + 16);\n    }\n\n    return plaintext;\n  }\n\n\n  /**\n   *  Mode Of Operation - Cipher Feedback (CFB)\n   */\n  var ModeOfOperationCFB = function(key, iv, segmentSize) {\n    if (!(this instanceof ModeOfOperationCFB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Cipher Feedback\";\n    this.name = \"cfb\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 size)');\n    }\n\n    if (!segmentSize) { segmentSize = 1; }\n\n    this.segmentSize = segmentSize;\n\n    this._shiftRegister = coerceArray(iv, true);\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCFB.prototype.encrypt = function(plaintext) {\n    if ((plaintext.length % this.segmentSize) != 0) {\n      throw new Error('invalid plaintext size (must be segmentSize bytes)');\n    }\n\n    var encrypted = coerceArray(plaintext, true);\n\n    var xorSegment;\n    for (var i = 0; i < encrypted.length; i += this.segmentSize) {\n      xorSegment = this._aes.encrypt(this._shiftRegister);\n      for (var j = 0; j < this.segmentSize; j++) {\n        encrypted[i + j] ^= xorSegment[j];\n      }\n\n      // Shift the register\n      copyArray(this._shiftRegister, this._shiftRegister, 0, this.segmentSize);\n      copyArray(encrypted, this._shiftRegister, 16 - this.segmentSize, i, i + this.segmentSize);\n    }\n\n    return encrypted;\n  }\n\n  ModeOfOperationCFB.prototype.decrypt = function(ciphertext) {\n    if ((ciphertext.length % this.segmentSize) != 0) {\n      throw new Error('invalid ciphertext size (must be segmentSize bytes)');\n    }\n\n    var plaintext = coerceArray(ciphertext, true);\n\n    var xorSegment;\n    for (var i = 0; i < plaintext.length; i += this.segmentSize) {\n      xorSegment = this._aes.encrypt(this._shiftRegister);\n\n      for (var j = 0; j < this.segmentSize; j++) {\n        plaintext[i + j] ^= xorSegment[j];\n      }\n\n      // Shift the register\n      copyArray(this._shiftRegister, this._shiftRegister, 0, this.segmentSize);\n      copyArray(ciphertext, this._shiftRegister, 16 - this.segmentSize, i, i + this.segmentSize);\n    }\n\n    return plaintext;\n  }\n\n  /**\n   *  Mode Of Operation - Output Feedback (OFB)\n   */\n  var ModeOfOperationOFB = function(key, iv) {\n    if (!(this instanceof ModeOfOperationOFB)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Output Feedback\";\n    this.name = \"ofb\";\n\n    if (!iv) {\n      iv = createArray(16);\n\n    } else if (iv.length != 16) {\n      throw new Error('invalid initialation vector size (must be 16 bytes)');\n    }\n\n    this._lastPrecipher = coerceArray(iv, true);\n    this._lastPrecipherIndex = 16;\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationOFB.prototype.encrypt = function(plaintext) {\n    var encrypted = coerceArray(plaintext, true);\n\n    for (var i = 0; i < encrypted.length; i++) {\n      if (this._lastPrecipherIndex === 16) {\n        this._lastPrecipher = this._aes.encrypt(this._lastPrecipher);\n        this._lastPrecipherIndex = 0;\n      }\n      encrypted[i] ^= this._lastPrecipher[this._lastPrecipherIndex++];\n    }\n\n    return encrypted;\n  }\n\n  // Decryption is symetric\n  ModeOfOperationOFB.prototype.decrypt = ModeOfOperationOFB.prototype.encrypt;\n\n\n  /**\n   *  Counter object for CTR common mode of operation\n   */\n  var Counter = function(initialValue) {\n    if (!(this instanceof Counter)) {\n      throw Error('Counter must be instanitated with `new`');\n    }\n\n    // We allow 0, but anything false-ish uses the default 1\n    if (initialValue !== 0 && !initialValue) { initialValue = 1; }\n\n    if (typeof(initialValue) === 'number') {\n      this._counter = createArray(16);\n      this.setValue(initialValue);\n\n    } else {\n      this.setBytes(initialValue);\n    }\n  }\n\n  Counter.prototype.setValue = function(value) {\n    if (typeof(value) !== 'number' || parseInt(value) != value) {\n      throw new Error('invalid counter value (must be an integer)');\n    }\n\n    // We cannot safely handle numbers beyond the safe range for integers\n    if (value > Number.MAX_SAFE_INTEGER) {\n      throw new Error('integer value out of safe range');\n    }\n\n    for (var index = 15; index >= 0; --index) {\n      this._counter[index] = value % 256;\n      value = parseInt(value / 256);\n    }\n  }\n\n  Counter.prototype.setBytes = function(bytes) {\n    bytes = coerceArray(bytes, true);\n\n    if (bytes.length != 16) {\n      throw new Error('invalid counter bytes size (must be 16 bytes)');\n    }\n\n    this._counter = bytes;\n  };\n\n  Counter.prototype.increment = function() {\n    for (var i = 15; i >= 0; i--) {\n      if (this._counter[i] === 255) {\n        this._counter[i] = 0;\n      } else {\n        this._counter[i]++;\n        break;\n      }\n    }\n  }\n\n\n  /**\n   *  Mode Of Operation - Counter (CTR)\n   */\n  var ModeOfOperationCTR = function(key, counter) {\n    if (!(this instanceof ModeOfOperationCTR)) {\n      throw Error('AES must be instanitated with `new`');\n    }\n\n    this.description = \"Counter\";\n    this.name = \"ctr\";\n\n    if (!(counter instanceof Counter)) {\n      counter = new Counter(counter)\n    }\n\n    this._counter = counter;\n\n    this._remainingCounter = null;\n    this._remainingCounterIndex = 16;\n\n    this._aes = new AES(key);\n  }\n\n  ModeOfOperationCTR.prototype.encrypt = function(plaintext) {\n    var encrypted = coerceArray(plaintext, true);\n\n    for (var i = 0; i < encrypted.length; i++) {\n      if (this._remainingCounterIndex === 16) {\n        this._remainingCounter = this._aes.encrypt(this._counter._counter);\n        this._remainingCounterIndex = 0;\n        this._counter.increment();\n      }\n      encrypted[i] ^= this._remainingCounter[this._remainingCounterIndex++];\n    }\n\n    return encrypted;\n  }\n\n  // Decryption is symetric\n  ModeOfOperationCTR.prototype.decrypt = ModeOfOperationCTR.prototype.encrypt;\n\n\n  ///////////////////////\n  // Padding\n\n  // See:https://tools.ietf.org/html/rfc2315\n  function pkcs7pad(data) {\n    data = coerceArray(data, true);\n    var padder = 16 - (data.length % 16);\n    var result = createArray(data.length + padder);\n    copyArray(data, result);\n    for (var i = data.length; i < result.length; i++) {\n      result[i] = padder;\n    }\n    return result;\n  }\n\n  function pkcs7strip(data) {\n    data = coerceArray(data, true);\n    if (data.length < 16) { throw new Error('PKCS#7 invalid length'); }\n\n    var padder = data[data.length - 1];\n    if (padder > 16) { throw new Error('PKCS#7 padding byte out of range'); }\n\n    var length = data.length - padder;\n    for (var i = 0; i < padder; i++) {\n      if (data[length + i] !== padder) {\n        throw new Error('PKCS#7 invalid padding byte');\n      }\n    }\n\n    var result = createArray(length);\n    copyArray(data, result, 0, 0, length);\n    return result;\n  }\n\n  ///////////////////////\n  // Exporting\n\n\n  // The block cipher\n  var aesjs = {\n    AES: AES,\n    Counter: Counter,\n\n    ModeOfOperation: {\n      ecb: ModeOfOperationECB,\n      cbc: ModeOfOperationCBC,\n      cfb: ModeOfOperationCFB,\n      ofb: ModeOfOperationOFB,\n      ctr: ModeOfOperationCTR\n    },\n\n    utils: {\n      hex: convertHex,\n      utf8: convertUtf8\n    },\n\n    padding: {\n      pkcs7: {\n        pad: pkcs7pad,\n        strip: pkcs7strip\n      }\n    },\n\n    _arrayTest: {\n      coerceArray: coerceArray,\n      createArray: createArray,\n      copyArray: copyArray,\n    }\n  };\n\n\n  // node.js\n  if (typeof exports !== 'undefined') {\n    module.exports = aesjs\n\n    // RequireJS/AMD\n    // http://www.requirejs.org/docs/api.html\n    // https://github.com/amdjs/amdjs-api/wiki/AMD\n  } else if (typeof(define) === 'function' && define.amd) {\n    define([], function() { return aesjs; });\n\n    // Web Browsers\n  } else {\n\n    // If there was an existing library at \"aesjs\" make sure it's still available\n    if (root.aesjs) {\n      aesjs._aesjs = root.aesjs;\n    }\n\n    root.aesjs = aesjs;\n  }\n\n\n})(this);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [973,508,115], () => (__webpack_require__(12332)))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".\" + {\"115\":\"91298d679585917d2a7c\",\"508\":\"0e2a432f09617cb8831c\",\"973\":\"8069d508cb08d6a3b5f3\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t941: 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunkmytonwallet\"] = self[\"webpackChunkmytonwallet\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["deferred","next","IS_EXTENSION_PAGE_SCRIPT","IS_EXTENSION","includes","self","location","protocol","dnsCategoryToBigInt","category","sha256BigInt","parseSmartContractAddressImpl","cell","prefix0","prefix1","slice","asSlice","byte0","loadUint","byte1","Error","n","loadUintBig","hashPart","toString","s","padStart","Address","parse","parseAddress","parseNextResolverRecord","parseStorageBagIdRecord","loadBuffer","async","dnsResolveImpl","client","dnsAddress","rawDomainBytes","oneStep","len","length","domainCell","Builder","storeBuffer","asCell","categoryBigInt","stack","callGetMethod","type","value","resultLen","readNumber","readCell","err","DnsCategory","DnsNextResolver","undefined","Wallet","parseSmartContractAddressRecord","Site","parseAdnlAddressRecord","parseSiteRecord","BagId","nextAddress","encodeDomain","domain","toLowerCase","i","charCodeAt","substring","c","String","fromCharCode","arr","split","forEach","part","reverse","join","dnsResolve","rootDnsAddress","rawDomain","Buffer","from","shouldShowAlert","APP_ENV","window","throttledAlert","throttle","message","alert","SECOND","handleErrorEvent","e","ErrorEvent","preventDefault","handleError","error","reason","logDebugError","endsWith","DEBUG_ALERT_MSG","addEventListener","TON_BIP39_PATH","ONE_TON","TOKEN_TRANSFER_AMOUNT","TINY_TOKEN_TRANSFER_AMOUNT","TOKEN_TRANSFER_REAL_AMOUNT","TINY_TOKEN_TRANSFER_REAL_AMOUNT","TINIEST_TOKEN_TRANSFER_REAL_AMOUNT","TOKEN_TRANSFER_FORWARD_AMOUNT","CLAIM_MINTLESS_AMOUNT","NFT_TRANSFER_AMOUNT","NFT_TRANSFER_REAL_AMOUNT","NFT_TRANSFER_FORWARD_AMOUNT","NFT_PAYLOAD_SAFE_MARGIN","TON_GAS","stakeNominators","unstakeNominators","stakeLiquid","unstakeLiquid","stakeJettonsForward","JettonStakingGas","STAKE_JETTONS","stakeJettons","unstakeJettons","UNSTAKE_JETTONS","claimJettons","JETTON_TRANSFER","SIMPLE_UPDATE_REQUEST","changeDns","stakeEthena","stakeEthenaForward","unstakeEthena","unstakeEthenaForward","unstakeEthenaLocked","unstakeEthenaLockedForward","STAKE_COMMENT","UNSTAKE_COMMENT","ATTEMPTS","DEFAULT_DECIMALS","DEFAULT_IS_BOUNCEABLE","FEE_FACTOR","ALL_WALLET_VERSIONS","OUR_FEE_PAYLOAD_BOC","Workchain","WORKCHAIN","BaseChain","TRANSFER_TIMEOUT_SEC","DEFAULT_MAX_MESSAGES","LEDGER_MAX_MESSAGES","W5_MAX_MESSAGES","OpCode","JettonOpCode","NftOpCode","LiquidStakingOpCode","JettonStakingOpCode","VestingV1OpCode","SingleNominatorOpCode","DnsOpCode","TeleitemOpCode","OtherOpCode","ContractType","EXCESS_OP_CODES","Excesses","Ok","DNS_CATEGORY_HASH_MAP","dns_next_resolver","wallet","site","storage","KnownContracts","simpleR1","name","hash","simpleR2","simpleR3","v2R1","v2R2","v3R1","v3R2","v4R1","v4R2","W5","highloadV2","nominatorPool","Staking","multisig","multisigV2","vesting","multisigNew","dedustPool","isSwapAllowed","dedustVaultNative","dedustVaultJetton","stonPtonWallet","stonRouter","stonRouterV2_1","stonPoolV2_1","stonRouterV2_2","stonRouterV2_2_alt","stonPoolV2_2","stonPtonWalletV2","Deferred","constructor","this","promise","Promise","resolve","reject","resolved","YEAR","withCache","langCode","dayStartAt","noYear","monthFormat","arguments","noDay","withTime","Date","toLocaleString","year","month","day","hour","minute","hourCycle","ApiLiquidUnstakeMode","MAX_DP","NAME","INVALID","INVALID_DP","INVALID_RM","DIV_BY_ZERO","P","UNDEFINED","NUMERIC","round","x","sd","rm","more","xc","RM","unshift","pop","stringify","doExponential","isNonzero","charAt","abs","cmp","y","isneg","yc","j","k","l","div","Big","a","b","dp","DP","bl","bt","ri","bz","ai","al","r","rl","q","qc","qi","p","push","shift","eq","gt","gte","lt","lte","minus","sub","t","xlty","plus","xe","ye","mod","ygtx","times","neg","add","pow","one","prec","sqrt","half","Math","toExponential","indexOf","mul","Array","toFixed","Symbol","for","toJSON","NE","PE","toNumber","Number","strict","toPrecision","valueOf","_Big_","TypeError","nl","test","replace","search","prototype","roundDown","roundHalfUp","roundHalfEven","roundUp","ten","fromDecimal","decimals","BigInt","TONCOIN","toDecimal","noFloor","toBig","randomBytes","size","crypto","getRandomValues","Uint8Array","BIGINT_PREFIX","bigintReviver","key","startsWith","bigintAbs","bigintDivideToNumber","num","bigintMultiplyToNumber","UNDEFINED_PREFIX","extensionMessageReplacer","extensionMessageReviver","callbackState","Map","parseAccountId","accountId","parts","id","network","isMnemonicPrivateKey","mnemonic","PRIVATE_KEY_HEX_LENGTH","address","fromRight","FILLER","pathRegex","replaceDerive","val","derivePath","path","seed","offset","map","some","isNaN","isValidPath","chainCode","I","createHmac","update","digest","getMasterKeyFromSeed","el","parseInt","reduce","parentKeys","segment","CKDPriv","_ref","index","indexBuffer","allocUnsafe","writeUInt32BE","data","concat","alloc","buildCollectionByKey","collection","byKey","member","pick","object","keys","result","omit","stringKeys","Set","Object","filter","has","omitUndefined","stringKey","compact","array","Boolean","chunkSize","range","start","end","fromKeyValueArrays","values","acc","isArray","extractKey","findDifference","array1","array2","set2","diff","element","getDnsDomainZone","zone","TON_DNS_ZONES","suffixes","baseFormat","suffix","base","sha256","bytes","subtle","bytesToHex","hexToBytes","hex","bytesToBase64","base64ToBytes","base64","environment","setEnvironment","args","_self","isDappSupported","isSseSupported","isElectron","IS_CAPACITOR","isNativeBottomSheet","apiHeaders","origin","toncenterMainnetKey","ELECTRON_TONCENTER_MAINNET_KEY","TONCENTER_MAINNET_KEY","toncenterTestnetKey","ELECTRON_TONCENTER_TESTNET_KEY","TONCENTER_TESTNET_KEY","getEnvironment","generateQueryId","randomNumber","randomBigInt","bigintRandom","TON_MAX_COMMENT_BYTES","clientByNetwork","walletClassMap","WalletContractV1R1","WalletContractV1R2","WalletContractV1R3","WalletContractV2R1","WalletContractV2R2","WalletContractV3R1","WalletContractV3R2","WalletContractV4","WalletContractV5R1","getTonClient","mainnet","TonClient","endpoint","TONCENTER_MAINNET_URL","timeout","DEFAULT_TIMEOUT","apiKey","headers","testnet","TONCENTER_TESTNET_URL","resolveTokenWalletAddress","withCacheAsync","tokenAddress","minter","open","JettonMinter","toBase64Address","getWalletAddress","resolveTokenAddress","tokenWalletAddress","tokenWallet","JettonWallet","getWalletData","getWalletPublicKey","res","runMethodWithError","exit_code","readBigNumber","getJettonPoolStakeWallet","poolAddress","period","tonClient","pool","StakingPool","createFromAddress","walletAddress","StakeWallet","oneCellFromBoc","Cell","fromBoc","isBounceable","urlSafe","bounceable","testOnly","toRawAddress","toRawString","buildTokenTransferBody","params","queryId","tokenAmount","toAddress","responseAddress","forwardAmount","customPayload","forwardPayload","builder","storeUint","Transfer","storeCoins","storeAddress","storeMaybeRef","packBytesAsSnake","availableBits","storeBit","storeRef","endCell","commentToBytes","comment","buffer","startBuffer","Comment","set","maxBytes","packBytesAsSnakeCell","bytesPerCell","headCell","ceil","cellOffset","cellLength","min","cellBuffer","byteOffset","nextHeadCell","EMPTY","packBytesAsSnakeForEncryptedData","subarray","buildLiquidStakingDepositBody","Deposit","isRaw","parseRaw","isValid","isFriendly","parseFriendly","isUserFriendly","getIsRawAddress","buildJettonUnstakePayload","jettonsToUnstake","forceUnstake","beginCell","JettonStakingOpCodes","buildJettonClaimPayload","poolWallets","rewardsToClaim","Dictionary","empty","Keys","Values","Bool","poolWallet","CLAIM_REWARDS","storeDict","unpackDicts","obj","isSimpleObject","callback","newByKey","getPrototypeOf","connector","StorageType","generateUniqueId","now","random","ConnectorClass","requestStates","requestStatesByCallback","target","onUpdate","channel","shouldUseJson","targetOrigin","destroy","init","_len","_key","postMessage","request","messageData","messageId","payload","requestState","assign","withCallback","catch","finally","delete","cancelCallback","progressCallback","isCanceled","get","onMessage","JSON","decodeExtensionMessage","response","_requestState$callbac","call","callbackArgs","_data$error","_data$error2","rawData","encodeExtensionMessage","callWindow","methodName","cache","getItem","force","isAndroidApp","setItem","removeItem","clear","getKeys","chrome","local","_await$storage$get","remove","bind","getAll","setMany","getMany","store","idb","INDEXED_DB_NAME","INDEXED_DB_STORE_NAME","items","entries","withPromise","fn","localStorage","extensionStorage","capacitorStorage","MIN_ACCOUNT_NUMBER","IndexedDb","LocalStorage","ExtensionLocal","CapacitorStorage","loginResolve","loginPromise","fetchStoredAddress","chain","fetchStoredAccount","fetchStoredTonWallet","fetchStoredTonAccount","ton","fetchStoredTronWallet","account","tron","fetchStoredTronAccount","fetchMaybeStoredAccount","getAccountValue","fetchStoredAccounts","updateStoredAccount","partial","setAccountValue","_await$storage$getIte","removeAccountValue","removedValue","restData","removeNetworkAccountsValue","getCurrentNetwork","getCurrentAccountId","getAddressesFromAccount","addressByChain","PBKDF2_IMPORT_KEY_ARGS","PBKDF2_DERIVE_KEY_ARGS","iterations","PBKDF2_DERIVE_KEY_TYPE","validateBip39Mnemonic","bip39","encryptMnemonic","password","plaintext","salt","keyMaterial","importKey","TextEncoder","encode","deriveKey","iv","ptUint8","ctBuffer","encrypt","ctArray","ctBase64","btoa","ivHex","decryptMnemonic","encrypted","pwUtf8","pwHash","match","byte","alg","ctStr","atob","ctUint8","ch","plainBuffer","decrypt","TextDecoder","decode","decryptMnemonicLegacy","saltHex","encryptedData","getMnemonic","sensitiveData","mnemonicEncrypted","decryptedMnemonic","ApiCommonError","DebugError","removeSensitiveDataFromError","tryMigratingMnemonicEncryption","removeFromString","text","toRemove","replaceAll","_error$stack","RE_SYMBOL_WITH_COMBINING_MARKS","RE_LINEBREAK_COMBINING_MARKS","RE_SPACE_CHARS","RE_FAKE_DOTS","RE_EMPTY_CHARS","checkLNPRegex","characters","alphabetMap","confusablesMap","alts","char","cleanText","str","checkLNP","newStr","clean","BAD_REQUEST_CODE","callBackendPost","options","authToken","isAllowBadRequest","method","shouldRetry","retries","timeouts","url","URL","BRILLIANT_API_BASE_URL","getBackendHeaders","body","fetchWithRetry","shouldSkipRetryFn","fetch","handleFetchErrors","json","callBackendGet","fetchJson","APP_VERSION","addBackendHeadersToSocketUrl","exec","searchParams","append","knownAddresses","scamMarkers","trustedSites","trustedCollections","tonNftSuperCollectionsByCollectionAddress","nftSuperCollectionsDeferred","tryUpdateKnownAddresses","RegExp","tonNftSuperCollections","superCollection","collections","rest","getKnownAddresses","getNftSuperCollectionsByCollectionAddress","getKnownAddressInfo","checkIsTrustedCollection","checkHasScamLink","matches","matchAll","RE_LINK_TEMPLATE","_match$groups","host","groups","compareActivities","isAsc","getIsActivityPending","timestamp","parseTxId","txId","subId","buildLocalTxId","buildTxId","getActivityTokenSlugs","activity","kind","nft","slug","to","cex","status","isPending","toMilliseconds","seconds","toSeconds","ms","floor","isEmptyObject","keyCount","hasOwnProperty","isKeyCountGreater","IGNORED_DEXIE_ERRORS","tryDbQuery","cb","ApiDb","Dexie","super","version","stores","nfts","sseConnections","tokens","upgrade","tx","table","apiDb","tokenRepository","all","toArray","find","where","put","item","bulkPut","deleteWhere","tokensPreload","tokensCache","baseCurrency","DEFAULT_PRICE_CURRENCY","bySlug","TOKEN_INFO","updateTokens","tokenDetails","shouldSendUpdate","tokensForDb","detailsBySlug","details","cachedToken","token","mergedToken","mergeTokenWithCache","sendUpdateTokens","isFromBackend","price","priceUsd","percentChange24h","getTokensCache","getTokenBySlug","getTokenByAddress","buildTokenSlug","ADDRESS_BOOK_CHUNK_SIZE","VERSION_MAP","fixAddressFormat","callToncenterV3","address_book","getWalletInfos","addresses","wallets","states","addressBook","walletInfoByRawAddress","fromEntries","state","buildWalletInfo","inputAddress","rawAddress","balance","isInitialized","seqno","user_friendly","wallet_type","lastTxId","last_transaction_hash","getToncenterHeaders","TONCENTER_ACTIONS_VERSION","MAX_LIMIT","EVENTS_LIMIT","apiByNetwork","getApi","Api","HttpClient","baseUrl","TONAPIIO_MAINNET_URL","baseApiParams","customFetch","TONAPIIO_TESTNET_URL","fetchJettonBalances","accounts","getAccountJettonsBalances","supported_extensions","balances","fetchNftItems","getNftItemsByAddresses","account_ids","nft_items","OFFCHAIN_CONTENT_PREFIX","dictSnakeBufferValue","sliceToVal","v","isFirst","remainingBits","remainingRefs","loadRef","beginParse","serialize","jettonOnChainMetadataSpec","uri","description","image","symbol","custom_payload_api_uri","fetchJettonOffchainMetadata","fetchJsonWithProxy","parsePayloadBase64","Slice","BitReader","BitString","dataToSlice","shouldLoadItems","transactionDebug","opCode","readSnakeBytes","Encrypted","encryptedComment","_forwardPayload","amount","loadCoins","destination","loadAddress","responseDestination","loadMaybeAddress","loadMaybeRef","forwardPayloadOpCode","storeBits","loadBits","forwardPayloadSlice","toBoc","TransferOwnership","_nft","newOwner","readForwardPayloadCell","readComment","nftSuperCollectionsByCollectionAddress","rawNft","parseTonapiioNft","nftAddress","nftName","OwnershipAssigned","prevOwner","Burn","addressObj","isLiquidUnstakeRequest","LIQUID_JETTON","DistributedAsset","Withdrawal","appId","AddWhitelist","Withdraw","ChangeValidator","Vote","votingAddress","expirationDate","vote","loadBit","needConfirmation","ChangeRecord","_Object$entries$find","contract","DnsItem","collectionAddress","getNftData","resolver","isTelemint","getTelemintDomain","getDomain","getDnsItemDomain","dataSlice","endParse","dataAddress","flags","record","Unknown","TokenBridgePaySwap","swapId","UnstakeRequest","isForce","loadBoolean","DEBUG","_opCode","debugTxString","opCodeHex","parsePayloadSlice","buildMtwCardsNftMetadata","metadata","attributes","mtwCardType","mtwCardTextType","_attributes$find","_attributes$find2","_attributes$find3","imageUrl","mtwCardId","attribute","trait_type","trim","mtwCardBorderShineType","rawMetadata","previews","sale","trust","owner","render_type","renderType","lottie","hasScamLink","isWhitelisted","isScam","isHidden","imageFromPreview","resolution","isFragmentGift","getIsFragmentGift","getProxiedLottieUrl","MTW_CARDS_COLLECTION","fragmentUrl","NFT_FRAGMENT_GIFT_IMAGE_TO_URL_REGEX","ownerAddress","fixIpfsUrl","thumbnail","isOnSale","collectionName","isOnFragment","NFT_FRAGMENT_COLLECTIONS","isTelegramGift","_nftSuperCollectionsB","TELEGRAM_GIFTS_SUPER_COLLECTION","areDeepEqual","value1","value2","type1","isArray1","every","member1","object1","object2","keys1","keys2","key1","key2","getDappConnectionUniqueId","_sseOptions","_sse","sseOptions","appClientId","sse","migrationEnsurePromise","currentOnUpdate","updateActivityMetadata","normalizedAddress","isIncoming","isNftTransfer","hasScamMarkers","sm","hasScamInComment","RE_TG_BOT_MENTION","isUpdaterAlive","buildOldAccountId","iosBackupAndMigrateKeychainMode","backupKey","assert","backupValue","shouldRewrite","RAW_LIQUID_POOL_ADDRESS","TME_RENEW_HASH_SUFFIX","RAW_NFT_COLLECTIONS_TO_RELOAD_METADATA","fetchActions","limit","toTimestamp","fromTimestamp","shouldIncludeFrom","shouldIncludeTo","includeTypes","excludeTypes","action_id","actionId","start_utime","end_utime","sort","action_type","exclude_action_type","actions","rawActions","parseActions","activities","action","parseAction","parseTonTransfer","parseCallContract","parseContractDeploy","parseNftTransfer","parseNftMint","parseJettonTransfer","parseJettonMint","parseJettonBurn","parseStakeDeposit","parseStakeWithdrawal","parseStakeWithdrawalRequest","parseJettonSwap","parseDns","parseAuctionBid","parseLiquidityDeposit","source","dex","partialExtended","parseCommonFields","shouldLoadDetails","extra","convertDexId","additionalId","buildActionActivityId","amount_1","getAssetSlug","asset_1","amount_2","asset_2","parseLiquidityWithdraw","_activity$nft","shouldHide","isEncrypted","common","opcode","OurFee","Bounced","ClaimRewards","fee","is_encrypted_comment","forward_payload","sender","receiver","fromAddress","asset","BURN_ADDRESS","MYCOIN_STAKING_POOL","TON_USDE","ETHENA_STAKING_VAULT","receiver_jetton_wallet","jettonWalletRaw","commonFields","TON_TSUSDE","end_lt","trace_end_lt","owner_jetton_wallet","jettonWallet","nft_item_index","nft_item","rawNftAddress","nft_collection","rawCollectionAddress","new_owner","old_owner","oldOwner","is_purchase","isPurchase","response_destination","marketplace","isMetadataMissing","parseToncenterNft","_metadata$rawCollecti","_collectionMetadata$n","collectionMetadata","token_info","isHiddenCollection","_addressBook$oldOwner","_addressBook$newOwner","oldOwnerAddress","newOwnerAddress","payloadBase64","safeExec","fromBase64","isExotic","shouldReload","_addressBook$newOwner2","isBuying","stake_holder","holder","LIQUID_POOL","provider","payout_nft","_parseToncenterJetton","_parseToncenterJetton2","endUtime","success","isSuccess","dex_incoming_transfer","fromAmount","fromAsset","dex_outgoing_transfer","toAmount","toAsset","decimalsFrom","parseToncenterJetton","decimalsTo","fromTokenAddress","toTokenAddress","STON_PTON_ADDRESS","networkFee","swapFee","ourFee","hashes","externalMsgHashNorm","trace_external_hash_norm","trace_external_hash","sum_type","sumType","bidder","auction","destination_liquidity","destinationAddress","rawFromAddress","rawToAddress","amountString","metadataMap","nftMetadata","extractMetadata","domainZone","domainBase","DNS_IMAGE_GEN_URL","_image_medium","isMtwCard","fixedImage","jettonMetadata","_data$token_info","is_indexed","tokenInfo","start_lt","trace_id","parseActionActivityId","traceId","startLt","toncenterDex","createCallbackManager","callbacks","removeCallback","runCallbacks","addCallback","hasCallbacks","focusListeners","isFocused","onFocusAwareDelay","forceMs","cleanup","callCb","setCancellableTimeout","unsubscribeFocus","cancelSecondTimeout","focusAwareDelay","msWhenNotFocused","setIsAppFocused","_isFocused","SEC","MINUTE","DAYS_IN_YEAR","FIRST_TRANSACTIONS_LIMIT","FAKE_TX_ID","activeWalletTiming","updateOnStart","minUpdateDelay","focused","notFocused","fallbackUpdateStartDelay","fallbackUpdatePeriod","forceUpdatePeriod","inactiveWalletTiming","pollingLoop","cancelPause","minDelay","skipInitialPoll","prepare","poll","isStopped","dependenciesDeferred","iteration","_cancelPause","dependencies","scheduleIteration","periodToMs","_cancelPause2","then","stop","_cancelPause3","withDoubleCheck","pauses","cancelDoubleCheck","makeAttempt","attemptNumber","_cancelDoubleCheck","_cancelDoubleCheck2","run","cancel","_cancelDoubleCheck3","FallbackPollingScheduler","isSocketConnected","pollOnStart","onSocketConnect","onSocketDisconnect","onSocketMessage","_this$cancelScheduled","minPollDelay","_this$cancelScheduled2","pollingStartDelay","pollingPeriod","handleTimeout","_this$cancelScheduled3","schedule","forcedPollingPeriod","ReconnectingWebSocket","send","isConnected","reconnect","close","onConnect","onDisconnect","WebSocket","binaryType","onerror","onopen","onclose","onmessage","_this$cancelTimeout","#handleSocketOpen","_this$cancelTimeout2","logDebug","event","code","wasClean","reconnectDelay","ArrayBuffer","PING_INTERVAL","PONG_TIMEOUT","toncenterSockets","ToncenterSocket","watchWallets","onNewActivities","watcher","watcherId","findIndex","splice","_this$socket","pathname","getSocketUrl","socket","_this$cancelReconnect","#handleSocketConnect","_this$socket2","operation","include_address_book","include_metadata","#handleSocketDisconnect","_this$stopPing","forbidConcurrency","arePending","messageHashNormalized","activitiesByAddress","addressWhitelist","actionsByAddress","byAddress","_addressBook$rawAddre","groupActionsByAddress","parseSocketActions","addressesToNotify","isWatcherReadyForNewActivities","requestId","oldAddresses","newAddresses","deletedAddresses","addedAddresses","types","isOnlyReadyForNewActivities","watchedAddresses","_this$stopPing2","pingIntervalId","setInterval","_this$socket3","_this$cancelReconnect2","_this$socket4","clearInterval","newActionAddresses","areNewActionsPending","prevSavedAddresses","nextSavedAddresses","isActivityUpdateFinal","throttleToncenterSocketActions","delayMs","onUpdates","updatesByHash","scheduleReport","cancelReport","toReport","_updatesByHash$hash","_updatesByHash$hash$c","MIN_POLL_DELAY","POLLING_START_DELAY","POLLING_PERIOD","FORCED_POLLING_PERIOD","ActivityStream","pendingActivities","finishedHashes","rememberFinishedHashes","messageHashNorms","releaseFinishedHashesMemory","confirmedActivities","allPendingActivities","pendingUpdates","currentPendingActivities","socketUpdates","hashesToRemove","flatMap","mergePendingActivities","managePendingActivities","newestConfirmedActivityTimestamp","getToncenterSocket","onLoadingChange","updates","instantConfirmedActivities","stashedConfirmedActivities","newConfirmedActivities","loadPendingActivities","polledActivities","socketActivities","_polledActivities$","newestPolledActivityTimestamp","mergedActivities","margeConfirmedActivitiesOnSocketConnect","fetchPendingActions","fetchTransactions","transactions","rawTransactions","rawTx","parseRawTransaction","flat","total_fees","totalFees","compute_ph","exitCode","in_msg","out_msgs","inMsgHash","msgs","oneMsgFee","msg","fwd_fee","fwdFee","msgHash","bounced","externalMsgHash","resolveAddress","skipFormatSelection","resolvedAddress","zoneMatch","_err$message","resolveAddressByDomain","chunks","chunk","fetchAddressBook","normalizeAddress","known","isAddressInitialized","walletOrAddress","getWalletInfo","isActiveSmartContract","publicKeyToAddress","publicKey","walletVersion","buildWallet","WalletClass","create","workchain","getContractInfo","getAddressInfo","codeHashOld","contractInfo","info","codeHash","isWallet","getAccountBalance","getWalletBalance","getWalletSeqno","pickBestWallet","allWallets","getWalletVersionInfos","defaultWallet","DEFAULT_WALLET_VERSION","withBiggestBalance","best","current","withLastTx","predicate","cursor","findLast","_ref2","v4Wallet","_ref3","walletInfos","getWalletVersions","getWalletStateInit","storedWallet","getTonWallet","storeWritable","storeStateInit","pickWalletByAddress","w","tonWallet","generateMnemonic","tonWebMnemonic","validateMnemonic","privateKeyHexToKeyPair","privateKeyHex","nacl","keyPair","fromSeed","fetchPrivateKey","secretKey","privateKey","fetchKeyPair","console","bip39MnemonicToKeyPair","rawSign","dataHex","detached","getWalletFromBip39Mnemonic","getWalletFromKeys","getWalletFromMnemonic","getWalletFromPrivateKey","hexSeed","HDKey","getOtherVersionWallet","otherVersion","getWalletFromAddress","addressOrDomain","ApiAuthError","DomainNotResolved","InvalidAddress","walletInfo","title","getChainConfig","CHAIN_CONFIG","getDieselTokenAmount","diesel","nativeToken","getAesCbcState","aesjs","cbc","combineSecrets","hmacAlgo","hmacKey","signature","sign","hmacSha512","encryptMessageComment","myPublicKey","theirPublicKey","myPrivateKey","senderAddress","commentBytes","encryptedBytes","sharedSecret","getSharedSecret","prefix","dataLength","prefixLength","minPadding","getRandomPrefix","combined","msgKey","encryptDataWithPrefix","encryptDataImpl","prefixedEncrypted","encryptData","decryptMessageComment","decryptedBytes","cbcStateSecret","decryptedData","gotMsgKey","doDecrypt","decryptDataImpl","decryptData","DIESEL_URL","sendExternal","gaslessType","neededInit","isContractDeployed","ext","external","storeMessage","isW5Gasless","msgHashNormalized","dest","getExternalMsgHashNormalized","bodyMessageHash","boc","paymentLink","isAddition","dieselW5SendRequest","dieselSendBoc","sendFile","byId","waitAndCreatePendingTransfer","prevPending","pendingTransfer","getPendingTransfer","fetchAndParseTrace","isActionPending","trace","include_actions","traces","fetchTrace","parseTrace","traceDetail","byHash","groupKey","totalSent","totalReceived","totalNetworkFee","byTransactionIndex","isWalletTransactionFound","processTrace","_traceDetail","_index","tx_hash","txs","sent","received","child","children","in_msg_hash","GET_TRANSACTIONS_LIMIT","TRACE_ATTEMPT_COUNT","TRACE_RETRY_DELAY","checkHasTransaction","fetchActivitySlice","tokenSlug","fetchActivityDetails","attempt","pause","parsedTrace","calculateActivityDetails","actionHashes","elem","intersection","sentForFee","excess","asset_in","asset_out","realFee","ourFeeAction","_action","tokenIn","setSwapDetails","activitiesPerAction","setTransactionDetails","getActivityRealFee","emulateTransaction","transaction","externalMessage","buildExternalBoc","emulation","ignore_chksig","include_code_data","with_actions","fetchEmulateTrace","allActivities","walletActivities","totalRealFee","totalExcess","excessActivity","addExcessActivity","fallbackFee","parseFailedEmulation","parseEmulation","insertMintlessPayload","transfer","customPayloadApiUrl","parsedPayload","mintlessTokenBalance","isMintlessClaimed","stateInit","getMintlessParams","newPayload","isBase64Payload","buildTokenTransfer","shouldSkipMintless","isTokenWalletDeployed","toncoinAmount","realAmount","getToncoinAmountForTransfer","getTokenBalanceWithMintless","accountAddress","calculateTokenBalanceWithMintless","getJettonBalance","getTokenBalance","runMethod","readBoolean","checkMintlessTokenWalletIsClaimed","fetchMintlessTokenWalletData","isExpired","compressed_info","expired_at","getTime","custom_payload","state_init","fetchToken","buildTokenByMetadata","content","getJettonData","getJettonMinterData","contentUri","dict","loadDict","_dict$get","sha256Key","parseJettonOnchainMetadata","fetchJettonMetadata","image_data","imageData","willClaimMintless","TON_USDT_SLUG","isTiny","loadTokenBalances","tokenBalances","balanceRaw","jetton","wallet_address","parseTokenBalance","getTokenBalances","tokenSlugs","cachedTokens","tokensToFetch","option","toUpperCase","tokensByAddress","addressByRaw","getAccountStates","code_hash","updateTokenHashes","WAIT_TRANSFER_TIMEOUT","WAIT_PAUSE","MAX_BALANCE_WITH_CHECK_DIESEL","PENDING_DIESEL_TIMEOUT_SEC","DIESEL_NOT_AVAILABLE","nativeAmount","remainingFee","checkTransactionDraft","shouldEncrypt","isBase64Data","stateInitString","allowGasless","checkToAddress","ApiTransactionDraftError","StateInitWithoutBin","InvalidStateInit","isToAddressNew","InactiveContract","InvalidAmount","WalletNotInitialized","isWalletInitialized","toncoinBalance","tokenTransfer","realToncoinAmount","isFullTonTransfer","signTransaction","isFullBalance","applyFeeFactorToEmulationResult","emulateTransactionWithFallback","isEnoughBalance","canTransferGasfully","getDiesel","tokenBalance","InsufficientBalance","handleServerError","InvalidToAddress","addressName","isMemoRequired","isTestOnly","isUrlSafe","InvalidAddressFormat","submitTransfer","stringToPayload","ApiTransactionError","retrySendBoc","resolveTransactionError","submitTransferWithDiesel","dieselAmount","isGaslessWithStars","messages","DIESEL_ADDRESS","submitMultiTransfer","isGasless","withW5Gasless","parseBase64","toPublicKey","ApiServerError","IncorrectDeviceTime","statusCode","displayError","UnsuccesfulTransfer","expireAt","loadStateInit","sendMode","SendMode","CARRY_ALL_REMAINING_BALANCE","PAY_GAS_SEPARATELY","IGNORE_ERRORS","transferParams","internal","bounce","createTransfer","getAccountNewestActionId","fetchNewestActionId","checkMultiTransactionDraft","withDiesel","totalAmount","isMainnet","hasInsufficientTokenBalance","parsedPayloads","payloadParsingResults","tokenResult","payloadAsString","getPayloadFromTransfer","tokenAmountsByAddress","tokenAddresses","requiredAmount","isTokenBalanceInsufficient","signMultiTransaction","hasInsufficientTonBalance","_ref4","clearedMessages","_ref5","hasPayload","preparedMessages","authType","waitUntil","isFallback","source_fees","fees","estimateExternalMessageFee","initCode","initData","ignoreSignature","in_fwd_fee","storage_fee","gas_fee","sendSignedMessage","pendingTransferId","sendSignedMessages","attempts","firstBoc","msgHashesNormalized","_pendingTransfer","successNumber","decryptComment","fetchEstimateDiesel","_ref6","storedTonWallet","isGaslessEnabled","isStarsEnabled","isStars","DEFAULT_FEE","getDieselToncoinFee","toncoinNeeded","rawDiesel","isW5","estimateDiesel","canPayDiesel","isAwaitingNotExpiredPrevious","pendingCreatedAt","estimation","_ref7","getAccountNfts","rawNfts","getAccountNftItems","indirect_ownership","fetchAccountNfts","checkNftOwnership","getNftItemByAddress","fetchNftByAddress","getNftUpdates","fromSec","_events$","events","getAccountEvents","start_date","fetchAccountEvents","NftPurchase","NftItemTransfer","recipient","buyer","equals","checkNftTransferDraft","NFT_BATCH_SIZE","buildNftTransferMessage","checkResult","batchFee","calculateNftTransferFee","submitNftTransfers","NOTCOIN_VOUCHERS_ADDRESS","NOTCOIN_EXCHANGERS","buildNftTransferPayload","nftIndex","first4Bits","readUint8","NOTCOIN_FORWARD_TON_AMOUNT","buildNotcoinVoucherExchange","totalNftCount","estimatedBatchSize","estimatedBatchBlockchainFee","amountPerNft","remainingBatchSize","isTokenTransferPayload","getMaxMessagesInTransaction","checkDnsRenewalDraft","nftAddresses","maxMessages","transactionCount","makeRenewMessage","submitDnsRenewal","nftBatches","nftBatch","checkDnsChangeWalletDraft","makeChangeMessage","submitDnsChangeWallet","buildFillUpMessage","linkedAddress","buildChangeDnsWalletMessage","devSettings","NominatorPool","createFromConfig","config","contractAddress","getListNominators","readTuple","tupleItems","tuple","TupleReader","pendingDepositAmount","withdrawRequested","stakingCommonCache","stakingCommonCacheDeferred","accountCache","backendConfig","configDeferred","getAccountCache","updateAccountCache","getStakingCommonCache","getBackendConfigCache","clientId","getClientId","referrer","checkStakeDraft","stakePayload","checkUnstakeDraft","commonData","liquid","currentRate","buildLiquidStakingWithdraw","stakeWalletAddress","ethena","rate","submitStake","stakedAt","submitUnstake","mode","instantAvailable","Default","BestRate","localActivityParams","waitTillRoundEnd","fillOrKill","buildLiquidStakingWithdrawCustomPayload","buildLiquidStakingWithdrawBody","Instant","getStakingStates","backendState","loyaltyType","shouldUseNominators","backendType","promises","poolConfig","jettonPools","buildJettonState","_currentNominator","_currentNominator2","apy","nominatorsPool","isPrevRoundUnlocked","prevRound","unlock","currentNominator","nominators","addressObject","annualYield","yieldType","unstakeRequestAmount","buildNominatorsState","isDisabled","apyVerified","isVerified","tsUsdeWalletAddress","tsUsdeWallet","TsUSDeWallet","lockedBalance","unlockTime","getTimeLockData","annualYieldStandard","annualYieldVerified","unclaimedRewards","MIN_ACTIVE_STAKING_REWARDS","getIsActiveStakingState","buildEthenaState","buildLiquidState","_backendState$liquid","max","liquidAvailable","VALIDATION_PERIOD_MS","simulateLongUnstaking","available","currentRound","gracePeriod","UNSTAKE_TON_GRACE_PERIOD","getLiquidStakingTimeRange","liquidApy","loyaltyApy","tvl","rewardJettons","rewardsDeposits","dailyReward","startTime","endTime","distributionSpeed","apr","calcJettonStakingApr","periodConfig","periods","stakedTokenSlug","stakeWallet","walletData","getStorageData","poolWalletAddress","rewards","getAvailableRewards","jettonBalance","getBackendStakingState","stakingState","totalProfit","STAKING_POOLS","poolPart","isKnownStakingPool","fetchBackendStakingState","submitTokenStakingClaim","submitUnstakeEthenaLocked","transferTimelockedMessage","jettonAmount","forwardTonAmount","packPayloadToBoc","storeStringTail","checkApiAvailability","getMasterchainInfo","FEE_ADDRESSES","SWAP_FEE_ADDRESS","MAX_NETWORK_FEE","validateDexSwapTransfers","transfers","condition","originalAssert","mainTransfer","feeTransfer","maxAmount","dieselFee","maxTonAmount","feePayload","tokenFeeAmount","feeDestination","swapItemToActivity","swap","backendId","getSwapItemSlug","_getTokenByAddress","patchSwapItem","swapVersion","SWAP_API_VERSION","RELOAD_ACTIVITIES_ATTEMPTS","RELOAD_ACTIVITIES_PAUSE","FETCH_ACTIONS_BATCH_SIZE","enrichActivities","isToNow","actionIdsToReload","tryReloadIncompleteActivities","reloadIncompleteActivities","SWAP_CROSSCHAIN_SLUGS","canHaveCexSwap","firstTimestamp","lastTimestamp","fromTime","toTime","swaps","swapGetHistory","isCex","allSwapHashes","swapReplaceCexActivities","actionIdBatches","reloadedActivities","actionIds","replaceById","reloadedActionIds","BackendSocket","onNewActivity","isWebSocketEnabled","messageAddresses","backendSockets","WalletPolling","#handleSocketNewActivity","#triggerBackupNotifications","isConfident","txCallbacks","OrGate","onSwitch","isOn","on","toggle","off","isItemOn","prevIsOn","nextIsOn","RichActivityStream","zombiePendingActivities","updateAfterRawUpdate","newPendingActivities","confirmedHashes","updateAfterEnrichment","rawConfirmedActivities","isLoading","lastPendingActivities","deduplicateActivityUpdates","rawActivityStream","unsubscribe","#handleRawActivitiesUpdate","richConfirmedActivities","POLL_DELAY_AFTER_SOCKET","POLL_MIN_INTERVAL","BALANCE_INTERVAL","INITIALIZATION_INTERVAL","STAKING_INTERVAL","VERSIONS_INTERVAL","VESTING_INTERVAL","TON_DNS_INTERVAL","NFT_FULL_INTERVAL","DOUBLE_CHECK_NFT_PAUSE","MAX_ACTIVITY_LOAD_CONCURRENCY","inactiveUpdateConcurrencyLimiter","createTaskQueue","setupActivePolling","onUpdatingStatusChange","newestActivityTimestamps","balanceAndDomainPolling","balanceUpdater","makeBalanceAndDomainUpdater","getBalances","setupBalanceAndDomainPolling","stopActivityPolling","newestConfirmedActivityTimestamps","onRawActivity","richActivityStream","newestTimestamps","onRawActivities","onRichActivities","doesNeedInitial","concurrencyLimiter","newestActivityTimestamp","mainActivities","loadTokenActivity","wrap","allSettled","loadInitialConfirmedActivities","loadInitialActivities","_richActivityStream","_rawActivityStream","setupActivityPolling","nftPolling","walletInitializationPolling","nftFromSec","updatePartial","nftResult","logAndRescue","nftUpdates","fullPolling","setupNftPolling","walletUpdate","updatedWallet","updateStoredTonWallet","setupWalletInitializationPolling","stopWalletVersionPolling","lastResult","accountType","currentVersion","versions","publicKeyBytes","LEDGER_WALLET_VERSIONS","POPULAR_WALLET_VERSIONS","versionInfos","filteredVersions","setupWalletVersionsPolling","stopTonDnsPolling","expirationByAddress","linkedAddressByAddress","lastFillUpTime","fetchDomains","setupTonDnsPolling","stopStakingPolling","IS_STAKING_DISABLED","lastStates","setupStakingPolling","stopVestingPolling","IS_CORE_WALLET","lastVestingInfo","isVestingEnabled","isEnabled","vestingInfo","isTestnet","fetchVestings","setupVestingPolling","lastDomain","balancesDeferred","getTonBalanceAndCheckDomain","tonBalance","newBalances","hasChanged","setupInactivePolling","walletPolling","parametersByNetwork","chainConfig","getTronClient","TronWeb","fullHost","apiUrl","getChainParameters","chainParameters","trx","energyUnitFee","param","bandwidthUnitFee","getTokenTransactionSlice","TRX","queryParams","getTrxTransactions","min_timestamp","max_timestamp","search_internal","raw_data","txID","energy_fee","energyFee","net_fee","netFee","block_timestamp","parameters","parameter","fromHex","owner_address","to_address","receiver_address","contract_address","parseRawTrxTransaction","getTrc20Transactions","transaction_id","parseRawTrc20Transaction","getAllTransactionSlice","mainChunk","prevChunk","trxChunk","tokenChunks","mergeActivities","trxTxs","uniqueTxIds","trxTxById","tokenTxs","tokenTxList","tokenTx","trxTx","tronWeb","getUnconfirmedBalance","getTrc20Balance","functions","issuerAddress","transactionBuilder","triggerSmartContract","_isConstant","constant_result","callContract","balancePolling","setupBalancePolling","activityPolling","usdtAddress","usdtSlug","slugs","_activities$","_activities$2","loadNewActivities","isFirstUpdate","trxBalance","usdtBalance","TRON_GAS","transferTrc20Estimated","ONE_TRX","SIGNATURE_SIZE","isAddress","bandwidth","getBandwidth","energy_required","energyRequired","estimateEnergy","estimateTrc20TransferFee","sendTrx","getAccount","raw_data_hex","byteLength","fromMnemonic","feeLimit","buildTrc20Transfer","signedTx","sendRawTransaction","sendTransaction","hexToString","hooks","callHook","hook","getBaseCurrency","setBaseCurrency","currency","resolvePromise","preloadPromise","resolveDataPreloadPromise","waitDataPreload","chains","getAmountForTokenTransfer","initTransactions","_onUpdate","fetchAllActivitySlice","tronTokenSlugs","tonActivities","tronActivities","mergeActivitiesToMaxTime","shouldCreateLocalActivity","localActivity","createLocalTransactions","isExternal","waitAndCreateTonPendingTransfer","sendSignedTransferMessage","cancelPendingTransfer","_getPendingTransfer","localTransactions","subParams","restParams","buildLocalTransaction","fetchTonActivityDetails","createLocalActivitiesFromEmulation","emulationActivities","localActivities","localActivityIndex","localTxId","convertEmulationActivityToLocal","initStaking","getStakingHistory","tryUpdateStakingCommonData","poolContract","setStakingCommonCache","submitStakingClaimOrUnlock","SIGN_MESSAGE","getBackendAuthToken","accountWallet","fetchAccountConfigForDebugPurposesOnly","stateVersion","mnemonicsEncrypted","ping","updateAccountMemoryCache","getMoonpayOnrampUrl","theme","initSwap","swapBuildTransfer","swapBuild","transferList","shouldTryDiesel","errorToString","swapSubmit","historyItem","activityId","fetchSwaps","ids","results","swapGetHistoryItem","nonExistentIds","swapEstimate","isMsgHashMode","swapGetAssets","swapGetTonCurrencies","swapGetPairs","symbolOrTokenAddress","swapCexEstimate","swapCexValidateAddress","swapCexCreateTransaction","swapCexSubmit","transferOptions","BACKEND_INTERVAL","LONG_BACKEND_INTERVAL","INCORRECT_TIME_DIFF","ACCOUNT_CONFIG_INTERVAL","MAX_POST_TOKENS","stopCommonBackendPolling","stopActiveAccountPolling","inactiveAccountPolling","IS_AIR_APP","stopByAccount","activeAccountId","startAccountPolling","stopFns","stopChain","stopAllPollings","stopAccountPolling","preventRaceCondition","setActiveAccount","_stopByAccount$active","newActiveAccountId","otherAccountIds","switchNetwork","previousActiveAccountId","previousActiveAccount","addAccount","isActiveAccount","isCurrentNetwork","removeAccount","_stopByAccount$accoun","removeNetworkAccounts","removeAllAccounts","createInactiveAccountsPollingManager","setUpdatingStatus","updatingStatuses","isUpdating","chainsBeingUpdated","createUpdatingStatusManager","initPolling","_stopCommonBackendPol","loadTokensCache","tryUpdateTokens","tryUpdateSwapTokens","tryUpdateConfig","stopFn","setupCommonBackendPolling","nonBackendTokenAddresses","nonBackendTokenDetails","assets","_tokensCache$bySlug$a","blockchain","setBackendConfigCache","isLimited","isCopyStorageEnabled","supportAccountsCount","serverUtc","country","countryCode","isUpdateRequired","isAppUpdateRequired","localUtc","setActivePollingAccount","_stopActiveAccountPol","stopPollingFns","setupAccountConfigPolling","nativeSlug","newBySlug","pickChainTimestamps","partialAccount","accountConfig","initAccounts","activateAccount","isFirstLogin","deactivateAllAccounts","fetchTonWallet","fetchLedgerAccount","initDapps","getDapp","uniqueId","_await$getAccountValu","byUrl","addDapp","dapp","dapps","getDappsByUrl","deleteDapp","dontNotifyDapp","deleteAllDapps","urls","getDapps","getDappsState","removeAccountDapps","removeAllDapps","removeNetworkDapps","loadExploreSites","isLandscape","isBip39","createWallet","importMnemonic","IS_BIP39_MNEMONIC_ENABLED","isPrivateKey","isBip39Mnemonic","isTonMnemonic","tronWallet","secondNetworkAccount","createAccountWithSecondNetwork","secondNetwork","importLedgerWallet","driver","deviceId","deviceName","addAccountMutex","preferredId","getAccountIds","buildAccountId","getNewAccountId","addPollingAccount","removeNetworkPollingAccounts","resetAccounts","nextAccountId","removePollingAccount","changePassword","oldPassword","encryptedMnemonic","importViewAccount","resolvedAddresses","importNewWalletVersion","newAccount","existingAccount","_account$ton","isNew","ledger","deferreds","createDappPromise","promiseId","resolveDappPromise","fetchTonPrivateKey","fetchMnemonic","getMnemonicWordList","default","checkWorkerStorageIntegrity","verifyPassword","getAccountWithMnemonic","confirmDappRequest","dappPromises","confirmDappRequestConnect","cancelDappRequest","ApiUserRejectsError","fetchAddress","fetchNfts","realFeePerNft","nftByAddress","activityIds","CONNECT_EVENT_ERROR_CODES","SEND_TRANSACTION_ERROR_CODES","CHAIN","tonConnectGetDeviceInfo","features","getTonConnectMaxMessages","platform","getPlatform","appName","APP_NAME","appVersion","packageJson","maxProtocolVersion","TONCONNECT_PROTOCOL_VERSION","_navigator","userAgent","navigator","userAgentData","devicePlatform","IS_TELEGRAM_APP","TonConnectError","ApiBaseError","ManifestContentError","MANIFEST_CONTENT_ERROR","UnknownError","UNKNOWN_ERROR","BadRequestError","BAD_REQUEST_ERROR","UnknownAppError","UNKNOWN_APP_ERROR","MethodNotSupportedError","METHOD_NOT_SUPPORTED","crc32Table","makeCrc32Table","Uint32Array","signDataWithPrivateKey","schema","crc","crc32FromBytes","storeStringRefTail","hashBuffer","createCellDataHash","makeAddressBuffer","makeBytesWithLengthBuffer","makeTimestampBuffer","createTextDataHash","addressBuffer","writeInt32BE","workChain","copy","isBigEndian","writeInt32LE","unixSeconds","timestampBuffer","writeBigInt64BE","writeBigInt64LE","URL_MAX_LENGTH","isValidString","maxLength","isValidUrl","getTransferActualToAddress","isNftTransferPayload","isTransferPayloadDangerous","BLANK_GIF_DATA_URL","resolveInit","initPromise","initTonConnect","connect","openExtensionPopup","connectionType","isSse","dappMetadata","fetchDappMetadata","manifestUrl","addressItem","proofItem","proof","errors","getCurrentAccountOrFail","connectedAt","isUrlEnsured","identifier","permissions","promiseResult","deviceInfo","buildTonAddressReplyItem","proofReplyItem","messageBuffer","bufferToSign","signTonProofWithPrivateKey","buildTonProofReplyItem","signTonProof","device","formatConnectError","ensureRequestParams","updateDapp","disconnect","_checkResult$emulatio","txPayload","dappNetworkRaw","publicKeyHex","dappNetwork","MAINNET","validUntil","valid_until","isLedger","vestingAddress","ownerPublicKey","_info$contractInfo","checkIsHisVestingWallet","WrongAddress","WrongNetwork","checkTransactionMessages","transactionsForRequest","rawAmount","rawPayload","transferEmulation","isDangerous","displayedToAddress","prepareTransactionForRequest","signedTransfers","submitResult","PartialTransactionFailure","handleMethodError","errorMessage","apiErrors","USER_REJECTS_ERROR","Unexpected","signData","payloadToSign","performSignData","TESTNET","walletStateInit","idx","crc32","domainBuffer","lengthBytes","iconUrl","safeIconUrl","getCurrentAccountIdOrFail","lastAccountId","lastConnectedAccountId","connections","conn","findLastConnectedAccount","TTL_SEC","NONCE_SIZE","MAX_CONFIRM_DURATION","sseEventSource","delayedReturnParams","sseDapps","startSseConnection","isFromInAppBrowser","connectionOrigin","ret","shouldOpenUrl","connectRequest","decodeURIComponent","secretKeyArray","publicKeyArray","lastOutputId","tonConnect","MANIFEST_NOT_FOUND_ERROR","sendMessage","resetupSseConnection","lastEventId","dappsState","dappsByUrl","byUniqueId","_dapp$sse","clientIds","SSE_BRIDGE_URL","EventSource","openEventSource","encryptedMessage","sseDapp","fullBuffer","nonce","decrypted","jsonText","decryptMessage","setSseLastEventId","toId","topic","encryptMessage","sendRawMessage","fetchPriceHistory","subscribeNotifications","props","unsubscribeNotifications","connectUpdater","worker","createConnector","handleMessage","removeEventListener","WINDOW_PROVIDER_CHANNEL","methods","accountIds","currentStorage","words","isTonProxyEnabled","isTonMagicEnabled","settings","secondAccountId","secondAddress","newAccountById","migrateCoreWallet","idbVersion","idbStorage","idbData","MAIN_ACCOUNT_ID","field","raw","oldItem","newItem","prevValue","newValue","accountDapps","byAccountId","internalAccountId","accountData","parsed","mainnetAccountId","testnetAccountId","publicKeys","oldAddress","newAddress","_dapp$sse2","isIosKeychainModeMigrated","isIosApp","oldAccountById","mnemonicById","oldAccount","migrations","oldState","newState","activeAccountIds","migrateStorage","_currentOnUpdate","startStorageMigration","tonConnectSse","saveReferrer","addHooks","onDappDisconnected","d","onDappsChanged","api","sendToOrigin","transferables","_e$error","_e$error2","_e$reason","_e$reason2","handleErrors","_e$data","_api$init","lastArg","ImageBitmap","arrayBuffer","createPostMessageInterface","tonConnectApi","WeakMap","fnCache","cacheKey","cached","process","DEBUG_MORE","env","IS_OPERA_EXTENSION","PROXY_API_BASE_URL","IPFS_GATEWAY_BASE_URL","cmcSlug","MYCOIN","minterAddress","isMemoSupported","isDnsSupported","addressRegex","addressPrefixRegex","TRC20_USDT_MAINNET_SLUG","TRC20_USDT_TESTNET_SLUG","TRC20_USDT","TON_USDT","COMMON_TOKEN","toncoin","DEFAULT_RETRIES","DEFAULT_ERROR_PAUSE","ALL_TON_DNS_ZONES","isUnofficial","setTimeout","shouldRunFirst","isRunning","scheduleFn","runFn","localArgs","_len2","_args","_key2","timeoutId","clearTimeout","maxConcurrency","queue","concurrency","task","runTasks","_len4","_key4","ServerError","MAX_TIMEOUT","encodeURIComponent","getProxiedJsonUrl","urlObject","isNotTemporaryError","fetchWithTimeout","controller","AbortController","abort","signal","ignoreHttpCodes","ok","_errors$","SAFE_EXEC_ENABLED","rescue","always","shouldIgnoreError","exports","nodeCrypto","freeze","__proto__","_0n","_1n","_2n","_8n","CU_O","CURVE","h","Gx","Gy","POW_2_256","SQRT_M1","SQRT_AD_MINUS_ONE","INVSQRT_A_MINUS_D","ONE_MINUS_D_SQ","D_MINUS_ONE_SQ","ExtendedPoint","z","fromAffine","Point","ZERO","toAffineBatch","points","toInv","nums","tmp","inverted","invert","reduceRight","invertBatch","toAffine","normalizeZ","other","assertExtPoint","X1","Y1","Z1","X2","Y2","Z2","X1Z2","X2Z1","Y1Z2","Y2Z1","negate","double","A","B","C","D","x1y1","E","G","F","H","X3","Y3","T3","Z3","T1","T2","subtract","precomputeWindow","W","windows","wNAF","affinePoint","BASE","_WINDOW_SIZE","precomputes","pointPrecomputes","f","windowSize","mask","maxNumber","shiftBy","wbits","offset1","offset2","cond1","cond2","constTimeNegate","multiply","scalar","normalizeScalar","multiplyUnsafe","P0","isSmallOrder","isTorsionFree","invZ","is0","ax","ay","zz","fromRistrettoBytes","legacyRist","toRistrettoBytes","fromRistrettoHash","assertRstPoint","RistrettoPoint","ep","calcElligatorRistrettoMap","r0","Ns","Ns_D_is_sq","uvRatio","s_","edIsNegative","Nt","s2","W0","W1","W2","W3","hashToCurve","r1","bytes255ToNumberLE","ensureBytes","R1","r2","R2","emsg","b1","b2","equalBytes","numberTo32BytesLE","u1","u2","u1_2","u2_2","invertSqrt","Dx","Dy","toRawBytes","u2sq","invsqrt","D1","D2","zInv","_x","_y","toHex","two","_setWindowSize","normed","bytesToNumberLE","y2","u","isXOdd","fromPrivateKey","getExtendedPublicKey","point","toX25519","Signature","assertValidity","u8","concatBytes","arrays","pad","hexes","uint8a","hexByte","numberTo32BytesBE","MAX_255B","number","modulo","m","pow2","power","pow_2_252_3","_5n","_10n","_20n","_40n","_80n","b4","b5","b10","b20","b40","b80","b160","b240","b250","pow_p_5_8","v3","v7","vx2","root1","root2","useRoot1","useRoot2","noRoot","modlLE","expectedLength","isSafeInteger","adjustBytes25519","checkPrivateKey","getKeyFromHash","hashed","head","pointBytes","_sha512Sync","sha512s","utils","sha512","getExtendedPublicKeySync","prepareVerification","sig","SB","pub","finishVerification","kA","sync","getPublicKey","R","verify","cswap","x_2","x_3","dummy","curve25519","BASE_POINT_U","scalarMult","pu","pointU","a24","x_1","sw","z_2","z_3","k_t","AA","BB","DA","CB","dacb","da_cb","xp2","montgomeryLadder","uEnc","decodeUCoordinate","scalarMultBase","node","web","TORSION_SUBGROUP","hashToPrivateScalar","bytesLength","randomPrivateKey","createHash","precompute","sha512Sync","defineProperties","configurable","defineProperty","factory","MAX_LOG_LENGTH","logs","errorReplacer","_","AssertionError","addLog","log","arg","time","getLogs","level","GET_STATIC_DATA","REPORT_STATIC_DATA","GET_STORAGE_DATA","REPORT_STORAGE_DATA","EXCESSES","TRANSFER_JETTON","INTERNAL_TRANSFER","TRANSFER_NOTIFICATION","PROVIDE_WALLET_ADDRESS","TAKE_WALLET_ADDRESS","BURN_JETTON","ADD_REWARDS","SEND_CLAIMED_REWARDS","SEND_UNSTAKED_JETTONS","APPROVE_STAKE","CANCEL_STAKE","ADD_REWARD_JETTONS","CLAIM_COMMISSIONS","REQUEST_UPDATE_REWARDS","RECEIVE_JETTONS","UNSTAKE_REQUEST","CANCEL_UNSTAKE_REQUEST","UPDATE_REWARDS","CONFIRM_TRANSFER","DEPLOY_NEW_POOL","SEND_COMMISSIONS","SET_CODE","CHANGE_CREATION_FEE","CHANGE_CONTENT","UPDATE_CODES","MIN_RESERVE","DEPLOY_POOL","NOTIFICATION","BURN_JETTONS","CANCEL_UNSTAKE","APPROVE_TRANSFER","SAVE_UPDATED_REWARDS","MIN_EXCESS","SEND_STAKED_JETTONS","Dividers","COMMISSION_DIVIDER","REWARDS_DIVIDER","DISTRIBUTION_SPEED_DIVIDER","DISTRIBUTED_REWARDS_DIVIDER","checkInt","checkInts","arrayish","coerceArray","createArray","copyArray","sourceArray","targetArray","targetStart","sourceStart","sourceEnd","Hex","convertUtf8","toBytes","encodeURI","substr","fromBytes","convertHex","numberOfRounds","rcon","S","Si","T4","T5","T6","T7","T8","U1","U2","U3","U4","convertToInt32","AES","_prepare","rounds","_Ke","_Kd","roundKeyCount","KC","tk","tt","rconpointer","ciphertext","ModeOfOperationECB","_aes","block","ModeOfOperationCBC","_lastCipherblock","ModeOfOperationCFB","segmentSize","_shiftRegister","xorSegment","ModeOfOperationOFB","_lastPrecipher","_lastPrecipherIndex","Counter","initialValue","_counter","setValue","setBytes","MAX_SAFE_INTEGER","increment","ModeOfOperationCTR","counter","_remainingCounter","_remainingCounterIndex","ModeOfOperation","ecb","cfb","ofb","ctr","utf8","padding","pkcs7","padder","strip","_arrayTest","module","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","__webpack_exports__","O","chunkIds","priority","notFulfilled","Infinity","fulfilled","getter","__esModule","definition","o","enumerable","chunkId","miniCssF","g","globalThis","Function","prop","toStringTag","scriptUrl","importScripts","document","currentScript","tagName","src","scripts","getElementsByTagName","installedChunks","chunkLoadingGlobal","parentChunkLoadingFunction","moreModules","runtime"],"sourceRoot":""}